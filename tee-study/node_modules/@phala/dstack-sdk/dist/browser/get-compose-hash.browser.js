// SPDX-FileCopyrightText: Â© 2025 Phala Network <dstack@phala.network>
//
// SPDX-License-Identifier: Apache-2.0
import crypto from 'crypto';
/**
 * Recursively sorts object keys lexicographically.
 * @param obj - The object to sort
 * @returns A new object with sorted keys
 */
function sortObjectKeys(obj) {
    if (obj === null || obj === undefined)
        return obj;
    if (typeof obj !== 'object')
        return obj;
    if (Array.isArray(obj))
        return obj.map(sortObjectKeys);
    const sortedObj = {};
    Object.keys(obj).sort().forEach(key => {
        sortedObj[key] = sortObjectKeys(obj[key]);
    });
    return sortedObj;
}
/**
 * Browser-compatible SHA-256 hash using crypto-browserify
 * @param data - Data to hash
 * @returns Promise resolving to hex-encoded hash
 */
async function sha256Hash(data) {
    const hash = crypto.createHash('sha256');
    hash.update(data, 'utf8');
    return hash.digest('hex');
}
/**
 * Get the hash of a docker-compose configuration
 * @param compose - The docker-compose configuration object
 * @returns Promise resolving to hex-encoded hash
 */
export async function getComposeHash(compose) {
    // Sort the object keys to ensure deterministic hashing
    const sortedCompose = sortObjectKeys(compose);
    // Convert to JSON string with no extra whitespace
    const jsonString = JSON.stringify(sortedCompose);
    // Return SHA-256 hash
    return sha256Hash(jsonString);
}
//# sourceMappingURL=get-compose-hash.browser.js.map