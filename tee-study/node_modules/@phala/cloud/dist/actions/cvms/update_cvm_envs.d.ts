import { z } from "zod";
import { type Client } from "../../client";
/**
 * Update CVM environment variables
 *
 * Updates environment variables for a CVM. Supports two scenarios:
 * 1. Encrypted environment only: Direct update without compose hash verification
 * 2. Allowed environment keys change: Requires compose hash verification (two-phase)
 *
 * When allowed_envs changes and compose_hash/transaction_hash are not provided,
 * the API returns HTTP 428 (Precondition Required) with the compose hash to sign.
 * The client should then register the compose hash on-chain and retry the request
 * with both compose_hash and transaction_hash.
 *
 * @example
 * ```typescript
 * import { createClient, updateCvmEnvs } from '@phala/cloud'
 *
 * const client = createClient({ apiKey: 'your-api-key' })
 *
 * // Phase 1: Initial update (may return precondition_required)
 * const result = await updateCvmEnvs(client, {
 *   id: 'cvm-123',
 *   encrypted_env: 'hex-encoded-encrypted-data',
 *   env_keys: ['API_KEY', 'DATABASE_URL']
 * })
 *
 * if (result.status === 'precondition_required') {
 *   // Register compose hash on-chain and get transaction hash
 *   const txHash = await registerComposeHashOnChain(
 *     result.compose_hash,
 *     result.kms_info
 *   )
 *
 *   // Phase 2: Retry with compose hash and transaction hash
 *   const finalResult = await updateCvmEnvs(client, {
 *     id: 'cvm-123',
 *     encrypted_env: 'hex-encoded-encrypted-data',
 *     env_keys: ['API_KEY', 'DATABASE_URL'],
 *     compose_hash: result.compose_hash,
 *     transaction_hash: txHash
 *   })
 *
 *   if (finalResult.status === 'in_progress') {
 *     console.log(`Update started: ${finalResult.correlation_id}`)
 *   }
 * }
 * ```
 *
 * ## Returns
 *
 * `UpdateCvmEnvsResult | unknown`
 *
 * Returns either:
 * - `{ status: "in_progress", ... }` - Update initiated successfully
 * - `{ status: "precondition_required", compose_hash: "...", ... }` - Compose hash verification required
 *
 * Return type depends on schema parameter.
 *
 * ## Parameters
 *
 * ### request (required)
 * - **Type:** `UpdateCvmEnvsRequest`
 *
 * Request parameters containing CVM ID, encrypted environment, and optional env_keys/compose_hash.
 *
 * ### parameters (optional)
 * - **Type:** `UpdateCvmEnvsParameters`
 *
 * Optional behavior parameters for schema validation.
 *
 * ```typescript
 * // Use default schema
 * const result = await updateCvmEnvs(client, {
 *   id: 'cvm-123',
 *   encrypted_env: 'hex-data'
 * })
 *
 * // Return raw data without validation
 * const raw = await updateCvmEnvs(client, request, { schema: false })
 *
 * // Use custom schema
 * const customSchema = z.object({ status: z.string() })
 * const custom = await updateCvmEnvs(client, request, { schema: customSchema })
 * ```
 *
 * ## Safe Version
 *
 * Use `safeUpdateCvmEnvs` for error handling without exceptions:
 *
 * ```typescript
 * import { safeUpdateCvmEnvs } from '@phala/cloud'
 *
 * const result = await safeUpdateCvmEnvs(client, {
 *   id: 'cvm-123',
 *   encrypted_env: 'hex-data',
 *   env_keys: ['API_KEY']
 * })
 *
 * if (result.success) {
 *   if (result.data.status === 'precondition_required') {
 *     console.log(`Compose hash: ${result.data.compose_hash}`)
 *     console.log(`App ID: ${result.data.app_id}`)
 *     // Register on-chain and retry with transaction_hash
 *   } else {
 *     console.log(`Update started: ${result.data.correlation_id}`)
 *   }
 * } else {
 *   if ("isRequestError" in result.error) {
 *     console.error(`HTTP ${result.error.status}: ${result.error.message}`)
 *   } else {
 *     console.error(`Validation error: ${result.error.issues}`)
 *   }
 * }
 * ```
 */
export declare const UpdateCvmEnvsRequestSchema: z.ZodEffects<z.ZodEffects<z.ZodObject<{
    id: z.ZodOptional<z.ZodString>;
    uuid: z.ZodOptional<z.ZodString>;
    app_id: z.ZodOptional<z.ZodEffects<z.ZodEffects<z.ZodString, string, string>, string, string>>;
    instance_id: z.ZodOptional<z.ZodEffects<z.ZodEffects<z.ZodString, string, string>, string, string>>;
    encrypted_env: z.ZodString;
    env_keys: z.ZodOptional<z.ZodArray<z.ZodString, "many">>;
    compose_hash: z.ZodOptional<z.ZodString>;
    transaction_hash: z.ZodOptional<z.ZodString>;
}, "strip", z.ZodTypeAny, {
    encrypted_env: string;
    id?: string | undefined;
    app_id?: string | undefined;
    instance_id?: string | undefined;
    uuid?: string | undefined;
    compose_hash?: string | undefined;
    env_keys?: string[] | undefined;
    transaction_hash?: string | undefined;
}, {
    encrypted_env: string;
    id?: string | undefined;
    app_id?: string | undefined;
    instance_id?: string | undefined;
    uuid?: string | undefined;
    compose_hash?: string | undefined;
    env_keys?: string[] | undefined;
    transaction_hash?: string | undefined;
}>, {
    encrypted_env: string;
    id?: string | undefined;
    app_id?: string | undefined;
    instance_id?: string | undefined;
    uuid?: string | undefined;
    compose_hash?: string | undefined;
    env_keys?: string[] | undefined;
    transaction_hash?: string | undefined;
}, {
    encrypted_env: string;
    id?: string | undefined;
    app_id?: string | undefined;
    instance_id?: string | undefined;
    uuid?: string | undefined;
    compose_hash?: string | undefined;
    env_keys?: string[] | undefined;
    transaction_hash?: string | undefined;
}>, {
    cvmId: string | undefined;
    request: {
        encrypted_env: string;
        env_keys: string[] | undefined;
        compose_hash: string | undefined;
        transaction_hash: string | undefined;
    };
    _raw: {
        encrypted_env: string;
        id?: string | undefined;
        app_id?: string | undefined;
        instance_id?: string | undefined;
        uuid?: string | undefined;
        compose_hash?: string | undefined;
        env_keys?: string[] | undefined;
        transaction_hash?: string | undefined;
    };
}, {
    encrypted_env: string;
    id?: string | undefined;
    app_id?: string | undefined;
    instance_id?: string | undefined;
    uuid?: string | undefined;
    compose_hash?: string | undefined;
    env_keys?: string[] | undefined;
    transaction_hash?: string | undefined;
}>;
declare const UpdateCvmEnvsInProgressSchema: z.ZodObject<{
    status: z.ZodLiteral<"in_progress">;
    message: z.ZodString;
    correlation_id: z.ZodString;
    allowed_envs_changed: z.ZodBoolean;
}, "strip", z.ZodTypeAny, {
    status: "in_progress";
    message: string;
    correlation_id: string;
    allowed_envs_changed: boolean;
}, {
    status: "in_progress";
    message: string;
    correlation_id: string;
    allowed_envs_changed: boolean;
}>;
declare const UpdateCvmEnvsPreconditionRequiredSchema: z.ZodObject<{
    status: z.ZodLiteral<"precondition_required">;
    message: z.ZodString;
    compose_hash: z.ZodString;
    app_id: z.ZodString;
    device_id: z.ZodString;
    kms_info: z.ZodEffects<z.ZodObject<{
        id: z.ZodString;
        slug: z.ZodNullable<z.ZodString>;
        url: z.ZodString;
        version: z.ZodString;
        chain_id: z.ZodNullable<z.ZodNumber>;
        kms_contract_address: z.ZodEffects<z.ZodNullable<z.ZodString>, `0x${string}`, string | null>;
        gateway_app_id: z.ZodEffects<z.ZodNullable<z.ZodString>, `0x${string}`, string | null>;
    }, "passthrough", z.ZodTypeAny, z.objectOutputType<{
        id: z.ZodString;
        slug: z.ZodNullable<z.ZodString>;
        url: z.ZodString;
        version: z.ZodString;
        chain_id: z.ZodNullable<z.ZodNumber>;
        kms_contract_address: z.ZodEffects<z.ZodNullable<z.ZodString>, `0x${string}`, string | null>;
        gateway_app_id: z.ZodEffects<z.ZodNullable<z.ZodString>, `0x${string}`, string | null>;
    }, z.ZodTypeAny, "passthrough">, z.objectInputType<{
        id: z.ZodString;
        slug: z.ZodNullable<z.ZodString>;
        url: z.ZodString;
        version: z.ZodString;
        chain_id: z.ZodNullable<z.ZodNumber>;
        kms_contract_address: z.ZodEffects<z.ZodNullable<z.ZodString>, `0x${string}`, string | null>;
        gateway_app_id: z.ZodEffects<z.ZodNullable<z.ZodString>, `0x${string}`, string | null>;
    }, z.ZodTypeAny, "passthrough">>, z.objectOutputType<{
        id: z.ZodString;
        slug: z.ZodNullable<z.ZodString>;
        url: z.ZodString;
        version: z.ZodString;
        chain_id: z.ZodNullable<z.ZodNumber>;
        kms_contract_address: z.ZodEffects<z.ZodNullable<z.ZodString>, `0x${string}`, string | null>;
        gateway_app_id: z.ZodEffects<z.ZodNullable<z.ZodString>, `0x${string}`, string | null>;
    }, z.ZodTypeAny, "passthrough">, z.objectInputType<{
        id: z.ZodString;
        slug: z.ZodNullable<z.ZodString>;
        url: z.ZodString;
        version: z.ZodString;
        chain_id: z.ZodNullable<z.ZodNumber>;
        kms_contract_address: z.ZodEffects<z.ZodNullable<z.ZodString>, `0x${string}`, string | null>;
        gateway_app_id: z.ZodEffects<z.ZodNullable<z.ZodString>, `0x${string}`, string | null>;
    }, z.ZodTypeAny, "passthrough">>;
}, "strip", z.ZodTypeAny, {
    status: "precondition_required";
    message: string;
    device_id: string;
    app_id: string;
    kms_info: {
        version: string;
        id: string;
        slug: string | null;
        url: string;
        chain_id: number | null;
        kms_contract_address: `0x${string}`;
        gateway_app_id: `0x${string}`;
    } & {
        [k: string]: unknown;
    };
    compose_hash: string;
}, {
    status: "precondition_required";
    message: string;
    device_id: string;
    app_id: string;
    kms_info: {
        version: string;
        id: string;
        slug: string | null;
        url: string;
        chain_id: number | null;
        kms_contract_address: string | null;
        gateway_app_id: string | null;
    } & {
        [k: string]: unknown;
    };
    compose_hash: string;
}>;
export declare const UpdateCvmEnvsResultSchema: z.ZodUnion<[z.ZodObject<{
    status: z.ZodLiteral<"in_progress">;
    message: z.ZodString;
    correlation_id: z.ZodString;
    allowed_envs_changed: z.ZodBoolean;
}, "strip", z.ZodTypeAny, {
    status: "in_progress";
    message: string;
    correlation_id: string;
    allowed_envs_changed: boolean;
}, {
    status: "in_progress";
    message: string;
    correlation_id: string;
    allowed_envs_changed: boolean;
}>, z.ZodObject<{
    status: z.ZodLiteral<"precondition_required">;
    message: z.ZodString;
    compose_hash: z.ZodString;
    app_id: z.ZodString;
    device_id: z.ZodString;
    kms_info: z.ZodEffects<z.ZodObject<{
        id: z.ZodString;
        slug: z.ZodNullable<z.ZodString>;
        url: z.ZodString;
        version: z.ZodString;
        chain_id: z.ZodNullable<z.ZodNumber>;
        kms_contract_address: z.ZodEffects<z.ZodNullable<z.ZodString>, `0x${string}`, string | null>;
        gateway_app_id: z.ZodEffects<z.ZodNullable<z.ZodString>, `0x${string}`, string | null>;
    }, "passthrough", z.ZodTypeAny, z.objectOutputType<{
        id: z.ZodString;
        slug: z.ZodNullable<z.ZodString>;
        url: z.ZodString;
        version: z.ZodString;
        chain_id: z.ZodNullable<z.ZodNumber>;
        kms_contract_address: z.ZodEffects<z.ZodNullable<z.ZodString>, `0x${string}`, string | null>;
        gateway_app_id: z.ZodEffects<z.ZodNullable<z.ZodString>, `0x${string}`, string | null>;
    }, z.ZodTypeAny, "passthrough">, z.objectInputType<{
        id: z.ZodString;
        slug: z.ZodNullable<z.ZodString>;
        url: z.ZodString;
        version: z.ZodString;
        chain_id: z.ZodNullable<z.ZodNumber>;
        kms_contract_address: z.ZodEffects<z.ZodNullable<z.ZodString>, `0x${string}`, string | null>;
        gateway_app_id: z.ZodEffects<z.ZodNullable<z.ZodString>, `0x${string}`, string | null>;
    }, z.ZodTypeAny, "passthrough">>, z.objectOutputType<{
        id: z.ZodString;
        slug: z.ZodNullable<z.ZodString>;
        url: z.ZodString;
        version: z.ZodString;
        chain_id: z.ZodNullable<z.ZodNumber>;
        kms_contract_address: z.ZodEffects<z.ZodNullable<z.ZodString>, `0x${string}`, string | null>;
        gateway_app_id: z.ZodEffects<z.ZodNullable<z.ZodString>, `0x${string}`, string | null>;
    }, z.ZodTypeAny, "passthrough">, z.objectInputType<{
        id: z.ZodString;
        slug: z.ZodNullable<z.ZodString>;
        url: z.ZodString;
        version: z.ZodString;
        chain_id: z.ZodNullable<z.ZodNumber>;
        kms_contract_address: z.ZodEffects<z.ZodNullable<z.ZodString>, `0x${string}`, string | null>;
        gateway_app_id: z.ZodEffects<z.ZodNullable<z.ZodString>, `0x${string}`, string | null>;
    }, z.ZodTypeAny, "passthrough">>;
}, "strip", z.ZodTypeAny, {
    status: "precondition_required";
    message: string;
    device_id: string;
    app_id: string;
    kms_info: {
        version: string;
        id: string;
        slug: string | null;
        url: string;
        chain_id: number | null;
        kms_contract_address: `0x${string}`;
        gateway_app_id: `0x${string}`;
    } & {
        [k: string]: unknown;
    };
    compose_hash: string;
}, {
    status: "precondition_required";
    message: string;
    device_id: string;
    app_id: string;
    kms_info: {
        version: string;
        id: string;
        slug: string | null;
        url: string;
        chain_id: number | null;
        kms_contract_address: string | null;
        gateway_app_id: string | null;
    } & {
        [k: string]: unknown;
    };
    compose_hash: string;
}>]>;
export type UpdateCvmEnvsRequest = z.input<typeof UpdateCvmEnvsRequestSchema>;
export type UpdateCvmEnvsResult = z.infer<typeof UpdateCvmEnvsResultSchema>;
export type UpdateCvmEnvsInProgress = z.infer<typeof UpdateCvmEnvsInProgressSchema>;
export type UpdateCvmEnvsPreconditionRequired = z.infer<typeof UpdateCvmEnvsPreconditionRequiredSchema>;
/**
 * Update CVM environment variables
 *
 * @param client - The API client
 * @param request - Request parameters containing CVM ID and environment data
 * @param parameters - Optional behavior parameters
 * @returns Update result (either in_progress or precondition_required)
 */
declare const updateCvmEnvs: {
    (client: Client, params: {
        encrypted_env: string;
        id?: string | undefined;
        app_id?: string | undefined;
        instance_id?: string | undefined;
        uuid?: string | undefined;
        compose_hash?: string | undefined;
        env_keys?: string[] | undefined;
        transaction_hash?: string | undefined;
    }): Promise<{
        status: "in_progress";
        message: string;
        correlation_id: string;
        allowed_envs_changed: boolean;
    } | {
        status: "precondition_required";
        message: string;
        device_id: string;
        app_id: string;
        kms_info: {
            version: string;
            id: string;
            slug: string | null;
            url: string;
            chain_id: number | null;
            kms_contract_address: `0x${string}`;
            gateway_app_id: `0x${string}`;
        } & {
            [k: string]: unknown;
        };
        compose_hash: string;
    }>;
    <T extends z.ZodTypeAny>(client: Client, params: {
        encrypted_env: string;
        id?: string | undefined;
        app_id?: string | undefined;
        instance_id?: string | undefined;
        uuid?: string | undefined;
        compose_hash?: string | undefined;
        env_keys?: string[] | undefined;
        transaction_hash?: string | undefined;
    }, parameters: {
        schema: T;
    }): Promise<z.TypeOf<T>>;
    (client: Client, params: {
        encrypted_env: string;
        id?: string | undefined;
        app_id?: string | undefined;
        instance_id?: string | undefined;
        uuid?: string | undefined;
        compose_hash?: string | undefined;
        env_keys?: string[] | undefined;
        transaction_hash?: string | undefined;
    }, parameters: {
        schema: false;
    }): Promise<unknown>;
}, safeUpdateCvmEnvs: {
    (client: Client, params: {
        encrypted_env: string;
        id?: string | undefined;
        app_id?: string | undefined;
        instance_id?: string | undefined;
        uuid?: string | undefined;
        compose_hash?: string | undefined;
        env_keys?: string[] | undefined;
        transaction_hash?: string | undefined;
    }): Promise<import("../..").SafeResult<{
        status: "in_progress";
        message: string;
        correlation_id: string;
        allowed_envs_changed: boolean;
    } | {
        status: "precondition_required";
        message: string;
        device_id: string;
        app_id: string;
        kms_info: {
            version: string;
            id: string;
            slug: string | null;
            url: string;
            chain_id: number | null;
            kms_contract_address: `0x${string}`;
            gateway_app_id: `0x${string}`;
        } & {
            [k: string]: unknown;
        };
        compose_hash: string;
    }>>;
    <T extends z.ZodTypeAny>(client: Client, params: {
        encrypted_env: string;
        id?: string | undefined;
        app_id?: string | undefined;
        instance_id?: string | undefined;
        uuid?: string | undefined;
        compose_hash?: string | undefined;
        env_keys?: string[] | undefined;
        transaction_hash?: string | undefined;
    }, parameters: {
        schema: T;
    }): Promise<import("../..").SafeResult<z.TypeOf<T>>>;
    (client: Client, params: {
        encrypted_env: string;
        id?: string | undefined;
        app_id?: string | undefined;
        instance_id?: string | undefined;
        uuid?: string | undefined;
        compose_hash?: string | undefined;
        env_keys?: string[] | undefined;
        transaction_hash?: string | undefined;
    }, parameters: {
        schema: false;
    }): Promise<import("../..").SafeResult<unknown>>;
};
export { updateCvmEnvs, safeUpdateCvmEnvs };
