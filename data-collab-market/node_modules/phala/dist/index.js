#!/usr/bin/env node
import { createRequire } from 'module';const require = createRequire(import.meta.url);
var Q5=Object.create;var Rl=Object.defineProperty;var eC=Object.getOwnPropertyDescriptor;var tC=Object.getOwnPropertyNames;var rC=Object.getPrototypeOf,oC=Object.prototype.hasOwnProperty;var qr=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var _=(e,t)=>()=>(e&&(t=e(e=0)),t);var gt=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Ml=(e,t)=>{for(var r in t)Rl(e,r,{get:t[r],enumerable:!0})},nC=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of tC(t))!oC.call(e,n)&&n!==r&&Rl(e,n,{get:()=>t[n],enumerable:!(o=eC(t,n))||o.enumerable});return e};var Zi=(e,t,r)=>(r=e!=null?Q5(rC(e)):{},nC(t||!e||!e.__esModule?Rl(r,"default",{value:e,enumerable:!0}):r,e));var nh=gt((GT,oh)=>{var Wn=1e3,Jn=Wn*60,Zn=Jn*60,un=Zn*24,dC=un*7,hC=un*365.25;oh.exports=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0)return gC(e);if(r==="number"&&isFinite(e))return t.long?bC(e):yC(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function gC(e){if(e=String(e),!(e.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]),o=(t[2]||"ms").toLowerCase();switch(o){case"years":case"year":case"yrs":case"yr":case"y":return r*hC;case"weeks":case"week":case"w":return r*dC;case"days":case"day":case"d":return r*un;case"hours":case"hour":case"hrs":case"hr":case"h":return r*Zn;case"minutes":case"minute":case"mins":case"min":case"m":return r*Jn;case"seconds":case"second":case"secs":case"sec":case"s":return r*Wn;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function yC(e){var t=Math.abs(e);return t>=un?Math.round(e/un)+"d":t>=Zn?Math.round(e/Zn)+"h":t>=Jn?Math.round(e/Jn)+"m":t>=Wn?Math.round(e/Wn)+"s":e+"ms"}function bC(e){var t=Math.abs(e);return t>=un?Ec(e,t,un,"day"):t>=Zn?Ec(e,t,Zn,"hour"):t>=Jn?Ec(e,t,Jn,"minute"):t>=Wn?Ec(e,t,Wn,"second"):e+" ms"}function Ec(e,t,r,o){var n=t>=r*1.5;return Math.round(e/r)+" "+o+(n?"s":"")}});var Nl=gt((VT,sh)=>{function xC(e){r.debug=r,r.default=r,r.coerce=c,r.disable=i,r.enable=n,r.enabled=a,r.humanize=nh(),r.destroy=m,Object.keys(e).forEach(u=>{r[u]=e[u]}),r.names=[],r.skips=[],r.formatters={};function t(u){let p=0;for(let l=0;l<u.length;l++)p=(p<<5)-p+u.charCodeAt(l),p|=0;return r.colors[Math.abs(p)%r.colors.length]}r.selectColor=t;function r(u){let p,l=null,d,h;function g(...y){if(!g.enabled)return;let x=g,b=Number(new Date),v=b-(p||b);x.diff=v,x.prev=p,x.curr=b,p=b,y[0]=r.coerce(y[0]),typeof y[0]!="string"&&y.unshift("%O");let E=0;y[0]=y[0].replace(/%([a-zA-Z%])/g,(k,I)=>{if(k==="%%")return"%";E++;let R=r.formatters[I];if(typeof R=="function"){let B=y[E];k=R.call(x,B),y.splice(E,1),E--}return k}),r.formatArgs.call(x,y),(x.log||r.log).apply(x,y)}return g.namespace=u,g.useColors=r.useColors(),g.color=r.selectColor(u),g.extend=o,g.destroy=r.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>l!==null?l:(d!==r.namespaces&&(d=r.namespaces,h=r.enabled(u)),h),set:y=>{l=y}}),typeof r.init=="function"&&r.init(g),g}function o(u,p){let l=r(this.namespace+(typeof p>"u"?":":p)+u);return l.log=this.log,l}function n(u){r.save(u),r.namespaces=u,r.names=[],r.skips=[];let p=(typeof u=="string"?u:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let l of p)l[0]==="-"?r.skips.push(l.slice(1)):r.names.push(l)}function s(u,p){let l=0,d=0,h=-1,g=0;for(;l<u.length;)if(d<p.length&&(p[d]===u[l]||p[d]==="*"))p[d]==="*"?(h=d,g=l,d++):(l++,d++);else if(h!==-1)d=h+1,g++,l=g;else return!1;for(;d<p.length&&p[d]==="*";)d++;return d===p.length}function i(){let u=[...r.names,...r.skips.map(p=>"-"+p)].join(",");return r.enable(""),u}function a(u){for(let p of r.skips)if(s(u,p))return!1;for(let p of r.names)if(s(u,p))return!0;return!1}function c(u){return u instanceof Error?u.stack||u.message:u}function m(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}sh.exports=xC});var ih=gt((yt,Sc)=>{yt.formatArgs=wC;yt.save=CC;yt.load=EC;yt.useColors=vC;yt.storage=SC();yt.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();yt.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function vC(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function wC(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+Sc.exports.humanize(this.diff),!this.useColors)return;let t="color: "+this.color;e.splice(1,0,t,"color: inherit");let r=0,o=0;e[0].replace(/%[a-zA-Z%]/g,n=>{n!=="%%"&&(r++,n==="%c"&&(o=r))}),e.splice(o,0,t)}yt.log=console.debug||console.log||(()=>{});function CC(e){try{e?yt.storage.setItem("debug",e):yt.storage.removeItem("debug")}catch{}}function EC(){let e;try{e=yt.storage.getItem("debug")||yt.storage.getItem("DEBUG")}catch{}return!e&&typeof process<"u"&&"env"in process&&(e=process.env.DEBUG),e}function SC(){try{return localStorage}catch{}}Sc.exports=Nl()(yt);var{formatters:kC}=Sc.exports;kC.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}});var ch=gt((qT,ah)=>{"use strict";ah.exports=(e,t=process.argv)=>{let r=e.startsWith("-")?"":e.length===1?"-":"--",o=t.indexOf(r+e),n=t.indexOf("--");return o!==-1&&(n===-1||o<n)}});var ph=gt((KT,uh)=>{"use strict";var IC=qr("os"),mh=qr("tty"),Ut=ch(),{env:je}=process,So;Ut("no-color")||Ut("no-colors")||Ut("color=false")||Ut("color=never")?So=0:(Ut("color")||Ut("colors")||Ut("color=true")||Ut("color=always"))&&(So=1);"FORCE_COLOR"in je&&(je.FORCE_COLOR==="true"?So=1:je.FORCE_COLOR==="false"?So=0:So=je.FORCE_COLOR.length===0?1:Math.min(parseInt(je.FORCE_COLOR,10),3));function Ll(e){return e===0?!1:{level:e,hasBasic:!0,has256:e>=2,has16m:e>=3}}function Ol(e,t){if(So===0)return 0;if(Ut("color=16m")||Ut("color=full")||Ut("color=truecolor"))return 3;if(Ut("color=256"))return 2;if(e&&!t&&So===void 0)return 0;let r=So||0;if(je.TERM==="dumb")return r;if(process.platform==="win32"){let o=IC.release().split(".");return Number(o[0])>=10&&Number(o[2])>=10586?Number(o[2])>=14931?3:2:1}if("CI"in je)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some(o=>o in je)||je.CI_NAME==="codeship"?1:r;if("TEAMCITY_VERSION"in je)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(je.TEAMCITY_VERSION)?1:0;if(je.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in je){let o=parseInt((je.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(je.TERM_PROGRAM){case"iTerm.app":return o>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(je.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(je.TERM)||"COLORTERM"in je?1:r}function _C(e){let t=Ol(e,e&&e.isTTY);return Ll(t)}uh.exports={supportsColor:_C,stdout:Ll(Ol(!0,mh.isatty(1))),stderr:Ll(Ol(!0,mh.isatty(2)))}});var fh=gt((Ge,Ic)=>{var AC=qr("tty"),kc=qr("util");Ge.init=FC;Ge.log=RC;Ge.formatArgs=TC;Ge.save=MC;Ge.load=BC;Ge.useColors=PC;Ge.destroy=kc.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");Ge.colors=[6,2,3,4,5,1];try{let e=ph();e&&(e.stderr||e).level>=2&&(Ge.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}Ge.inspectOpts=Object.keys(process.env).filter(e=>/^debug_/i.test(e)).reduce((e,t)=>{let r=t.substring(6).toLowerCase().replace(/_([a-z])/g,(n,s)=>s.toUpperCase()),o=process.env[t];return/^(yes|on|true|enabled)$/i.test(o)?o=!0:/^(no|off|false|disabled)$/i.test(o)?o=!1:o==="null"?o=null:o=Number(o),e[r]=o,e},{});function PC(){return"colors"in Ge.inspectOpts?!!Ge.inspectOpts.colors:AC.isatty(process.stderr.fd)}function TC(e){let{namespace:t,useColors:r}=this;if(r){let o=this.color,n="\x1B[3"+(o<8?o:"8;5;"+o),s=`  ${n};1m${t} \x1B[0m`;e[0]=s+e[0].split(`
`).join(`
`+s),e.push(n+"m+"+Ic.exports.humanize(this.diff)+"\x1B[0m")}else e[0]=$C()+t+" "+e[0]}function $C(){return Ge.inspectOpts.hideDate?"":new Date().toISOString()+" "}function RC(...e){return process.stderr.write(kc.formatWithOptions(Ge.inspectOpts,...e)+`
`)}function MC(e){e?process.env.DEBUG=e:delete process.env.DEBUG}function BC(){return process.env.DEBUG}function FC(e){e.inspectOpts={};let t=Object.keys(Ge.inspectOpts);for(let r=0;r<t.length;r++)e.inspectOpts[t[r]]=Ge.inspectOpts[t[r]]}Ic.exports=Nl()(Ge);var{formatters:lh}=Ic.exports;lh.o=function(e){return this.inspectOpts.colors=this.useColors,kc.inspect(e,this.inspectOpts).split(`
`).map(t=>t.trim()).join(" ")};lh.O=function(e){return this.inspectOpts.colors=this.useColors,kc.inspect(e,this.inspectOpts)}});var dh=gt((WT,Ul)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?Ul.exports=ih():Ul.exports=fh()});var zl,gh=_(()=>{zl="2.38.6"});function yh(e,t){return t?.(e)?e:e&&typeof e=="object"&&"cause"in e&&e.cause!==void 0?yh(e.cause,t):t?null:e}var Hl,w,G=_(()=>{gh();Hl={getDocsUrl:({docsBaseUrl:e,docsPath:t="",docsSlug:r})=>t?`${e??"https://viem.sh"}${t}${r?`#${r}`:""}`:void 0,version:`viem@${zl}`},w=class e extends Error{constructor(t,r={}){let o=r.cause instanceof e?r.cause.details:r.cause?.message?r.cause.message:r.details,n=r.cause instanceof e&&r.cause.docsPath||r.docsPath,s=Hl.getDocsUrl?.({...r,docsPath:n}),i=[t||"An error occurred.","",...r.metaMessages?[...r.metaMessages,""]:[],...s?[`Docs: ${s}`]:[],...o?[`Details: ${o}`]:[],...Hl.version?[`Version: ${Hl.version}`]:[]].join(`
`);super(i,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=o,this.docsPath=n,this.metaMessages=r.metaMessages,this.name=r.name??this.name,this.shortMessage=t,this.version=zl}walk(t){return yh(this,t)}}});var Yn,_c,Ac,Pc,Xi=_(()=>{G();Yn=class extends w{constructor({max:t,min:r,signed:o,size:n,value:s}){super(`Number "${s}" is not in safe ${n?`${n*8}-bit ${o?"signed":"unsigned"} `:""}integer range ${t?`(${r} to ${t})`:`(above ${r})`}`,{name:"IntegerOutOfRangeError"})}},_c=class extends w{constructor(t){super(`Bytes value "${t}" is not a valid boolean. The bytes array must contain a single byte of either a 0 or 1 value.`,{name:"InvalidBytesBooleanError"})}},Ac=class extends w{constructor(t){super(`Hex value "${t}" is not a valid boolean. The hex value must be "0x0" (false) or "0x1" (true).`,{name:"InvalidHexBooleanError"})}},Pc=class extends w{constructor({givenSize:t,maxSize:r}){super(`Size cannot exceed ${r} bytes. Given size: ${t} bytes.`,{name:"SizeOverflowError"})}}});function pe(e,{strict:t=!0}={}){return!e||typeof e!="string"?!1:t?/^0x[0-9a-fA-F]*$/.test(e):e.startsWith("0x")}var Pt=_(()=>{});function Q(e){return pe(e,{strict:!1})?Math.ceil((e.length-2)/2):e.length}var zt=_(()=>{Pt()});function Ve(e,{dir:t="left"}={}){let r=typeof e=="string"?e.replace("0x",""):e,o=0;for(let n=0;n<r.length-1&&r[t==="left"?n:r.length-n-1].toString()==="0";n++)o++;return r=t==="left"?r.slice(o):r.slice(0,r.length-o),typeof e=="string"?(r.length===1&&t==="right"&&(r=`${r}0`),`0x${r.length%2===1?`0${r}`:r}`):r}var ln=_(()=>{});var Qi,ea,ta,Tc=_(()=>{G();Qi=class extends w{constructor({offset:t,position:r,size:o}){super(`Slice ${r==="start"?"starting":"ending"} at offset "${t}" is out-of-bounds (size: ${o}).`,{name:"SliceOffsetOutOfBoundsError"})}},ea=class extends w{constructor({size:t,targetSize:r,type:o}){super(`${o.charAt(0).toUpperCase()}${o.slice(1).toLowerCase()} size (${t}) exceeds padding size (${r}).`,{name:"SizeExceedsPaddingSizeError"})}},ta=class extends w{constructor({size:t,targetSize:r,type:o}){super(`${o.charAt(0).toUpperCase()}${o.slice(1).toLowerCase()} is expected to be ${r} ${o} long, but is ${t} ${o} long.`,{name:"InvalidBytesLengthError"})}}});function ko(e,{dir:t,size:r=32}={}){return typeof e=="string"?Kr(e,{dir:t,size:r}):DC(e,{dir:t,size:r})}function Kr(e,{dir:t,size:r=32}={}){if(r===null)return e;let o=e.replace("0x","");if(o.length>r*2)throw new ea({size:Math.ceil(o.length/2),targetSize:r,type:"hex"});return`0x${o[t==="right"?"padEnd":"padStart"](r*2,"0")}`}function DC(e,{dir:t,size:r=32}={}){if(r===null)return e;if(e.length>r)throw new ea({size:e.length,targetSize:r,type:"bytes"});let o=new Uint8Array(r);for(let n=0;n<r;n++){let s=t==="right";o[s?n:r-n-1]=e[s?n:e.length-n-1]}return o}var $c=_(()=>{Tc()});function me(e,t={}){return typeof e=="number"||typeof e=="bigint"?S(e,t):typeof e=="string"?sr(e,t):typeof e=="boolean"?Rc(e,t):ee(e,t)}function Rc(e,t={}){let r=`0x${Number(e)}`;return typeof t.size=="number"?(bt(r,{size:t.size}),ko(r,{size:t.size})):r}function ee(e,t={}){let r="";for(let n=0;n<e.length;n++)r+=NC[e[n]];let o=`0x${r}`;return typeof t.size=="number"?(bt(o,{size:t.size}),ko(o,{dir:"right",size:t.size})):o}function S(e,t={}){let{signed:r,size:o}=t,n=BigInt(e),s;o?r?s=(1n<<BigInt(o)*8n-1n)-1n:s=2n**(BigInt(o)*8n)-1n:typeof e=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));let i=typeof s=="bigint"&&r?-s-1n:0;if(s&&n>s||n<i){let c=typeof e=="bigint"?"n":"";throw new Yn({max:s?`${s}${c}`:void 0,min:`${i}${c}`,signed:r,size:o,value:`${e}${c}`})}let a=`0x${(r&&n<0?(1n<<BigInt(o*8))+BigInt(n):n).toString(16)}`;return o?ko(a,{size:o}):a}function sr(e,t={}){let r=LC.encode(e);return ee(r,t)}var NC,LC,D=_(()=>{Xi();$c();Oe();NC=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));LC=new TextEncoder});function Ht(e,t={}){return typeof e=="number"||typeof e=="bigint"?zC(e,t):typeof e=="boolean"?UC(e,t):pe(e)?Ue(e,t):ir(e,t)}function UC(e,t={}){let r=new Uint8Array(1);return r[0]=Number(e),typeof t.size=="number"?(bt(r,{size:t.size}),ko(r,{size:t.size})):r}function bh(e){if(e>=Wr.zero&&e<=Wr.nine)return e-Wr.zero;if(e>=Wr.A&&e<=Wr.F)return e-(Wr.A-10);if(e>=Wr.a&&e<=Wr.f)return e-(Wr.a-10)}function Ue(e,t={}){let r=e;t.size&&(bt(r,{size:t.size}),r=ko(r,{dir:"right",size:t.size}));let o=r.slice(2);o.length%2&&(o=`0${o}`);let n=o.length/2,s=new Uint8Array(n);for(let i=0,a=0;i<n;i++){let c=bh(o.charCodeAt(a++)),m=bh(o.charCodeAt(a++));if(c===void 0||m===void 0)throw new w(`Invalid byte sequence ("${o[a-2]}${o[a-1]}" in "${o}").`);s[i]=c*16+m}return s}function zC(e,t){let r=S(e,t);return Ue(r)}function ir(e,t={}){let r=OC.encode(e);return typeof t.size=="number"?(bt(r,{size:t.size}),ko(r,{dir:"right",size:t.size})):r}var OC,Wr,qe=_(()=>{G();Pt();$c();Oe();D();OC=new TextEncoder;Wr={zero:48,nine:57,A:65,F:70,a:97,f:102}});function bt(e,{size:t}){if(Q(e)>t)throw new Pc({givenSize:Q(e),maxSize:t})}function ue(e,t={}){let{signed:r}=t;t.size&&bt(e,{size:t.size});let o=BigInt(e);if(!r)return o;let n=(e.length-2)/2,s=(1n<<BigInt(n)*8n-1n)-1n;return o<=s?o:o-BigInt(`0x${"f".padStart(n*2,"f")}`)-1n}function jl(e,t={}){let r=e;if(t.size&&(bt(r,{size:t.size}),r=Ve(r)),Ve(r)==="0x00")return!1;if(Ve(r)==="0x01")return!0;throw new Ac(r)}function Ce(e,t={}){return Number(ue(e,t))}var Oe=_(()=>{Xi();zt();ln()});function Xn(e,t){return({exclude:r,format:o})=>({exclude:r,format:(n,s)=>{let i=t(n,s);if(r)for(let a of r)delete i[a];return{...i,...o(n,s)}},type:e})}var Mc=_(()=>{});function xt(e,t){let r={};return typeof e.authorizationList<"u"&&(r.authorizationList=GC(e.authorizationList)),typeof e.accessList<"u"&&(r.accessList=e.accessList),typeof e.blobVersionedHashes<"u"&&(r.blobVersionedHashes=e.blobVersionedHashes),typeof e.blobs<"u"&&(typeof e.blobs[0]!="string"?r.blobs=e.blobs.map(o=>ee(o)):r.blobs=e.blobs),typeof e.data<"u"&&(r.data=e.data),e.account&&(r.from=e.account.address),typeof e.from<"u"&&(r.from=e.from),typeof e.gas<"u"&&(r.gas=S(e.gas)),typeof e.gasPrice<"u"&&(r.gasPrice=S(e.gasPrice)),typeof e.maxFeePerBlobGas<"u"&&(r.maxFeePerBlobGas=S(e.maxFeePerBlobGas)),typeof e.maxFeePerGas<"u"&&(r.maxFeePerGas=S(e.maxFeePerGas)),typeof e.maxPriorityFeePerGas<"u"&&(r.maxPriorityFeePerGas=S(e.maxPriorityFeePerGas)),typeof e.nonce<"u"&&(r.nonce=S(e.nonce)),typeof e.to<"u"&&(r.to=e.to),typeof e.type<"u"&&(r.type=jC[e.type]),typeof e.value<"u"&&(r.value=S(e.value)),r}function GC(e){return e.map(t=>({address:t.address,r:t.r?S(BigInt(t.r)):t.r,s:t.s?S(BigInt(t.s)):t.s,chainId:S(t.chainId),nonce:S(t.nonce),...typeof t.yParity<"u"?{yParity:S(t.yParity)}:{},...typeof t.v<"u"&&typeof t.yParity>"u"?{v:S(t.v)}:{}}))}var jC,Io=_(()=>{D();jC={legacy:"0x0",eip2930:"0x1",eip1559:"0x2",eip4844:"0x3",eip7702:"0x4"}});var O4,U4,z4,H4,j4,G4,V4,q4,K4,W4,J4,Z4,Y4,X4,Q4,e9,t9,r9,o9,n9,s9,i9,a9,c9,m9,u9,p9,l9,f9,d9,h9,g9,y9,b9,x9,v9,w9,C9,E9,S9,k9,I9,_9,A9,P9,T9,$9,R9,M9,B9,F9,D9,N9,L9,O9,U9,z9,H9,j9,G9,V9,q9,K9,W9,J9,Z9,Y9,X9,Q9,e$,t$,r$,o$,n$,s$,i$,a$,c$,m$,u$,p$,l$,f$,d$,h$,g$,y$,b$,x$,v$,w$,C$,E$,S$,k$,Qn,ql=_(()=>{O4=2n**(8n-1n)-1n,U4=2n**(16n-1n)-1n,z4=2n**(24n-1n)-1n,H4=2n**(32n-1n)-1n,j4=2n**(40n-1n)-1n,G4=2n**(48n-1n)-1n,V4=2n**(56n-1n)-1n,q4=2n**(64n-1n)-1n,K4=2n**(72n-1n)-1n,W4=2n**(80n-1n)-1n,J4=2n**(88n-1n)-1n,Z4=2n**(96n-1n)-1n,Y4=2n**(104n-1n)-1n,X4=2n**(112n-1n)-1n,Q4=2n**(120n-1n)-1n,e9=2n**(128n-1n)-1n,t9=2n**(136n-1n)-1n,r9=2n**(144n-1n)-1n,o9=2n**(152n-1n)-1n,n9=2n**(160n-1n)-1n,s9=2n**(168n-1n)-1n,i9=2n**(176n-1n)-1n,a9=2n**(184n-1n)-1n,c9=2n**(192n-1n)-1n,m9=2n**(200n-1n)-1n,u9=2n**(208n-1n)-1n,p9=2n**(216n-1n)-1n,l9=2n**(224n-1n)-1n,f9=2n**(232n-1n)-1n,d9=2n**(240n-1n)-1n,h9=2n**(248n-1n)-1n,g9=2n**(256n-1n)-1n,y9=-(2n**(8n-1n)),b9=-(2n**(16n-1n)),x9=-(2n**(24n-1n)),v9=-(2n**(32n-1n)),w9=-(2n**(40n-1n)),C9=-(2n**(48n-1n)),E9=-(2n**(56n-1n)),S9=-(2n**(64n-1n)),k9=-(2n**(72n-1n)),I9=-(2n**(80n-1n)),_9=-(2n**(88n-1n)),A9=-(2n**(96n-1n)),P9=-(2n**(104n-1n)),T9=-(2n**(112n-1n)),$9=-(2n**(120n-1n)),R9=-(2n**(128n-1n)),M9=-(2n**(136n-1n)),B9=-(2n**(144n-1n)),F9=-(2n**(152n-1n)),D9=-(2n**(160n-1n)),N9=-(2n**(168n-1n)),L9=-(2n**(176n-1n)),O9=-(2n**(184n-1n)),U9=-(2n**(192n-1n)),z9=-(2n**(200n-1n)),H9=-(2n**(208n-1n)),j9=-(2n**(216n-1n)),G9=-(2n**(224n-1n)),V9=-(2n**(232n-1n)),q9=-(2n**(240n-1n)),K9=-(2n**(248n-1n)),W9=-(2n**(256n-1n)),J9=2n**8n-1n,Z9=2n**16n-1n,Y9=2n**24n-1n,X9=2n**32n-1n,Q9=2n**40n-1n,e$=2n**48n-1n,t$=2n**56n-1n,r$=2n**64n-1n,o$=2n**72n-1n,n$=2n**80n-1n,s$=2n**88n-1n,i$=2n**96n-1n,a$=2n**104n-1n,c$=2n**112n-1n,m$=2n**120n-1n,u$=2n**128n-1n,p$=2n**136n-1n,l$=2n**144n-1n,f$=2n**152n-1n,d$=2n**160n-1n,h$=2n**168n-1n,g$=2n**176n-1n,y$=2n**184n-1n,b$=2n**192n-1n,x$=2n**200n-1n,v$=2n**208n-1n,w$=2n**216n-1n,C$=2n**224n-1n,E$=2n**232n-1n,S$=2n**240n-1n,k$=2n**248n-1n,Qn=2n**256n-1n});function Fe(e){return typeof e[0]=="string"?Ke(e):VC(e)}function VC(e){let t=0;for(let n of e)t+=n.length;let r=new Uint8Array(t),o=0;for(let n of e)r.set(n,o),o+=n.length;return r}function Ke(e){return`0x${e.reduce((t,r)=>t+r.replace("0x",""),"")}`}var ut=_(()=>{});var na,es,Bc,Kl=_(()=>{G();na=class extends w{constructor({offset:t}){super(`Offset \`${t}\` cannot be negative.`,{name:"NegativeOffsetError"})}},es=class extends w{constructor({length:t,position:r}){super(`Position \`${r}\` is out of bounds (\`0 < position < ${t}\`).`,{name:"PositionOutOfBoundsError"})}},Bc=class extends w{constructor({count:t,limit:r}){super(`Recursive read limit of \`${r}\` exceeded (recursive read count: \`${t}\`).`,{name:"RecursiveReadLimitExceededError"})}}});function ts(e,{recursiveReadLimit:t=8192}={}){let r=Object.create(qC);return r.bytes=e,r.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength),r.positionReadCount=new Map,r.recursiveReadLimit=t,r}var qC,Fc=_(()=>{Kl();qC={bytes:new Uint8Array,dataView:new DataView(new ArrayBuffer(0)),position:0,positionReadCount:new Map,recursiveReadCount:0,recursiveReadLimit:Number.POSITIVE_INFINITY,assertReadLimit(){if(this.recursiveReadCount>=this.recursiveReadLimit)throw new Bc({count:this.recursiveReadCount+1,limit:this.recursiveReadLimit})},assertPosition(e){if(e<0||e>this.bytes.length-1)throw new es({length:this.bytes.length,position:e})},decrementPosition(e){if(e<0)throw new na({offset:e});let t=this.position-e;this.assertPosition(t),this.position=t},getReadCount(e){return this.positionReadCount.get(e||this.position)||0},incrementPosition(e){if(e<0)throw new na({offset:e});let t=this.position+e;this.assertPosition(t),this.position=t},inspectByte(e){let t=e??this.position;return this.assertPosition(t),this.bytes[t]},inspectBytes(e,t){let r=t??this.position;return this.assertPosition(r+e-1),this.bytes.subarray(r,r+e)},inspectUint8(e){let t=e??this.position;return this.assertPosition(t),this.bytes[t]},inspectUint16(e){let t=e??this.position;return this.assertPosition(t+1),this.dataView.getUint16(t)},inspectUint24(e){let t=e??this.position;return this.assertPosition(t+2),(this.dataView.getUint16(t)<<8)+this.dataView.getUint8(t+2)},inspectUint32(e){let t=e??this.position;return this.assertPosition(t+3),this.dataView.getUint32(t)},pushByte(e){this.assertPosition(this.position),this.bytes[this.position]=e,this.position++},pushBytes(e){this.assertPosition(this.position+e.length-1),this.bytes.set(e,this.position),this.position+=e.length},pushUint8(e){this.assertPosition(this.position),this.bytes[this.position]=e,this.position++},pushUint16(e){this.assertPosition(this.position+1),this.dataView.setUint16(this.position,e),this.position+=2},pushUint24(e){this.assertPosition(this.position+2),this.dataView.setUint16(this.position,e>>8),this.dataView.setUint8(this.position+2,e&255),this.position+=3},pushUint32(e){this.assertPosition(this.position+3),this.dataView.setUint32(this.position,e),this.position+=4},readByte(){this.assertReadLimit(),this._touch();let e=this.inspectByte();return this.position++,e},readBytes(e,t){this.assertReadLimit(),this._touch();let r=this.inspectBytes(e);return this.position+=t??e,r},readUint8(){this.assertReadLimit(),this._touch();let e=this.inspectUint8();return this.position+=1,e},readUint16(){this.assertReadLimit(),this._touch();let e=this.inspectUint16();return this.position+=2,e},readUint24(){this.assertReadLimit(),this._touch();let e=this.inspectUint24();return this.position+=3,e},readUint32(){this.assertReadLimit(),this._touch();let e=this.inspectUint32();return this.position+=4,e},get remaining(){return this.bytes.length-this.position},setPosition(e){let t=this.position;return this.assertPosition(e),this.position=e,()=>this.position=t},_touch(){if(this.recursiveReadLimit===Number.POSITIVE_INFINITY)return;let e=this.getReadCount();this.positionReadCount.set(this.position,e+1),e>0&&this.recursiveReadCount++}}});var Dc,Sh,Nc=_(()=>{Dc={gwei:9,wei:18},Sh={ether:-9,wei:9}});function Lc(e,t){let r=e.toString(),o=r.startsWith("-");o&&(r=r.slice(1)),r=r.padStart(t,"0");let[n,s]=[r.slice(0,r.length-t),r.slice(r.length-t)];return s=s.replace(/(0+)$/,""),`${o?"-":""}${n||"0"}${s?`.${s}`:""}`}var Wl=_(()=>{});function rs(e,t="wei"){return Lc(e,Dc[t])}var Oc=_(()=>{Nc();Wl()});function ze(e,t="wei"){return Lc(e,Sh[t])}var os=_(()=>{Nc();Wl()});function dn(e){let t=Object.entries(e).map(([o,n])=>n===void 0||n===!1?null:[o,n]).filter(Boolean),r=t.reduce((o,[n])=>Math.max(o,n.length),0);return t.map(([o,n])=>`  ${`${o}:`.padEnd(r+1)}  ${n}`).join(`
`)}var Uc,zc,Hc,jc,Gc,ns,ss,is,Vc,Tt=_(()=>{Oc();os();G();Uc=class extends w{constructor(){super(["Cannot specify both a `gasPrice` and a `maxFeePerGas`/`maxPriorityFeePerGas`.","Use `maxFeePerGas`/`maxPriorityFeePerGas` for EIP-1559 compatible networks, and `gasPrice` for others."].join(`
`),{name:"FeeConflictError"})}},zc=class extends w{constructor({v:t}){super(`Invalid \`v\` value "${t}". Expected 27 or 28.`,{name:"InvalidLegacyVError"})}},Hc=class extends w{constructor({transaction:t}){super("Cannot infer a transaction type from provided transaction.",{metaMessages:["Provided Transaction:","{",dn(t),"}","","To infer the type, either provide:","- a `type` to the Transaction, or","- an EIP-1559 Transaction with `maxFeePerGas`, or","- an EIP-2930 Transaction with `gasPrice` & `accessList`, or","- an EIP-4844 Transaction with `blobs`, `blobVersionedHashes`, `sidecars`, or","- an EIP-7702 Transaction with `authorizationList`, or","- a Legacy Transaction with `gasPrice`"],name:"InvalidSerializableTransactionError"})}},jc=class extends w{constructor({storageKey:t}){super(`Size for storage key "${t}" is invalid. Expected 32 bytes. Got ${Math.floor((t.length-2)/2)} bytes.`,{name:"InvalidStorageKeySizeError"})}},Gc=class extends w{constructor(t,{account:r,docsPath:o,chain:n,data:s,gas:i,gasPrice:a,maxFeePerGas:c,maxPriorityFeePerGas:m,nonce:u,to:p,value:l}){let d=dn({chain:n&&`${n?.name} (id: ${n?.id})`,from:r?.address,to:p,value:typeof l<"u"&&`${rs(l)} ${n?.nativeCurrency?.symbol||"ETH"}`,data:s,gas:i,gasPrice:typeof a<"u"&&`${ze(a)} gwei`,maxFeePerGas:typeof c<"u"&&`${ze(c)} gwei`,maxPriorityFeePerGas:typeof m<"u"&&`${ze(m)} gwei`,nonce:u});super(t.shortMessage,{cause:t,docsPath:o,metaMessages:[...t.metaMessages?[...t.metaMessages," "]:[],"Request Arguments:",d].filter(Boolean),name:"TransactionExecutionError"}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cause=t}},ns=class extends w{constructor({blockHash:t,blockNumber:r,blockTag:o,hash:n,index:s}){let i="Transaction";o&&s!==void 0&&(i=`Transaction at block time "${o}" at index "${s}"`),t&&s!==void 0&&(i=`Transaction at block hash "${t}" at index "${s}"`),r&&s!==void 0&&(i=`Transaction at block number "${r}" at index "${s}"`),n&&(i=`Transaction with hash "${n}"`),super(`${i} could not be found.`,{name:"TransactionNotFoundError"})}},ss=class extends w{constructor({hash:t}){super(`Transaction receipt with hash "${t}" could not be found. The Transaction may not be processed on a block yet.`,{name:"TransactionReceiptNotFoundError"})}},is=class extends w{constructor({receipt:t}){super(`Transaction with hash "${t.transactionHash}" reverted.`,{metaMessages:['The receipt marked the transaction as "reverted". This could mean that the function on the contract you are trying to call threw an error.'," ","You can attempt to extract the revert reason by:","- calling the `simulateContract` or `simulateCalls` Action with the `abi` and `functionName` of the contract","- using the `call` Action with raw `data`"],name:"TransactionReceiptRevertedError"}),Object.defineProperty(this,"receipt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.receipt=t}},Vc=class extends w{constructor({hash:t}){super(`Timed out while waiting for transaction with hash "${t}" to be confirmed.`,{name:"WaitForTransactionReceiptTimeoutError"})}}});function JC(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Jl(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function hn(e,...t){if(!JC(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function ps(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function qc(e,t){hn(e);let r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Ih(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function _o(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function Kc(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function cr(e,t){return e<<32-t|e>>>t}function YC(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function XC(e){for(let t=0;t<e.length;t++)e[t]=YC(e[t]);return e}function QC(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function sa(e){return typeof e=="string"&&(e=QC(e)),hn(e),e}function Wc(e){let t=o=>e().update(sa(o)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}var ZC,Zl,us,Jc=_(()=>{ZC=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;Zl=ZC?e=>e:XC;us=class{}});function t2(e,t=!1){return t?{h:Number(e&Yc),l:Number(e>>Ph&Yc)}:{h:Number(e>>Ph&Yc)|0,l:Number(e&Yc)|0}}function Th(e,t=!1){let r=e.length,o=new Uint32Array(r),n=new Uint32Array(r);for(let s=0;s<r;s++){let{h:i,l:a}=t2(e[s],t);[o[s],n[s]]=[i,a]}return[o,n]}var Yc,Ph,$h,Rh,Mh,Bh,Fh=_(()=>{Yc=BigInt(4294967295),Ph=BigInt(32);$h=(e,t,r)=>e<<r|t>>>32-r,Rh=(e,t,r)=>t<<r|e>>>32-r,Mh=(e,t,r)=>t<<r-32|e>>>64-r,Bh=(e,t,r)=>e<<r-32|t>>>64-r});var ae,mr=_(()=>{G();ae=class extends w{constructor({address:t}){super(`Address "${t}" is invalid.`,{metaMessages:["- Address must be a hex value of 20 bytes (40 hex characters).","- Address must match its checksum counterpart."],name:"InvalidAddressError"})}}});var gn,nm,sm,ia,yn,aa=_(()=>{G();gn=class extends w{constructor({blockNumber:t,chain:r,contract:o}){super(`Chain "${r.name}" does not support contract "${o.name}".`,{metaMessages:["This could be due to any of the following:",...t&&o.blockCreated&&o.blockCreated>t?[`- The contract "${o.name}" was not deployed until block ${o.blockCreated} (current block ${t}).`]:[`- The chain does not have the contract "${o.name}" configured.`]],name:"ChainDoesNotSupportContract"})}},nm=class extends w{constructor({chain:t,currentChainId:r}){super(`The current chain of the wallet (id: ${r}) does not match the target chain for the transaction (id: ${t.id} \u2013 ${t.name}).`,{metaMessages:[`Current Chain ID:  ${r}`,`Expected Chain ID: ${t.id} \u2013 ${t.name}`],name:"ChainMismatchError"})}},sm=class extends w{constructor(){super(["No chain was provided to the request.","Please provide a chain with the `chain` argument on the Action, or by supplying a `chain` to WalletClient."].join(`
`),{name:"ChainNotFoundError"})}},ia=class extends w{constructor(){super("No chain was provided to the Client.",{name:"ClientChainNotConfiguredError"})}},yn=class extends w{constructor({chainId:t}){super(typeof t=="number"?`Chain ID "${t}" is invalid.`:"Chain ID is invalid.",{name:"InvalidChainIdError"})}}});var Zr,jt,fs,ds,hs,gs,ys,bs,xs,vs,br,Gt,Po=_(()=>{os();G();Zr=class extends w{constructor({cause:t,message:r}={}){let o=r?.replace("execution reverted: ","")?.replace("execution reverted","");super(`Execution reverted ${o?`with reason: ${o}`:"for an unknown reason"}.`,{cause:t,name:"ExecutionRevertedError"})}};Object.defineProperty(Zr,"code",{enumerable:!0,configurable:!0,writable:!0,value:3});Object.defineProperty(Zr,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/execution reverted/});jt=class extends w{constructor({cause:t,maxFeePerGas:r}={}){super(`The fee cap (\`maxFeePerGas\`${r?` = ${ze(r)} gwei`:""}) cannot be higher than the maximum allowed value (2^256-1).`,{cause:t,name:"FeeCapTooHighError"})}};Object.defineProperty(jt,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/max fee per gas higher than 2\^256-1|fee cap higher than 2\^256-1/});fs=class extends w{constructor({cause:t,maxFeePerGas:r}={}){super(`The fee cap (\`maxFeePerGas\`${r?` = ${ze(r)}`:""} gwei) cannot be lower than the block base fee.`,{cause:t,name:"FeeCapTooLowError"})}};Object.defineProperty(fs,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/max fee per gas less than block base fee|fee cap less than block base fee|transaction is outdated/});ds=class extends w{constructor({cause:t,nonce:r}={}){super(`Nonce provided for the transaction ${r?`(${r}) `:""}is higher than the next one expected.`,{cause:t,name:"NonceTooHighError"})}};Object.defineProperty(ds,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/nonce too high/});hs=class extends w{constructor({cause:t,nonce:r}={}){super([`Nonce provided for the transaction ${r?`(${r}) `:""}is lower than the current nonce of the account.`,"Try increasing the nonce or find the latest nonce with `getTransactionCount`."].join(`
`),{cause:t,name:"NonceTooLowError"})}};Object.defineProperty(hs,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/nonce too low|transaction already imported|already known/});gs=class extends w{constructor({cause:t,nonce:r}={}){super(`Nonce provided for the transaction ${r?`(${r}) `:""}exceeds the maximum allowed nonce.`,{cause:t,name:"NonceMaxValueError"})}};Object.defineProperty(gs,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/nonce has max value/});ys=class extends w{constructor({cause:t}={}){super(["The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account."].join(`
`),{cause:t,metaMessages:["This error could arise when the account does not have enough funds to:"," - pay for the total gas fee,"," - pay for the value to send."," ","The cost of the transaction is calculated as `gas * gas fee + value`, where:"," - `gas` is the amount of gas needed for transaction to execute,"," - `gas fee` is the gas fee,"," - `value` is the amount of ether to send to the recipient."],name:"InsufficientFundsError"})}};Object.defineProperty(ys,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/insufficient funds|exceeds transaction sender account balance/});bs=class extends w{constructor({cause:t,gas:r}={}){super(`The amount of gas ${r?`(${r}) `:""}provided for the transaction exceeds the limit allowed for the block.`,{cause:t,name:"IntrinsicGasTooHighError"})}};Object.defineProperty(bs,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/intrinsic gas too high|gas limit reached/});xs=class extends w{constructor({cause:t,gas:r}={}){super(`The amount of gas ${r?`(${r}) `:""}provided for the transaction is too low.`,{cause:t,name:"IntrinsicGasTooLowError"})}};Object.defineProperty(xs,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/intrinsic gas too low/});vs=class extends w{constructor({cause:t}){super("The transaction type is not supported for this chain.",{cause:t,name:"TransactionTypeNotSupportedError"})}};Object.defineProperty(vs,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/transaction type not valid/});br=class extends w{constructor({cause:t,maxPriorityFeePerGas:r,maxFeePerGas:o}={}){super([`The provided tip (\`maxPriorityFeePerGas\`${r?` = ${ze(r)} gwei`:""}) cannot be higher than the fee cap (\`maxFeePerGas\`${o?` = ${ze(o)} gwei`:""}).`].join(`
`),{cause:t,name:"TipAboveFeeCapError"})}};Object.defineProperty(br,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/max priority fee per gas higher than max fee per gas|tip higher than fee cap/});Gt=class extends w{constructor({cause:t}){super(`An error occurred while executing: ${t?.shortMessage}`,{cause:t,name:"UnknownNodeError"})}}});var Vt,ws=_(()=>{Vt=class extends Map{constructor(t){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=t}get(t){let r=super.get(t);return super.has(t)&&r!==void 0&&(this.delete(t),super.set(t,r)),r}set(t,r){if(super.set(t,r),this.maxSize&&this.size>this.maxSize){let o=this.keys().next().value;o&&this.delete(o)}return this}}});function l2(e,t=24){let r=new Uint32Array(10);for(let o=24-t;o<24;o++){for(let i=0;i<10;i++)r[i]=e[i]^e[i+10]^e[i+20]^e[i+30]^e[i+40];for(let i=0;i<10;i+=2){let a=(i+8)%10,c=(i+2)%10,m=r[c],u=r[c+1],p=zh(m,u,1)^r[a],l=Hh(m,u,1)^r[a+1];for(let d=0;d<50;d+=10)e[i+d]^=p,e[i+d+1]^=l}let n=e[2],s=e[3];for(let i=0;i<24;i++){let a=Gh[i],c=zh(n,s,a),m=Hh(n,s,a),u=jh[i];n=e[u],s=e[u+1],e[u]=c,e[u+1]=m}for(let i=0;i<50;i+=10){for(let a=0;a<10;a++)r[a]=e[i+a];for(let a=0;a<10;a++)e[i+a]^=~r[(a+2)%10]&r[(a+4)%10]}e[0]^=u2[o],e[1]^=p2[o]}_o(r)}var s2,ca,i2,a2,c2,m2,jh,Gh,Vh,qh,u2,p2,zh,Hh,Yl,f2,im,Xl=_(()=>{Fh();Jc();s2=BigInt(0),ca=BigInt(1),i2=BigInt(2),a2=BigInt(7),c2=BigInt(256),m2=BigInt(113),jh=[],Gh=[],Vh=[];for(let e=0,t=ca,r=1,o=0;e<24;e++){[r,o]=[o,(2*r+3*o)%5],jh.push(2*(5*o+r)),Gh.push((e+1)*(e+2)/2%64);let n=s2;for(let s=0;s<7;s++)t=(t<<ca^(t>>a2)*m2)%c2,t&i2&&(n^=ca<<(ca<<BigInt(s))-ca);Vh.push(n)}qh=Th(Vh,!0),u2=qh[0],p2=qh[1],zh=(e,t,r)=>r>32?Mh(e,t,r):$h(e,t,r),Hh=(e,t,r)=>r>32?Bh(e,t,r):Rh(e,t,r);Yl=class e extends us{constructor(t,r,o,n=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=t,this.suffix=r,this.outputLen=o,this.enableXOF=n,this.rounds=s,Jl(o),!(0<t&&t<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Ih(this.state)}clone(){return this._cloneInto()}keccak(){Zl(this.state32),l2(this.state32,this.rounds),Zl(this.state32),this.posOut=0,this.pos=0}update(t){ps(this),t=sa(t),hn(t);let{blockLen:r,state:o}=this,n=t.length;for(let s=0;s<n;){let i=Math.min(r-this.pos,n-s);for(let a=0;a<i;a++)o[this.pos++]^=t[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:t,suffix:r,pos:o,blockLen:n}=this;t[o]^=r,(r&128)!==0&&o===n-1&&this.keccak(),t[n-1]^=128,this.keccak()}writeInto(t){ps(this,!1),hn(t),this.finish();let r=this.state,{blockLen:o}=this;for(let n=0,s=t.length;n<s;){this.posOut>=o&&this.keccak();let i=Math.min(o-this.posOut,s-n);t.set(r.subarray(this.posOut,this.posOut+i),n),this.posOut+=i,n+=i}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return Jl(t),this.xofInto(new Uint8Array(t))}digestInto(t){if(qc(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,_o(this.state)}_cloneInto(t){let{blockLen:r,suffix:o,outputLen:n,rounds:s,enableXOF:i}=this;return t||(t=new e(r,o,n,i,s)),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=s,t.suffix=o,t.outputLen=n,t.enableXOF=i,t.destroyed=this.destroyed,t}},f2=(e,t,r)=>Wc(()=>new Yl(t,e,r)),im=f2(1,136,256/8)});function ce(e,t){let r=t||"hex",o=im(pe(e,{strict:!1})?Ht(e):e);return r==="bytes"?o:me(o)}var qt=_(()=>{Xl();Pt();qe();D()});function Yr(e,t){if(Ql.has(`${e}.${t}`))return Ql.get(`${e}.${t}`);let r=t?`${t}${e.toLowerCase()}`:e.substring(2).toLowerCase(),o=ce(ir(r),"bytes"),n=(t?r.substring(`${t}0x`.length):r).split("");for(let i=0;i<40;i+=2)o[i>>1]>>4>=8&&n[i]&&(n[i]=n[i].toUpperCase()),(o[i>>1]&15)>=8&&n[i+1]&&(n[i+1]=n[i+1].toUpperCase());let s=`0x${n.join("")}`;return Ql.set(`${e}.${t}`,s),s}function Cs(e,t){if(!te(e,{strict:!1}))throw new ae({address:e});return Yr(e,t)}var Ql,To=_(()=>{mr();qe();qt();ws();$t();Ql=new Vt(8192)});function te(e,t){let{strict:r=!0}=t??{},o=`${e}.${r}`;if(ef.has(o))return ef.get(o);let n=d2.test(e)?e.toLowerCase()===e?!0:r?Yr(e)===e:!0:!1;return ef.set(o,n),n}var d2,ef,$t=_(()=>{ws();To();d2=/^0x[a-fA-F0-9]{40}$/,ef=new Vt(8192)});function Kt(e,t,r,{strict:o}={}){return pe(e,{strict:!1})?am(e,t,r,{strict:o}):tf(e,t,r,{strict:o})}function Kh(e,t){if(typeof t=="number"&&t>0&&t>Q(e)-1)throw new Qi({offset:t,position:"start",size:Q(e)})}function Wh(e,t,r){if(typeof t=="number"&&typeof r=="number"&&Q(e)!==r-t)throw new Qi({offset:r,position:"end",size:Q(e)})}function tf(e,t,r,{strict:o}={}){Kh(e,t);let n=e.slice(t,r);return o&&Wh(n,t,r),n}function am(e,t,r,{strict:o}={}){Kh(e,t);let n=`0x${e.replace("0x","").slice((t??0)*2,(r??e.length)*2)}`;return o&&Wh(n,t,r),n}var $o=_(()=>{Tc();Pt();zt()});function Wt({blockNumber:e,chain:t,contract:r}){let o=t?.contracts?.[r];if(!o)throw new gn({chain:t,contract:{name:r}});if(e&&o.blockCreated&&o.blockCreated>e)throw new gn({blockNumber:e,chain:t,contract:{name:r,blockCreated:o.blockCreated}});return o.address}var bn=_(()=>{aa()});function V(e){return typeof e=="string"?{address:e,type:"json-rpc"}:e}var ke=_(()=>{});var rg,lm,og,fm=_(()=>{rg={1:"An `assert` condition failed.",17:"Arithmetic operation resulted in underflow or overflow.",18:"Division or modulo by zero (e.g. `5 / 0` or `23 % 0`).",33:"Attempted to convert to an invalid type.",34:"Attempted to access a storage byte array that is incorrectly encoded.",49:"Performed `.pop()` on an empty array",50:"Array index is out of bounds.",65:"Allocated too much memory or created an array which is too large.",81:"Attempted to call a zero-initialized variable of internal function type."},lm={inputs:[{name:"message",type:"string"}],name:"Error",type:"error"},og={inputs:[{name:"reason",type:"uint256"}],name:"Panic",type:"error"}});function He(e,{includeName:t=!1}={}){if(e.type!=="function"&&e.type!=="event"&&e.type!=="error")throw new dm(e.type);return`${e.name}(${la(e.inputs,{includeName:t})})`}function la(e,{includeName:t=!1}={}){return e?e.map(r=>k2(r,{includeName:t})).join(t?", ":","):""}function k2(e,{includeName:t}){return e.type.startsWith("tuple")?`(${la(e.components,{includeName:t})})${e.type.slice(5)}`:e.type+(t&&e.name?` ${e.name}`:"")}var Xr=_(()=>{Ie()});var hm,fa,Ss,Zt,gm,ym,bm,xm,da,ks,vm,Is,ha,ur,_s,wm,Cm,Em,pr,xr,Sm,km,As,dm,Ie=_(()=>{Xr();zt();G();hm=class extends w{constructor({docsPath:t}){super(["A constructor was not found on the ABI.","Make sure you are using the correct ABI and that the constructor exists on it."].join(`
`),{docsPath:t,name:"AbiConstructorNotFoundError"})}},fa=class extends w{constructor({docsPath:t}){super(["Constructor arguments were provided (`args`), but a constructor parameters (`inputs`) were not found on the ABI.","Make sure you are using the correct ABI, and that the `inputs` attribute on the constructor exists."].join(`
`),{docsPath:t,name:"AbiConstructorParamsNotFoundError"})}},Ss=class extends w{constructor({data:t,params:r,size:o}){super([`Data size of ${o} bytes is too small for given parameters.`].join(`
`),{metaMessages:[`Params: (${la(r,{includeName:!0})})`,`Data:   ${t} (${o} bytes)`],name:"AbiDecodingDataSizeTooSmallError"}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"params",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=t,this.params=r,this.size=o}},Zt=class extends w{constructor(){super('Cannot decode zero data ("0x") with ABI parameters.',{name:"AbiDecodingZeroDataError"})}},gm=class extends w{constructor({expectedLength:t,givenLength:r,type:o}){super([`ABI encoding array length mismatch for type ${o}.`,`Expected length: ${t}`,`Given length: ${r}`].join(`
`),{name:"AbiEncodingArrayLengthMismatchError"})}},ym=class extends w{constructor({expectedSize:t,value:r}){super(`Size of bytes "${r}" (bytes${Q(r)}) does not match expected size (bytes${t}).`,{name:"AbiEncodingBytesSizeMismatchError"})}},bm=class extends w{constructor({expectedLength:t,givenLength:r}){super(["ABI encoding params/values length mismatch.",`Expected length (params): ${t}`,`Given length (values): ${r}`].join(`
`),{name:"AbiEncodingLengthMismatchError"})}},xm=class extends w{constructor(t,{docsPath:r}){super([`Arguments (\`args\`) were provided to "${t}", but "${t}" on the ABI does not contain any parameters (\`inputs\`).`,"Cannot encode error result without knowing what the parameter types are.","Make sure you are using the correct ABI and that the inputs exist on it."].join(`
`),{docsPath:r,name:"AbiErrorInputsNotFoundError"})}},da=class extends w{constructor(t,{docsPath:r}={}){super([`Error ${t?`"${t}" `:""}not found on ABI.`,"Make sure you are using the correct ABI and that the error exists on it."].join(`
`),{docsPath:r,name:"AbiErrorNotFoundError"})}},ks=class extends w{constructor(t,{docsPath:r}){super([`Encoded error signature "${t}" not found on ABI.`,"Make sure you are using the correct ABI and that the error exists on it.",`You can look up the decoded signature here: https://openchain.xyz/signatures?query=${t}.`].join(`
`),{docsPath:r,name:"AbiErrorSignatureNotFoundError"}),Object.defineProperty(this,"signature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.signature=t}},vm=class extends w{constructor({docsPath:t}){super("Cannot extract event signature from empty topics.",{docsPath:t,name:"AbiEventSignatureEmptyTopicsError"})}},Is=class extends w{constructor(t,{docsPath:r}){super([`Encoded event signature "${t}" not found on ABI.`,"Make sure you are using the correct ABI and that the event exists on it.",`You can look up the signature here: https://openchain.xyz/signatures?query=${t}.`].join(`
`),{docsPath:r,name:"AbiEventSignatureNotFoundError"})}},ha=class extends w{constructor(t,{docsPath:r}={}){super([`Event ${t?`"${t}" `:""}not found on ABI.`,"Make sure you are using the correct ABI and that the event exists on it."].join(`
`),{docsPath:r,name:"AbiEventNotFoundError"})}},ur=class extends w{constructor(t,{docsPath:r}={}){super([`Function ${t?`"${t}" `:""}not found on ABI.`,"Make sure you are using the correct ABI and that the function exists on it."].join(`
`),{docsPath:r,name:"AbiFunctionNotFoundError"})}},_s=class extends w{constructor(t,{docsPath:r}){super([`Function "${t}" does not contain any \`outputs\` on ABI.`,"Cannot decode function result without knowing what the parameter types are.","Make sure you are using the correct ABI and that the function exists on it."].join(`
`),{docsPath:r,name:"AbiFunctionOutputsNotFoundError"})}},wm=class extends w{constructor(t,{docsPath:r}){super([`Encoded function signature "${t}" not found on ABI.`,"Make sure you are using the correct ABI and that the function exists on it.",`You can look up the signature here: https://openchain.xyz/signatures?query=${t}.`].join(`
`),{docsPath:r,name:"AbiFunctionSignatureNotFoundError"})}},Cm=class extends w{constructor(t,r){super("Found ambiguous types in overloaded ABI items.",{metaMessages:[`\`${t.type}\` in \`${He(t.abiItem)}\`, and`,`\`${r.type}\` in \`${He(r.abiItem)}\``,"","These types encode differently and cannot be distinguished at runtime.","Remove one of the ambiguous items in the ABI."],name:"AbiItemAmbiguityError"})}},Em=class extends w{constructor({expectedSize:t,givenSize:r}){super(`Expected bytes${t}, got bytes${r}.`,{name:"BytesSizeMismatchError"})}},pr=class extends w{constructor({abiItem:t,data:r,params:o,size:n}){super([`Data size of ${n} bytes is too small for non-indexed event parameters.`].join(`
`),{metaMessages:[`Params: (${la(o,{includeName:!0})})`,`Data:   ${r} (${n} bytes)`],name:"DecodeLogDataMismatch"}),Object.defineProperty(this,"abiItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"params",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.abiItem=t,this.data=r,this.params=o,this.size=n}},xr=class extends w{constructor({abiItem:t,param:r}){super([`Expected a topic for indexed event parameter${r.name?` "${r.name}"`:""} on event "${He(t,{includeName:!0})}".`].join(`
`),{name:"DecodeLogTopicsMismatch"}),Object.defineProperty(this,"abiItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.abiItem=t}},Sm=class extends w{constructor(t,{docsPath:r}){super([`Type "${t}" is not a valid encoding type.`,"Please provide a valid ABI type."].join(`
`),{docsPath:r,name:"InvalidAbiEncodingType"})}},km=class extends w{constructor(t,{docsPath:r}){super([`Type "${t}" is not a valid decoding type.`,"Please provide a valid ABI type."].join(`
`),{docsPath:r,name:"InvalidAbiDecodingType"})}},As=class extends w{constructor(t){super([`Value "${t}" is not a valid array.`].join(`
`),{name:"InvalidArrayError"})}},dm=class extends w{constructor(t){super([`"${t}" is not a valid definition type.`,'Valid types: "function", "event", "error"'].join(`
`),{name:"InvalidDefinitionTypeError"})}}});function ng(e){return I2(e)}var I2,sg=_(()=>{qe();qt();I2=e=>ce(Ht(e))});var ig,ag=_(()=>{ig="1.1.0"});var Re,Ps=_(()=>{ag();Re=class e extends Error{constructor(t,r={}){let o=r.cause instanceof e?r.cause.details:r.cause?.message?r.cause.message:r.details,n=r.cause instanceof e&&r.cause.docsPath||r.docsPath,s=[t||"An error occurred.","",...r.metaMessages?[...r.metaMessages,""]:[],...n?[`Docs: https://abitype.dev${n}`]:[],...o?[`Details: ${o}`]:[],`Version: abitype@${ig}`].join(`
`);super(s),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiTypeError"}),r.cause&&(this.cause=r.cause),this.details=o,this.docsPath=n,this.metaMessages=r.metaMessages,this.shortMessage=t}}});function Rt(e,t){return e.exec(t)?.groups}var of,nf,Im,ga=_(()=>{of=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,nf=/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/,Im=/^\(.+?\).*?$/});function _m(e){let t=e.type;if(cg.test(e.type)&&"components"in e){t="(";let r=e.components.length;for(let n=0;n<r;n++){let s=e.components[n];t+=_m(s),n<r-1&&(t+=", ")}let o=Rt(cg,e.type);return t+=`)${o?.array??""}`,_m({...e,type:t})}return"indexed"in e&&e.indexed&&(t=`${t} indexed`),e.name?`${t} ${e.name}`:t}var cg,mg=_(()=>{ga();cg=/^tuple(?<array>(\[(\d*)\])*)$/});function Qr(e){let t="",r=e.length;for(let o=0;o<r;o++){let n=e[o];t+=_m(n),o!==r-1&&(t+=", ")}return t}var sf=_(()=>{mg()});function xn(e){return e.type==="function"?`function ${e.name}(${Qr(e.inputs)})${e.stateMutability&&e.stateMutability!=="nonpayable"?` ${e.stateMutability}`:""}${e.outputs?.length?` returns (${Qr(e.outputs)})`:""}`:e.type==="event"?`event ${e.name}(${Qr(e.inputs)})`:e.type==="error"?`error ${e.name}(${Qr(e.inputs)})`:e.type==="constructor"?`constructor(${Qr(e.inputs)})${e.stateMutability==="payable"?" payable":""}`:e.type==="fallback"?`fallback() external${e.stateMutability==="payable"?" payable":""}`:"receive() external payable"}var ug=_(()=>{sf()});function lg(e){return pg.test(e)}function fg(e){return Rt(pg,e)}function hg(e){return dg.test(e)}function gg(e){return Rt(dg,e)}function bg(e){return yg.test(e)}function xg(e){return Rt(yg,e)}function Ro(e){return vg.test(e)}function wg(e){return Rt(vg,e)}function Eg(e){return Cg.test(e)}function Sg(e){return Rt(Cg,e)}function Ig(e){return kg.test(e)}function _g(e){return Rt(kg,e)}function Ag(e){return _2.test(e)}var pg,dg,yg,vg,Cg,kg,_2,af,Pg,Am,Ts=_(()=>{ga();pg=/^error (?<name>[a-zA-Z$_][a-zA-Z0-9$_]*)\((?<parameters>.*?)\)$/;dg=/^event (?<name>[a-zA-Z$_][a-zA-Z0-9$_]*)\((?<parameters>.*?)\)$/;yg=/^function (?<name>[a-zA-Z$_][a-zA-Z0-9$_]*)\((?<parameters>.*?)\)(?: (?<scope>external|public{1}))?(?: (?<stateMutability>pure|view|nonpayable|payable{1}))?(?: returns\s?\((?<returns>.*?)\))?$/;vg=/^struct (?<name>[a-zA-Z$_][a-zA-Z0-9$_]*) \{(?<properties>.*?)\}$/;Cg=/^constructor\((?<parameters>.*?)\)(?:\s(?<stateMutability>payable{1}))?$/;kg=/^fallback\(\) external(?:\s(?<stateMutability>payable{1}))?$/;_2=/^receive\(\) external payable$/;af=new Set(["memory","indexed","storage","calldata"]),Pg=new Set(["indexed"]),Am=new Set(["calldata","memory","storage"])});var Pm,Tm,$m,Rm=_(()=>{Ps();Pm=class extends Re{constructor({signature:t}){super("Failed to parse ABI item.",{details:`parseAbiItem(${JSON.stringify(t,null,2)})`,docsPath:"/api/human#parseabiitem-1"}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidAbiItemError"})}},Tm=class extends Re{constructor({type:t}){super("Unknown type.",{metaMessages:[`Type "${t}" is not a valid ABI type. Perhaps you forgot to include a struct signature?`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"UnknownTypeError"})}},$m=class extends Re{constructor({type:t}){super("Unknown type.",{metaMessages:[`Type "${t}" is not a valid ABI type.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"UnknownSolidityTypeError"})}}});var Mm,Bm,Fm,Dm,Nm,Lm,Om=_(()=>{Ps();Mm=class extends Re{constructor({params:t}){super("Failed to parse ABI parameters.",{details:`parseAbiParameters(${JSON.stringify(t,null,2)})`,docsPath:"/api/human#parseabiparameters-1"}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidAbiParametersError"})}},Bm=class extends Re{constructor({param:t}){super("Invalid ABI parameter.",{details:t}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidParameterError"})}},Fm=class extends Re{constructor({param:t,name:r}){super("Invalid ABI parameter.",{details:t,metaMessages:[`"${r}" is a protected Solidity keyword. More info: https://docs.soliditylang.org/en/latest/cheatsheet.html`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"SolidityProtectedKeywordError"})}},Dm=class extends Re{constructor({param:t,type:r,modifier:o}){super("Invalid ABI parameter.",{details:t,metaMessages:[`Modifier "${o}" not allowed${r?` in "${r}" type`:""}.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidModifierError"})}},Nm=class extends Re{constructor({param:t,type:r,modifier:o}){super("Invalid ABI parameter.",{details:t,metaMessages:[`Modifier "${o}" not allowed${r?` in "${r}" type`:""}.`,`Data location can only be specified for array, struct, or mapping types, but "${o}" was given.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidFunctionModifierError"})}},Lm=class extends Re{constructor({abiParameter:t}){super("Invalid ABI parameter.",{details:JSON.stringify(t,null,2),metaMessages:["ABI parameter type is invalid."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidAbiTypeParameterError"})}}});var vr,Um,zm,cf=_(()=>{Ps();vr=class extends Re{constructor({signature:t,type:r}){super(`Invalid ${r} signature.`,{details:t}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidSignatureError"})}},Um=class extends Re{constructor({signature:t}){super("Unknown signature.",{details:t}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"UnknownSignatureError"})}},zm=class extends Re{constructor({signature:t}){super("Invalid struct signature.",{details:t,metaMessages:["No properties exist."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidStructSignatureError"})}}});var Hm,Tg=_(()=>{Ps();Hm=class extends Re{constructor({type:t}){super("Circular reference detected.",{metaMessages:[`Struct "${t}" is a circular reference.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"CircularReferenceError"})}}});var jm,$g=_(()=>{Ps();jm=class extends Re{constructor({current:t,depth:r}){super("Unbalanced parentheses.",{metaMessages:[`"${t.trim()}" has too many ${r>0?"opening":"closing"} parentheses.`],details:`Depth "${r}"`}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidParenthesisError"})}}});function Rg(e,t,r){let o="";if(r)for(let n of Object.entries(r)){if(!n)continue;let s="";for(let i of n[1])s+=`[${i.type}${i.name?`:${i.name}`:""}]`;o+=`(${n[0]}{${s}})`}return t?`${t}:${e}${o}`:e}var Gm,Mg=_(()=>{Gm=new Map([["address",{type:"address"}],["bool",{type:"bool"}],["bytes",{type:"bytes"}],["bytes32",{type:"bytes32"}],["int",{type:"int256"}],["int256",{type:"int256"}],["string",{type:"string"}],["uint",{type:"uint256"}],["uint8",{type:"uint8"}],["uint16",{type:"uint16"}],["uint24",{type:"uint24"}],["uint32",{type:"uint32"}],["uint64",{type:"uint64"}],["uint96",{type:"uint96"}],["uint112",{type:"uint112"}],["uint160",{type:"uint160"}],["uint192",{type:"uint192"}],["uint256",{type:"uint256"}],["address owner",{type:"address",name:"owner"}],["address to",{type:"address",name:"to"}],["bool approved",{type:"bool",name:"approved"}],["bytes _data",{type:"bytes",name:"_data"}],["bytes data",{type:"bytes",name:"data"}],["bytes signature",{type:"bytes",name:"signature"}],["bytes32 hash",{type:"bytes32",name:"hash"}],["bytes32 r",{type:"bytes32",name:"r"}],["bytes32 root",{type:"bytes32",name:"root"}],["bytes32 s",{type:"bytes32",name:"s"}],["string name",{type:"string",name:"name"}],["string symbol",{type:"string",name:"symbol"}],["string tokenURI",{type:"string",name:"tokenURI"}],["uint tokenId",{type:"uint256",name:"tokenId"}],["uint8 v",{type:"uint8",name:"v"}],["uint256 balance",{type:"uint256",name:"balance"}],["uint256 tokenId",{type:"uint256",name:"tokenId"}],["uint256 value",{type:"uint256",name:"value"}],["event:address indexed from",{type:"address",name:"from",indexed:!0}],["event:address indexed to",{type:"address",name:"to",indexed:!0}],["event:uint indexed tokenId",{type:"uint256",name:"tokenId",indexed:!0}],["event:uint256 indexed tokenId",{type:"uint256",name:"tokenId",indexed:!0}]])});function ya(e,t={}){if(bg(e))return A2(e,t);if(hg(e))return P2(e,t);if(lg(e))return T2(e,t);if(Eg(e))return $2(e,t);if(Ig(e))return R2(e);if(Ag(e))return{type:"receive",stateMutability:"payable"};throw new Um({signature:e})}function A2(e,t={}){let r=xg(e);if(!r)throw new vr({signature:e,type:"function"});let o=vt(r.parameters),n=[],s=o.length;for(let a=0;a<s;a++)n.push(lr(o[a],{modifiers:Am,structs:t,type:"function"}));let i=[];if(r.returns){let a=vt(r.returns),c=a.length;for(let m=0;m<c;m++)i.push(lr(a[m],{modifiers:Am,structs:t,type:"function"}))}return{name:r.name,type:"function",stateMutability:r.stateMutability??"nonpayable",inputs:n,outputs:i}}function P2(e,t={}){let r=gg(e);if(!r)throw new vr({signature:e,type:"event"});let o=vt(r.parameters),n=[],s=o.length;for(let i=0;i<s;i++)n.push(lr(o[i],{modifiers:Pg,structs:t,type:"event"}));return{name:r.name,type:"event",inputs:n}}function T2(e,t={}){let r=fg(e);if(!r)throw new vr({signature:e,type:"error"});let o=vt(r.parameters),n=[],s=o.length;for(let i=0;i<s;i++)n.push(lr(o[i],{structs:t,type:"error"}));return{name:r.name,type:"error",inputs:n}}function $2(e,t={}){let r=Sg(e);if(!r)throw new vr({signature:e,type:"constructor"});let o=vt(r.parameters),n=[],s=o.length;for(let i=0;i<s;i++)n.push(lr(o[i],{structs:t,type:"constructor"}));return{type:"constructor",stateMutability:r.stateMutability??"nonpayable",inputs:n}}function R2(e){let t=_g(e);if(!t)throw new vr({signature:e,type:"fallback"});return{type:"fallback",stateMutability:t.stateMutability??"nonpayable"}}function lr(e,t){let r=Rg(e,t?.type,t?.structs);if(Gm.has(r))return Gm.get(r);let o=Im.test(e),n=Rt(o?B2:M2,e);if(!n)throw new Bm({param:e});if(n.name&&N2(n.name))throw new Fm({param:e,name:n.name});let s=n.name?{name:n.name}:{},i=n.modifier==="indexed"?{indexed:!0}:{},a=t?.structs??{},c,m={};if(o){c="tuple";let p=vt(n.type),l=[],d=p.length;for(let h=0;h<d;h++)l.push(lr(p[h],{structs:a}));m={components:l}}else if(n.type in a)c="tuple",m={components:a[n.type]};else if(F2.test(n.type))c=`${n.type}256`;else if(n.type==="address payable")c="address";else if(c=n.type,t?.type!=="struct"&&!mf(c))throw new $m({type:c});if(n.modifier){if(!t?.modifiers?.has?.(n.modifier))throw new Dm({param:e,type:t?.type,modifier:n.modifier});if(Am.has(n.modifier)&&!L2(c,!!n.array))throw new Nm({param:e,type:t?.type,modifier:n.modifier})}let u={type:`${c}${n.array??""}`,...s,...i,...m};return Gm.set(r,u),u}function vt(e,t=[],r="",o=0){let n=e.trim().length;for(let s=0;s<n;s++){let i=e[s],a=e.slice(s+1);switch(i){case",":return o===0?vt(a,[...t,r.trim()]):vt(a,t,`${r}${i}`,o);case"(":return vt(a,t,`${r}${i}`,o+1);case")":return vt(a,t,`${r}${i}`,o-1);default:return vt(a,t,`${r}${i}`,o)}}if(r==="")return t;if(o!==0)throw new jm({current:r,depth:o});return t.push(r.trim()),t}function mf(e){return e==="address"||e==="bool"||e==="function"||e==="string"||of.test(e)||nf.test(e)}function N2(e){return e==="address"||e==="bool"||e==="function"||e==="string"||e==="tuple"||of.test(e)||nf.test(e)||D2.test(e)}function L2(e,t){return t||e==="bytes"||e==="string"||e==="tuple"}var M2,B2,F2,D2,$s=_(()=>{ga();Rm();Om();cf();$g();Mg();Ts();M2=/^(?<type>[a-zA-Z$_][a-zA-Z0-9$_]*(?:\spayable)?)(?<array>(?:\[\d*?\])+?)?(?:\s(?<modifier>calldata|indexed|memory|storage{1}))?(?:\s(?<name>[a-zA-Z$_][a-zA-Z0-9$_]*))?$/,B2=/^\((?<type>.+?)\)(?<array>(?:\[\d*?\])+?)?(?:\s(?<modifier>calldata|indexed|memory|storage{1}))?(?:\s(?<name>[a-zA-Z$_][a-zA-Z0-9$_]*))?$/,F2=/^u?int$/;D2=/^(?:after|alias|anonymous|apply|auto|byte|calldata|case|catch|constant|copyof|default|defined|error|event|external|false|final|function|immutable|implements|in|indexed|inline|internal|let|mapping|match|memory|mutable|null|of|override|partial|private|promise|public|pure|reference|relocatable|return|returns|sizeof|static|storage|struct|super|supports|switch|this|true|try|typedef|typeof|var|view|virtual)$/});function Rs(e){let t={},r=e.length;for(let i=0;i<r;i++){let a=e[i];if(!Ro(a))continue;let c=wg(a);if(!c)throw new vr({signature:a,type:"struct"});let m=c.properties.split(";"),u=[],p=m.length;for(let l=0;l<p;l++){let h=m[l].trim();if(!h)continue;let g=lr(h,{type:"struct"});u.push(g)}if(!u.length)throw new zm({signature:a});t[c.name]=u}let o={},n=Object.entries(t),s=n.length;for(let i=0;i<s;i++){let[a,c]=n[i];o[a]=Bg(c,t)}return o}function Bg(e,t,r=new Set){let o=[],n=e.length;for(let s=0;s<n;s++){let i=e[s];if(Im.test(i.type))o.push(i);else{let c=Rt(O2,i.type);if(!c?.type)throw new Lm({abiParameter:i});let{array:m,type:u}=c;if(u in t){if(r.has(u))throw new Hm({type:u});o.push({...i,type:`tuple${m??""}`,components:Bg(t[u]??[],t,new Set([...r,u]))})}else if(mf(u))o.push(i);else throw new Tm({type:u})}}return o}var O2,Vm=_(()=>{ga();Rm();Om();cf();Tg();Ts();$s();O2=/^(?<type>[a-zA-Z$_][a-zA-Z0-9$_]*)(?<array>(?:\[\d*?\])+?)?$/});function qm(e){let t=Rs(e),r=[],o=e.length;for(let n=0;n<o;n++){let s=e[n];Ro(s)||r.push(ya(s,t))}return r}var Fg=_(()=>{Ts();Vm();$s()});function Km(e){let t;if(typeof e=="string")t=ya(e);else{let r=Rs(e),o=e.length;for(let n=0;n<o;n++){let s=e[n];if(!Ro(s)){t=ya(s,r);break}}}if(!t)throw new Pm({signature:e});return t}var Dg=_(()=>{Rm();Ts();Vm();$s()});function Wm(e){let t=[];if(typeof e=="string"){let r=vt(e),o=r.length;for(let n=0;n<o;n++)t.push(lr(r[n],{modifiers:af}))}else{let r=Rs(e),o=e.length;for(let n=0;n<o;n++){let s=e[n];if(Ro(s))continue;let i=vt(s),a=i.length;for(let c=0;c<a;c++)t.push(lr(i[c],{modifiers:af,structs:r}))}}if(t.length===0)throw new Mm({params:e});return t}var Ng=_(()=>{Om();Ts();Vm();$s();$s()});var ba=_(()=>{ug();sf();Fg();Dg();Ng()});function Og(e){let t=!0,r="",o=0,n="",s=!1;for(let i=0;i<e.length;i++){let a=e[i];if(["(",")",","].includes(a)&&(t=!0),a==="("&&o++,a===")"&&o--,!!t){if(o===0){if(a===" "&&["event","function",""].includes(n))n="";else if(n+=a,a===")"){s=!0;break}continue}if(a===" "){e[i-1]!==","&&r!==","&&r!==",("&&(r="",t=!1);continue}n+=a,r+=a}}if(!s)throw new w("Unable to normalize signature.");return n}var Ug=_(()=>{G()});var zg,Hg=_(()=>{ba();Ug();zg=e=>{let t=typeof e=="string"?e:xn(e);return Og(t)}});function Jm(e){return ng(zg(e))}var uf=_(()=>{sg();Hg()});var wr,Ms=_(()=>{$o();uf();wr=e=>Kt(Jm(e),0,4)});function jg(e,t={}){typeof t.size<"u"&&bt(e,{size:t.size});let r=ee(e,t);return ue(r,t)}function Gg(e,t={}){let r=e;if(typeof t.size<"u"&&(bt(r,{size:t.size}),r=Ve(r)),r.length>1||r[0]>1)throw new _c(r);return!!r[0]}function Cr(e,t={}){typeof t.size<"u"&&bt(e,{size:t.size});let r=ee(e,t);return Ce(r,t)}function Vg(e,t={}){let r=e;return typeof t.size<"u"&&(bt(r,{size:t.size}),r=Ve(r,{dir:"right"})),new TextDecoder().decode(r)}var qg=_(()=>{Xi();ln();Oe();D()});var Kg,Zm,pf=_(()=>{Kg=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,Zm=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/});function pt(e,t){if(e.length!==t.length)throw new bm({expectedLength:e.length,givenLength:t.length});let r=U2({params:e,values:t}),o=ff(r);return o.length===0?"0x":o}function U2({params:e,values:t}){let r=[];for(let o=0;o<e.length;o++)r.push(lf({param:e[o],value:t[o]}));return r}function lf({param:e,value:t}){let r=Ym(e.type);if(r){let[o,n]=r;return H2(t,{length:o,param:{...e,type:n}})}if(e.type==="tuple")return K2(t,{param:e});if(e.type==="address")return z2(t);if(e.type==="bool")return G2(t);if(e.type.startsWith("uint")||e.type.startsWith("int")){let o=e.type.startsWith("int"),[,,n="256"]=Zm.exec(e.type)??[];return V2(t,{signed:o,size:Number(n)})}if(e.type.startsWith("bytes"))return j2(t,{param:e});if(e.type==="string")return q2(t);throw new Sm(e.type,{docsPath:"/docs/contract/encodeAbiParameters"})}function ff(e){let t=0;for(let s=0;s<e.length;s++){let{dynamic:i,encoded:a}=e[s];i?t+=32:t+=Q(a)}let r=[],o=[],n=0;for(let s=0;s<e.length;s++){let{dynamic:i,encoded:a}=e[s];i?(r.push(S(t+n,{size:32})),o.push(a),n+=Q(a)):r.push(a)}return Fe([...r,...o])}function z2(e){if(!te(e))throw new ae({address:e});return{dynamic:!1,encoded:Kr(e.toLowerCase())}}function H2(e,{length:t,param:r}){let o=t===null;if(!Array.isArray(e))throw new As(e);if(!o&&e.length!==t)throw new gm({expectedLength:t,givenLength:e.length,type:`${r.type}[${t}]`});let n=!1,s=[];for(let i=0;i<e.length;i++){let a=lf({param:r,value:e[i]});a.dynamic&&(n=!0),s.push(a)}if(o||n){let i=ff(s);if(o){let a=S(s.length,{size:32});return{dynamic:!0,encoded:s.length>0?Fe([a,i]):a}}if(n)return{dynamic:!0,encoded:i}}return{dynamic:!1,encoded:Fe(s.map(({encoded:i})=>i))}}function j2(e,{param:t}){let[,r]=t.type.split("bytes"),o=Q(e);if(!r){let n=e;return o%32!==0&&(n=Kr(n,{dir:"right",size:Math.ceil((e.length-2)/2/32)*32})),{dynamic:!0,encoded:Fe([Kr(S(o,{size:32})),n])}}if(o!==Number.parseInt(r,10))throw new ym({expectedSize:Number.parseInt(r,10),value:e});return{dynamic:!1,encoded:Kr(e,{dir:"right"})}}function G2(e){if(typeof e!="boolean")throw new w(`Invalid boolean value: "${e}" (type: ${typeof e}). Expected: \`true\` or \`false\`.`);return{dynamic:!1,encoded:Kr(Rc(e))}}function V2(e,{signed:t,size:r=256}){if(typeof r=="number"){let o=2n**(BigInt(r)-(t?1n:0n))-1n,n=t?-o-1n:0n;if(e>o||e<n)throw new Yn({max:o.toString(),min:n.toString(),signed:t,size:r/8,value:e.toString()})}return{dynamic:!1,encoded:S(e,{size:32,signed:t})}}function q2(e){let t=sr(e),r=Math.ceil(Q(t)/32),o=[];for(let n=0;n<r;n++)o.push(Kr(Kt(t,n*32,(n+1)*32),{dir:"right"}));return{dynamic:!0,encoded:Fe([Kr(S(Q(t),{size:32})),...o])}}function K2(e,{param:t}){let r=!1,o=[];for(let n=0;n<t.components.length;n++){let s=t.components[n],i=Array.isArray(e)?n:s.name,a=lf({param:s,value:e[i]});o.push(a),a.dynamic&&(r=!0)}return{dynamic:r,encoded:r?ff(o):Fe(o.map(({encoded:n})=>n))}}function Ym(e){let t=e.match(/^(.*)\[(\d+)?\]$/);return t?[t[2]?Number(t[2]):null,t[1]]:void 0}var eo=_(()=>{Ie();mr();G();Xi();$t();ut();$c();zt();$o();D();pf()});function to(e,t){let r=typeof t=="string"?Ue(t):t,o=ts(r);if(Q(r)===0&&e.length>0)throw new Zt;if(Q(t)&&Q(t)<32)throw new Ss({data:typeof t=="string"?t:ee(t),params:e,size:Q(t)});let n=0,s=[];for(let i=0;i<e.length;++i){let a=e[i];o.setPosition(n);let[c,m]=Bs(o,a,{staticPosition:0});n+=m,s.push(c)}return s}function Bs(e,t,{staticPosition:r}){let o=Ym(t.type);if(o){let[n,s]=o;return J2(e,{...t,type:s},{length:n,staticPosition:r})}if(t.type==="tuple")return Q2(e,t,{staticPosition:r});if(t.type==="address")return W2(e);if(t.type==="bool")return Z2(e);if(t.type.startsWith("bytes"))return Y2(e,t,{staticPosition:r});if(t.type.startsWith("uint")||t.type.startsWith("int"))return X2(e,t);if(t.type==="string")return eE(e,{staticPosition:r});throw new km(t.type,{docsPath:"/docs/contract/decodeAbiParameters"})}function W2(e){let t=e.readBytes(32);return[Yr(ee(tf(t,-20))),32]}function J2(e,t,{length:r,staticPosition:o}){if(!r){let i=Cr(e.readBytes(df)),a=o+i,c=a+Wg;e.setPosition(a);let m=Cr(e.readBytes(Wg)),u=xa(t),p=0,l=[];for(let d=0;d<m;++d){e.setPosition(c+(u?d*32:p));let[h,g]=Bs(e,t,{staticPosition:c});p+=g,l.push(h)}return e.setPosition(o+32),[l,32]}if(xa(t)){let i=Cr(e.readBytes(df)),a=o+i,c=[];for(let m=0;m<r;++m){e.setPosition(a+m*32);let[u]=Bs(e,t,{staticPosition:a});c.push(u)}return e.setPosition(o+32),[c,32]}let n=0,s=[];for(let i=0;i<r;++i){let[a,c]=Bs(e,t,{staticPosition:o+n});n+=c,s.push(a)}return[s,n]}function Z2(e){return[Gg(e.readBytes(32),{size:32}),32]}function Y2(e,t,{staticPosition:r}){let[o,n]=t.type.split("bytes");if(!n){let i=Cr(e.readBytes(32));e.setPosition(r+i);let a=Cr(e.readBytes(32));if(a===0)return e.setPosition(r+32),["0x",32];let c=e.readBytes(a);return e.setPosition(r+32),[ee(c),32]}return[ee(e.readBytes(Number.parseInt(n,10),32)),32]}function X2(e,t){let r=t.type.startsWith("int"),o=Number.parseInt(t.type.split("int")[1]||"256",10),n=e.readBytes(32);return[o>48?jg(n,{signed:r}):Cr(n,{signed:r}),32]}function Q2(e,t,{staticPosition:r}){let o=t.components.length===0||t.components.some(({name:i})=>!i),n=o?[]:{},s=0;if(xa(t)){let i=Cr(e.readBytes(df)),a=r+i;for(let c=0;c<t.components.length;++c){let m=t.components[c];e.setPosition(a+s);let[u,p]=Bs(e,m,{staticPosition:a});s+=p,n[o?c:m?.name]=u}return e.setPosition(r+32),[n,32]}for(let i=0;i<t.components.length;++i){let a=t.components[i],[c,m]=Bs(e,a,{staticPosition:r});n[o?i:a?.name]=c,s+=m}return[n,s]}function eE(e,{staticPosition:t}){let r=Cr(e.readBytes(32)),o=t+r;e.setPosition(o);let n=Cr(e.readBytes(32));if(n===0)return e.setPosition(t+32),["",32];let s=e.readBytes(n,32),i=Vg(Ve(s));return e.setPosition(t+32),[i,32]}function xa(e){let{type:t}=e;if(t==="string"||t==="bytes"||t.endsWith("[]"))return!0;if(t==="tuple")return e.components?.some(xa);let r=Ym(e.type);return!!(r&&xa({...e,type:r[1]}))}var Wg,df,va=_(()=>{Ie();To();Fc();zt();$o();ln();qg();qe();D();eo();Wg=32,df=32});function Xm(e){let{abi:t,data:r}=e,o=Kt(r,0,4);if(o==="0x")throw new Zt;let s=[...t||[],lm,og].find(i=>i.type==="error"&&o===wr(He(i)));if(!s)throw new ks(o,{docsPath:"/docs/contract/decodeErrorResult"});return{abiItem:s,args:"inputs"in s&&s.inputs&&s.inputs.length>0?to(s.inputs,Kt(r,4)):void 0,errorName:s.name}}var hf=_(()=>{fm();Ie();$o();Ms();va();Xr()});var Z,rt=_(()=>{Z=(e,t,r)=>JSON.stringify(e,(o,n)=>{let s=typeof n=="bigint"?n.toString():n;return typeof t=="function"?t(o,s):s},r)});function gf({abiItem:e,args:t,includeFunctionName:r=!0,includeName:o=!1}){if("name"in e&&"inputs"in e&&e.inputs)return`${r?e.name:""}(${e.inputs.map((n,s)=>`${o&&n.name?`${n.name}: `:""}${typeof t[s]=="object"?Z(t[s]):t[s]}`).join(", ")})`}var Jg=_(()=>{rt()});var Mo,wa=_(()=>{uf();Mo=Jm});function wt(e){let{abi:t,args:r=[],name:o}=e,n=pe(o,{strict:!1}),s=t.filter(a=>n?a.type==="function"?wr(a)===o:a.type==="event"?Mo(a)===o:!1:"name"in a&&a.name===o);if(s.length===0)return;if(s.length===1)return s[0];let i;for(let a of s){if(!("inputs"in a))continue;if(!r||r.length===0){if(!a.inputs||a.inputs.length===0)return a;continue}if(!a.inputs||a.inputs.length===0||a.inputs.length!==r.length)continue;if(r.every((m,u)=>{let p="inputs"in a&&a.inputs[u];return p?yf(m,p):!1})){if(i&&"inputs"in i&&i.inputs){let m=Zg(a.inputs,i.inputs,r);if(m)throw new Cm({abiItem:a,type:m[0]},{abiItem:i,type:m[1]})}i=a}}return i||s[0]}function yf(e,t){let r=typeof e,o=t.type;switch(o){case"address":return te(e,{strict:!1});case"bool":return r==="boolean";case"function":return r==="string";case"string":return r==="string";default:return o==="tuple"&&"components"in t?Object.values(t.components).every((n,s)=>yf(Object.values(e)[s],n)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(o)?r==="number"||r==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(o)?r==="string"||e instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(o)?Array.isArray(e)&&e.every(n=>yf(n,{...t,type:o.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function Zg(e,t,r){for(let o in e){let n=e[o],s=t[o];if(n.type==="tuple"&&s.type==="tuple"&&"components"in n&&"components"in s)return Zg(n.components,s.components,r[o]);let i=[n.type,s.type];if(i.includes("address")&&i.includes("bytes20")?!0:i.includes("address")&&i.includes("string")?te(r[o],{strict:!1}):i.includes("address")&&i.includes("bytes")?te(r[o],{strict:!1}):!1)return i}}var Bo=_(()=>{Ie();Pt();$t();wa();Ms()});function Yg(e){return e.reduce((t,{slot:r,value:o})=>`${t}        ${r}: ${o}
`,"")}function Xg(e){return e.reduce((t,{address:r,...o})=>{let n=`${t}    ${r}:
`;return o.nonce&&(n+=`      nonce: ${o.nonce}
`),o.balance&&(n+=`      balance: ${o.balance}
`),o.code&&(n+=`      code: ${o.code}
`),o.state&&(n+=`      state:
`,n+=Yg(o.state)),o.stateDiff&&(n+=`      stateDiff:
`,n+=Yg(o.stateDiff)),n},`  State Override:
`).slice(0,-1)}var Qm,eu,bf=_(()=>{G();Qm=class extends w{constructor({address:t}){super(`State for account "${t}" is set multiple times.`,{name:"AccountStateConflictError"})}},eu=class extends w{constructor(){super("state and stateDiff are set on the same account.",{name:"StateAssignmentConflictError"})}}});var Qg,vn,tu=_(()=>{Qg=e=>e,vn=e=>e});var Fs,Ds,wn,ru,ou,Er,Fo=_(()=>{ke();fm();hf();Xr();Jg();Bo();Oc();os();Ie();G();bf();Tt();tu();Fs=class extends w{constructor(t,{account:r,docsPath:o,chain:n,data:s,gas:i,gasPrice:a,maxFeePerGas:c,maxPriorityFeePerGas:m,nonce:u,to:p,value:l,stateOverride:d}){let h=r?V(r):void 0,g=dn({from:h?.address,to:p,value:typeof l<"u"&&`${rs(l)} ${n?.nativeCurrency?.symbol||"ETH"}`,data:s,gas:i,gasPrice:typeof a<"u"&&`${ze(a)} gwei`,maxFeePerGas:typeof c<"u"&&`${ze(c)} gwei`,maxPriorityFeePerGas:typeof m<"u"&&`${ze(m)} gwei`,nonce:u});d&&(g+=`
${Xg(d)}`),super(t.shortMessage,{cause:t,docsPath:o,metaMessages:[...t.metaMessages?[...t.metaMessages," "]:[],"Raw Call Arguments:",g].filter(Boolean),name:"CallExecutionError"}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cause=t}},Ds=class extends w{constructor(t,{abi:r,args:o,contractAddress:n,docsPath:s,functionName:i,sender:a}){let c=wt({abi:r,args:o,name:i}),m=c?gf({abiItem:c,args:o,includeFunctionName:!1,includeName:!1}):void 0,u=c?He(c,{includeName:!0}):void 0,p=dn({address:n&&Qg(n),function:u,args:m&&m!=="()"&&`${[...Array(i?.length??0).keys()].map(()=>" ").join("")}${m}`,sender:a});super(t.shortMessage||`An unknown error occurred while executing the contract function "${i}".`,{cause:t,docsPath:s,metaMessages:[...t.metaMessages?[...t.metaMessages," "]:[],p&&"Contract Call:",p].filter(Boolean),name:"ContractFunctionExecutionError"}),Object.defineProperty(this,"abi",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"args",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"contractAddress",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formattedArgs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"functionName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sender",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.abi=r,this.args=o,this.cause=t,this.contractAddress=n,this.functionName=i,this.sender=a}},wn=class extends w{constructor({abi:t,data:r,functionName:o,message:n}){let s,i,a,c;if(r&&r!=="0x")try{i=Xm({abi:t,data:r});let{abiItem:u,errorName:p,args:l}=i;if(p==="Error")c=l[0];else if(p==="Panic"){let[d]=l;c=rg[d]}else{let d=u?He(u,{includeName:!0}):void 0,h=u&&l?gf({abiItem:u,args:l,includeFunctionName:!1,includeName:!1}):void 0;a=[d?`Error: ${d}`:"",h&&h!=="()"?`       ${[...Array(p?.length??0).keys()].map(()=>" ").join("")}${h}`:""]}}catch(u){s=u}else n&&(c=n);let m;s instanceof ks&&(m=s.signature,a=[`Unable to decode signature "${m}" as it was not found on the provided ABI.`,"Make sure you are using the correct ABI and that the error exists on it.",`You can look up the decoded signature here: https://openchain.xyz/signatures?query=${m}.`]),super(c&&c!=="execution reverted"||m?[`The contract function "${o}" reverted with the following ${m?"signature":"reason"}:`,c||m].join(`
`):`The contract function "${o}" reverted.`,{cause:s,metaMessages:a,name:"ContractFunctionRevertedError"}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"raw",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reason",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=i,this.raw=r,this.reason=c,this.signature=m}},ru=class extends w{constructor({functionName:t}){super(`The contract function "${t}" returned no data ("0x").`,{metaMessages:["This could be due to any of the following:",`  - The contract does not have the function "${t}",`,"  - The parameters passed to the contract function may be invalid, or","  - The address is not a contract."],name:"ContractFunctionZeroDataError"})}},ou=class extends w{constructor({factory:t}){super(`Deployment for counterfactual contract call failed${t?` for factory "${t}".`:""}`,{metaMessages:["Please ensure:","- The `factory` is a valid contract deployment factory (ie. Create2 Factory, ERC-4337 Factory, etc).","- The `factoryData` is a valid encoded function call for contract deployment function on the factory."],name:"CounterfactualDeploymentFailedError"})}},Er=class extends w{constructor({data:t,message:r}){super(r||"",{name:"RawContractError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=t}}});var Yt,Do,Ca,Cn=_(()=>{rt();G();tu();Yt=class extends w{constructor({body:t,cause:r,details:o,headers:n,status:s,url:i}){super("HTTP request failed.",{cause:r,details:o,metaMessages:[s&&`Status: ${s}`,`URL: ${vn(i)}`,t&&`Request body: ${Z(t)}`].filter(Boolean),name:"HttpRequestError"}),Object.defineProperty(this,"body",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.body=t,this.headers=n,this.status=s,this.url=i}},Do=class extends w{constructor({body:t,error:r,url:o}){super("RPC Request failed.",{cause:r,details:r.message,metaMessages:[`URL: ${vn(o)}`,`Request body: ${Z(t)}`],name:"RpcRequestError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.code=r.code,this.data=r.data}},Ca=class extends w{constructor({body:t,url:r}){super("The request took too long to respond.",{details:"The request timed out.",metaMessages:[`URL: ${vn(r)}`,`Request body: ${Z(t)}`],name:"TimeoutError"})}}});var tE,ot,lt,Ns,Ls,Os,Us,ro,Sr,zs,Hs,js,No,En,Gs,Sn,Vs,qs,Ks,Ws,Js,Lo,Zs,Ys,Xs,Qs,ei,Oo,nu,ti=_(()=>{G();Cn();tE=-1,ot=class extends w{constructor(t,{code:r,docsPath:o,metaMessages:n,name:s,shortMessage:i}){super(i,{cause:t,docsPath:o,metaMessages:n||t?.metaMessages,name:s||"RpcError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=s||t.name,this.code=t instanceof Do?t.code:r??tE}},lt=class extends ot{constructor(t,r){super(t,r),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=r.data}},Ns=class e extends ot{constructor(t){super(t,{code:e.code,name:"ParseRpcError",shortMessage:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."})}};Object.defineProperty(Ns,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32700});Ls=class e extends ot{constructor(t){super(t,{code:e.code,name:"InvalidRequestRpcError",shortMessage:"JSON is not a valid request object."})}};Object.defineProperty(Ls,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32600});Os=class e extends ot{constructor(t,{method:r}={}){super(t,{code:e.code,name:"MethodNotFoundRpcError",shortMessage:`The method${r?` "${r}"`:""} does not exist / is not available.`})}};Object.defineProperty(Os,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32601});Us=class e extends ot{constructor(t){super(t,{code:e.code,name:"InvalidParamsRpcError",shortMessage:["Invalid parameters were provided to the RPC method.","Double check you have provided the correct parameters."].join(`
`)})}};Object.defineProperty(Us,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32602});ro=class e extends ot{constructor(t){super(t,{code:e.code,name:"InternalRpcError",shortMessage:"An internal error was received."})}};Object.defineProperty(ro,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32603});Sr=class e extends ot{constructor(t){super(t,{code:e.code,name:"InvalidInputRpcError",shortMessage:["Missing or invalid parameters.","Double check you have provided the correct parameters."].join(`
`)})}};Object.defineProperty(Sr,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32e3});zs=class e extends ot{constructor(t){super(t,{code:e.code,name:"ResourceNotFoundRpcError",shortMessage:"Requested resource not found."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ResourceNotFoundRpcError"})}};Object.defineProperty(zs,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32001});Hs=class e extends ot{constructor(t){super(t,{code:e.code,name:"ResourceUnavailableRpcError",shortMessage:"Requested resource not available."})}};Object.defineProperty(Hs,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32002});js=class e extends ot{constructor(t){super(t,{code:e.code,name:"TransactionRejectedRpcError",shortMessage:"Transaction creation failed."})}};Object.defineProperty(js,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32003});No=class e extends ot{constructor(t,{method:r}={}){super(t,{code:e.code,name:"MethodNotSupportedRpcError",shortMessage:`Method${r?` "${r}"`:""} is not supported.`})}};Object.defineProperty(No,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32004});En=class e extends ot{constructor(t){super(t,{code:e.code,name:"LimitExceededRpcError",shortMessage:"Request exceeds defined limit."})}};Object.defineProperty(En,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32005});Gs=class e extends ot{constructor(t){super(t,{code:e.code,name:"JsonRpcVersionUnsupportedError",shortMessage:"Version of JSON-RPC protocol is not supported."})}};Object.defineProperty(Gs,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32006});Sn=class e extends lt{constructor(t){super(t,{code:e.code,name:"UserRejectedRequestError",shortMessage:"User rejected the request."})}};Object.defineProperty(Sn,"code",{enumerable:!0,configurable:!0,writable:!0,value:4001});Vs=class e extends lt{constructor(t){super(t,{code:e.code,name:"UnauthorizedProviderError",shortMessage:"The requested method and/or account has not been authorized by the user."})}};Object.defineProperty(Vs,"code",{enumerable:!0,configurable:!0,writable:!0,value:4100});qs=class e extends lt{constructor(t,{method:r}={}){super(t,{code:e.code,name:"UnsupportedProviderMethodError",shortMessage:`The Provider does not support the requested method${r?` " ${r}"`:""}.`})}};Object.defineProperty(qs,"code",{enumerable:!0,configurable:!0,writable:!0,value:4200});Ks=class e extends lt{constructor(t){super(t,{code:e.code,name:"ProviderDisconnectedError",shortMessage:"The Provider is disconnected from all chains."})}};Object.defineProperty(Ks,"code",{enumerable:!0,configurable:!0,writable:!0,value:4900});Ws=class e extends lt{constructor(t){super(t,{code:e.code,name:"ChainDisconnectedError",shortMessage:"The Provider is not connected to the requested chain."})}};Object.defineProperty(Ws,"code",{enumerable:!0,configurable:!0,writable:!0,value:4901});Js=class e extends lt{constructor(t){super(t,{code:e.code,name:"SwitchChainError",shortMessage:"An error occurred when attempting to switch chain."})}};Object.defineProperty(Js,"code",{enumerable:!0,configurable:!0,writable:!0,value:4902});Lo=class e extends lt{constructor(t){super(t,{code:e.code,name:"UnsupportedNonOptionalCapabilityError",shortMessage:"This Wallet does not support a capability that was not marked as optional."})}};Object.defineProperty(Lo,"code",{enumerable:!0,configurable:!0,writable:!0,value:5700});Zs=class e extends lt{constructor(t){super(t,{code:e.code,name:"UnsupportedChainIdError",shortMessage:"This Wallet does not support the requested chain ID."})}};Object.defineProperty(Zs,"code",{enumerable:!0,configurable:!0,writable:!0,value:5710});Ys=class e extends lt{constructor(t){super(t,{code:e.code,name:"DuplicateIdError",shortMessage:"There is already a bundle submitted with this ID."})}};Object.defineProperty(Ys,"code",{enumerable:!0,configurable:!0,writable:!0,value:5720});Xs=class e extends lt{constructor(t){super(t,{code:e.code,name:"UnknownBundleIdError",shortMessage:"This bundle id is unknown / has not been submitted"})}};Object.defineProperty(Xs,"code",{enumerable:!0,configurable:!0,writable:!0,value:5730});Qs=class e extends lt{constructor(t){super(t,{code:e.code,name:"BundleTooLargeError",shortMessage:"The call bundle is too large for the Wallet to process."})}};Object.defineProperty(Qs,"code",{enumerable:!0,configurable:!0,writable:!0,value:5740});ei=class e extends lt{constructor(t){super(t,{code:e.code,name:"AtomicReadyWalletRejectedUpgradeError",shortMessage:"The Wallet can support atomicity after an upgrade, but the user rejected the upgrade."})}};Object.defineProperty(ei,"code",{enumerable:!0,configurable:!0,writable:!0,value:5750});Oo=class e extends lt{constructor(t){super(t,{code:e.code,name:"AtomicityNotSupportedError",shortMessage:"The wallet does not support atomic execution but the request requires it."})}};Object.defineProperty(Oo,"code",{enumerable:!0,configurable:!0,writable:!0,value:5760});nu=class extends ot{constructor(t){super(t,{name:"UnknownRpcError",shortMessage:"An unknown RPC error occurred."})}}});function Uo(e,t){let r=(e.details||"").toLowerCase(),o=e instanceof w?e.walk(n=>n?.code===Zr.code):e;return o instanceof w?new Zr({cause:e,message:o.details}):Zr.nodeMessage.test(r)?new Zr({cause:e,message:e.details}):jt.nodeMessage.test(r)?new jt({cause:e,maxFeePerGas:t?.maxFeePerGas}):fs.nodeMessage.test(r)?new fs({cause:e,maxFeePerGas:t?.maxFeePerGas}):ds.nodeMessage.test(r)?new ds({cause:e,nonce:t?.nonce}):hs.nodeMessage.test(r)?new hs({cause:e,nonce:t?.nonce}):gs.nodeMessage.test(r)?new gs({cause:e,nonce:t?.nonce}):ys.nodeMessage.test(r)?new ys({cause:e}):bs.nodeMessage.test(r)?new bs({cause:e,gas:t?.gas}):xs.nodeMessage.test(r)?new xs({cause:e,gas:t?.gas}):vs.nodeMessage.test(r)?new vs({cause:e}):br.nodeMessage.test(r)?new br({cause:e,maxFeePerGas:t?.maxFeePerGas,maxPriorityFeePerGas:t?.maxPriorityFeePerGas}):new Gt({cause:e})}var Ea=_(()=>{G();Po()});function su(e,{docsPath:t,...r}){let o=(()=>{let n=Uo(e,r);return n instanceof Gt?e:n})();return new Fs(o,{docsPath:t,...r})}var xf=_(()=>{Fo();Po();Ea()});function kr(e,{format:t}){if(!t)return{};let r={};function o(s){let i=Object.keys(s);for(let a of i)a in e&&(r[a]=e[a]),s[a]&&typeof s[a]=="object"&&!Array.isArray(s[a])&&o(s[a])}let n=t(e||{});return o(n),r}var ri=_(()=>{});function nt(e){let{account:t,gasPrice:r,maxFeePerGas:o,maxPriorityFeePerGas:n,to:s}=e,i=t?V(t):void 0;if(i&&!te(i.address))throw new ae({address:i.address});if(s&&!te(s))throw new ae({address:s});if(typeof r<"u"&&(typeof o<"u"||typeof n<"u"))throw new Uc;if(o&&o>Qn)throw new jt({maxFeePerGas:o});if(n&&o&&n>o)throw new br({maxFeePerGas:o,maxPriorityFeePerGas:n})}var oo=_(()=>{ke();ql();mr();Po();Tt();$t()});function oy(e){let{abi:t,args:r,functionName:o}=e,n=t[0];if(o){let s=wt({abi:t,args:r,name:o});if(!s)throw new ur(o,{docsPath:ry});n=s}if(n.type!=="function")throw new ur(void 0,{docsPath:ry});return{abi:[n],functionName:wr(He(n))}}var ry,ny=_(()=>{Ie();Ms();Xr();Bo();ry="/docs/contract/encodeFunctionData"});function de(e){let{args:t}=e,{abi:r,functionName:o}=e.abi.length===1&&e.functionName?.startsWith("0x")?e:oy(e),n=r[0],s=o,i="inputs"in n&&n.inputs?pt(n.inputs,t??[]):void 0;return Ke([s,i??"0x"])}var Mt=_(()=>{ut();eo();ny()});function cy(e){if(!(!e||e.length===0))return e.reduce((t,{slot:r,value:o})=>{if(r.length!==66)throw new ta({size:r.length,targetSize:66,type:"hex"});if(o.length!==66)throw new ta({size:o.length,targetSize:66,type:"hex"});return t[r]=o,t},{})}function oE(e){let{balance:t,nonce:r,state:o,stateDiff:n,code:s}=e,i={};if(s!==void 0&&(i.code=s),t!==void 0&&(i.balance=S(t)),r!==void 0&&(i.nonce=S(r)),o!==void 0&&(i.state=cy(o)),n!==void 0){if(i.state)throw new eu;i.stateDiff=cy(n)}return i}function oi(e){if(!e)return;let t={};for(let{address:r,...o}of e){if(!te(r,{strict:!1}))throw new ae({address:r});if(t[r])throw new Qm({address:r});t[r]=oE(o)}return t}var fu=_(()=>{mr();Tc();bf();$t();D()});function Xt(e,t){if(!te(e,{strict:!1}))throw new ae({address:e});if(!te(t,{strict:!1}))throw new ae({address:t});return e.toLowerCase()===t.toLowerCase()}var kn=_(()=>{mr();$t()});function Et(e){let{abi:t,args:r,functionName:o,data:n}=e,s=t[0];if(o){let a=wt({abi:t,args:r,name:o});if(!a)throw new ur(o,{docsPath:wf});s=a}if(s.type!=="function")throw new ur(void 0,{docsPath:wf});if(!s.outputs)throw new _s(s.name,{docsPath:wf});let i=to(s.outputs,n);if(i&&i.length>1)return i;if(i&&i.length===1)return i[0]}var wf,Go=_(()=>{Ie();va();Bo();wf="/docs/contract/decodeFunctionResult"});var dy,hy=_(()=>{dy="0.1.1"});function gy(){return dy}var yy=_(()=>{hy()});function by(e,t){return t?.(e)?e:e&&typeof e=="object"&&"cause"in e&&e.cause?by(e.cause,t):t?null:e}var F,St=_(()=>{yy();F=class e extends Error{constructor(t,r={}){let o=(()=>{if(r.cause instanceof e){if(r.cause.details)return r.cause.details;if(r.cause.shortMessage)return r.cause.shortMessage}return r.cause&&"details"in r.cause&&typeof r.cause.details=="string"?r.cause.details:r.cause?.message?r.cause.message:r.details})(),n=r.cause instanceof e&&r.cause.docsPath||r.docsPath,i=`https://oxlib.sh${n??""}`,a=[t||"An error occurred.",...r.metaMessages?["",...r.metaMessages]:[],...o||n?["",o?`Details: ${o}`:void 0,n?`See: ${i}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${gy()}`}),this.cause=r.cause,this.details=o,this.docs=i,this.docsPath=n,this.shortMessage=t}walk(t){return by(this,t)}}});function ui(e,t){if(Qt(e)>t)throw new bu({givenSize:Qt(e),maxSize:t})}function xy(e,t){if(typeof t=="number"&&t>0&&t>Qt(e)-1)throw new ka({offset:t,position:"start",size:Qt(e)})}function vy(e,t,r){if(typeof t=="number"&&typeof r=="number"&&Qt(e)!==r-t)throw new ka({offset:r,position:"end",size:Qt(e)})}function Cf(e){if(e>=no.zero&&e<=no.nine)return e-no.zero;if(e>=no.A&&e<=no.F)return e-(no.A-10);if(e>=no.a&&e<=no.f)return e-(no.a-10)}function wy(e,t={}){let{dir:r,size:o=32}=t;if(o===0)return e;if(e.length>o)throw new xu({size:e.length,targetSize:o,type:"Bytes"});let n=new Uint8Array(o);for(let s=0;s<o;s++){let i=r==="right";n[i?s:o-s-1]=e[i?s:e.length-s-1]}return n}function Ef(e,t={}){let{dir:r="left"}=t,o=e,n=0;for(let s=0;s<o.length-1&&o[r==="left"?s:o.length-s-1].toString()==="0";s++)n++;return o=r==="left"?o.slice(n):o.slice(0,o.length-n),o}var no,Cy=_(()=>{Vo();no={zero:48,nine:57,A:65,F:70,a:97,f:102}});function pi(e,t){if(ye(e)>t)throw new vu({givenSize:ye(e),maxSize:t})}function Ey(e,t){if(typeof t=="number"&&t>0&&t>ye(e)-1)throw new Ia({offset:t,position:"start",size:ye(e)})}function Sy(e,t,r){if(typeof t=="number"&&typeof r=="number"&&ye(e)!==r-t)throw new Ia({offset:r,position:"end",size:ye(e)})}function Sf(e,t={}){let{dir:r,size:o=32}=t;if(o===0)return e;let n=e.replace("0x","");if(n.length>o*2)throw new wu({size:Math.ceil(n.length/2),targetSize:o,type:"Hex"});return`0x${n[r==="right"?"padEnd":"padStart"](o*2,"0")}`}function ky(e,t={}){let{dir:r="left"}=t,o=e.replace("0x",""),n=0;for(let s=0;s<o.length-1&&o[r==="left"?s:o.length-s-1].toString()==="0";s++)n++;return o=r==="left"?o.slice(n):o.slice(0,o.length-n),o==="0"?"0x":r==="right"&&o.length%2===1?`0x${o}0`:`0x${o}`}var kf=_(()=>{Je()});function qo(e,t,r){return JSON.stringify(e,(o,n)=>typeof t=="function"?t(o,n):typeof n=="bigint"?n.toString()+aE:n,r)}var aE,_a=_(()=>{aE="#__bigint"});import{equalBytes as BU}from"@noble/curves/abstract/utils";function uE(e){if(!(e instanceof Uint8Array)){if(!e)throw new li(e);if(typeof e!="object")throw new li(e);if(!("BYTES_PER_ELEMENT"in e))throw new li(e);if(e.BYTES_PER_ELEMENT!==1||e.constructor.name!=="Uint8Array")throw new li(e)}}function _y(e){return e instanceof Uint8Array?e:typeof e=="string"?fi(e):pE(e)}function pE(e){return e instanceof Uint8Array?e:new Uint8Array(e)}function fi(e,t={}){let{size:r}=t,o=e;r&&(pi(e,r),o=Pr(e,r));let n=o.slice(2);n.length%2&&(n=`0${n}`);let s=n.length/2,i=new Uint8Array(s);for(let a=0,c=0;a<s;a++){let m=Cf(n.charCodeAt(c++)),u=Cf(n.charCodeAt(c++));if(m===void 0||u===void 0)throw new F(`Invalid byte sequence ("${n[c-2]}${n[c-1]}" in "${n}").`);i[a]=m*16+u}return i}function Ay(e,t={}){let{size:r}=t,o=mE.encode(e);return typeof r=="number"?(ui(o,r),lE(o,r)):o}function lE(e,t){return wy(e,{dir:"right",size:t})}function Qt(e){return e.length}function Py(e,t,r,o={}){let{strict:n}=o;xy(e,t);let s=e.slice(t,r);return n&&vy(s,t,r),s}function Ty(e,t={}){let{size:r}=t;typeof r<"u"&&ui(e,r);let o=Me(e,t);return Af(o,t)}function $y(e,t={}){let{size:r}=t,o=e;if(typeof r<"u"&&(ui(o,r),o=_f(o)),o.length>1||o[0]>1)throw new If(o);return!!o[0]}function Ar(e,t={}){let{size:r}=t;typeof r<"u"&&ui(e,r);let o=Me(e,t);return Eu(o,t)}function Ry(e,t={}){let{size:r}=t,o=e;return typeof r<"u"&&(ui(o,r),o=fE(o)),cE.decode(o)}function _f(e){return Ef(e,{dir:"left"})}function fE(e){return Ef(e,{dir:"right"})}function My(e){try{return uE(e),!0}catch{return!1}}var cE,mE,If,li,bu,ka,xu,Vo=_(()=>{St();Je();Cy();kf();_a();cE=new TextDecoder,mE=new TextEncoder;If=class extends F{constructor(t){super(`Bytes value \`${t}\` is not a valid boolean.`,{metaMessages:["The bytes array must contain a single byte of either a `0` or `1` value."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesBooleanError"})}},li=class extends F{constructor(t){super(`Value \`${typeof t=="object"?qo(t):t}\` of type \`${typeof t}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}},bu=class extends F{constructor({givenSize:t,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${t}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}},ka=class extends F{constructor({offset:t,position:r,size:o}){super(`Slice ${r==="start"?"starting":"ending"} at offset \`${t}\` is out-of-bounds (size: \`${o}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SliceOffsetOutOfBoundsError"})}},xu=class extends F{constructor({size:t,targetSize:r,type:o}){super(`${o.charAt(0).toUpperCase()}${o.slice(1).toLowerCase()} size (\`${t}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}});import{equalBytes as DU}from"@noble/curves/abstract/utils";function gE(e,t={}){let{strict:r=!1}=t;if(!e)throw new Su(e);if(typeof e!="string")throw new Su(e);if(r&&!/^0x[0-9a-fA-F]*$/.test(e))throw new ku(e);if(!e.startsWith("0x"))throw new ku(e)}function Ee(...e){return`0x${e.reduce((t,r)=>t+r.replace("0x",""),"")}`}function di(e){return e instanceof Uint8Array?Me(e):Array.isArray(e)?Me(new Uint8Array(e)):e}function Iu(e,t={}){let r=`0x${Number(e)}`;return typeof t.size=="number"?(pi(r,t.size),so(r,t.size)):r}function Me(e,t={}){let r="";for(let n=0;n<e.length;n++)r+=hE[e[n]];let o=`0x${r}`;return typeof t.size=="number"?(pi(o,t.size),Pr(o,t.size)):o}function oe(e,t={}){let{signed:r,size:o}=t,n=BigInt(e),s;o?r?s=(1n<<BigInt(o)*8n-1n)-1n:s=2n**(BigInt(o)*8n)-1n:typeof e=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));let i=typeof s=="bigint"&&r?-s-1n:0;if(s&&n>s||n<i){let m=typeof e=="bigint"?"n":"";throw new Aa({max:s?`${s}${m}`:void 0,min:`${i}${m}`,signed:r,size:o,value:`${e}${m}`})}let c=`0x${(r&&n<0?(1n<<BigInt(o*8))+BigInt(n):n).toString(16)}`;return o?so(c,o):c}function hi(e,t={}){return Me(dE.encode(e),t)}function so(e,t){return Sf(e,{dir:"left",size:t})}function Pr(e,t){return Sf(e,{dir:"right",size:t})}function be(e,t,r,o={}){let{strict:n}=o;Ey(e,t);let s=`0x${e.replace("0x","").slice((t??0)*2,(r??e.length)*2)}`;return n&&Sy(s,t,r),s}function ye(e){return Math.ceil((e.length-2)/2)}function Pf(e){return ky(e,{dir:"left"})}function Af(e,t={}){let{signed:r}=t;t.size&&pi(e,t.size);let o=BigInt(e);if(!r)return o;let n=(e.length-2)/2,s=(1n<<BigInt(n)*8n)-1n,i=s>>1n;return o<=i?o:o-s-1n}function Eu(e,t={}){let{signed:r,size:o}=t;return Number(!r&&!o?e:Af(e,t))}function Pa(e,t={}){let{strict:r=!1}=t;try{return gE(e,{strict:r}),!0}catch{return!1}}var dE,hE,Aa,Su,ku,vu,Ia,wu,Je=_(()=>{St();kf();_a();dE=new TextEncoder,hE=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));Aa=class extends F{constructor({max:t,min:r,signed:o,size:n,value:s}){super(`Number \`${s}\` is not in safe${n?` ${n*8}-bit`:""}${o?" signed":" unsigned"} integer range ${t?`(\`${r}\` to \`${t}\`)`:`(above \`${r}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}},Su=class extends F{constructor(t){super(`Value \`${typeof t=="object"?qo(t):t}\` of type \`${typeof t}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}},ku=class extends F{constructor(t){super(`Value \`${t}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}},vu=class extends F{constructor({givenSize:t,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${t}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}},Ia=class extends F{constructor({offset:t,position:r,size:o}){super(`Slice ${r==="start"?"starting":"ending"} at offset \`${t}\` is out-of-bounds (size: \`${o}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}},wu=class extends F{constructor({size:t,targetSize:r,type:o}){super(`${o.charAt(0).toUpperCase()}${o.slice(1).toLowerCase()} size (\`${t}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}}});function By(e){return{address:e.address,amount:oe(e.amount),index:oe(e.index),validatorIndex:oe(e.validatorIndex)}}var Fy=_(()=>{Je()});function _u(e){return{...typeof e.baseFeePerGas=="bigint"&&{baseFeePerGas:oe(e.baseFeePerGas)},...typeof e.blobBaseFee=="bigint"&&{blobBaseFee:oe(e.blobBaseFee)},...typeof e.feeRecipient=="string"&&{feeRecipient:e.feeRecipient},...typeof e.gasLimit=="bigint"&&{gasLimit:oe(e.gasLimit)},...typeof e.number=="bigint"&&{number:oe(e.number)},...typeof e.prevRandao=="bigint"&&{prevRandao:oe(e.prevRandao)},...typeof e.time=="bigint"&&{time:oe(e.time)},...e.withdrawals&&{withdrawals:e.withdrawals.map(By)}}}var Tf=_(()=>{Je();Fy()});var _n,Au,Ny,Pu,Ly,$f,Rf,Mf,Bf,Ko=_(()=>{_n=[{inputs:[{components:[{name:"target",type:"address"},{name:"allowFailure",type:"bool"},{name:"callData",type:"bytes"}],name:"calls",type:"tuple[]"}],name:"aggregate3",outputs:[{components:[{name:"success",type:"bool"},{name:"returnData",type:"bytes"}],name:"returnData",type:"tuple[]"}],stateMutability:"view",type:"function"},{inputs:[],name:"getCurrentBlockTimestamp",outputs:[{internalType:"uint256",name:"timestamp",type:"uint256"}],stateMutability:"view",type:"function"}],Au=[{name:"query",type:"function",stateMutability:"view",inputs:[{type:"tuple[]",name:"queries",components:[{type:"address",name:"sender"},{type:"string[]",name:"urls"},{type:"bytes",name:"data"}]}],outputs:[{type:"bool[]",name:"failures"},{type:"bytes[]",name:"responses"}]},{name:"HttpError",type:"error",inputs:[{type:"uint16",name:"status"},{type:"string",name:"message"}]}],Ny=[{inputs:[{name:"dns",type:"bytes"}],name:"DNSDecodingFailed",type:"error"},{inputs:[{name:"ens",type:"string"}],name:"DNSEncodingFailed",type:"error"},{inputs:[],name:"EmptyAddress",type:"error"},{inputs:[{name:"status",type:"uint16"},{name:"message",type:"string"}],name:"HttpError",type:"error"},{inputs:[],name:"InvalidBatchGatewayResponse",type:"error"},{inputs:[{name:"errorData",type:"bytes"}],name:"ResolverError",type:"error"},{inputs:[{name:"name",type:"bytes"},{name:"resolver",type:"address"}],name:"ResolverNotContract",type:"error"},{inputs:[{name:"name",type:"bytes"}],name:"ResolverNotFound",type:"error"},{inputs:[{name:"primary",type:"string"},{name:"primaryAddress",type:"bytes"}],name:"ReverseAddressMismatch",type:"error"},{inputs:[{internalType:"bytes4",name:"selector",type:"bytes4"}],name:"UnsupportedResolverProfile",type:"error"}],Pu=[...Ny,{name:"resolveWithGateways",type:"function",stateMutability:"view",inputs:[{name:"name",type:"bytes"},{name:"data",type:"bytes"},{name:"gateways",type:"string[]"}],outputs:[{name:"",type:"bytes"},{name:"address",type:"address"}]}],Ly=[...Ny,{name:"reverseWithGateways",type:"function",stateMutability:"view",inputs:[{type:"bytes",name:"reverseName"},{type:"uint256",name:"coinType"},{type:"string[]",name:"gateways"}],outputs:[{type:"string",name:"resolvedName"},{type:"address",name:"resolver"},{type:"address",name:"reverseResolver"}]}],$f=[{name:"text",type:"function",stateMutability:"view",inputs:[{name:"name",type:"bytes32"},{name:"key",type:"string"}],outputs:[{name:"",type:"string"}]}],Rf=[{name:"addr",type:"function",stateMutability:"view",inputs:[{name:"name",type:"bytes32"}],outputs:[{name:"",type:"address"}]},{name:"addr",type:"function",stateMutability:"view",inputs:[{name:"name",type:"bytes32"},{name:"coinType",type:"uint256"}],outputs:[{name:"",type:"bytes"}]}],Mf=[{name:"isValidSignature",type:"function",stateMutability:"view",inputs:[{name:"hash",type:"bytes32"},{name:"signature",type:"bytes"}],outputs:[{name:"",type:"bytes4"}]}],Bf=[{inputs:[{name:"_signer",type:"address"},{name:"_hash",type:"bytes32"},{name:"_signature",type:"bytes"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[{name:"_signer",type:"address"},{name:"_hash",type:"bytes32"},{name:"_signature",type:"bytes"}],outputs:[{type:"bool"}],stateMutability:"nonpayable",type:"function",name:"isValidSig"}]});var Oy,Uy=_(()=>{Oy="0x82ad56cb"});var Tu,zy,Hy,gi,Ta=_(()=>{Tu="0x608060405234801561001057600080fd5b5060405161018e38038061018e83398101604081905261002f91610124565b6000808351602085016000f59050803b61004857600080fd5b6000808351602085016000855af16040513d6000823e81610067573d81fd5b3d81f35b634e487b7160e01b600052604160045260246000fd5b600082601f83011261009257600080fd5b81516001600160401b038111156100ab576100ab61006b565b604051601f8201601f19908116603f011681016001600160401b03811182821017156100d9576100d961006b565b6040528181528382016020018510156100f157600080fd5b60005b82811015610110576020818601810151838301820152016100f4565b506000918101602001919091529392505050565b6000806040838503121561013757600080fd5b82516001600160401b0381111561014d57600080fd5b61015985828601610081565b602085015190935090506001600160401b0381111561017757600080fd5b61018385828601610081565b915050925092905056fe",zy="0x608060405234801561001057600080fd5b506040516102c03803806102c083398101604081905261002f916101e6565b836001600160a01b03163b6000036100e457600080836001600160a01b03168360405161005c9190610270565b6000604051808303816000865af19150503d8060008114610099576040519150601f19603f3d011682016040523d82523d6000602084013e61009e565b606091505b50915091508115806100b857506001600160a01b0386163b155b156100e1578060405163101bb98d60e01b81526004016100d8919061028c565b60405180910390fd5b50505b6000808451602086016000885af16040513d6000823e81610103573d81fd5b3d81f35b80516001600160a01b038116811461011e57600080fd5b919050565b634e487b7160e01b600052604160045260246000fd5b60005b8381101561015457818101518382015260200161013c565b50506000910152565b600082601f83011261016e57600080fd5b81516001600160401b0381111561018757610187610123565b604051601f8201601f19908116603f011681016001600160401b03811182821017156101b5576101b5610123565b6040528181528382016020018510156101cd57600080fd5b6101de826020830160208701610139565b949350505050565b600080600080608085870312156101fc57600080fd5b61020585610107565b60208601519094506001600160401b0381111561022157600080fd5b61022d8782880161015d565b93505061023c60408601610107565b60608601519092506001600160401b0381111561025857600080fd5b6102648782880161015d565b91505092959194509250565b60008251610282818460208701610139565b9190910192915050565b60208152600082518060208401526102ab816040850160208701610139565b601f01601f1916919091016040019291505056fe",Hy="0x608060405234801561001057600080fd5b5060405161069438038061069483398101604081905261002f9161051e565b600061003c848484610048565b9050806000526001601ff35b60007f64926492649264926492649264926492649264926492649264926492649264926100748361040c565b036101e7576000606080848060200190518101906100929190610577565b60405192955090935091506000906001600160a01b038516906100b69085906105dd565b6000604051808303816000865af19150503d80600081146100f3576040519150601f19603f3d011682016040523d82523d6000602084013e6100f8565b606091505b50509050876001600160a01b03163b60000361016057806101605760405162461bcd60e51b815260206004820152601e60248201527f5369676e617475726556616c696461746f723a206465706c6f796d656e74000060448201526064015b60405180910390fd5b604051630b135d3f60e11b808252906001600160a01b038a1690631626ba7e90610190908b9087906004016105f9565b602060405180830381865afa1580156101ad573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906101d19190610633565b6001600160e01b03191614945050505050610405565b6001600160a01b0384163b1561027a57604051630b135d3f60e11b808252906001600160a01b03861690631626ba7e9061022790879087906004016105f9565b602060405180830381865afa158015610244573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906102689190610633565b6001600160e01b031916149050610405565b81516041146102df5760405162461bcd60e51b815260206004820152603a602482015260008051602061067483398151915260448201527f3a20696e76616c6964207369676e6174757265206c656e6774680000000000006064820152608401610157565b6102e7610425565b5060208201516040808401518451859392600091859190811061030c5761030c61065d565b016020015160f81c9050601b811480159061032b57508060ff16601c14155b1561038c5760405162461bcd60e51b815260206004820152603b602482015260008051602061067483398151915260448201527f3a20696e76616c6964207369676e617475726520762076616c756500000000006064820152608401610157565b60408051600081526020810180835289905260ff83169181019190915260608101849052608081018390526001600160a01b0389169060019060a0016020604051602081039080840390855afa1580156103ea573d6000803e3d6000fd5b505050602060405103516001600160a01b0316149450505050505b9392505050565b600060208251101561041d57600080fd5b508051015190565b60405180606001604052806003906020820280368337509192915050565b6001600160a01b038116811461045857600080fd5b50565b634e487b7160e01b600052604160045260246000fd5b60005b8381101561048c578181015183820152602001610474565b50506000910152565b600082601f8301126104a657600080fd5b81516001600160401b038111156104bf576104bf61045b565b604051601f8201601f19908116603f011681016001600160401b03811182821017156104ed576104ed61045b565b60405281815283820160200185101561050557600080fd5b610516826020830160208701610471565b949350505050565b60008060006060848603121561053357600080fd5b835161053e81610443565b6020850151604086015191945092506001600160401b0381111561056157600080fd5b61056d86828701610495565b9150509250925092565b60008060006060848603121561058c57600080fd5b835161059781610443565b60208501519093506001600160401b038111156105b357600080fd5b6105bf86828701610495565b604086015190935090506001600160401b0381111561056157600080fd5b600082516105ef818460208701610471565b9190910192915050565b828152604060208201526000825180604084015261061e816060850160208701610471565b601f01601f1916919091016060019392505050565b60006020828403121561064557600080fd5b81516001600160e01b03198116811461040557600080fd5b634e487b7160e01b600052603260045260246000fdfe5369676e617475726556616c696461746f72237265636f7665725369676e6572",gi="0x608060405234801561001057600080fd5b506115b9806100206000396000f3fe6080604052600436106100f35760003560e01c80634d2301cc1161008a578063a8b0574e11610059578063a8b0574e14610325578063bce38bd714610350578063c3077fa914610380578063ee82ac5e146103b2576100f3565b80634d2301cc1461026257806372425d9d1461029f57806382ad56cb146102ca57806386d516e8146102fa576100f3565b80633408e470116100c65780633408e470146101af578063399542e9146101da5780633e64a6961461020c57806342cbb15c14610237576100f3565b80630f28c97d146100f8578063174dea7114610123578063252dba421461015357806327e86d6e14610184575b600080fd5b34801561010457600080fd5b5061010d6103ef565b60405161011a9190610c0a565b60405180910390f35b61013d60048036038101906101389190610c94565b6103f7565b60405161014a9190610e94565b60405180910390f35b61016d60048036038101906101689190610f0c565b610615565b60405161017b92919061101b565b60405180910390f35b34801561019057600080fd5b506101996107ab565b6040516101a69190611064565b60405180910390f35b3480156101bb57600080fd5b506101c46107b7565b6040516101d19190610c0a565b60405180910390f35b6101f460048036038101906101ef91906110ab565b6107bf565b6040516102039392919061110b565b60405180910390f35b34801561021857600080fd5b506102216107e1565b60405161022e9190610c0a565b60405180910390f35b34801561024357600080fd5b5061024c6107e9565b6040516102599190610c0a565b60405180910390f35b34801561026e57600080fd5b50610289600480360381019061028491906111a7565b6107f1565b6040516102969190610c0a565b60405180910390f35b3480156102ab57600080fd5b506102b4610812565b6040516102c19190610c0a565b60405180910390f35b6102e460048036038101906102df919061122a565b61081a565b6040516102f19190610e94565b60405180910390f35b34801561030657600080fd5b5061030f6109e4565b60405161031c9190610c0a565b60405180910390f35b34801561033157600080fd5b5061033a6109ec565b6040516103479190611286565b60405180910390f35b61036a600480360381019061036591906110ab565b6109f4565b6040516103779190610e94565b60405180910390f35b61039a60048036038101906103959190610f0c565b610ba6565b6040516103a99392919061110b565b60405180910390f35b3480156103be57600080fd5b506103d960048036038101906103d491906112cd565b610bca565b6040516103e69190611064565b60405180910390f35b600042905090565b60606000808484905090508067ffffffffffffffff81111561041c5761041b6112fa565b5b60405190808252806020026020018201604052801561045557816020015b610442610bd5565b81526020019060019003908161043a5790505b5092503660005b828110156105c957600085828151811061047957610478611329565b5b6020026020010151905087878381811061049657610495611329565b5b90506020028101906104a89190611367565b925060008360400135905080860195508360000160208101906104cb91906111a7565b73ffffffffffffffffffffffffffffffffffffffff16818580606001906104f2919061138f565b604051610500929190611431565b60006040518083038185875af1925050503d806000811461053d576040519150601f19603f3d011682016040523d82523d6000602084013e610542565b606091505b5083600001846020018290528215151515815250505081516020850135176105bc577f08c379a000000000000000000000000000000000000000000000000000000000600052602060045260176024527f4d756c746963616c6c333a2063616c6c206661696c656400000000000000000060445260846000fd5b826001019250505061045c565b5082341461060c576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610603906114a7565b60405180910390fd5b50505092915050565b6000606043915060008484905090508067ffffffffffffffff81111561063e5761063d6112fa565b5b60405190808252806020026020018201604052801561067157816020015b606081526020019060019003908161065c5790505b5091503660005b828110156107a157600087878381811061069557610694611329565b5b90506020028101906106a791906114c7565b92508260000160208101906106bc91906111a7565b73ffffffffffffffffffffffffffffffffffffffff168380602001906106e2919061138f565b6040516106f0929190611431565b6000604051808303816000865af19150503d806000811461072d576040519150601f19603f3d011682016040523d82523d6000602084013e610732565b606091505b5086848151811061074657610745611329565b5b60200260200101819052819250505080610795576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161078c9061153b565b60405180910390fd5b81600101915050610678565b5050509250929050565b60006001430340905090565b600046905090565b6000806060439250434091506107d68686866109f4565b905093509350939050565b600048905090565b600043905090565b60008173ffffffffffffffffffffffffffffffffffffffff16319050919050565b600044905090565b606060008383905090508067ffffffffffffffff81111561083e5761083d6112fa565b5b60405190808252806020026020018201604052801561087757816020015b610864610bd5565b81526020019060019003908161085c5790505b5091503660005b828110156109db57600084828151811061089b5761089a611329565b5b602002602001015190508686838181106108b8576108b7611329565b5b90506020028101906108ca919061155b565b92508260000160208101906108df91906111a7565b73ffffffffffffffffffffffffffffffffffffffff16838060400190610905919061138f565b604051610913929190611431565b6000604051808303816000865af19150503d8060008114610950576040519150601f19603f3d011682016040523d82523d6000602084013e610955565b606091505b5082600001836020018290528215151515815250505080516020840135176109cf577f08c379a000000000000000000000000000000000000000000000000000000000600052602060045260176024527f4d756c746963616c6c333a2063616c6c206661696c656400000000000000000060445260646000fd5b8160010191505061087e565b50505092915050565b600045905090565b600041905090565b606060008383905090508067ffffffffffffffff811115610a1857610a176112fa565b5b604051908082528060200260200182016040528015610a5157816020015b610a3e610bd5565b815260200190600190039081610a365790505b5091503660005b82811015610b9c576000848281518110610a7557610a74611329565b5b60200260200101519050868683818110610a9257610a91611329565b5b9050602002810190610aa491906114c7565b9250826000016020810190610ab991906111a7565b73ffffffffffffffffffffffffffffffffffffffff16838060200190610adf919061138f565b604051610aed929190611431565b6000604051808303816000865af19150503d8060008114610b2a576040519150601f19603f3d011682016040523d82523d6000602084013e610b2f565b606091505b508260000183602001829052821515151581525050508715610b90578060000151610b8f576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610b869061153b565b60405180910390fd5b5b81600101915050610a58565b5050509392505050565b6000806060610bb7600186866107bf565b8093508194508295505050509250925092565b600081409050919050565b6040518060400160405280600015158152602001606081525090565b6000819050919050565b610c0481610bf1565b82525050565b6000602082019050610c1f6000830184610bfb565b92915050565b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b60008083601f840112610c5457610c53610c2f565b5b8235905067ffffffffffffffff811115610c7157610c70610c34565b5b602083019150836020820283011115610c8d57610c8c610c39565b5b9250929050565b60008060208385031215610cab57610caa610c25565b5b600083013567ffffffffffffffff811115610cc957610cc8610c2a565b5b610cd585828601610c3e565b92509250509250929050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b60008115159050919050565b610d2281610d0d565b82525050565b600081519050919050565b600082825260208201905092915050565b60005b83811015610d62578082015181840152602081019050610d47565b83811115610d71576000848401525b50505050565b6000601f19601f8301169050919050565b6000610d9382610d28565b610d9d8185610d33565b9350610dad818560208601610d44565b610db681610d77565b840191505092915050565b6000604083016000830151610dd96000860182610d19565b5060208301518482036020860152610df18282610d88565b9150508091505092915050565b6000610e0a8383610dc1565b905092915050565b6000602082019050919050565b6000610e2a82610ce1565b610e348185610cec565b935083602082028501610e4685610cfd565b8060005b85811015610e825784840389528151610e638582610dfe565b9450610e6e83610e12565b925060208a01995050600181019050610e4a565b50829750879550505050505092915050565b60006020820190508181036000830152610eae8184610e1f565b905092915050565b60008083601f840112610ecc57610ecb610c2f565b5b8235905067ffffffffffffffff811115610ee957610ee8610c34565b5b602083019150836020820283011115610f0557610f04610c39565b5b9250929050565b60008060208385031215610f2357610f22610c25565b5b600083013567ffffffffffffffff811115610f4157610f40610c2a565b5b610f4d85828601610eb6565b92509250509250929050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b6000610f918383610d88565b905092915050565b6000602082019050919050565b6000610fb182610f59565b610fbb8185610f64565b935083602082028501610fcd85610f75565b8060005b858110156110095784840389528151610fea8582610f85565b9450610ff583610f99565b925060208a01995050600181019050610fd1565b50829750879550505050505092915050565b60006040820190506110306000830185610bfb565b81810360208301526110428184610fa6565b90509392505050565b6000819050919050565b61105e8161104b565b82525050565b60006020820190506110796000830184611055565b92915050565b61108881610d0d565b811461109357600080fd5b50565b6000813590506110a58161107f565b92915050565b6000806000604084860312156110c4576110c3610c25565b5b60006110d286828701611096565b935050602084013567ffffffffffffffff8111156110f3576110f2610c2a565b5b6110ff86828701610eb6565b92509250509250925092565b60006060820190506111206000830186610bfb565b61112d6020830185611055565b818103604083015261113f8184610e1f565b9050949350505050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600061117482611149565b9050919050565b61118481611169565b811461118f57600080fd5b50565b6000813590506111a18161117b565b92915050565b6000602082840312156111bd576111bc610c25565b5b60006111cb84828501611192565b91505092915050565b60008083601f8401126111ea576111e9610c2f565b5b8235905067ffffffffffffffff81111561120757611206610c34565b5b60208301915083602082028301111561122357611222610c39565b5b9250929050565b6000806020838503121561124157611240610c25565b5b600083013567ffffffffffffffff81111561125f5761125e610c2a565b5b61126b858286016111d4565b92509250509250929050565b61128081611169565b82525050565b600060208201905061129b6000830184611277565b92915050565b6112aa81610bf1565b81146112b557600080fd5b50565b6000813590506112c7816112a1565b92915050565b6000602082840312156112e3576112e2610c25565b5b60006112f1848285016112b8565b91505092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b600080fd5b600080fd5b600080fd5b60008235600160800383360303811261138357611382611358565b5b80830191505092915050565b600080833560016020038436030381126113ac576113ab611358565b5b80840192508235915067ffffffffffffffff8211156113ce576113cd61135d565b5b6020830192506001820236038313156113ea576113e9611362565b5b509250929050565b600081905092915050565b82818337600083830152505050565b600061141883856113f2565b93506114258385846113fd565b82840190509392505050565b600061143e82848661140c565b91508190509392505050565b600082825260208201905092915050565b7f4d756c746963616c6c333a2076616c7565206d69736d61746368000000000000600082015250565b6000611491601a8361144a565b915061149c8261145b565b602082019050919050565b600060208201905081810360008301526114c081611484565b9050919050565b6000823560016040038336030381126114e3576114e2611358565b5b80830191505092915050565b7f4d756c746963616c6c333a2063616c6c206661696c6564000000000000000000600082015250565b600061152560178361144a565b9150611530826114ef565b602082019050919050565b6000602082019050818103600083015261155481611518565b9050919050565b60008235600160600383360303811261157757611576611358565b5b8083019150509291505056fea264697066735822122020c1bc9aacf8e4a6507193432a895a8e77094f45a1395583f07b24e860ef06cd64736f6c634300080c0033"});function An(e){let{abi:t,args:r,bytecode:o}=e;if(!r||r.length===0)return o;let n=t.find(i=>"type"in i&&i.type==="constructor");if(!n)throw new hm({docsPath:Ff});if(!("inputs"in n))throw new fa({docsPath:Ff});if(!n.inputs||n.inputs.length===0)throw new fa({docsPath:Ff});let s=pt(n.inputs,r);return Ke([o,s])}var Ff,$u=_(()=>{Ie();ut();eo();Ff="/docs/contract/encodeDeployData"});function yi(){let e=()=>{},t=()=>{};return{promise:new Promise((o,n)=>{e=o,t=n}),resolve:e,reject:t}}var Ru=_(()=>{});function Mu({fn:e,id:t,shouldSplitBatch:r,wait:o=0,sort:n}){let s=async()=>{let u=c();i();let p=u.map(({args:l})=>l);p.length!==0&&e(p).then(l=>{n&&Array.isArray(l)&&l.sort(n);for(let d=0;d<u.length;d++){let{resolve:h}=u[d];h?.([l[d],l])}}).catch(l=>{for(let d=0;d<u.length;d++){let{reject:h}=u[d];h?.(l)}})},i=()=>Df.delete(t),a=()=>c().map(({args:u})=>u),c=()=>Df.get(t)||[],m=u=>Df.set(t,[...c(),u]);return{flush:i,async schedule(u){let{promise:p,resolve:l,reject:d}=yi();return r?.([...a(),u])&&s(),c().length>0?(m({args:u,resolve:l,reject:d}),p):(m({args:u,resolve:l,reject:d}),setTimeout(s,o),p)}}}var Df,Nf=_(()=>{Ru();Df=new Map});var Bu,Fu,Du,jy=_(()=>{rt();G();tu();Bu=class extends w{constructor({callbackSelector:t,cause:r,data:o,extraData:n,sender:s,urls:i}){super(r.shortMessage||"An error occurred while fetching for an offchain result.",{cause:r,metaMessages:[...r.metaMessages||[],r.metaMessages?.length?"":[],"Offchain Gateway Call:",i&&["  Gateway URL(s):",...i.map(a=>`    ${vn(a)}`)],`  Sender: ${s}`,`  Data: ${o}`,`  Callback selector: ${t}`,`  Extra data: ${n}`].flat(),name:"OffchainLookupError"})}},Fu=class extends w{constructor({result:t,url:r}){super("Offchain gateway response is malformed. Response data must be a hex value.",{metaMessages:[`Gateway URL: ${vn(r)}`,`Response: ${Z(t)}`],name:"OffchainLookupResponseMalformedError"})}},Du=class extends w{constructor({sender:t,to:r}){super("Reverted sender address does not match target contract address (`to`).",{metaMessages:[`Contract address: ${r}`,`OffchainLookup sender address: ${t}`],name:"OffchainLookupSenderMismatchError"})}}});function Gy(e){let{abi:t,data:r}=e,o=Kt(r,0,4),n=t.find(s=>s.type==="function"&&o===wr(He(s)));if(!n)throw new wm(o,{docsPath:"/docs/contract/decodeFunctionData"});return{functionName:n.name,args:"inputs"in n&&n.inputs&&n.inputs.length>0?to(n.inputs,Kt(r,4)):void 0}}var Vy=_(()=>{Ie();$o();Ms();va();Xr()});function Of(e){let{abi:t,errorName:r,args:o}=e,n=t[0];if(r){let c=wt({abi:t,args:o,name:r});if(!c)throw new da(r,{docsPath:Lf});n=c}if(n.type!=="error")throw new da(void 0,{docsPath:Lf});let s=He(n),i=wr(s),a="0x";if(o&&o.length>0){if(!n.inputs)throw new xm(n.name,{docsPath:Lf});a=pt(n.inputs,o)}return Ke([i,a])}var Lf,qy=_(()=>{Ie();ut();Ms();eo();Xr();Bo();Lf="/docs/contract/encodeErrorResult"});function Ky(e){let{abi:t,functionName:r,result:o}=e,n=t[0];if(r){let i=wt({abi:t,name:r});if(!i)throw new ur(r,{docsPath:Uf});n=i}if(n.type!=="function")throw new ur(void 0,{docsPath:Uf});if(!n.outputs)throw new _s(n.name,{docsPath:Uf});let s=(()=>{if(n.outputs.length===0)return[];if(n.outputs.length===1)return[o];if(Array.isArray(o))return o;throw new As(o)})();return pt(n.outputs,s)}var Uf,Wy=_(()=>{Ie();eo();Bo();Uf="/docs/contract/encodeFunctionResult"});async function zf(e){let{data:t,ccipRequest:r}=e,{args:[o]}=Gy({abi:Au,data:t}),n=[],s=[];return await Promise.all(o.map(async(i,a)=>{try{s[a]=i.urls.includes(io)?await zf({data:i.data,ccipRequest:r}):await r(i),n[a]=!1}catch(c){n[a]=!0,s[a]=bE(c)}})),Ky({abi:Au,functionName:"query",result:[n,s]})}function bE(e){return e.name==="HttpRequestError"&&e.status?Of({abi:Au,errorName:"HttpError",args:[e.status,e.shortMessage]}):Of({abi:[lm],errorName:"Error",args:["shortMessage"in e?e.shortMessage:e.message]})}var io,$a=_(()=>{Ko();fm();Vy();qy();Wy();io="x-batch-gateway:true"});var Yy={};Ml(Yy,{ccipRequest:()=>Zy,offchainLookup:()=>vE,offchainLookupAbiItem:()=>Jy,offchainLookupSignature:()=>xE});async function vE(e,{blockNumber:t,blockTag:r,data:o,to:n}){let{args:s}=Xm({data:o,abi:[Jy]}),[i,a,c,m,u]=s,{ccipRead:p}=e,l=p&&typeof p?.request=="function"?p.request:Zy;try{if(!Xt(n,i))throw new Du({sender:i,to:n});let d=a.includes(io)?await zf({data:c,ccipRequest:l}):await l({data:c,sender:i,urls:a}),{data:h}=await Tr(e,{blockNumber:t,blockTag:r,data:Fe([m,pt([{type:"bytes"},{type:"bytes"}],[d,u])]),to:n});return h}catch(d){throw new Bu({callbackSelector:m,cause:d,data:o,extraData:u,sender:i,urls:a})}}async function Zy({data:e,sender:t,urls:r}){let o=new Error("An unknown error occurred.");for(let n=0;n<r.length;n++){let s=r[n],i=s.includes("{data}")?"GET":"POST",a=i==="POST"?{data:e,sender:t}:void 0,c=i==="POST"?{"Content-Type":"application/json"}:{};try{let m=await fetch(s.replace("{sender}",t.toLowerCase()).replace("{data}",e),{body:JSON.stringify(a),headers:c,method:i}),u;if(m.headers.get("Content-Type")?.startsWith("application/json")?u=(await m.json()).data:u=await m.text(),!m.ok){o=new Yt({body:a,details:u?.error?Z(u.error):m.statusText,headers:m.headers,status:m.status,url:s});continue}if(!pe(u)){o=new Fu({result:u,url:s});continue}return u}catch(m){o=new Yt({body:a,details:m.message,url:s})}}throw o}var xE,Jy,Xy=_(()=>{bi();jy();Cn();hf();eo();kn();ut();Pt();$a();rt();xE="0x556f1830",Jy={name:"OffchainLookup",type:"error",inputs:[{name:"sender",type:"address"},{name:"urls",type:"string[]"},{name:"callData",type:"bytes"},{name:"callbackFunction",type:"bytes4"},{name:"extraData",type:"bytes"}]}});async function Tr(e,t){let{account:r=e.account,authorizationList:o,batch:n=!!e.batch?.multicall,blockNumber:s,blockTag:i=e.experimental_blockTag??"latest",accessList:a,blobs:c,blockOverrides:m,code:u,data:p,factory:l,factoryData:d,gas:h,gasPrice:g,maxFeePerBlobGas:y,maxFeePerGas:x,maxPriorityFeePerGas:b,nonce:v,to:E,value:A,stateOverride:k,...I}=t,R=r?V(r):void 0;if(u&&(l||d))throw new w("Cannot provide both `code` & `factory`/`factoryData` as parameters.");if(u&&E)throw new w("Cannot provide both `code` & `to` as parameters.");let B=u&&p,M=l&&d&&E&&p,L=B||M,O=B?Qy({code:u,data:p}):M?EE({data:p,factory:l,factoryData:d,to:E}):p;try{nt(t);let re=(typeof s=="bigint"?S(s):void 0)||i,W=m?_u(m):void 0,ge=oi(k),Ot=e.chain?.formatters?.transactionRequest?.format,Te=(Ot||xt)({...kr(I,{format:Ot}),accessList:a,account:R,authorizationList:o,blobs:c,data:O,gas:h,gasPrice:g,maxFeePerBlobGas:y,maxFeePerGas:x,maxPriorityFeePerGas:b,nonce:v,to:L?void 0:E,value:A},"call");if(n&&wE({request:Te})&&!ge&&!W)try{return await CE(e,{...Te,blockNumber:s,blockTag:i})}catch(le){if(!(le instanceof ia)&&!(le instanceof gn))throw le}let yr=(()=>{let le=[Te,re];return ge&&W?[...le,ge,W]:ge?[...le,ge]:W?[...le,{},W]:le})(),Co=await e.request({method:"eth_call",params:yr});return Co==="0x"?{data:void 0}:{data:Co}}catch(U){let re=SE(U),{offchainLookup:W,offchainLookupSignature:ge}=await Promise.resolve().then(()=>(Xy(),Yy));if(e.ccipRead!==!1&&re?.slice(0,10)===ge&&E)return{data:await W(e,{data:re,to:E})};throw L&&re?.slice(0,10)==="0x101bb98d"?new ou({factory:l}):su(U,{...t,account:R,chain:e.chain})}}function wE({request:e}){let{data:t,to:r,...o}=e;return!(!t||t.startsWith(Oy)||!r||Object.values(o).filter(n=>typeof n<"u").length>0)}async function CE(e,t){let{batchSize:r=1024,deployless:o=!1,wait:n=0}=typeof e.batch?.multicall=="object"?e.batch.multicall:{},{blockNumber:s,blockTag:i=e.experimental_blockTag??"latest",data:a,to:c}=t,m=(()=>{if(o)return null;if(t.multicallAddress)return t.multicallAddress;if(e.chain)return Wt({blockNumber:s,chain:e.chain,contract:"multicall3"});throw new ia})(),p=(typeof s=="bigint"?S(s):void 0)||i,{schedule:l}=Mu({id:`${e.uid}.${p}`,wait:n,shouldSplitBatch(g){return g.reduce((x,{data:b})=>x+(b.length-2),0)>r*2},fn:async g=>{let y=g.map(v=>({allowFailure:!0,callData:v.data,target:v.to})),x=de({abi:_n,args:[y],functionName:"aggregate3"}),b=await e.request({method:"eth_call",params:[{...m===null?{data:Qy({code:gi,data:x})}:{to:m,data:x}},p]});return Et({abi:_n,args:[y],functionName:"aggregate3",data:b||"0x"})}}),[{returnData:d,success:h}]=await l({data:a,to:c});if(!h)throw new Er({data:d});return d==="0x"?{data:void 0}:{data:d}}function Qy(e){let{code:t,data:r}=e;return An({abi:qm(["constructor(bytes, bytes)"]),bytecode:Tu,args:[t,r]})}function EE(e){let{data:t,factory:r,factoryData:o,to:n}=e;return An({abi:qm(["constructor(address, bytes, address, bytes)"]),bytecode:zy,args:[n,t,r,o]})}function SE(e){if(!(e instanceof w))return;let t=e.walk();return typeof t?.data=="object"?t.data?.data:t.data}var bi=_(()=>{ba();Tf();ke();Ko();Uy();Ta();G();aa();Fo();Go();$u();Mt();bn();D();xf();ri();Io();Nf();fu();oo()});var Rd=gt(Ka=>{"use strict";var KS=Ka&&Ka.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ka,"__esModule",{value:!0});Ka.encryptEnvVars=ZS;var Td=qr("@noble/curves/ed25519"),$d=KS(qr("crypto"));function WS(e){var t,r;return e=e.startsWith("0x")?e.slice(2):e,new Uint8Array((r=(t=e.match(/.{1,2}/g))===null||t===void 0?void 0:t.map(o=>parseInt(o,16)))!==null&&r!==void 0?r:[])}function JS(e){return Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join("")}async function ZS(e,t){let r=JSON.stringify({env:e}),o=Td.x25519.utils.randomPrivateKey(),n=Td.x25519.getPublicKey(o),s=WS(t),i=Td.x25519.getSharedSecret(o,s),a=await $d.default.subtle.importKey("raw",i,{name:"AES-GCM",length:256},!0,["encrypt"]),c=$d.default.getRandomValues(new Uint8Array(12)),m=await $d.default.subtle.encrypt({name:"AES-GCM",iv:c},a,new TextEncoder().encode(r)),u=new Uint8Array(n.length+c.length+m.byteLength);return u.set(n),u.set(c,n.length),u.set(new Uint8Array(m),n.length+c.length),JS(u)}});var Jx=gt(Wa=>{"use strict";var YS=Wa&&Wa.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Wa,"__esModule",{value:!0});Wa.getComposeHash=tk;var XS=YS(qr("crypto"));function Md(e){return e==null?e:Array.isArray(e)?e.map(Md):e&&typeof e=="object"&&e.constructor===Object?Object.keys(e).sort().reduce((t,r)=>{let o=e[r];return t[r]=Md(o),t},{}):e}function QS(e){let t={...e};return t.runner==="bash"&&"docker_compose_file"in t?delete t.docker_compose_file:t.runner==="docker-compose"&&"bash_script"in t&&delete t.bash_script,"pre_launch_script"in t&&!t.pre_launch_script&&delete t.pre_launch_script,t}function ek(e){let t=Md(e);return JSON.stringify(t,(r,o)=>typeof o=="number"&&(isNaN(o)||!isFinite(o))?null:o)}function tk(e,t=!1){t&&(e=QS(e));let r=ek(e);return XS.default.createHash("sha256").update(r,"utf8").digest("hex")}});var y1=gt(j=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0});j.toBig=j.shrSL=j.shrSH=j.rotrSL=j.rotrSH=j.rotrBL=j.rotrBH=j.rotr32L=j.rotr32H=j.rotlSL=j.rotlSH=j.rotlBL=j.rotlBH=j.add5L=j.add5H=j.add4L=j.add4H=j.add3L=j.add3H=void 0;j.add=u1;j.fromBig=Fd;j.split=Zx;var Bp=BigInt(2**32-1),Bd=BigInt(32);function Fd(e,t=!1){return t?{h:Number(e&Bp),l:Number(e>>Bd&Bp)}:{h:Number(e>>Bd&Bp)|0,l:Number(e&Bp)|0}}function Zx(e,t=!1){let r=e.length,o=new Uint32Array(r),n=new Uint32Array(r);for(let s=0;s<r;s++){let{h:i,l:a}=Fd(e[s],t);[o[s],n[s]]=[i,a]}return[o,n]}var Yx=(e,t)=>BigInt(e>>>0)<<Bd|BigInt(t>>>0);j.toBig=Yx;var Xx=(e,t,r)=>e>>>r;j.shrSH=Xx;var Qx=(e,t,r)=>e<<32-r|t>>>r;j.shrSL=Qx;var e1=(e,t,r)=>e>>>r|t<<32-r;j.rotrSH=e1;var t1=(e,t,r)=>e<<32-r|t>>>r;j.rotrSL=t1;var r1=(e,t,r)=>e<<64-r|t>>>r-32;j.rotrBH=r1;var o1=(e,t,r)=>e>>>r-32|t<<64-r;j.rotrBL=o1;var n1=(e,t)=>t;j.rotr32H=n1;var s1=(e,t)=>e;j.rotr32L=s1;var i1=(e,t,r)=>e<<r|t>>>32-r;j.rotlSH=i1;var a1=(e,t,r)=>t<<r|e>>>32-r;j.rotlSL=a1;var c1=(e,t,r)=>t<<r-32|e>>>64-r;j.rotlBH=c1;var m1=(e,t,r)=>e<<r-32|t>>>64-r;j.rotlBL=m1;function u1(e,t,r,o){let n=(t>>>0)+(o>>>0);return{h:e+r+(n/2**32|0)|0,l:n|0}}var p1=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0);j.add3L=p1;var l1=(e,t,r,o)=>t+r+o+(e/2**32|0)|0;j.add3H=l1;var f1=(e,t,r,o)=>(e>>>0)+(t>>>0)+(r>>>0)+(o>>>0);j.add4L=f1;var d1=(e,t,r,o,n)=>t+r+o+n+(e/2**32|0)|0;j.add4H=d1;var h1=(e,t,r,o,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(o>>>0)+(n>>>0);j.add5L=h1;var g1=(e,t,r,o,n,s)=>t+r+o+n+s+(e/2**32|0)|0;j.add5H=g1;var rk={fromBig:Fd,split:Zx,toBig:Yx,shrSH:Xx,shrSL:Qx,rotrSH:e1,rotrSL:t1,rotrBH:r1,rotrBL:o1,rotr32H:n1,rotr32L:s1,rotlSH:i1,rotlSL:a1,rotlBH:c1,rotlBL:m1,add:u1,add3L:p1,add3H:l1,add4L:f1,add4H:d1,add5H:g1,add5L:h1};j.default=rk});var b1=gt(Fp=>{"use strict";Object.defineProperty(Fp,"__esModule",{value:!0});Fp.crypto=void 0;var tn=qr("crypto");Fp.crypto=tn&&typeof tn=="object"&&"webcrypto"in tn?tn.webcrypto:tn&&typeof tn=="object"&&"randomBytes"in tn?tn:void 0});var I1=gt(N=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0});N.wrapXOFConstructorWithOpts=N.wrapConstructorWithOpts=N.wrapConstructor=N.Hash=N.nextTick=N.swap32IfBE=N.byteSwapIfBE=N.swap8IfBE=N.isLE=void 0;N.isBytes=v1;N.anumber=Dd;N.abytes=Ri;N.ahash=ok;N.aexists=nk;N.aoutput=sk;N.u8=ik;N.u32=ak;N.clean=ck;N.createView=mk;N.rotr=uk;N.rotl=pk;N.byteSwap=Ld;N.byteSwap32=w1;N.bytesToHex=fk;N.hexToBytes=dk;N.asyncLoop=gk;N.utf8ToBytes=Od;N.bytesToUtf8=yk;N.toBytes=Dp;N.kdfInputToBytes=bk;N.concatBytes=xk;N.checkOpts=vk;N.createHasher=E1;N.createOptHasher=S1;N.createXOFer=k1;N.randomBytes=wk;var $i=b1();function v1(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Dd(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function Ri(e,...t){if(!v1(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function ok(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Dd(e.outputLen),Dd(e.blockLen)}function nk(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function sk(e,t){Ri(e);let r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function ik(e){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}function ak(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function ck(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function mk(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function uk(e,t){return e<<32-t|e>>>t}function pk(e,t){return e<<t|e>>>32-t>>>0}N.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Ld(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}N.swap8IfBE=N.isLE?e=>e:e=>Ld(e);N.byteSwapIfBE=N.swap8IfBE;function w1(e){for(let t=0;t<e.length;t++)e[t]=Ld(e[t]);return e}N.swap32IfBE=N.isLE?e=>e:w1;var C1=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",lk=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function fk(e){if(Ri(e),C1)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=lk[e[r]];return t}var mo={_0:48,_9:57,A:65,F:70,a:97,f:102};function x1(e){if(e>=mo._0&&e<=mo._9)return e-mo._0;if(e>=mo.A&&e<=mo.F)return e-(mo.A-10);if(e>=mo.a&&e<=mo.f)return e-(mo.a-10)}function dk(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(C1)return Uint8Array.fromHex(e);let t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let o=new Uint8Array(r);for(let n=0,s=0;n<r;n++,s+=2){let i=x1(e.charCodeAt(s)),a=x1(e.charCodeAt(s+1));if(i===void 0||a===void 0){let c=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}o[n]=i*16+a}return o}var hk=async()=>{};N.nextTick=hk;async function gk(e,t,r){let o=Date.now();for(let n=0;n<e;n++){r(n);let s=Date.now()-o;s>=0&&s<t||(await(0,N.nextTick)(),o+=s)}}function Od(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function yk(e){return new TextDecoder().decode(e)}function Dp(e){return typeof e=="string"&&(e=Od(e)),Ri(e),e}function bk(e){return typeof e=="string"&&(e=Od(e)),Ri(e),e}function xk(...e){let t=0;for(let o=0;o<e.length;o++){let n=e[o];Ri(n),t+=n.length}let r=new Uint8Array(t);for(let o=0,n=0;o<e.length;o++){let s=e[o];r.set(s,n),n+=s.length}return r}function vk(e,t){if(t!==void 0&&{}.toString.call(t)!=="[object Object]")throw new Error("options should be object or undefined");return Object.assign(e,t)}var Nd=class{};N.Hash=Nd;function E1(e){let t=o=>e().update(Dp(o)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function S1(e){let t=(o,n)=>e(n).update(Dp(o)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=o=>e(o),t}function k1(e){let t=(o,n)=>e(n).update(Dp(o)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=o=>e(o),t}N.wrapConstructor=E1;N.wrapConstructorWithOpts=S1;N.wrapXOFConstructorWithOpts=k1;function wk(e=32){if($i.crypto&&typeof $i.crypto.getRandomValues=="function")return $i.crypto.getRandomValues(new Uint8Array(e));if($i.crypto&&typeof $i.crypto.randomBytes=="function")return Uint8Array.from($i.crypto.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")}});var F1=gt(he=>{"use strict";Object.defineProperty(he,"__esModule",{value:!0});he.shake256=he.shake128=he.keccak_512=he.keccak_384=he.keccak_256=he.keccak_224=he.sha3_512=he.sha3_384=he.sha3_256=he.sha3_224=he.Keccak=void 0;he.keccakP=M1;var Za=y1(),at=I1(),Ck=BigInt(0),Ja=BigInt(1),Ek=BigInt(2),Sk=BigInt(7),kk=BigInt(256),Ik=BigInt(113),P1=[],T1=[],$1=[];for(let e=0,t=Ja,r=1,o=0;e<24;e++){[r,o]=[o,(2*r+3*o)%5],P1.push(2*(5*o+r)),T1.push((e+1)*(e+2)/2%64);let n=Ck;for(let s=0;s<7;s++)t=(t<<Ja^(t>>Sk)*Ik)%kk,t&Ek&&(n^=Ja<<(Ja<<BigInt(s))-Ja);$1.push(n)}var R1=(0,Za.split)($1,!0),_k=R1[0],Ak=R1[1],_1=(e,t,r)=>r>32?(0,Za.rotlBH)(e,t,r):(0,Za.rotlSH)(e,t,r),A1=(e,t,r)=>r>32?(0,Za.rotlBL)(e,t,r):(0,Za.rotlSL)(e,t,r);function M1(e,t=24){let r=new Uint32Array(10);for(let o=24-t;o<24;o++){for(let i=0;i<10;i++)r[i]=e[i]^e[i+10]^e[i+20]^e[i+30]^e[i+40];for(let i=0;i<10;i+=2){let a=(i+8)%10,c=(i+2)%10,m=r[c],u=r[c+1],p=_1(m,u,1)^r[a],l=A1(m,u,1)^r[a+1];for(let d=0;d<50;d+=10)e[i+d]^=p,e[i+d+1]^=l}let n=e[2],s=e[3];for(let i=0;i<24;i++){let a=T1[i],c=_1(n,s,a),m=A1(n,s,a),u=P1[i];n=e[u],s=e[u+1],e[u]=c,e[u+1]=m}for(let i=0;i<50;i+=10){for(let a=0;a<10;a++)r[a]=e[i+a];for(let a=0;a<10;a++)e[i+a]^=~r[(a+2)%10]&r[(a+4)%10]}e[0]^=_k[o],e[1]^=Ak[o]}(0,at.clean)(r)}var Ya=class e extends at.Hash{constructor(t,r,o,n=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=t,this.suffix=r,this.outputLen=o,this.enableXOF=n,this.rounds=s,(0,at.anumber)(o),!(0<t&&t<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=(0,at.u32)(this.state)}clone(){return this._cloneInto()}keccak(){(0,at.swap32IfBE)(this.state32),M1(this.state32,this.rounds),(0,at.swap32IfBE)(this.state32),this.posOut=0,this.pos=0}update(t){(0,at.aexists)(this),t=(0,at.toBytes)(t),(0,at.abytes)(t);let{blockLen:r,state:o}=this,n=t.length;for(let s=0;s<n;){let i=Math.min(r-this.pos,n-s);for(let a=0;a<i;a++)o[this.pos++]^=t[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:t,suffix:r,pos:o,blockLen:n}=this;t[o]^=r,(r&128)!==0&&o===n-1&&this.keccak(),t[n-1]^=128,this.keccak()}writeInto(t){(0,at.aexists)(this,!1),(0,at.abytes)(t),this.finish();let r=this.state,{blockLen:o}=this;for(let n=0,s=t.length;n<s;){this.posOut>=o&&this.keccak();let i=Math.min(o-this.posOut,s-n);t.set(r.subarray(this.posOut,this.posOut+i),n),this.posOut+=i,n+=i}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return(0,at.anumber)(t),this.xofInto(new Uint8Array(t))}digestInto(t){if((0,at.aoutput)(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,(0,at.clean)(this.state)}_cloneInto(t){let{blockLen:r,suffix:o,outputLen:n,rounds:s,enableXOF:i}=this;return t||(t=new e(r,o,n,i,s)),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=s,t.suffix=o,t.outputLen=n,t.enableXOF=i,t.destroyed=this.destroyed,t}};he.Keccak=Ya;var rn=(e,t,r)=>(0,at.createHasher)(()=>new Ya(t,e,r));he.sha3_224=rn(6,144,224/8);he.sha3_256=rn(6,136,256/8);he.sha3_384=rn(6,104,384/8);he.sha3_512=rn(6,72,512/8);he.keccak_224=rn(1,144,224/8);he.keccak_256=rn(1,136,256/8);he.keccak_384=rn(1,104,384/8);he.keccak_512=rn(1,72,512/8);var B1=(e,t,r)=>(0,at.createXOFer)((o={})=>new Ya(t,e,o.dkLen===void 0?r:o.dkLen,!0));he.shake128=B1(31,168,128/8);he.shake256=B1(31,136,256/8)});var D1=gt(Ud=>{"use strict";Object.defineProperty(Ud,"__esModule",{value:!0});Ud.verifyEnvEncryptPublicKey=$k;var Pk=F1(),Tk=qr("@noble/curves/secp256k1");function $k(e,t,r){if(t.length!==65)return null;let o=Buffer.from("dstack-env-encrypt-pubkey","utf8"),n=r;r.startsWith("0x")&&(n=r.slice(2));let s=Buffer.from(n,"hex"),i=Buffer.from(":","utf8"),a=Buffer.concat([o,i,s,Buffer.from(e)]),c=(0,Pk.keccak_256)(a);try{let m=t.slice(0,32),u=t.slice(32,64),p=t[64],l=new Uint8Array(64);l.set(m,0),l.set(u,32);let d=Tk.secp256k1.Signature.fromCompact(l).addRecoveryBit(p).recoverPublicKey(c);return"0x"+Buffer.from(d.toRawBytes(!0)).toString("hex")}catch(m){return console.error("signature verification failed:",m),null}}});import{readFileSync as bT}from"fs";import{dirname as xT,join as vT}from"path";import{fileURLToPath as wT}from"url";import{ZodError as dA}from"zod";import Hi from"chalk";function xc(e){return e.split(/[\s-]+/).filter(Boolean).map((t,r)=>r===0?t.toLowerCase():t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join("")}function J0(e){return e===void 0?[]:Array.isArray(e)?[...e]:[e]}function Z0(e,t){let r={};for(let a of t.flagConfig.descriptors.values()){let c=t.flags[a.canonicalKey];c!==void 0&&(r[a.target]=c)}for(let a of t.flagConfig.negatedLookup.values())a.negatedKey&&t.flags[a.negatedKey]&&(r[a.target]=!1);t.passThrough.length>0&&(r["--"]=t.passThrough);let o={},n=e.arguments??[],s=[...t.positionals],i=0;for(let a of n){let c=a.target??xc(a.name);if(a.variadic){o[c]=s.slice(i),i=s.length;break}o[c]=s[i],i+=1}return{options:r,positionals:o,raw:{flags:t.flags,positionals:t.positionals}}}import mC from"arg";var sC={name:"help",shorthand:"h",description:"Show help information for the current command",type:"boolean",target:"help"},iC={name:"version",shorthand:"v",description:"Show CLI version",type:"boolean",target:"version"},$e={name:"interactive",shorthand:"i",description:"Enable interactive mode",type:"boolean",target:"interactive",group:"basic"},Y0={name:"api-token",description:"API token used for authentication",type:"string",target:"apiToken",aliases:["api-key"],argumentName:"token",group:"basic"},aC={name:"json",shorthand:"j",description:"Output in JSON format",type:"boolean",target:"json",negatedName:"no-json",group:"basic"},mn=[sC,iC,Y0,aC,$e],Kn=[Y0],Be={name:"cvm_id",description:"CVM identifier (UUID, app_id, instance_id, or name)",required:!1,target:"cvmId"},X0={name:"cvm-id",description:"CVM identifier (UUID, app_id, instance_id, or name)",type:"string",target:"cvmId"},Q0={name:"uuid",description:"[DEPRECATED] Use --cvm-id instead. CVM UUID.",type:"string",target:"cvmId",deprecated:!0,group:"deprecated"};import eh from"arg";function th(e){let t={},r=new Map,o=new Map;if(!e)return{spec:t,descriptors:r,negatedLookup:o};for(let n of e){let s=`--${n.name}`,i=n.target??xc(n.name),a=cC(n.type);r.set(s,{option:n,canonicalKey:s,target:i,negatedKey:n.negatedName?`--${n.negatedName}`:void 0}),t[s]=a,n.shorthand&&(t[`-${n.shorthand}`]=s);for(let c of J0(n.aliases))t[`--${c}`]=s;if(n.negatedName){let c=`--${n.negatedName}`;if(n.type!=="boolean")throw new Error(`Negated option is only supported for boolean types: ${n.name}`);t[c]=eh.flag(()=>!0),o.set(c,{option:n,canonicalKey:s,target:i,negatedKey:c})}}return{spec:t,descriptors:r,negatedLookup:o}}function cC(e){switch(e){case"string":return(t="")=>t;case"number":return(t,r)=>{let o=Number(t);if(Number.isNaN(o))throw new Error(`Invalid value for ${r}: expected a number.`);return o};case"boolean":return eh.flag(()=>!0);case"string[]":return(t,r,o)=>{let n=Array.isArray(o)?[...o]:[];if(t==="")throw new Error(`Option ${r} expects a value.`);return n.push(t),n};case"number[]":return(t,r,o)=>{let n=Array.isArray(o)?[...o]:[],s=Number(t);if(Number.isNaN(s))throw new Error(`Invalid value for ${r}: expected a number.`);return n.push(s),n};default:throw new Error(`Unsupported option type: ${e}`)}}function uC(e){let t=e.indexOf("--");return t===-1?[[...e],[]]:[e.slice(0,t),e.slice(t+1)]}function Yi(e,t,r={}){let o=[...mn,...t?[...t]:[]],n=th(o),{permissive:s=!1,stopAtPositional:i=!1}=r,[a,c]=uC(e),m=mC(n.spec,{argv:a,permissive:s,stopAtPositional:i}),{_:u,...p}=m;return{positionals:u??[],flags:p,flagConfig:n,passThrough:c}}function vc(e){return e==="unstable"?" [UNSTABLE]":e==="deprecated"?" [DEPRECATED]":""}function Cc(e){let{registry:t,executableName:r}=e,o=[];o.push(`Usage: ${r} <command> [options]`),o.push(""),o.push("Available commands:");for(let n of t.getChildren()){let s=n.command?.meta??n.group?.meta,i=(s?.description??"").split(`
`)[0],a=s?.stability,c=a?vc(a):"",m=n.name??"";o.push(`  ${m.padEnd(18)}${i}${c}`.trimEnd())}o.push(""),o.push("Global options:");for(let n of mn)o.push(`  ${wc(n).padEnd(24)}${n.description??""}`.trimEnd());return o.join(`
`)}function rh(e){let{registry:t,executableName:r,groupPath:o}=e,n=t.getNode(o);if(!n?.group)return Cc({registry:t,executableName:r});let s=[],i=o.join(" "),a=`${r} ${i}`;s.push(`Usage: ${a} <command> [options]`),s.push(""),n.group.meta.description&&(s.push(n.group.meta.description),s.push(""));let c=t.getChildren(o);if(c.length>0){s.push("Available commands:");for(let m of c){let u=m.command?.meta??m.group?.meta,p=(u?.description??"").split(`
`)[0],l=u?.stability,d=l?vc(l):"",h=m.name??"";s.push(`  ${h.padEnd(18)}${p}${d}`.trimEnd())}s.push("")}s.push("Global options:");for(let m of mn)s.push(`  ${wc(m).padEnd(24)}${m.description??""}`.trimEnd());return s.join(`
`)}function Bl(e){let{executableName:t,definition:r,registry:o}=e,n=pC({executableName:t,definition:r}),s=vc(r.meta.stability),i=[n,"",`${r.meta.description}${s}`],a=r.meta.arguments??[];if(a.length>0){i.push(""),i.push("Arguments:");for(let h of a){let g=fC(h);i.push(`  ${g.padEnd(18)}${h.description??""}`.trimEnd())}}let c=[...r.meta.options??[]],m=mn.filter(h=>!h.hidden),u=c.filter(h=>!h.hidden),p=new Set(mn.map(h=>h.name)),l=u.filter(h=>!p.has(h.name));if(m.length>0){let h=new Set(l.map(g=>g.shorthand).filter(g=>typeof g=="string"&&g.length>0));i.push(""),i.push("Global options:");for(let g of m){let y=!g.shorthand||!h.has(g.shorthand);i.push(`  ${wc(g,{includeShorthand:y}).padEnd(24)}${g.description??""}`.trimEnd())}}if(l.length>0){let h=b=>b.group==="deprecated"||b.deprecated?!0:(b.description??"").includes("[DEPRECATED]"),g=b=>b.group?b.group:h(b)?"deprecated":"basic",y={basic:[],advanced:[],deprecated:[]};for(let b of l)y[g(b)].push(b);let x=(b,v)=>{if(v.length!==0){i.push(""),i.push(b);for(let E of v)i.push(`  ${wc(E).padEnd(24)}${E.description??""}`.trimEnd())}};x("Basic options:",y.basic),x("Advanced options:",y.advanced),x("Deprecated options:",y.deprecated)}if(r.meta.passThrough&&(i.push(""),i.push("Pass-through (after --):"),i.push(`  ${r.meta.passThrough.description}`),r.meta.passThrough.examples&&r.meta.passThrough.examples.length>0)){i.push(""),i.push("  Examples:");for(let h of r.meta.passThrough.examples)i.push(`    ${h}`)}if(r.meta.examples&&r.meta.examples.length>0){i.push(""),i.push("Examples:");for(let h of r.meta.examples)i.push(`  # ${h.name}`),i.push(`  ${h.value}`)}let d=o.getChildren(r.path);if(d.length>0){i.push(""),i.push("Subcommands:");for(let h of d){let g=h.command?.meta??h.group?.meta,y=(g?.description??"").split(`
`)[0],x=g?.stability,b=x?vc(x):"",v=h.name??"";i.push(`  ${v.padEnd(18)}${y}${b}`.trimEnd())}}return i.join(`
`)}function pC({executableName:e,definition:t}){let r=[e,...t.path],n=(t.meta.arguments??[]).map(m=>lC(m)).join(" "),i=(t.meta.options?.length??0)>0?" [options]":"",a=n?` ${n}`:"",c=t.meta.passThrough?" [--] [...]":"";return`Usage: ${r.join(" ")}${i}${a}${c}`}function lC(e){let t=`<${e.name}>`;return e.variadic?`${t}...`:e.required===!1?`[${t}]`:t}function fC(e){return e.variadic?`<${e.name}...>`:e.required===!1?`<${e.name}>?`:`<${e.name}>`}function wc(e,{includeShorthand:t=!0}={}){let r=[];t&&e.shorthand&&r.push(`-${e.shorthand}`);let o=`--${e.name}`;if(e.argumentName?o+=` ${e.argumentName.toUpperCase()}`:e.type!=="boolean"&&(o+=" <value>"),r.push(o),e.aliases&&e.aliases.length>0)for(let n of e.aliases){let s=`--${n}`;e.argumentName?s+=` ${e.argumentName.toUpperCase()}`:e.type!=="boolean"&&(s+=" <value>"),r.push(s)}return e.type==="boolean"&&e.negatedName&&r.push(`--${e.negatedName}`),r.join(", ")}var Fl=!1;function we(e){Fl=e}function et(){return Fl}function Dl(){return!Fl}import X_ from"path";import Vp from"fs-extra";import pv from"@iarna/toml";import{z as zr}from"zod";var z1=Zi(dh(),1);import{ofetch as Rk}from"ofetch";function hh(e){return{all:e=e||new Map,on:function(t,r){var o=e.get(t);o?o.push(r):e.set(t,[r])},off:function(t,r){var o=e.get(t);o&&(r?o.splice(o.indexOf(r)>>>0,1):e.set(t,[]))},emit:function(t,r){var o=e.get(t);o&&o.slice().map(function(n){n(r)}),(o=e.get("*"))&&o.slice().map(function(n){n(t,r)})}}}import{z as Ze}from"zod";import{z as on}from"zod";import{z as J}from"zod";import{z as nn}from"zod";function pn(e){return{formatters:void 0,fees:void 0,serializers:void 0,...e}}Mc();Oe();Mc();var Gl={"0x0":"legacy","0x1":"eip2930","0x2":"eip1559","0x3":"eip4844","0x4":"eip7702"};function fn(e,t){let r={...e,blockHash:e.blockHash?e.blockHash:null,blockNumber:e.blockNumber?BigInt(e.blockNumber):null,chainId:e.chainId?Ce(e.chainId):void 0,gas:e.gas?BigInt(e.gas):void 0,gasPrice:e.gasPrice?BigInt(e.gasPrice):void 0,maxFeePerBlobGas:e.maxFeePerBlobGas?BigInt(e.maxFeePerBlobGas):void 0,maxFeePerGas:e.maxFeePerGas?BigInt(e.maxFeePerGas):void 0,maxPriorityFeePerGas:e.maxPriorityFeePerGas?BigInt(e.maxPriorityFeePerGas):void 0,nonce:e.nonce?Ce(e.nonce):void 0,to:e.to?e.to:null,transactionIndex:e.transactionIndex?Number(e.transactionIndex):null,type:e.type?Gl[e.type]:void 0,typeHex:e.type?e.type:void 0,value:e.value?BigInt(e.value):void 0,v:e.v?BigInt(e.v):void 0};return e.authorizationList&&(r.authorizationList=HC(e.authorizationList)),r.yParity=(()=>{if(e.yParity)return Number(e.yParity);if(typeof r.v=="bigint"){if(r.v===0n||r.v===27n)return 0;if(r.v===1n||r.v===28n)return 1;if(r.v>=35n)return r.v%2n===0n?1:0}})(),r.type==="legacy"&&(delete r.accessList,delete r.maxFeePerBlobGas,delete r.maxFeePerGas,delete r.maxPriorityFeePerGas,delete r.yParity),r.type==="eip2930"&&(delete r.maxFeePerBlobGas,delete r.maxFeePerGas,delete r.maxPriorityFeePerGas),r.type==="eip1559"&&delete r.maxFeePerBlobGas,r}var xh=Xn("transaction",fn);function HC(e){return e.map(t=>({address:t.address,chainId:Number(t.chainId),nonce:Number(t.nonce),r:t.r,s:t.s,yParity:Number(t.yParity)}))}function ra(e,t){let r=(e.transactions??[]).map(o=>typeof o=="string"?o:fn(o));return{...e,baseFeePerGas:e.baseFeePerGas?BigInt(e.baseFeePerGas):null,blobGasUsed:e.blobGasUsed?BigInt(e.blobGasUsed):void 0,difficulty:e.difficulty?BigInt(e.difficulty):void 0,excessBlobGas:e.excessBlobGas?BigInt(e.excessBlobGas):void 0,gasLimit:e.gasLimit?BigInt(e.gasLimit):void 0,gasUsed:e.gasUsed?BigInt(e.gasUsed):void 0,hash:e.hash?e.hash:null,logsBloom:e.logsBloom?e.logsBloom:null,nonce:e.nonce?e.nonce:null,number:e.number?BigInt(e.number):null,size:e.size?BigInt(e.size):void 0,timestamp:e.timestamp?BigInt(e.timestamp):void 0,transactions:r,totalDifficulty:e.totalDifficulty?BigInt(e.totalDifficulty):null}}var vh=Xn("block",ra);function tt(e,{args:t,eventName:r}={}){return{...e,blockHash:e.blockHash?e.blockHash:null,blockNumber:e.blockNumber?BigInt(e.blockNumber):null,logIndex:e.logIndex?Number(e.logIndex):null,transactionHash:e.transactionHash?e.transactionHash:null,transactionIndex:e.transactionIndex?Number(e.transactionIndex):null,...r?{args:t,eventName:r}:{}}}Oe();Mc();var Vl={"0x0":"reverted","0x1":"success"};function oa(e,t){let r={...e,blockNumber:e.blockNumber?BigInt(e.blockNumber):null,contractAddress:e.contractAddress?e.contractAddress:null,cumulativeGasUsed:e.cumulativeGasUsed?BigInt(e.cumulativeGasUsed):null,effectiveGasPrice:e.effectiveGasPrice?BigInt(e.effectiveGasPrice):null,gasUsed:e.gasUsed?BigInt(e.gasUsed):null,logs:e.logs?e.logs.map(o=>tt(o)):null,to:e.to?e.to:null,transactionIndex:e.transactionIndex?Ce(e.transactionIndex):null,status:e.status?Vl[e.status]:null,type:e.type?Gl[e.type]||e.type:null};return e.blobGasPrice&&(r.blobGasPrice=BigInt(e.blobGasPrice)),e.blobGasUsed&&(r.blobGasUsed=BigInt(e.blobGasUsed)),r}var wh=Xn("transactionReceipt",oa);G();Fc();qe();D();function ar(e,t="hex"){let r=Ch(e),o=ts(new Uint8Array(r.length));return r.encode(o),t==="hex"?ee(o.bytes):o.bytes}function Ch(e){return Array.isArray(e)?KC(e.map(t=>Ch(t))):WC(e)}function KC(e){let t=e.reduce((n,s)=>n+s.length,0),r=Eh(t);return{length:t<=55?1+t:1+r+t,encode(n){t<=55?n.pushByte(192+t):(n.pushByte(247+r),r===1?n.pushUint8(t):r===2?n.pushUint16(t):r===3?n.pushUint24(t):n.pushUint32(t));for(let{encode:s}of e)s(n)}}}function WC(e){let t=typeof e=="string"?Ue(e):e,r=Eh(t.length);return{length:t.length===1&&t[0]<128?1:t.length<=55?1+t.length:1+r+t.length,encode(n){t.length===1&&t[0]<128?n.pushBytes(t):t.length<=55?(n.pushByte(128+t.length),n.pushBytes(t)):(n.pushByte(183+r),r===1?n.pushUint8(t.length):r===2?n.pushUint16(t.length):r===3?n.pushUint24(t.length):n.pushUint32(t.length),n.pushBytes(t))}}}function Eh(e){if(e<2**8)return 1;if(e<2**16)return 2;if(e<2**24)return 3;if(e<2**32)return 4;throw new w("Length is too large.")}Tt();D();function kh(e){if(!e||e.length===0)return[];let t=[];for(let r of e){let{chainId:o,nonce:n,...s}=r,i=r.address;t.push([o?me(o):"0x",i,n?me(n):"0x",...as({},s)])}return t}qe();D();function cs(e){let{kzg:t}=e,r=e.to??(typeof e.blobs[0]=="string"?"hex":"bytes"),o=typeof e.blobs[0]=="string"?e.blobs.map(s=>Ue(s)):e.blobs,n=[];for(let s of o)n.push(Uint8Array.from(t.blobToKzgCommitment(s)));return r==="bytes"?n:n.map(s=>ee(s))}qe();D();function ms(e){let{kzg:t}=e,r=e.to??(typeof e.blobs[0]=="string"?"hex":"bytes"),o=typeof e.blobs[0]=="string"?e.blobs.map(i=>Ue(i)):e.blobs,n=typeof e.commitments[0]=="string"?e.commitments.map(i=>Ue(i)):e.commitments,s=[];for(let i=0;i<o.length;i++){let a=o[i],c=n[i];s.push(Uint8Array.from(t.computeBlobKzgProof(a,c)))}return r==="bytes"?s:s.map(i=>ee(i))}D();Jc();function e2(e,t,r,o){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,o);let n=BigInt(32),s=BigInt(4294967295),i=Number(r>>n&s),a=Number(r&s),c=o?4:0,m=o?0:4;e.setUint32(t+c,i,o),e.setUint32(t+m,a,o)}function _h(e,t,r){return e&t^~e&r}function Ah(e,t,r){return e&t^e&r^t&r}var Zc=class extends us{constructor(t,r,o,n){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=r,this.padOffset=o,this.isLE=n,this.buffer=new Uint8Array(t),this.view=Kc(this.buffer)}update(t){ps(this),t=sa(t),hn(t);let{view:r,buffer:o,blockLen:n}=this,s=t.length;for(let i=0;i<s;){let a=Math.min(n-this.pos,s-i);if(a===n){let c=Kc(t);for(;n<=s-i;i+=n)this.process(c,i);continue}o.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===n&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){ps(this),qc(t,this),this.finished=!0;let{buffer:r,view:o,blockLen:n,isLE:s}=this,{pos:i}=this;r[i++]=128,_o(this.buffer.subarray(i)),this.padOffset>n-i&&(this.process(o,0),i=0);for(let p=i;p<n;p++)r[p]=0;e2(o,n-8,BigInt(this.length*8),s),this.process(o,0);let a=Kc(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let m=c/4,u=this.get();if(m>u.length)throw new Error("_sha2: outputLen bigger than state");for(let p=0;p<m;p++)a.setUint32(4*p,u[p],s)}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let o=t.slice(0,r);return this.destroy(),o}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:r,buffer:o,length:n,finished:s,destroyed:i,pos:a}=this;return t.destroyed=i,t.finished=s,t.length=n,t.pos=a,n%r&&t.buffer.set(o),t}clone(){return this._cloneInto()}},Jr=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);Jc();var r2=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ao=new Uint32Array(64),Xc=class extends Zc{constructor(t=32){super(64,t,8,!1),this.A=Jr[0]|0,this.B=Jr[1]|0,this.C=Jr[2]|0,this.D=Jr[3]|0,this.E=Jr[4]|0,this.F=Jr[5]|0,this.G=Jr[6]|0,this.H=Jr[7]|0}get(){let{A:t,B:r,C:o,D:n,E:s,F:i,G:a,H:c}=this;return[t,r,o,n,s,i,a,c]}set(t,r,o,n,s,i,a,c){this.A=t|0,this.B=r|0,this.C=o|0,this.D=n|0,this.E=s|0,this.F=i|0,this.G=a|0,this.H=c|0}process(t,r){for(let p=0;p<16;p++,r+=4)Ao[p]=t.getUint32(r,!1);for(let p=16;p<64;p++){let l=Ao[p-15],d=Ao[p-2],h=cr(l,7)^cr(l,18)^l>>>3,g=cr(d,17)^cr(d,19)^d>>>10;Ao[p]=g+Ao[p-7]+h+Ao[p-16]|0}let{A:o,B:n,C:s,D:i,E:a,F:c,G:m,H:u}=this;for(let p=0;p<64;p++){let l=cr(a,6)^cr(a,11)^cr(a,25),d=u+l+_h(a,c,m)+r2[p]+Ao[p]|0,g=(cr(o,2)^cr(o,13)^cr(o,22))+Ah(o,n,s)|0;u=m,m=c,c=a,a=i+d|0,i=s,s=n,n=o,o=d+g|0}o=o+this.A|0,n=n+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,m=m+this.G|0,u=u+this.H|0,this.set(o,n,s,i,a,c,m,u)}roundClean(){_o(Ao)}destroy(){this.set(0,0,0,0,0,0,0,0),_o(this.buffer)}};var Dh=Wc(()=>new Xc);var Nh=Dh;Pt();qe();D();function Lh(e,t){let r=t||"hex",o=Nh(pe(e,{strict:!1})?Ht(e):e);return r==="bytes"?o:me(o)}function Oh(e){let{commitment:t,version:r=1}=e,o=e.to??(typeof t=="string"?"hex":"bytes"),n=Lh(t,"bytes");return n.set([r],0),o==="bytes"?n:ee(n)}function Qc(e){let{commitments:t,version:r}=e,o=e.to??(typeof t[0]=="string"?"hex":"bytes"),n=[];for(let s of t)n.push(Oh({commitment:s,to:o,version:r}));return n}G();var em=class extends w{constructor({maxSize:t,size:r}){super("Blob size is too large.",{metaMessages:[`Max: ${t} bytes`,`Given: ${r} bytes`],name:"BlobSizeTooLargeError"})}},ls=class extends w{constructor(){super("Blob data must not be empty.",{name:"EmptyBlobError"})}},tm=class extends w{constructor({hash:t,size:r}){super(`Versioned hash "${t}" size is invalid.`,{metaMessages:["Expected: 32",`Received: ${r}`],name:"InvalidVersionedHashSizeError"})}},rm=class extends w{constructor({hash:t,version:r}){super(`Versioned hash "${t}" version is invalid.`,{metaMessages:[`Expected: ${1}`,`Received: ${r}`],name:"InvalidVersionedHashVersionError"})}};Fc();zt();qe();D();function Uh(e){let t=e.to??(typeof e.data=="string"?"hex":"bytes"),r=typeof e.data=="string"?Ue(e.data):e.data,o=Q(r);if(!o)throw new ls;if(o>761855)throw new em({maxSize:761855,size:o});let n=[],s=!0,i=0;for(;s;){let a=ts(new Uint8Array(131072)),c=0;for(;c<4096;){let m=r.slice(i,i+31);if(a.pushByte(0),a.pushBytes(m),m.length<31){a.pushByte(128),s=!1;break}c++,i+=31}n.push(a)}return t==="bytes"?n.map(a=>a.bytes):n.map(a=>ee(a.bytes))}function om(e){let{data:t,kzg:r,to:o}=e,n=e.blobs??Uh({data:t,to:o}),s=e.commitments??cs({blobs:n,kzg:r,to:o}),i=e.proofs??ms({blobs:n,commitments:s,kzg:r,to:o}),a=[];for(let c=0;c<n.length;c++)a.push({blob:n[c],commitment:s[c],proof:i[c]});return a}ut();ln();D();ql();mr();G();aa();Po();$t();zt();$o();Oe();function Jh(e){let{authorizationList:t}=e;if(t)for(let r of t){let{chainId:o}=r,n=r.address;if(!te(n))throw new ae({address:n});if(o<0)throw new yn({chainId:o})}cm(e)}function Zh(e){let{blobVersionedHashes:t}=e;if(t){if(t.length===0)throw new ls;for(let r of t){let o=Q(r),n=Ce(Kt(r,0,1));if(o!==32)throw new tm({hash:r,size:o});if(n!==1)throw new rm({hash:r,version:n})}}cm(e)}function cm(e){let{chainId:t,maxPriorityFeePerGas:r,maxFeePerGas:o,to:n}=e;if(t<=0)throw new yn({chainId:t});if(n&&!te(n))throw new ae({address:n});if(o&&o>Qn)throw new jt({maxFeePerGas:o});if(r&&o&&r>o)throw new br({maxFeePerGas:o,maxPriorityFeePerGas:r})}function Yh(e){let{chainId:t,maxPriorityFeePerGas:r,gasPrice:o,maxFeePerGas:n,to:s}=e;if(t<=0)throw new yn({chainId:t});if(s&&!te(s))throw new ae({address:s});if(r||n)throw new w("`maxFeePerGas`/`maxPriorityFeePerGas` is not a valid EIP-2930 Transaction attribute.");if(o&&o>Qn)throw new jt({maxFeePerGas:o})}function Xh(e){let{chainId:t,maxPriorityFeePerGas:r,gasPrice:o,maxFeePerGas:n,to:s}=e;if(s&&!te(s))throw new ae({address:s});if(typeof t<"u"&&t<=0)throw new yn({chainId:t});if(r||n)throw new w("`maxFeePerGas`/`maxPriorityFeePerGas` is not a valid Legacy Transaction attribute.");if(o&&o>Qn)throw new jt({maxFeePerGas:o})}Tt();function mm(e){if(e.type)return e.type;if(typeof e.authorizationList<"u")return"eip7702";if(typeof e.blobs<"u"||typeof e.blobVersionedHashes<"u"||typeof e.maxFeePerBlobGas<"u"||typeof e.sidecars<"u")return"eip4844";if(typeof e.maxFeePerGas<"u"||typeof e.maxPriorityFeePerGas<"u")return"eip1559";if(typeof e.gasPrice<"u")return typeof e.accessList<"u"?"eip2930":"legacy";throw new Hc({transaction:e})}mr();Tt();$t();function ma(e){if(!e||e.length===0)return[];let t=[];for(let r=0;r<e.length;r++){let{address:o,storageKeys:n}=e[r];for(let s=0;s<n.length;s++)if(n[s].length-2!==64)throw new jc({storageKey:n[s]});if(!te(o,{strict:!1}))throw new ae({address:o});t.push([o,n])}return t}function um(e,t){let r=mm(e);return r==="eip1559"?y2(e,t):r==="eip2930"?b2(e,t):r==="eip4844"?g2(e,t):r==="eip7702"?h2(e,t):x2(e,t)}function h2(e,t){let{authorizationList:r,chainId:o,gas:n,nonce:s,to:i,value:a,maxFeePerGas:c,maxPriorityFeePerGas:m,accessList:u,data:p}=e;Jh(e);let l=ma(u),d=kh(r);return Ke(["0x04",ar([S(o),s?S(s):"0x",m?S(m):"0x",c?S(c):"0x",n?S(n):"0x",i??"0x",a?S(a):"0x",p??"0x",l,d,...as(e,t)])])}function g2(e,t){let{chainId:r,gas:o,nonce:n,to:s,value:i,maxFeePerBlobGas:a,maxFeePerGas:c,maxPriorityFeePerGas:m,accessList:u,data:p}=e;Zh(e);let l=e.blobVersionedHashes,d=e.sidecars;if(e.blobs&&(typeof l>"u"||typeof d>"u")){let v=typeof e.blobs[0]=="string"?e.blobs:e.blobs.map(k=>ee(k)),E=e.kzg,A=cs({blobs:v,kzg:E});if(typeof l>"u"&&(l=Qc({commitments:A})),typeof d>"u"){let k=ms({blobs:v,commitments:A,kzg:E});d=om({blobs:v,commitments:A,proofs:k})}}let h=ma(u),g=[S(r),n?S(n):"0x",m?S(m):"0x",c?S(c):"0x",o?S(o):"0x",s??"0x",i?S(i):"0x",p??"0x",h,a?S(a):"0x",l??[],...as(e,t)],y=[],x=[],b=[];if(d)for(let v=0;v<d.length;v++){let{blob:E,commitment:A,proof:k}=d[v];y.push(E),x.push(A),b.push(k)}return Ke(["0x03",d?ar([g,y,x,b]):ar(g)])}function y2(e,t){let{chainId:r,gas:o,nonce:n,to:s,value:i,maxFeePerGas:a,maxPriorityFeePerGas:c,accessList:m,data:u}=e;cm(e);let p=ma(m),l=[S(r),n?S(n):"0x",c?S(c):"0x",a?S(a):"0x",o?S(o):"0x",s??"0x",i?S(i):"0x",u??"0x",p,...as(e,t)];return Ke(["0x02",ar(l)])}function b2(e,t){let{chainId:r,gas:o,data:n,nonce:s,to:i,value:a,accessList:c,gasPrice:m}=e;Yh(e);let u=ma(c),p=[S(r),s?S(s):"0x",m?S(m):"0x",o?S(o):"0x",i??"0x",a?S(a):"0x",n??"0x",u,...as(e,t)];return Ke(["0x01",ar(p)])}function x2(e,t){let{chainId:r=0,gas:o,data:n,nonce:s,to:i,value:a,gasPrice:c}=e;Xh(e);let m=[s?S(s):"0x",c?S(c):"0x",o?S(o):"0x",i??"0x",a?S(a):"0x",n??"0x"];if(t){let u=(()=>{if(t.v>=35n)return(t.v-35n)/2n>0?t.v:27n+(t.v===35n?0n:1n);if(r>0)return BigInt(r*2)+BigInt(35n+t.v-27n);let d=27n+(t.v===27n?0n:1n);if(t.v!==d)throw new zc({v:t.v});return d})(),p=Ve(t.r),l=Ve(t.s);m=[...m,S(u),p==="0x00"?"0x":p,l==="0x00"?"0x":l]}else r>0&&(m=[...m,S(r),"0x","0x"]);return ar(m)}function as(e,t){let r=t??e,{v:o,yParity:n}=r;if(typeof r.r>"u")return[];if(typeof r.s>"u")return[];if(typeof o>"u"&&typeof n>"u")return[];let s=Ve(r.r),i=Ve(r.s);return[typeof n=="number"?n?S(1):"0x":o===0n?"0x":o===1n?S(1):o===27n?"0x":S(1),s==="0x00"?"0x":s,i==="0x00"?"0x":i]}var Qh={gasPriceOracle:{address:"0x420000000000000000000000000000000000000F"},l1Block:{address:"0x4200000000000000000000000000000000000015"},l2CrossDomainMessenger:{address:"0x4200000000000000000000000000000000000007"},l2Erc721Bridge:{address:"0x4200000000000000000000000000000000000014"},l2StandardBridge:{address:"0x4200000000000000000000000000000000000010"},l2ToL1MessagePasser:{address:"0x4200000000000000000000000000000000000016"}};Oe();var eg={block:vh({format(e){return{transactions:e.transactions?.map(r=>{if(typeof r=="string")return r;let o=fn(r);return o.typeHex==="0x7e"&&(o.isSystemTx=r.isSystemTx,o.mint=r.mint?ue(r.mint):void 0,o.sourceHash=r.sourceHash,o.type="deposit"),o}),stateRoot:e.stateRoot}}}),transaction:xh({format(e){let t={};return e.type==="0x7e"&&(t.isSystemTx=e.isSystemTx,t.mint=e.mint?ue(e.mint):void 0,t.sourceHash=e.sourceHash,t.type="deposit"),t}}),transactionReceipt:wh({format(e){return{l1GasPrice:e.l1GasPrice?ue(e.l1GasPrice):null,l1GasUsed:e.l1GasUsed?ue(e.l1GasUsed):null,l1Fee:e.l1Fee?ue(e.l1Fee):null,l1FeeScalar:e.l1FeeScalar?Number(e.l1FeeScalar):null}}})};mr();$t();ut();D();function v2(e,t){return C2(e)?w2(e):um(e,t)}var tg={transaction:v2};function w2(e){E2(e);let{sourceHash:t,data:r,from:o,gas:n,isSystemTx:s,mint:i,to:a,value:c}=e,m=[t,o,a??"0x",i?me(i):"0x",c?me(c):"0x",n?me(n):"0x",s?"0x1":"0x",r??"0x"];return Ke(["0x7e",ar(m)])}function C2(e){return e.type==="deposit"||typeof e.sourceHash<"u"}function E2(e){let{from:t,to:r}=e;if(t&&!te(t))throw new ae({address:t});if(r&&!te(r))throw new ae({address:r})}var rf={blockTime:2e3,contracts:Qh,formatters:eg,serializers:tg};var pm=pn({id:31337,name:"Anvil",nativeCurrency:{decimals:18,name:"Ether",symbol:"ETH"},rpcUrls:{default:{http:["http://127.0.0.1:8545"],webSocket:["ws://127.0.0.1:8545"]}}});var ua=1,pa=pn({...rf,id:8453,name:"Base",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},rpcUrls:{default:{http:["https://mainnet.base.org"]}},blockExplorers:{default:{name:"Basescan",url:"https://basescan.org",apiUrl:"https://api.basescan.org/api"}},contracts:{...rf.contracts,disputeGameFactory:{[ua]:{address:"0x43edB88C4B80fDD2AdFF2412A7BebF9dF42cB40e"}},l2OutputOracle:{[ua]:{address:"0x56315b90c40730925ec5485cf004d835058518A0"}},multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:5022},portal:{[ua]:{address:"0x49048044D57e1C92A77f79988d21Fa8fAF74E97e",blockCreated:17482143}},l1StandardBridge:{[ua]:{address:"0x3154Cf16ccdb4C6d922629664174b904d80F2C35",blockCreated:17482143}}},sourceId:ua}),S2=pn({...pa,experimental_preconfirmationTime:200,rpcUrls:{default:{http:["https://mainnet-preconf.base.org"]}}});aa();function Es({chain:e,currentChainId:t}){if(!e)throw new sm;if(t!==e.id)throw new nm({chain:e,currentChainId:t})}G();var We=class extends w{constructor({docsPath:t}={}){super(["Could not find an Account to execute with this Action.","Please provide an Account with the `account` argument on the Action, or by supplying an `account` to the Client."].join(`
`),{docsPath:t,docsSlug:"account",name:"AccountNotFoundError"})}},Jt=class extends w{constructor({docsPath:t,metaMessages:r,type:o}){super(`Account type "${o}" is not supported.`,{docsPath:t,metaMessages:r,name:"AccountTypeNotSupportedError"})}};var iu=pn({id:1,name:"Ethereum",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},blockTime:12e3,rpcUrls:{default:{http:["https://eth.merkle.io"]}},blockExplorers:{default:{name:"Etherscan",url:"https://etherscan.io",apiUrl:"https://api.etherscan.io/api"}},contracts:{ensUniversalResolver:{address:"0xeeeeeeee14d718c2b47d9923deab1335e144eeee",blockCreated:23085558},multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:14353601}}});import{z as Pe}from"zod";import{z as Dt}from"zod";import{z as P}from"zod";import{z as Bi}from"zod";import{z as tr}from"zod";import{z as q}from"zod";import{z as Y}from"zod";import{z as ft}from"zod";import $8 from"crypto";import{z as Dr}from"zod";import{z as hr}from"zod";import{z as Xe}from"zod";import{z as kt}from"zod";import{z as It}from"zod";import{z as aI}from"zod";import{z as L1}from"zod";import{z as Nr}from"zod";import{z as Ni}from"zod";import{z as Nn}from"zod";import{z as RI}from"zod";import{z as FI}from"zod";import{z as ie}from"zod";import{z as Br}from"zod";import{z as JI}from"zod";import{z as Ae}from"zod";import{z as H}from"zod";import{z as Di}from"zod";import{z as O1}from"zod";import{z as ct}from"zod";import{z as rv}from"zod";import{z as Mr}from"zod";import{z as Ne}from"zod";function T(e,t,r){let o=e[t.name];if(typeof o=="function")return o;let n=e[r];return typeof n=="function"?n:s=>t(e,s)}Ie();G();var au=class extends w{constructor(t){super(`Filter type "${t}" is not supported.`,{name:"FilterTypeNotSupportedError"})}};qe();qt();wa();eo();Xr();Bo();var ey="/docs/contract/encodeEventTopics";function Ir(e){let{abi:t,eventName:r,args:o}=e,n=t[0];if(r){let c=wt({abi:t,name:r});if(!c)throw new ha(r,{docsPath:ey});n=c}if(n.type!=="event")throw new ha(void 0,{docsPath:ey});let s=He(n),i=Mo(s),a=[];if(o&&"inputs"in n){let c=n.inputs?.filter(u=>"indexed"in u&&u.indexed),m=Array.isArray(o)?o:Object.values(o).length>0?c?.map(u=>o[u.name])??[]:[];m.length>0&&(a=c?.map((u,p)=>Array.isArray(m[p])?m[p].map((l,d)=>ty({param:u,value:m[p][d]})):typeof m[p]<"u"&&m[p]!==null?ty({param:u,value:m[p]}):null)??[])}return[i,...a]}function ty({param:e,value:t}){if(e.type==="string"||e.type==="bytes")return ce(Ht(t));if(e.type==="tuple"||e.type.match(/^(.*)\[(\d+)?\]$/))throw new au(e.type);return pt([e],[t])}D();function zo(e,{method:t}){let r={};return e.transport.type==="fallback"&&e.transport.onResponse?.(({method:o,response:n,status:s,transport:i})=>{s==="success"&&t===o&&(r[n]=i.request)}),(o=>r[o]||e.request)}async function cu(e,t){let{address:r,abi:o,args:n,eventName:s,fromBlock:i,strict:a,toBlock:c}=t,m=zo(e,{method:"eth_newFilter"}),u=s?Ir({abi:o,args:n,eventName:s}):void 0,p=await e.request({method:"eth_newFilter",params:[{address:r,fromBlock:typeof i=="bigint"?S(i):i,toBlock:typeof c=="bigint"?S(c):c,topics:u}]});return{abi:o,args:n,eventName:s,id:p,request:m(p),strict:!!a,type:"event"}}ke();Mt();Ie();G();Fo();Cn();ti();var rE=3;function Bt(e,{abi:t,address:r,args:o,docsPath:n,functionName:s,sender:i}){let a=e instanceof Er?e:e instanceof w?e.walk(h=>"data"in h)||e.walk():{},{code:c,data:m,details:u,message:p,shortMessage:l}=a,d=e instanceof Zt?new ru({functionName:s}):[rE,ro.code].includes(c)&&(m||u||p||l)?new wn({abi:t,data:typeof m=="object"?m.data:m,functionName:s,message:a instanceof Do?u:l??p}):e;return new Ds(d,{abi:t,args:o,contractAddress:r,docsPath:n,functionName:s,sender:i})}ke();G();To();qt();function mu(e){let t=ce(`0x${e.substring(4)}`).substring(26);return Yr(`0x${t}`)}Pt();zt();Oe();D();async function iy({hash:e,signature:t}){let r=pe(e)?e:me(e),{secp256k1:o}=await import("@noble/curves/secp256k1");return`0x${(()=>{if(typeof t=="object"&&"r"in t&&"s"in t){let{r:m,s:u,v:p,yParity:l}=t,d=Number(l??p),h=sy(d);return new o.Signature(ue(m),ue(u)).addRecoveryBit(h)}let i=pe(t)?t:me(t);if(Q(i)!==65)throw new Error("invalid signature length");let a=Ce(`0x${i.slice(130)}`),c=sy(a);return o.Signature.fromCompact(i.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(r.substring(2)).toHex(!1)}`}function sy(e){if(e===0||e===1)return e;if(e===27)return 0;if(e===28)return 1;throw new Error("Invalid yParityOrV value")}async function uu({hash:e,signature:t}){return mu(await iy({hash:e,signature:t}))}ut();qe();D();qt();function pu(e){let{chainId:t,nonce:r,to:o}=e,n=e.contractAddress??e.address,s=ce(Ke(["0x05",ar([t?S(t):"0x",n,r?S(r):"0x"])]));return o==="bytes"?Ue(s):s}async function Ho(e){let{authorization:t,signature:r}=e;return uu({hash:pu(t),signature:r??t})}D();Oc();os();G();Tt();var lu=class extends w{constructor(t,{account:r,docsPath:o,chain:n,data:s,gas:i,gasPrice:a,maxFeePerGas:c,maxPriorityFeePerGas:m,nonce:u,to:p,value:l}){let d=dn({from:r?.address,to:p,value:typeof l<"u"&&`${rs(l)} ${n?.nativeCurrency?.symbol||"ETH"}`,data:s,gas:i,gasPrice:typeof a<"u"&&`${ze(a)} gwei`,maxFeePerGas:typeof c<"u"&&`${ze(c)} gwei`,maxPriorityFeePerGas:typeof m<"u"&&`${ze(m)} gwei`,nonce:u});super(t.shortMessage,{cause:t,docsPath:o,metaMessages:[...t.metaMessages?[...t.metaMessages," "]:[],"Estimate Gas Arguments:",d].filter(Boolean),name:"EstimateGasExecutionError"}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cause=t}};Po();Ea();function ay(e,{docsPath:t,...r}){let o=(()=>{let n=Uo(e,r);return n instanceof Gt?e:n})();return new lu(o,{docsPath:t,...r})}ri();Io();fu();oo();ke();os();G();var du=class extends w{constructor(){super("`baseFeeMultiplier` must be greater than 1.",{name:"BaseFeeScalarError"})}},jo=class extends w{constructor(){super("Chain does not support EIP-1559 fees.",{name:"Eip1559FeesNotSupportedError"})}},hu=class extends w{constructor({maxPriorityFeePerGas:t}){super(`\`maxFeePerGas\` cannot be less than the \`maxPriorityFeePerGas\` (${ze(t)} gwei).`,{name:"MaxFeePerGasTooLowError"})}};Oe();G();var ni=class extends w{constructor({blockHash:t,blockNumber:r}){let o="Block";t&&(o=`Block at hash "${t}"`),r&&(o=`Block at number "${r}"`),super(`${o} could not be found.`,{name:"BlockNotFoundError"})}};D();async function st(e,{blockHash:t,blockNumber:r,blockTag:o=e.experimental_blockTag??"latest",includeTransactions:n}={}){let s=n??!1,i=r!==void 0?S(r):void 0,a=null;if(t?a=await e.request({method:"eth_getBlockByHash",params:[t,s]},{dedupe:!0}):a=await e.request({method:"eth_getBlockByNumber",params:[i||o,s]},{dedupe:!!i}),!a)throw new ni({blockHash:t,blockNumber:r});return(e.chain?.formatters?.block?.format||ra)(a,"getBlock")}async function si(e){let t=await e.request({method:"eth_gasPrice"});return BigInt(t)}async function my(e,t){return vf(e,t)}async function vf(e,t){let{block:r,chain:o=e.chain,request:n}=t||{};try{let s=o?.fees?.maxPriorityFeePerGas??o?.fees?.defaultPriorityFee;if(typeof s=="function"){let a=r||await T(e,st,"getBlock")({}),c=await s({block:a,client:e,request:n});if(c===null)throw new Error;return c}if(typeof s<"u")return s;let i=await e.request({method:"eth_maxPriorityFeePerGas"});return ue(i)}catch{let[s,i]=await Promise.all([r?Promise.resolve(r):T(e,st,"getBlock")({}),T(e,si,"getGasPrice")({})]);if(typeof s.baseFeePerGas!="bigint")throw new jo;let a=i-s.baseFeePerGas;return a<0n?0n:a}}async function uy(e,t){return gu(e,t)}async function gu(e,t){let{block:r,chain:o=e.chain,request:n,type:s="eip1559"}=t||{},i=await(async()=>typeof o?.fees?.baseFeeMultiplier=="function"?o.fees.baseFeeMultiplier({block:r,client:e,request:n}):o?.fees?.baseFeeMultiplier??1.2)();if(i<1)throw new du;let c=10**(i.toString().split(".")[1]?.length??0),m=l=>l*BigInt(Math.ceil(i*c))/BigInt(c),u=r||await T(e,st,"getBlock")({});if(typeof o?.fees?.estimateFeesPerGas=="function"){let l=await o.fees.estimateFeesPerGas({block:r,client:e,multiply:m,request:n,type:s});if(l!==null)return l}if(s==="eip1559"){if(typeof u.baseFeePerGas!="bigint")throw new jo;let l=typeof n?.maxPriorityFeePerGas=="bigint"?n.maxPriorityFeePerGas:await vf(e,{block:u,chain:o,request:n}),d=m(u.baseFeePerGas);return{maxFeePerGas:n?.maxFeePerGas??d+l,maxPriorityFeePerGas:l}}return{gasPrice:n?.gasPrice??m(await T(e,si,"getGasPrice")({}))}}Oe();D();async function ii(e,{address:t,blockTag:r="latest",blockNumber:o}){let n=await e.request({method:"eth_getTransactionCount",params:[t,typeof o=="bigint"?S(o):r]},{dedupe:!!o});return Ce(n)}oo();Oe();async function Ct(e){let t=await e.request({method:"eth_chainId"},{dedupe:!0});return Ce(t)}var Sa=["blobVersionedHashes","chainId","fees","gas","nonce","type"],py=new Map;async function _r(e,t){let{account:r=e.account,blobs:o,chain:n,gas:s,kzg:i,nonce:a,nonceManager:c,parameters:m=Sa,type:u}=t,p=r&&V(r),l={...t,...p?{from:p?.address}:{}},d;async function h(){return d||(d=await T(e,st,"getBlock")({blockTag:"latest"}),d)}let g;async function y(){return g||(n?n.id:typeof t.chainId<"u"?t.chainId:(g=await T(e,Ct,"getChainId")({}),g))}if(m.includes("nonce")&&typeof a>"u"&&p)if(c){let x=await y();l.nonce=await c.consume({address:p.address,chainId:x,client:e})}else l.nonce=await T(e,ii,"getTransactionCount")({address:p.address,blockTag:"pending"});if((m.includes("blobVersionedHashes")||m.includes("sidecars"))&&o&&i){let x=cs({blobs:o,kzg:i});if(m.includes("blobVersionedHashes")){let b=Qc({commitments:x,to:"hex"});l.blobVersionedHashes=b}if(m.includes("sidecars")){let b=ms({blobs:o,commitments:x,kzg:i}),v=om({blobs:o,commitments:x,proofs:b,to:"hex"});l.sidecars=v}}if(m.includes("chainId")&&(l.chainId=await y()),(m.includes("fees")||m.includes("type"))&&typeof u>"u")try{l.type=mm(l)}catch{let x=py.get(e.uid);typeof x>"u"&&(x=typeof(await h())?.baseFeePerGas=="bigint",py.set(e.uid,x)),l.type=x?"eip1559":"legacy"}if(m.includes("fees"))if(l.type!=="legacy"&&l.type!=="eip2930"){if(typeof l.maxFeePerGas>"u"||typeof l.maxPriorityFeePerGas>"u"){let x=await h(),{maxFeePerGas:b,maxPriorityFeePerGas:v}=await gu(e,{block:x,chain:n,request:l});if(typeof t.maxPriorityFeePerGas>"u"&&t.maxFeePerGas&&t.maxFeePerGas<v)throw new hu({maxPriorityFeePerGas:v});l.maxPriorityFeePerGas=v,l.maxFeePerGas=b}}else{if(typeof t.maxFeePerGas<"u"||typeof t.maxPriorityFeePerGas<"u")throw new jo;if(typeof t.gasPrice>"u"){let x=await h(),{gasPrice:b}=await gu(e,{block:x,chain:n,request:l,type:"legacy"});l.gasPrice=b}}return m.includes("gas")&&typeof s>"u"&&(l.gas=await T(e,ai,"estimateGas")({...l,account:p,prepare:p?.type==="local"?[]:["blobVersionedHashes"]})),nt(l),delete l.parameters,l}async function ai(e,t){let{account:r=e.account,prepare:o=!0}=t,n=r?V(r):void 0,s=(()=>{if(Array.isArray(o))return o;if(n?.type!=="local")return["blobVersionedHashes"]})();try{let{accessList:i,authorizationList:a,blobs:c,blobVersionedHashes:m,blockNumber:u,blockTag:p,data:l,gas:d,gasPrice:h,maxFeePerBlobGas:g,maxFeePerGas:y,maxPriorityFeePerGas:x,nonce:b,value:v,stateOverride:E,...A}=o?await _r(e,{...t,parameters:s}):t,I=(typeof u=="bigint"?S(u):void 0)||p,R=oi(E),B=await(async()=>{if(A.to)return A.to;if(a&&a.length>0)return await Ho({authorization:a[0]}).catch(()=>{throw new w("`to` is required. Could not infer from `authorizationList`")})})();nt(t);let M=e.chain?.formatters?.transactionRequest?.format,O=(M||xt)({...kr(A,{format:M}),account:n,accessList:i,authorizationList:a,blobs:c,blobVersionedHashes:m,data:l,gas:d,gasPrice:h,maxFeePerBlobGas:g,maxFeePerGas:y,maxPriorityFeePerGas:x,nonce:b,to:B,value:v},"estimateGas");return BigInt(await e.request({method:"eth_estimateGas",params:R?[O,I??e.experimental_blockTag??"latest",R]:I?[O,I]:[O]}))}catch(i){throw ay(i,{...t,account:n,chain:e.chain})}}async function ly(e,t){let{abi:r,address:o,args:n,functionName:s,dataSuffix:i,...a}=t,c=de({abi:r,args:n,functionName:s});try{return await T(e,ai,"estimateGas")({data:`${c}${i?i.replace("0x",""):""}`,to:o,...a})}catch(m){let u=a.account?V(a.account):void 0;throw Bt(m,{abi:r,address:o,args:n,docsPath:"/docs/contract/estimateContractGas",functionName:s,sender:u?.address})}}Bo();Ie();kn();qe();qt();wa();Ie();Kl();zt();wa();va();Xr();var fy="/docs/contract/decodeEventLog";function ci(e){let{abi:t,data:r,strict:o,topics:n}=e,s=o??!0,[i,...a]=n;if(!i)throw new vm({docsPath:fy});let c=t.find(g=>g.type==="event"&&i===Mo(He(g)));if(!(c&&"name"in c)||c.type!=="event")throw new Is(i,{docsPath:fy});let{name:m,inputs:u}=c,p=u?.some(g=>!("name"in g&&g.name)),l=p?[]:{},d=u.map((g,y)=>[g,y]).filter(([g])=>"indexed"in g&&g.indexed);for(let g=0;g<d.length;g++){let[y,x]=d[g],b=a[g];if(!b)throw new xr({abiItem:c,param:y});l[p?x:y.name||x]=nE({param:y,value:b})}let h=u.filter(g=>!("indexed"in g&&g.indexed));if(h.length>0){if(r&&r!=="0x")try{let g=to(h,r);if(g)if(p)for(let y=0;y<u.length;y++)l[y]=l[y]??g.shift();else for(let y=0;y<h.length;y++)l[h[y].name]=g[y]}catch(g){if(s)throw g instanceof Ss||g instanceof es?new pr({abiItem:c,data:r,params:h,size:Q(r)}):g}else if(s)throw new pr({abiItem:c,data:"0x",params:h,size:0})}return{eventName:m,args:Object.values(l).length>0?l:void 0}}function nE({param:e,value:t}){return e.type==="string"||e.type==="bytes"||e.type==="tuple"||e.type.match(/^(.*)\[(\d+)?\]$/)?t:(to([e],t)||[])[0]}function fr(e){let{abi:t,args:r,logs:o,strict:n=!0}=e,s=(()=>{if(e.eventName)return Array.isArray(e.eventName)?e.eventName:[e.eventName]})();return o.map(i=>{try{let a=t.find(m=>m.type==="event"&&i.topics[0]===Mo(m));if(!a)return null;let c=ci({...i,abi:[a],strict:n});return s&&!s.includes(c.eventName)||!sE({args:c.args,inputs:a.inputs,matchArgs:r})?null:{...c,...i}}catch(a){let c,m;if(a instanceof Is)return null;if(a instanceof pr||a instanceof xr){if(n)return null;c=a.abiItem.name,m=a.abiItem.inputs?.some(u=>!("name"in u&&u.name))}return{...i,args:m?[]:{},eventName:c}}}).filter(Boolean)}function sE(e){let{args:t,inputs:r,matchArgs:o}=e;if(!o)return!0;if(!t)return!1;function n(s,i,a){try{return s.type==="address"?Xt(i,a):s.type==="string"||s.type==="bytes"?ce(Ht(i))===a:i===a}catch{return!1}}return Array.isArray(t)&&Array.isArray(o)?o.every((s,i)=>{if(s==null)return!0;let a=r[i];return a?(Array.isArray(s)?s:[s]).some(m=>n(a,m,t[i])):!1}):typeof t=="object"&&!Array.isArray(t)&&typeof o=="object"&&!Array.isArray(o)?Object.entries(o).every(([s,i])=>{if(i==null)return!0;let a=r.find(m=>m.name===s);return a?(Array.isArray(i)?i:[i]).some(m=>n(a,m,t[s])):!1}):!1}D();async function mi(e,{address:t,blockHash:r,fromBlock:o,toBlock:n,event:s,events:i,args:a,strict:c}={}){let m=c??!1,u=i??(s?[s]:void 0),p=[];u&&(p=[u.flatMap(g=>Ir({abi:[g],eventName:g.name,args:i?void 0:a}))],s&&(p=p[0]));let l;r?l=await e.request({method:"eth_getLogs",params:[{address:t,topics:p,blockHash:r}]}):l=await e.request({method:"eth_getLogs",params:[{address:t,topics:p,fromBlock:typeof o=="bigint"?S(o):o,toBlock:typeof n=="bigint"?S(n):n}]});let d=l.map(h=>tt(h));return u?fr({abi:u,args:a,logs:d,strict:m}):d}async function yu(e,t){let{abi:r,address:o,args:n,blockHash:s,eventName:i,fromBlock:a,toBlock:c,strict:m}=t,u=i?wt({abi:r,name:i}):void 0,p=u?void 0:r.filter(l=>l.type==="event");return T(e,mi,"getLogs")({address:o,args:n,blockHash:s,event:u,events:p,fromBlock:a,toBlock:c,strict:m})}Go();Mt();bi();async function De(e,t){let{abi:r,address:o,args:n,functionName:s,...i}=t,a=de({abi:r,args:n,functionName:s});try{let{data:c}=await T(e,Tr,"call")({...i,data:a,to:o});return Et({abi:r,args:n,functionName:s,data:c||"0x"})}catch(c){throw Bt(c,{abi:r,address:o,args:n,docsPath:"/docs/contract/readContract",functionName:s})}}ke();Go();Mt();bi();async function eb(e,t){let{abi:r,address:o,args:n,dataSuffix:s,functionName:i,...a}=t,c=a.account?V(a.account):e.account,m=de({abi:r,args:n,functionName:i});try{let{data:u}=await T(e,Tr,"call")({batch:!1,data:`${m}${s?s.replace("0x",""):""}`,to:o,...a,account:c}),p=Et({abi:r,args:n,functionName:i,data:u||"0x"}),l=r.filter(d=>"name"in d&&d.name===t.functionName);return{result:p,request:{abi:l,address:o,args:n,dataSuffix:s,functionName:i,...a,account:c}}}catch(u){throw Bt(u,{abi:r,address:o,args:n,docsPath:"/docs/contract/simulateContract",functionName:i,sender:c?.address})}}Ie();ti();var Hf=new Map,tb=new Map,kE=0;function it(e,t,r){let o=++kE,n=()=>Hf.get(e)||[],s=()=>{let u=n();Hf.set(e,u.filter(p=>p.id!==o))},i=()=>{let u=n();if(!u.some(l=>l.id===o))return;let p=tb.get(e);if(u.length===1&&p){let l=p();l instanceof Promise&&l.catch(()=>{})}s()},a=n();if(Hf.set(e,[...a,{id:o,fns:t}]),a&&a.length>0)return i;let c={};for(let u in t)c[u]=((...p)=>{let l=n();if(l.length!==0)for(let d of l)d.fns[u]?.(...p)});let m=r(c);return typeof m=="function"&&tb.set(e,m),i}async function Ra(e){return new Promise(t=>setTimeout(t,e))}function er(e,{emitOnBegin:t,initialWaitTime:r,interval:o}){let n=!0,s=()=>n=!1;return(async()=>{let a;t&&(a=await e({unpoll:s}));let c=await r?.(a)??o;await Ra(c);let m=async()=>{n&&(await e({unpoll:s}),await Ra(o),m())};m()})(),s}rt();var IE=new Map,_E=new Map;function rb(e){let t=(n,s)=>({clear:()=>s.delete(n),get:()=>s.get(n),set:i=>s.set(n,i)}),r=t(e,IE),o=t(e,_E);return{clear:()=>{r.clear(),o.clear()},promise:r,response:o}}async function ob(e,{cacheKey:t,cacheTime:r=Number.POSITIVE_INFINITY}){let o=rb(t),n=o.response.get();if(n&&r>0&&Date.now()-n.created.getTime()<r)return n.data;let s=o.promise.get();s||(s=e(),o.promise.set(s));try{let i=await s;return o.response.set({created:new Date,data:i}),i}finally{o.promise.clear()}}var AE=e=>`blockNumber.${e}`;async function $r(e,{cacheTime:t=e.cacheTime}={}){let r=await ob(()=>e.request({method:"eth_blockNumber"}),{cacheKey:AE(e.uid),cacheTime:t});return BigInt(r)}async function Wo(e,{filter:t}){let r="strict"in t&&t.strict,o=await t.request({method:"eth_getFilterChanges",params:[t.id]});if(typeof o[0]=="string")return o;let n=o.map(s=>tt(s));return!("abi"in t)||!t.abi?n:fr({abi:t.abi,logs:n,strict:r})}async function Jo(e,{filter:t}){return t.request({method:"eth_uninstallFilter",params:[t.id]})}function nb(e,t){let{abi:r,address:o,args:n,batch:s=!0,eventName:i,fromBlock:a,onError:c,onLogs:m,poll:u,pollingInterval:p=e.pollingInterval,strict:l}=t;return(typeof u<"u"?u:typeof a=="bigint"?!0:!(e.transport.type==="webSocket"||e.transport.type==="ipc"||e.transport.type==="fallback"&&(e.transport.transports[0].config.type==="webSocket"||e.transport.transports[0].config.type==="ipc")))?(()=>{let y=l??!1,x=Z(["watchContractEvent",o,n,s,e.uid,i,p,y,a]);return it(x,{onLogs:m,onError:c},b=>{let v;a!==void 0&&(v=a-1n);let E,A=!1,k=er(async()=>{if(!A){try{E=await T(e,cu,"createContractEventFilter")({abi:r,address:o,args:n,eventName:i,strict:y,fromBlock:a})}catch{}A=!0;return}try{let I;if(E)I=await T(e,Wo,"getFilterChanges")({filter:E});else{let R=await T(e,$r,"getBlockNumber")({});v&&v<R?I=await T(e,yu,"getContractEvents")({abi:r,address:o,args:n,eventName:i,fromBlock:v+1n,toBlock:R,strict:y}):I=[],v=R}if(I.length===0)return;if(s)b.onLogs(I);else for(let R of I)b.onLogs([R])}catch(I){E&&I instanceof Sr&&(A=!1),b.onError?.(I)}},{emitOnBegin:!0,interval:p});return async()=>{E&&await T(e,Jo,"uninstallFilter")({filter:E}),k()}})})():(()=>{let y=l??!1,x=Z(["watchContractEvent",o,n,s,e.uid,i,p,y]),b=!0,v=()=>b=!1;return it(x,{onLogs:m,onError:c},E=>((async()=>{try{let A=(()=>{if(e.transport.type==="fallback"){let R=e.transport.transports.find(B=>B.config.type==="webSocket"||B.config.type==="ipc");return R?R.value:e.transport}return e.transport})(),k=i?Ir({abi:r,eventName:i,args:n}):[],{unsubscribe:I}=await A.subscribe({params:["logs",{address:o,topics:k}],onData(R){if(!b)return;let B=R.result;try{let{eventName:M,args:L}=ci({abi:r,data:B.data,topics:B.topics,strict:l}),O=tt(B,{args:L,eventName:M});E.onLogs([O])}catch(M){let L,O;if(M instanceof pr||M instanceof xr){if(l)return;L=M.abiItem.name,O=M.abiItem.inputs?.some(re=>!("name"in re&&re.name))}let U=tt(B,{args:O?[]:{},eventName:L});E.onLogs([U])}},onError(R){E.onError?.(R)}});v=I,b||v()}catch(A){c?.(A)}})(),()=>v()))})()}ke();Mt();ke();G();Po();Tt();Ea();function xi(e,{docsPath:t,...r}){let o=(()=>{let n=Uo(e,r);return n instanceof Gt?e:n})();return new Gc(o,{docsPath:t,...r})}ri();Io();ws();oo();async function vi(e,{serializedTransaction:t}){return e.request({method:"eth_sendRawTransaction",params:[t]},{retryCount:0})}var jf=new Vt(128);async function Zo(e,t){let{account:r=e.account,chain:o=e.chain,accessList:n,authorizationList:s,blobs:i,data:a,gas:c,gasPrice:m,maxFeePerBlobGas:u,maxFeePerGas:p,maxPriorityFeePerGas:l,nonce:d,type:h,value:g,...y}=t;if(typeof r>"u")throw new We({docsPath:"/docs/actions/wallet/sendTransaction"});let x=r?V(r):null;try{nt(t);let b=await(async()=>{if(t.to)return t.to;if(t.to!==null&&s&&s.length>0)return await Ho({authorization:s[0]}).catch(()=>{throw new w("`to` is required. Could not infer from `authorizationList`.")})})();if(x?.type==="json-rpc"||x===null){let v;o!==null&&(v=await T(e,Ct,"getChainId")({}),Es({currentChainId:v,chain:o}));let E=e.chain?.formatters?.transactionRequest?.format,k=(E||xt)({...kr(y,{format:E}),accessList:n,account:x,authorizationList:s,blobs:i,chainId:v,data:a,gas:c,gasPrice:m,maxFeePerBlobGas:u,maxFeePerGas:p,maxPriorityFeePerGas:l,nonce:d,to:b,type:h,value:g},"sendTransaction"),I=jf.get(e.uid),R=I?"wallet_sendTransaction":"eth_sendTransaction";try{return await e.request({method:R,params:[k]},{retryCount:0})}catch(B){if(I===!1)throw B;let M=B;if(M.name==="InvalidInputRpcError"||M.name==="InvalidParamsRpcError"||M.name==="MethodNotFoundRpcError"||M.name==="MethodNotSupportedRpcError")return await e.request({method:"wallet_sendTransaction",params:[k]},{retryCount:0}).then(L=>(jf.set(e.uid,!0),L)).catch(L=>{let O=L;throw O.name==="MethodNotFoundRpcError"||O.name==="MethodNotSupportedRpcError"?(jf.set(e.uid,!1),M):O});throw M}}if(x?.type==="local"){let v=await T(e,_r,"prepareTransactionRequest")({account:x,accessList:n,authorizationList:s,blobs:i,chain:o,data:a,gas:c,gasPrice:m,maxFeePerBlobGas:u,maxFeePerGas:p,maxPriorityFeePerGas:l,nonce:d,nonceManager:x.nonceManager,parameters:[...Sa,"sidecars"],type:h,value:g,...y,to:b}),E=o?.serializers?.transaction,A=await x.signTransaction(v,{serializer:E});return await T(e,vi,"sendRawTransaction")({serializedTransaction:A})}throw x?.type==="smart"?new Jt({metaMessages:["Consider using the `sendUserOperation` Action instead."],docsPath:"/docs/actions/bundler/sendUserOperation",type:"smart"}):new Jt({docsPath:"/docs/actions/wallet/sendTransaction",type:x?.type})}catch(b){throw b instanceof Jt?b:xi(b,{...t,account:x,chain:t.chain||void 0})}}async function Pn(e,t){return Pn.internal(e,Zo,"sendTransaction",t)}(function(e){async function t(r,o,n,s){let{abi:i,account:a=r.account,address:c,args:m,dataSuffix:u,functionName:p,...l}=s;if(typeof a>"u")throw new We({docsPath:"/docs/contract/writeContract"});let d=a?V(a):null,h=de({abi:i,args:m,functionName:p});try{return await T(r,o,n)({data:`${h}${u?u.replace("0x",""):""}`,to:c,account:d,...l})}catch(g){throw Bt(g,{abi:i,address:c,args:m,docsPath:"/docs/contract/writeContract",functionName:p,sender:d?.address})}}e.internal=t})(Pn||(Pn={}));G();G();var Nu=class extends w{constructor(t){super(`Call bundle failed with status: ${t.statusCode}`,{name:"BundleFailedError"}),Object.defineProperty(this,"result",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.result=t}};Ru();function Tn(e,{delay:t=100,retryCount:r=2,shouldRetry:o=()=>!0}={}){return new Promise((n,s)=>{let i=async({count:a=0}={})=>{let c=async({error:m})=>{let u=typeof t=="function"?t({count:a,error:m}):t;u&&await Ra(u),i({count:a+1})};try{let m=await e();n(m)}catch(m){if(a<r&&await o({count:a,error:m}))return c({error:m});s(m)}};i()})}rt();$o();ln();Oe();ke();G();ti();Mt();ut();Oe();D();var Gf="0x5792579257925792579257925792579257925792579257925792579257925792",Vf=S(0,{size:32});async function Lu(e,t){let{account:r=e.account,capabilities:o,chain:n=e.chain,experimental_fallback:s,experimental_fallbackDelay:i=32,forceAtomic:a=!1,id:c,version:m="2.0.0"}=t,u=r?V(r):null,p=t.calls.map(l=>{let d=l,h=d.abi?de({abi:d.abi,functionName:d.functionName,args:d.args}):d.data;return{data:d.dataSuffix&&h?Fe([h,d.dataSuffix]):h,to:d.to,value:d.value?S(d.value):void 0}});try{let l=await e.request({method:"wallet_sendCalls",params:[{atomicRequired:a,calls:p,capabilities:o,chainId:S(n.id),from:u?.address,id:c,version:m}]},{retryCount:0});return typeof l=="string"?{id:l}:l}catch(l){let d=l;if(s&&(d.name==="MethodNotFoundRpcError"||d.name==="MethodNotSupportedRpcError"||d.name==="UnknownRpcError"||d.details.toLowerCase().includes("does not exist / is not available")||d.details.toLowerCase().includes("missing or invalid. request()")||d.details.toLowerCase().includes("did not match any variant of untagged enum")||d.details.toLowerCase().includes("account upgraded to unsupported contract")||d.details.toLowerCase().includes("eip-7702 not supported")||d.details.toLowerCase().includes("unsupported wc_ method")||d.details.toLowerCase().includes("feature toggled misconfigured")||d.details.toLowerCase().includes("jsonrpcengine: response has no error or result for request"))){if(o&&Object.values(o).some(b=>!b.optional)){let b="non-optional `capabilities` are not supported on fallback to `eth_sendTransaction`.";throw new Lo(new w(b,{details:b}))}if(a&&p.length>1){let x="`forceAtomic` is not supported on fallback to `eth_sendTransaction`.";throw new Oo(new w(x,{details:x}))}let h=[];for(let x of p){let b=Zo(e,{account:u,chain:n,data:x.data,to:x.to,value:x.value?ue(x.value):void 0});h.push(b),i>0&&await new Promise(v=>setTimeout(v,i))}let g=await Promise.allSettled(h);if(g.every(x=>x.status==="rejected"))throw g[0].reason;let y=g.map(x=>x.status==="fulfilled"?x.value:Vf);return{id:Fe([...y,S(n.id,{size:32}),Gf])}}throw xi(l,{...t,account:u,chain:t.chain})}}async function Ou(e,t){async function r(u){if(u.endsWith(Gf.slice(2))){let l=Ve(am(u,-64,-32)),d=am(u,0,-64).slice(2).match(/.{1,64}/g),h=await Promise.all(d.map(y=>Vf.slice(2)!==y?e.request({method:"eth_getTransactionReceipt",params:[`0x${y}`]},{dedupe:!0}):void 0)),g=h.some(y=>y===null)?100:h.every(y=>y?.status==="0x1")?200:h.every(y=>y?.status==="0x0")?500:600;return{atomic:!1,chainId:Ce(l),receipts:h.filter(Boolean),status:g,version:"2.0.0"}}return e.request({method:"wallet_getCallsStatus",params:[u]})}let{atomic:o=!1,chainId:n,receipts:s,version:i="2.0.0",...a}=await r(t.id),[c,m]=(()=>{let u=a.status;return u>=100&&u<200?["pending",u]:u>=200&&u<300?["success",u]:u>=300&&u<700?["failure",u]:u==="CONFIRMED"?["success",200]:u==="PENDING"?["pending",100]:[void 0,u]})();return{...a,atomic:o,chainId:n?Ce(n):void 0,receipts:s?.map(u=>({...u,blockNumber:ue(u.blockNumber),gasUsed:ue(u.gasUsed),status:Vl[u.status]}))??[],statusCode:m,status:c,version:i}}async function Uu(e,t){let{id:r,pollingInterval:o=e.pollingInterval,status:n=({statusCode:g})=>g===200||g>=300,retryCount:s=4,retryDelay:i=({count:g})=>~~(1<<g)*200,timeout:a=6e4,throwOnFailure:c=!1}=t,m=Z(["waitForCallsStatus",e.uid,r]),{promise:u,resolve:p,reject:l}=yi(),d,h=it(m,{resolve:p,reject:l},g=>{let y=er(async()=>{let x=b=>{clearTimeout(d),y(),b(),h()};try{let b=await Tn(async()=>{let v=await T(e,Ou,"getCallsStatus")({id:r});if(c&&v.status==="failure")throw new Nu(v);return v},{retryCount:s,delay:i});if(!n(b))return;x(()=>g.resolve(b))}catch(b){x(()=>g.reject(b))}},{interval:o,emitOnBegin:!0});return y});return d=a?setTimeout(()=>{h(),clearTimeout(d),l(new qf({id:r}))},a):void 0,await u}var qf=class extends w{constructor({id:t}){super(`Timed out while waiting for call bundle with id "${t}" to be confirmed.`,{name:"WaitForCallsStatusTimeoutError"})}};ke();var zu=256,Hu;function ju(e=11){if(!Hu||zu+e>256*2){Hu="",zu=0;for(let t=0;t<256;t++)Hu+=(256+Math.random()*256|0).toString(16).substring(1)}return Hu.substring(zu,zu+++e)}function Gu(e){let{batch:t,chain:r,ccipRead:o,key:n="base",name:s="Base Client",type:i="base"}=e,a=e.experimental_blockTag??(typeof r?.experimental_preconfirmationTime=="number"?"pending":void 0),c=r?.blockTime??12e3,m=Math.min(Math.max(Math.floor(c/2),500),4e3),u=e.pollingInterval??m,p=e.cacheTime??u,l=e.account?V(e.account):void 0,{config:d,request:h,value:g}=e.transport({chain:r,pollingInterval:u}),y={...d,...g},x={account:l,batch:t,cacheTime:p,ccipRead:o,chain:r,key:n,name:s,pollingInterval:u,request:h,transport:y,type:i,uid:ju(),...a?{experimental_blockTag:a}:{}};function b(v){return E=>{let A=E(v);for(let I in x)delete A[I];let k={...v,...A};return Object.assign(k,{extend:b(k)})}}return Object.assign(x,{extend:b(x)})}Ko();Go();Mt();bn();ln();D();G();Fo();function wi(e){if(!(e instanceof w))return!1;let t=e.walk(r=>r instanceof wn);return t instanceof wn?t.data?.errorName==="HttpError"||t.data?.errorName==="ResolverError"||t.data?.errorName==="ResolverNotContract"||t.data?.errorName==="ResolverNotFound"||t.data?.errorName==="ReverseAddressMismatch"||t.data?.errorName==="UnsupportedResolverProfile":!1}$a();ut();qe();D();qt();Pt();function Vu(e){if(e.length!==66||e.indexOf("[")!==0||e.indexOf("]")!==65)return null;let t=`0x${e.slice(1,65)}`;return pe(t)?t:null}function Ma(e){let t=new Uint8Array(32).fill(0);if(!e)return ee(t);let r=e.split(".");for(let o=r.length-1;o>=0;o-=1){let n=Vu(r[o]),s=n?Ht(n):ce(ir(r[o]),"bytes");t=ce(Fe([t,s]),"bytes")}return ee(t)}qe();function sb(e){return`[${e.slice(2)}]`}qe();D();qt();function ib(e){let t=new Uint8Array(32).fill(0);return e?Vu(e)||ce(ir(e)):ee(t)}function Ci(e){let t=e.replace(/^\.|\.$/gm,"");if(t.length===0)return new Uint8Array(1);let r=new Uint8Array(ir(t).byteLength+2),o=0,n=t.split(".");for(let s=0;s<n.length;s++){let i=ir(n[s]);i.byteLength>255&&(i=ir(sb(ib(n[s])))),r[o]=i.length,r.set(i,o+1),o+=i.length+1}return r.byteLength!==o+1?r.slice(0,o+1):r}async function ab(e,t){let{blockNumber:r,blockTag:o,coinType:n,name:s,gatewayUrls:i,strict:a}=t,{chain:c}=e,m=(()=>{if(t.universalResolverAddress)return t.universalResolverAddress;if(!c)throw new Error("client chain not configured. universalResolverAddress is required.");return Wt({blockNumber:r,chain:c,contract:"ensUniversalResolver"})})(),u=c?.ensTlds;if(u&&!u.some(l=>s.endsWith(l)))return null;let p=n!=null?[Ma(s),BigInt(n)]:[Ma(s)];try{let l=de({abi:Rf,functionName:"addr",args:p}),d={address:m,abi:Pu,functionName:"resolveWithGateways",args:[me(Ci(s)),l,i??[io]],blockNumber:r,blockTag:o},g=await T(e,De,"readContract")(d);if(g[0]==="0x")return null;let y=Et({abi:Rf,args:p,functionName:"addr",data:g[0]});return y==="0x"||Ve(y)==="0x00"?null:y}catch(l){if(a)throw l;if(wi(l))return null;throw l}}G();var qu=class extends w{constructor({data:t}){super("Unable to extract image from metadata. The metadata may be malformed or invalid.",{metaMessages:["- Metadata must be a JSON object with at least an `image`, `image_url` or `image_data` property.","",`Provided data: ${JSON.stringify(t)}`],name:"EnsAvatarInvalidMetadataError"})}},Yo=class extends w{constructor({reason:t}){super(`ENS NFT avatar URI is invalid. ${t}`,{name:"EnsAvatarInvalidNftUriError"})}},Ei=class extends w{constructor({uri:t}){super(`Unable to resolve ENS avatar URI "${t}". The URI may be malformed, invalid, or does not respond with a valid image.`,{name:"EnsAvatarUriResolutionError"})}},Ku=class extends w{constructor({namespace:t}){super(`ENS NFT avatar namespace "${t}" is not supported. Must be "erc721" or "erc1155".`,{name:"EnsAvatarUnsupportedNamespaceError"})}};var PE=/(?<protocol>https?:\/\/[^/]*|ipfs:\/|ipns:\/|ar:\/)?(?<root>\/)?(?<subpath>ipfs\/|ipns\/)?(?<target>[\w\-.]+)(?<subtarget>\/.*)?/,TE=/^(Qm[1-9A-HJ-NP-Za-km-z]{44,}|b[A-Za-z2-7]{58,}|B[A-Z2-7]{58,}|z[1-9A-HJ-NP-Za-km-z]{48,}|F[0-9A-F]{50,})(\/(?<target>[\w\-.]+))?(?<subtarget>\/.*)?$/,$E=/^data:([a-zA-Z\-/+]*);base64,([^"].*)/,RE=/^data:([a-zA-Z\-/+]*)?(;[a-zA-Z0-9].*?)?(,)/;async function ME(e){try{let t=await fetch(e,{method:"HEAD"});return t.status===200?t.headers.get("content-type")?.startsWith("image/"):!1}catch(t){return typeof t=="object"&&typeof t.response<"u"||!Object.hasOwn(globalThis,"Image")?!1:new Promise(r=>{let o=new Image;o.onload=()=>{r(!0)},o.onerror=()=>{r(!1)},o.src=e})}}function cb(e,t){return e?e.endsWith("/")?e.slice(0,-1):e:t}function Kf({uri:e,gatewayUrls:t}){let r=$E.test(e);if(r)return{uri:e,isOnChain:!0,isEncoded:r};let o=cb(t?.ipfs,"https://ipfs.io"),n=cb(t?.arweave,"https://arweave.net"),s=e.match(PE),{protocol:i,subpath:a,target:c,subtarget:m=""}=s?.groups||{},u=i==="ipns:/"||a==="ipns/",p=i==="ipfs:/"||a==="ipfs/"||TE.test(e);if(e.startsWith("http")&&!u&&!p){let d=e;return t?.arweave&&(d=e.replace(/https:\/\/arweave.net/g,t?.arweave)),{uri:d,isOnChain:!1,isEncoded:!1}}if((u||p)&&c)return{uri:`${o}/${u?"ipns":"ipfs"}/${c}${m}`,isOnChain:!1,isEncoded:!1};if(i==="ar:/"&&c)return{uri:`${n}/${c}${m||""}`,isOnChain:!1,isEncoded:!1};let l=e.replace(RE,"");if(l.startsWith("<svg")&&(l=`data:image/svg+xml;base64,${btoa(l)}`),l.startsWith("data:")||l.startsWith("{"))return{uri:l,isOnChain:!0,isEncoded:!1};throw new Ei({uri:e})}function Wf(e){if(typeof e!="object"||!("image"in e)&&!("image_url"in e)&&!("image_data"in e))throw new qu({data:e});return e.image||e.image_url||e.image_data}async function mb({gatewayUrls:e,uri:t}){try{let r=await fetch(t).then(n=>n.json());return await Wu({gatewayUrls:e,uri:Wf(r)})}catch{throw new Ei({uri:t})}}async function Wu({gatewayUrls:e,uri:t}){let{uri:r,isOnChain:o}=Kf({uri:t,gatewayUrls:e});if(o||await ME(r))return r;throw new Ei({uri:t})}function ub(e){let t=e;t.startsWith("did:nft:")&&(t=t.replace("did:nft:","").replace(/_/g,"/"));let[r,o,n]=t.split("/"),[s,i]=r.split(":"),[a,c]=o.split(":");if(!s||s.toLowerCase()!=="eip155")throw new Yo({reason:"Only EIP-155 supported"});if(!i)throw new Yo({reason:"Chain ID not found"});if(!c)throw new Yo({reason:"Contract address not found"});if(!n)throw new Yo({reason:"Token ID not found"});if(!a)throw new Yo({reason:"ERC namespace not found"});return{chainID:Number.parseInt(i,10),namespace:a.toLowerCase(),contractAddress:c,tokenID:n}}async function pb(e,{nft:t}){if(t.namespace==="erc721")return De(e,{address:t.contractAddress,abi:[{name:"tokenURI",type:"function",stateMutability:"view",inputs:[{name:"tokenId",type:"uint256"}],outputs:[{name:"",type:"string"}]}],functionName:"tokenURI",args:[BigInt(t.tokenID)]});if(t.namespace==="erc1155")return De(e,{address:t.contractAddress,abi:[{name:"uri",type:"function",stateMutability:"view",inputs:[{name:"_id",type:"uint256"}],outputs:[{name:"",type:"string"}]}],functionName:"uri",args:[BigInt(t.tokenID)]});throw new Ku({namespace:t.namespace})}async function lb(e,{gatewayUrls:t,record:r}){return/eip155:/i.test(r)?BE(e,{gatewayUrls:t,record:r}):Wu({uri:r,gatewayUrls:t})}async function BE(e,{gatewayUrls:t,record:r}){let o=ub(r),n=await pb(e,{nft:o}),{uri:s,isOnChain:i,isEncoded:a}=Kf({uri:n,gatewayUrls:t});if(i&&(s.includes("data:application/json;base64,")||s.startsWith("{"))){let m=a?atob(s.replace("data:application/json;base64,","")):s,u=JSON.parse(m);return Wu({uri:Wf(u),gatewayUrls:t})}let c=o.tokenID;return o.namespace==="erc1155"&&(c=c.replace("0x","").padStart(64,"0")),mb({gatewayUrls:t,uri:s.replace(/(?:0x)?{id}/,c)})}Ko();Go();Mt();bn();D();$a();async function Ju(e,t){let{blockNumber:r,blockTag:o,key:n,name:s,gatewayUrls:i,strict:a}=t,{chain:c}=e,m=(()=>{if(t.universalResolverAddress)return t.universalResolverAddress;if(!c)throw new Error("client chain not configured. universalResolverAddress is required.");return Wt({blockNumber:r,chain:c,contract:"ensUniversalResolver"})})(),u=c?.ensTlds;if(u&&!u.some(p=>s.endsWith(p)))return null;try{let p={address:m,abi:Pu,args:[me(Ci(s)),de({abi:$f,functionName:"text",args:[Ma(s),n]}),i??[io]],functionName:"resolveWithGateways",blockNumber:r,blockTag:o},d=await T(e,De,"readContract")(p);if(d[0]==="0x")return null;let h=Et({abi:$f,functionName:"text",data:d[0]});return h===""?null:h}catch(p){if(a)throw p;if(wi(p))return null;throw p}}async function fb(e,{blockNumber:t,blockTag:r,assetGatewayUrls:o,name:n,gatewayUrls:s,strict:i,universalResolverAddress:a}){let c=await T(e,Ju,"getEnsText")({blockNumber:t,blockTag:r,key:"avatar",name:n,universalResolverAddress:a,gatewayUrls:s,strict:i});if(!c)return null;try{return await lb(e,{record:c,gatewayUrls:o})}catch{return null}}Ko();bn();$a();async function db(e,t){let{address:r,blockNumber:o,blockTag:n,coinType:s=60n,gatewayUrls:i,strict:a}=t,{chain:c}=e,m=(()=>{if(t.universalResolverAddress)return t.universalResolverAddress;if(!c)throw new Error("client chain not configured. universalResolverAddress is required.");return Wt({blockNumber:o,chain:c,contract:"ensUniversalResolver"})})();try{let u={address:m,abi:Ly,args:[r,s,i??[io]],functionName:"reverseWithGateways",blockNumber:o,blockTag:n},p=T(e,De,"readContract"),[l]=await p(u);return l||null}catch(u){if(a)throw u;if(wi(u))return null;throw u}}bn();D();async function hb(e,t){let{blockNumber:r,blockTag:o,name:n}=t,{chain:s}=e,i=(()=>{if(t.universalResolverAddress)return t.universalResolverAddress;if(!s)throw new Error("client chain not configured. universalResolverAddress is required.");return Wt({blockNumber:r,chain:s,contract:"ensUniversalResolver"})})(),a=s?.ensTlds;if(a&&!a.some(m=>n.endsWith(m)))throw new Error(`${n} is not a valid ENS TLD (${a?.join(", ")}) for chain "${s.name}" (id: ${s.id}).`);let[c]=await T(e,De,"readContract")({address:i,abi:[{inputs:[{type:"bytes"}],name:"findResolver",outputs:[{type:"address"},{type:"bytes32"},{type:"uint256"}],stateMutability:"view",type:"function"}],functionName:"findResolver",args:[me(Ci(n))],blockNumber:r,blockTag:o});return c}bi();ke();D();xf();ri();Io();oo();async function Zu(e,t){let{account:r=e.account,blockNumber:o,blockTag:n="latest",blobs:s,data:i,gas:a,gasPrice:c,maxFeePerBlobGas:m,maxFeePerGas:u,maxPriorityFeePerGas:p,to:l,value:d,...h}=t,g=r?V(r):void 0;try{nt(t);let x=(typeof o=="bigint"?S(o):void 0)||n,b=e.chain?.formatters?.transactionRequest?.format,E=(b||xt)({...kr(h,{format:b}),account:g,blobs:s,data:i,gas:a,gasPrice:c,maxFeePerBlobGas:m,maxFeePerGas:u,maxPriorityFeePerGas:p,to:l,value:d},"createAccessList"),A=await e.request({method:"eth_createAccessList",params:[E,x]});return{accessList:A.accessList,gasUsed:BigInt(A.gasUsed)}}catch(y){throw su(y,{...t,account:g,chain:e.chain})}}async function gb(e){let t=zo(e,{method:"eth_newBlockFilter"}),r=await e.request({method:"eth_newBlockFilter"});return{id:r,request:t(r),type:"block"}}D();async function Yu(e,{address:t,args:r,event:o,events:n,fromBlock:s,strict:i,toBlock:a}={}){let c=n??(o?[o]:void 0),m=zo(e,{method:"eth_newFilter"}),u=[];c&&(u=[c.flatMap(d=>Ir({abi:[d],eventName:d.name,args:r}))],o&&(u=u[0]));let p=await e.request({method:"eth_newFilter",params:[{address:t,fromBlock:typeof s=="bigint"?S(s):s,toBlock:typeof a=="bigint"?S(a):a,...u.length?{topics:u}:{}}]});return{abi:c,args:r,eventName:o?o.name:void 0,fromBlock:s,id:p,request:m(p),strict:!!i,toBlock:a,type:"event"}}async function Xu(e){let t=zo(e,{method:"eth_newPendingTransactionFilter"}),r=await e.request({method:"eth_newPendingTransactionFilter"});return{id:r,request:t(r),type:"transaction"}}D();async function yb(e,{address:t,blockNumber:r,blockTag:o=e.experimental_blockTag??"latest"}){let n=typeof r=="bigint"?S(r):void 0,s=await e.request({method:"eth_getBalance",params:[t,n||o]});return BigInt(s)}async function bb(e){let t=await e.request({method:"eth_blobBaseFee"});return BigInt(t)}Oe();D();async function xb(e,{blockHash:t,blockNumber:r,blockTag:o="latest"}={}){let n=r!==void 0?S(r):void 0,s;return t?s=await e.request({method:"eth_getBlockTransactionCountByHash",params:[t]},{dedupe:!0}):s=await e.request({method:"eth_getBlockTransactionCountByNumber",params:[n||o]},{dedupe:!!n}),Ce(s)}D();async function Ba(e,{address:t,blockNumber:r,blockTag:o="latest"}){let n=r!==void 0?S(r):void 0,s=await e.request({method:"eth_getCode",params:[t,n||o]},{dedupe:!!n});if(s!=="0x")return s}G();var Qu=class extends w{constructor({address:t}){super(`No EIP-712 domain found on contract "${t}".`,{metaMessages:["Ensure that:",`- The contract is deployed at the address "${t}".`,"- `eip712Domain()` function exists on the contract.","- `eip712Domain()` function matches signature to ERC-5267 specification."],name:"Eip712DomainNotFoundError"})}};async function vb(e,t){let{address:r,factory:o,factoryData:n}=t;try{let[s,i,a,c,m,u,p]=await T(e,De,"readContract")({abi:FE,address:r,functionName:"eip712Domain",factory:o,factoryData:n});return{domain:{name:i,version:a,chainId:Number(c),verifyingContract:m,salt:u},extensions:p,fields:s}}catch(s){let i=s;throw i.name==="ContractFunctionExecutionError"&&i.cause.name==="ContractFunctionZeroDataError"?new Qu({address:r}):i}}var FE=[{inputs:[],name:"eip712Domain",outputs:[{name:"fields",type:"bytes1"},{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"},{name:"salt",type:"bytes32"},{name:"extensions",type:"uint256[]"}],stateMutability:"view",type:"function"}];D();function wb(e){return{baseFeePerGas:e.baseFeePerGas.map(t=>BigInt(t)),gasUsedRatio:e.gasUsedRatio,oldestBlock:BigInt(e.oldestBlock),reward:e.reward?.map(t=>t.map(r=>BigInt(r)))}}async function Cb(e,{blockCount:t,blockNumber:r,blockTag:o="latest",rewardPercentiles:n}){let s=typeof r=="bigint"?S(r):void 0,i=await e.request({method:"eth_feeHistory",params:[S(t),s||o,n]},{dedupe:!!s});return wb(i)}async function Eb(e,{filter:t}){let r=t.strict??!1,n=(await t.request({method:"eth_getFilterLogs",params:[t.id]})).map(s=>tt(s));return t.abi?fr({abi:t.abi,logs:n,strict:r}):n}D();To();kn();async function Sb({address:e,authorization:t,signature:r}){return Xt(Cs(e),await Ho({authorization:t,signature:r}))}G();Cn();ti();D();ws();var ep=new Vt(8192);function kb(e,{enabled:t=!0,id:r}){if(!t||!r)return e();if(ep.get(r))return ep.get(r);let o=e().finally(()=>ep.delete(r));return ep.set(r,o),o}rt();function Ib(e,t={}){return async(r,o={})=>{let{dedupe:n=!1,methods:s,retryDelay:i=150,retryCount:a=3,uid:c}={...t,...o},{method:m}=r;if(s?.exclude?.includes(m))throw new No(new Error("method not supported"),{method:m});if(s?.include&&!s.include.includes(m))throw new No(new Error("method not supported"),{method:m});let u=n?sr(`${c}.${Z(r)}`):void 0;return kb(()=>Tn(async()=>{try{return await e(r)}catch(p){let l=p;switch(l.code){case Ns.code:throw new Ns(l);case Ls.code:throw new Ls(l);case Os.code:throw new Os(l,{method:r.method});case Us.code:throw new Us(l);case ro.code:throw new ro(l);case Sr.code:throw new Sr(l);case zs.code:throw new zs(l);case Hs.code:throw new Hs(l);case js.code:throw new js(l);case No.code:throw new No(l,{method:r.method});case En.code:throw new En(l);case Gs.code:throw new Gs(l);case Sn.code:throw new Sn(l);case Vs.code:throw new Vs(l);case qs.code:throw new qs(l);case Ks.code:throw new Ks(l);case Ws.code:throw new Ws(l);case Js.code:throw new Js(l);case Lo.code:throw new Lo(l);case Zs.code:throw new Zs(l);case Ys.code:throw new Ys(l);case Xs.code:throw new Xs(l);case Qs.code:throw new Qs(l);case ei.code:throw new ei(l);case Oo.code:throw new Oo(l);case 5e3:throw new Sn(l);default:throw p instanceof w?p:new nu(l)}}},{delay:({count:p,error:l})=>{if(l&&l instanceof Yt){let d=l?.headers?.get("Retry-After");if(d?.match(/\d/))return Number.parseInt(d,10)*1e3}return~~(1<<p)*i},retryCount:a,shouldRetry:({error:p})=>DE(p)}),{enabled:n,id:u})}}function DE(e){return"code"in e&&typeof e.code=="number"?e.code===-1||e.code===En.code||e.code===ro.code:e instanceof Yt&&e.status?e.status===403||e.status===408||e.status===413||e.status===429||e.status===500||e.status===502||e.status===503||e.status===504:!0}Oe();D();Cn();function _b(e,{errorInstance:t=new Error("timed out"),timeout:r,signal:o}){return new Promise((n,s)=>{(async()=>{let i;try{let a=new AbortController;r>0&&(i=setTimeout(()=>{o?a.abort():s(t)},r)),n(await e({signal:a?.signal||null}))}catch(a){a?.name==="AbortError"&&s(t),s(a)}finally{clearTimeout(i)}})()})}rt();function NE(){return{current:0,take(){return this.current++},reset(){this.current=0}}}var Jf=NE();function Ab(e,t={}){return{async request(r){let{body:o,fetchFn:n=t.fetchFn??fetch,onRequest:s=t.onRequest,onResponse:i=t.onResponse,timeout:a=t.timeout??1e4}=r,c={...t.fetchOptions??{},...r.fetchOptions??{}},{headers:m,method:u,signal:p}=c;try{let l=await _b(async({signal:h})=>{let g={...c,body:Array.isArray(o)?Z(o.map(v=>({jsonrpc:"2.0",id:v.id??Jf.take(),...v}))):Z({jsonrpc:"2.0",id:o.id??Jf.take(),...o}),headers:{"Content-Type":"application/json",...m},method:u||"POST",signal:p||(a>0?h:null)},y=new Request(e,g),x=await s?.(y,g)??{...g,url:e};return await n(x.url??e,x)},{errorInstance:new Ca({body:o,url:e}),timeout:a,signal:!0});i&&await i(l);let d;if(l.headers.get("Content-Type")?.startsWith("application/json"))d=await l.json();else{d=await l.text();try{d=JSON.parse(d||"{}")}catch(h){if(l.ok)throw h;d={error:d}}}if(!l.ok)throw new Yt({body:o,details:Z(d.error)||l.statusText,headers:l.headers,status:l.status,url:e});return d}catch(l){throw l instanceof Yt||l instanceof Ca?l:new Yt({body:o,cause:l,url:e})}}}}qt();var Pb=`Ethereum Signed Message:
`;ut();zt();D();function Tb(e){let t=typeof e=="string"?sr(e):typeof e.raw=="string"?e.raw:ee(e.raw),r=sr(`${Pb}${Q(t)}`);return Fe([r,t])}function Si(e,t){return ce(Tb(e),t)}eo();ut();D();qt();Ie();mr();rt();G();var tp=class extends w{constructor({domain:t}){super(`Invalid domain "${Z(t)}".`,{metaMessages:["Must be a valid EIP-712 domain."]})}},rp=class extends w{constructor({primaryType:t,types:r}){super(`Invalid primary type \`${t}\` must be one of \`${JSON.stringify(Object.keys(r))}\`.`,{docsPath:"/api/glossary/Errors#typeddatainvalidprimarytypeerror",metaMessages:["Check that the primary type is a key in `types`."]})}},op=class extends w{constructor({type:t}){super(`Struct type "${t}" is invalid.`,{metaMessages:["Struct type must not be a Solidity type."],name:"InvalidStructTypeError"})}};$t();zt();D();pf();rt();function $b(e){let{domain:t,message:r,primaryType:o,types:n}=e,s=(c,m)=>{let u={...m};for(let p of c){let{name:l,type:d}=p;d==="address"&&(u[l]=u[l].toLowerCase())}return u},i=n.EIP712Domain?t?s(n.EIP712Domain,t):{}:{},a=(()=>{if(o!=="EIP712Domain")return s(n[o],r)})();return Z({domain:i,message:a,primaryType:o,types:n})}function np(e){let{domain:t,message:r,primaryType:o,types:n}=e,s=(i,a)=>{for(let c of i){let{name:m,type:u}=c,p=a[m],l=u.match(Zm);if(l&&(typeof p=="number"||typeof p=="bigint")){let[g,y,x]=l;S(p,{signed:y==="int",size:Number.parseInt(x,10)/8})}if(u==="address"&&typeof p=="string"&&!te(p))throw new ae({address:p});let d=u.match(Kg);if(d){let[g,y]=d;if(y&&Q(p)!==Number.parseInt(y,10))throw new Em({expectedSize:Number.parseInt(y,10),givenSize:Q(p)})}let h=n[u];h&&(LE(u),s(h,p))}};if(n.EIP712Domain&&t){if(typeof t!="object")throw new tp({domain:t});s(n.EIP712Domain,t)}if(o!=="EIP712Domain")if(n[o])s(n[o],r);else throw new rp({primaryType:o,types:n})}function sp({domain:e}){return[typeof e?.name=="string"&&{name:"name",type:"string"},e?.version&&{name:"version",type:"string"},(typeof e?.chainId=="number"||typeof e?.chainId=="bigint")&&{name:"chainId",type:"uint256"},e?.verifyingContract&&{name:"verifyingContract",type:"address"},e?.salt&&{name:"salt",type:"bytes32"}].filter(Boolean)}function LE(e){if(e==="address"||e==="bool"||e==="string"||e.startsWith("bytes")||e.startsWith("uint")||e.startsWith("int"))throw new op({type:e})}function ip(e){let{domain:t={},message:r,primaryType:o}=e,n={EIP712Domain:sp({domain:t}),...e.types};np({domain:t,message:r,primaryType:o,types:n});let s=["0x1901"];return t&&s.push(OE({domain:t,types:n})),o!=="EIP712Domain"&&s.push(Rb({data:r,primaryType:o,types:n})),ce(Fe(s))}function OE({domain:e,types:t}){return Rb({data:e,primaryType:"EIP712Domain",types:t})}function Rb({data:e,primaryType:t,types:r}){let o=Mb({data:e,primaryType:t,types:r});return ce(o)}function Mb({data:e,primaryType:t,types:r}){let o=[{type:"bytes32"}],n=[UE({primaryType:t,types:r})];for(let s of r[t]){let[i,a]=Fb({types:r,name:s.name,type:s.type,value:e[s.name]});o.push(i),n.push(a)}return pt(o,n)}function UE({primaryType:e,types:t}){let r=me(zE({primaryType:e,types:t}));return ce(r)}function zE({primaryType:e,types:t}){let r="",o=Bb({primaryType:e,types:t});o.delete(e);let n=[e,...Array.from(o).sort()];for(let s of n)r+=`${s}(${t[s].map(({name:i,type:a})=>`${a} ${i}`).join(",")})`;return r}function Bb({primaryType:e,types:t},r=new Set){let n=e.match(/^\w*/u)?.[0];if(r.has(n)||t[n]===void 0)return r;r.add(n);for(let s of t[n])Bb({primaryType:s.type,types:t},r);return r}function Fb({types:e,name:t,type:r,value:o}){if(e[r]!==void 0)return[{type:"bytes32"},ce(Mb({data:o,primaryType:r,types:e}))];if(r==="bytes")return o=`0x${(o.length%2?"0":"")+o.slice(2)}`,[{type:"bytes32"},ce(o)];if(r==="string")return[{type:"bytes32"},ce(me(o))];if(r.lastIndexOf("]")===r.length-1){let n=r.slice(0,r.lastIndexOf("[")),s=o.map(i=>Fb({name:t,type:n,types:e,value:i}));return[{type:"bytes32"},ce(pt(s.map(([i])=>i),s.map(([,i])=>i)))]}return[{type:r},o]}var za={};Ml(za,{InvalidWrappedSignatureError:()=>wp,assert:()=>Cp,from:()=>ES,magicBytes:()=>wd,suffixParameters:()=>Cd,unwrap:()=>rx,validate:()=>kS,wrap:()=>SS});ba();Vo();var ap=class extends Map{constructor(t){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=t}get(t){let r=super.get(t);return super.has(t)&&r!==void 0&&(this.delete(t),super.set(t,r)),r}set(t,r){if(super.set(t,r),this.maxSize&&this.size>this.maxSize){let o=this.keys().next().value;o&&this.delete(o)}return this}};var HE={checksum:new ap(8192)},cp=HE.checksum;St();Xl();Vo();Je();function $n(e,t={}){let{as:r=typeof e=="string"?"Hex":"Bytes"}=t,o=im(_y(e));return r==="Bytes"?o:Me(o)}Vo();St();Je();_a();function Db(e,t={}){let{compressed:r}=t,{prefix:o,x:n,y:s}=e;if(r===!1||typeof n=="bigint"&&typeof s=="bigint"){if(o!==4)throw new mp({prefix:o,cause:new Qf});return}if(r===!0||typeof n=="bigint"&&typeof s>"u"){if(o!==3&&o!==2)throw new mp({prefix:o,cause:new Xf});return}throw new Yf({publicKey:e})}function Nb(e){let t=(()=>{if(Pa(e))return Lb(e);if(My(e))return GE(e);let{prefix:r,x:o,y:n}=e;return typeof o=="bigint"&&typeof n=="bigint"?{prefix:r??4,x:o,y:n}:{prefix:r,x:o}})();return Db(t),t}function GE(e){return Lb(Me(e))}function Lb(e){if(e.length!==132&&e.length!==130&&e.length!==68)throw new ed({publicKey:e});if(e.length===130){let o=BigInt(be(e,0,32)),n=BigInt(be(e,32,64));return{prefix:4,x:o,y:n}}if(e.length===132){let o=Number(be(e,0,1)),n=BigInt(be(e,1,33)),s=BigInt(be(e,33,65));return{prefix:o,x:n,y:s}}let t=Number(be(e,0,1)),r=BigInt(be(e,1,33));return{prefix:t,x:r}}function td(e,t={}){Db(e);let{prefix:r,x:o,y:n}=e,{includePrefix:s=!0}=t;return Ee(s?oe(r,{size:1}):"0x",oe(o,{size:32}),typeof n=="bigint"?oe(n,{size:32}):"0x")}var Yf=class extends F{constructor({publicKey:t}){super(`Value \`${qo(t)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}},mp=class extends F{constructor({prefix:t,cause:r}){super(`Prefix "${t}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}},Xf=class extends F{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}},Qf=class extends F{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}},ed=class extends F{constructor({publicKey:t}){super(`Value \`${t}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${ye(di(t))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}};var VE=/^0x[a-fA-F0-9]{40}$/;function Rn(e,t={}){let{strict:r=!0}=t;if(!VE.test(e))throw new up({address:e,cause:new rd});if(r){if(e.toLowerCase()===e)return;if(pp(e)!==e)throw new up({address:e,cause:new od})}}function pp(e){if(cp.has(e))return cp.get(e);Rn(e,{strict:!1});let t=e.substring(2).toLowerCase(),r=$n(Ay(t),{as:"Bytes"}),o=t.split("");for(let s=0;s<40;s+=2)r[s>>1]>>4>=8&&o[s]&&(o[s]=o[s].toUpperCase()),(r[s>>1]&15)>=8&&o[s+1]&&(o[s+1]=o[s+1].toUpperCase());let n=`0x${o.join("")}`;return cp.set(e,n),n}function qE(e,t={}){let{checksum:r=!1}=t;return Rn(e),r?pp(e):e}function Ub(e,t={}){let r=$n(`0x${td(e).slice(4)}`).substring(26);return qE(`0x${r}`,t)}function lp(e,t={}){let{strict:r=!0}=t??{};try{return Rn(e,{strict:r}),!0}catch{return!1}}var up=class extends F{constructor({address:t,cause:r}){super(`Address "${t}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}},rd=class extends F{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}},od=class extends F{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}};Vo();St();Je();Vo();St();Je();var zb=/^(.*)\[([0-9]*)\]$/,Hb=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,dp=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/,LV=2n**(8n-1n)-1n,OV=2n**(16n-1n)-1n,UV=2n**(24n-1n)-1n,zV=2n**(32n-1n)-1n,HV=2n**(40n-1n)-1n,jV=2n**(48n-1n)-1n,GV=2n**(56n-1n)-1n,VV=2n**(64n-1n)-1n,qV=2n**(72n-1n)-1n,KV=2n**(80n-1n)-1n,WV=2n**(88n-1n)-1n,JV=2n**(96n-1n)-1n,ZV=2n**(104n-1n)-1n,YV=2n**(112n-1n)-1n,XV=2n**(120n-1n)-1n,QV=2n**(128n-1n)-1n,eq=2n**(136n-1n)-1n,tq=2n**(144n-1n)-1n,rq=2n**(152n-1n)-1n,oq=2n**(160n-1n)-1n,nq=2n**(168n-1n)-1n,sq=2n**(176n-1n)-1n,iq=2n**(184n-1n)-1n,aq=2n**(192n-1n)-1n,cq=2n**(200n-1n)-1n,mq=2n**(208n-1n)-1n,uq=2n**(216n-1n)-1n,pq=2n**(224n-1n)-1n,lq=2n**(232n-1n)-1n,fq=2n**(240n-1n)-1n,dq=2n**(248n-1n)-1n,hq=2n**(256n-1n)-1n,gq=-(2n**(8n-1n)),yq=-(2n**(16n-1n)),bq=-(2n**(24n-1n)),xq=-(2n**(32n-1n)),vq=-(2n**(40n-1n)),wq=-(2n**(48n-1n)),Cq=-(2n**(56n-1n)),Eq=-(2n**(64n-1n)),Sq=-(2n**(72n-1n)),kq=-(2n**(80n-1n)),Iq=-(2n**(88n-1n)),_q=-(2n**(96n-1n)),Aq=-(2n**(104n-1n)),Pq=-(2n**(112n-1n)),Tq=-(2n**(120n-1n)),$q=-(2n**(128n-1n)),Rq=-(2n**(136n-1n)),Mq=-(2n**(144n-1n)),Bq=-(2n**(152n-1n)),Fq=-(2n**(160n-1n)),Dq=-(2n**(168n-1n)),Nq=-(2n**(176n-1n)),Lq=-(2n**(184n-1n)),Oq=-(2n**(192n-1n)),Uq=-(2n**(200n-1n)),zq=-(2n**(208n-1n)),Hq=-(2n**(216n-1n)),jq=-(2n**(224n-1n)),Gq=-(2n**(232n-1n)),Vq=-(2n**(240n-1n)),qq=-(2n**(248n-1n)),Kq=-(2n**(256n-1n)),Wq=2n**8n-1n,Jq=2n**16n-1n,Zq=2n**24n-1n,Yq=2n**32n-1n,Xq=2n**40n-1n,Qq=2n**48n-1n,eK=2n**56n-1n,tK=2n**64n-1n,rK=2n**72n-1n,oK=2n**80n-1n,nK=2n**88n-1n,sK=2n**96n-1n,iK=2n**104n-1n,aK=2n**112n-1n,cK=2n**120n-1n,mK=2n**128n-1n,uK=2n**136n-1n,pK=2n**144n-1n,lK=2n**152n-1n,fK=2n**160n-1n,dK=2n**168n-1n,hK=2n**176n-1n,gK=2n**184n-1n,yK=2n**192n-1n,bK=2n**200n-1n,xK=2n**208n-1n,vK=2n**216n-1n,wK=2n**224n-1n,CK=2n**232n-1n,EK=2n**240n-1n,SK=2n**248n-1n,nd=2n**256n-1n;function Mn(e,t,r){let{checksumAddress:o,staticPosition:n}=r,s=ad(t.type);if(s){let[i,a]=s;return WE(e,{...t,type:a},{checksumAddress:o,length:i,staticPosition:n})}if(t.type==="tuple")return XE(e,t,{checksumAddress:o,staticPosition:n});if(t.type==="address")return KE(e,{checksum:o});if(t.type==="bool")return JE(e);if(t.type.startsWith("bytes"))return ZE(e,t,{staticPosition:n});if(t.type.startsWith("uint")||t.type.startsWith("int"))return YE(e,t);if(t.type==="string")return QE(e,{staticPosition:n});throw new ki(t.type)}var Gb=32,sd=32;function KE(e,t={}){let{checksum:r=!1}=t,o=e.readBytes(32);return[(s=>r?pp(s):s)(Me(Py(o,-20))),32]}function WE(e,t,r){let{checksumAddress:o,length:n,staticPosition:s}=r;if(!n){let c=Ar(e.readBytes(sd)),m=s+c,u=m+Gb;e.setPosition(m);let p=Ar(e.readBytes(Gb)),l=Fa(t),d=0,h=[];for(let g=0;g<p;++g){e.setPosition(u+(l?g*32:d));let[y,x]=Mn(e,t,{checksumAddress:o,staticPosition:u});d+=x,h.push(y)}return e.setPosition(s+32),[h,32]}if(Fa(t)){let c=Ar(e.readBytes(sd)),m=s+c,u=[];for(let p=0;p<n;++p){e.setPosition(m+p*32);let[l]=Mn(e,t,{checksumAddress:o,staticPosition:m});u.push(l)}return e.setPosition(s+32),[u,32]}let i=0,a=[];for(let c=0;c<n;++c){let[m,u]=Mn(e,t,{checksumAddress:o,staticPosition:s+i});i+=u,a.push(m)}return[a,i]}function JE(e){return[$y(e.readBytes(32),{size:32}),32]}function ZE(e,t,{staticPosition:r}){let[o,n]=t.type.split("bytes");if(!n){let i=Ar(e.readBytes(32));e.setPosition(r+i);let a=Ar(e.readBytes(32));if(a===0)return e.setPosition(r+32),["0x",32];let c=e.readBytes(a);return e.setPosition(r+32),[Me(c),32]}return[Me(e.readBytes(Number.parseInt(n,10),32)),32]}function YE(e,t){let r=t.type.startsWith("int"),o=Number.parseInt(t.type.split("int")[1]||"256",10),n=e.readBytes(32);return[o>48?Ty(n,{signed:r}):Ar(n,{signed:r}),32]}function XE(e,t,r){let{checksumAddress:o,staticPosition:n}=r,s=t.components.length===0||t.components.some(({name:c})=>!c),i=s?[]:{},a=0;if(Fa(t)){let c=Ar(e.readBytes(sd)),m=n+c;for(let u=0;u<t.components.length;++u){let p=t.components[u];e.setPosition(m+a);let[l,d]=Mn(e,p,{checksumAddress:o,staticPosition:m});a+=d,i[s?u:p?.name]=l}return e.setPosition(n+32),[i,32]}for(let c=0;c<t.components.length;++c){let m=t.components[c],[u,p]=Mn(e,m,{checksumAddress:o,staticPosition:n});i[s?c:m?.name]=u,a+=p}return[i,a]}function QE(e,{staticPosition:t}){let r=Ar(e.readBytes(32)),o=t+r;e.setPosition(o);let n=Ar(e.readBytes(32));if(n===0)return e.setPosition(t+32),["",32];let s=e.readBytes(n,32),i=Ry(_f(s));return e.setPosition(t+32),[i,32]}function Vb({checksumAddress:e,parameters:t,values:r}){let o=[];for(let n=0;n<t.length;n++)o.push(id({checksumAddress:e,parameter:t[n],value:r[n]}));return o}function id({checksumAddress:e=!1,parameter:t,value:r}){let o=t,n=ad(o.type);if(n){let[s,i]=n;return tS(r,{checksumAddress:e,length:s,parameter:{...o,type:i}})}if(o.type==="tuple")return iS(r,{checksumAddress:e,parameter:o});if(o.type==="address")return eS(r,{checksum:e});if(o.type==="bool")return oS(r);if(o.type.startsWith("uint")||o.type.startsWith("int")){let s=o.type.startsWith("int"),[,,i="256"]=dp.exec(o.type)??[];return nS(r,{signed:s,size:Number(i)})}if(o.type.startsWith("bytes"))return rS(r,{type:o.type});if(o.type==="string")return sS(r);throw new ki(o.type)}function hp(e){let t=0;for(let s=0;s<e.length;s++){let{dynamic:i,encoded:a}=e[s];i?t+=32:t+=ye(a)}let r=[],o=[],n=0;for(let s=0;s<e.length;s++){let{dynamic:i,encoded:a}=e[s];i?(r.push(oe(t+n,{size:32})),o.push(a),n+=ye(a)):r.push(a)}return Ee(...r,...o)}function eS(e,t){let{checksum:r=!1}=t;return Rn(e,{strict:r}),{dynamic:!1,encoded:so(e.toLowerCase())}}function tS(e,t){let{checksumAddress:r,length:o,parameter:n}=t,s=o===null;if(!Array.isArray(e))throw new yp(e);if(!s&&e.length!==o)throw new gp({expectedLength:o,givenLength:e.length,type:`${n.type}[${o}]`});let i=!1,a=[];for(let c=0;c<e.length;c++){let m=id({checksumAddress:r,parameter:n,value:e[c]});m.dynamic&&(i=!0),a.push(m)}if(s||i){let c=hp(a);if(s){let m=oe(a.length,{size:32});return{dynamic:!0,encoded:a.length>0?Ee(m,c):m}}if(i)return{dynamic:!0,encoded:c}}return{dynamic:!1,encoded:Ee(...a.map(({encoded:c})=>c))}}function rS(e,{type:t}){let[,r]=t.split("bytes"),o=ye(e);if(!r){let n=e;return o%32!==0&&(n=Pr(n,Math.ceil((e.length-2)/2/32)*32)),{dynamic:!0,encoded:Ee(so(oe(o,{size:32})),n)}}if(o!==Number.parseInt(r,10))throw new Da({expectedSize:Number.parseInt(r,10),value:e});return{dynamic:!1,encoded:Pr(e)}}function oS(e){if(typeof e!="boolean")throw new F(`Invalid boolean value: "${e}" (type: ${typeof e}). Expected: \`true\` or \`false\`.`);return{dynamic:!1,encoded:so(Iu(e))}}function nS(e,{signed:t,size:r}){if(typeof r=="number"){let o=2n**(BigInt(r)-(t?1n:0n))-1n,n=t?-o-1n:0n;if(e>o||e<n)throw new Aa({max:o.toString(),min:n.toString(),signed:t,size:r/8,value:e.toString()})}return{dynamic:!1,encoded:oe(e,{size:32,signed:t})}}function sS(e){let t=hi(e),r=Math.ceil(ye(t)/32),o=[];for(let n=0;n<r;n++)o.push(Pr(be(t,n*32,(n+1)*32)));return{dynamic:!0,encoded:Ee(Pr(oe(ye(t),{size:32})),...o)}}function iS(e,t){let{checksumAddress:r,parameter:o}=t,n=!1,s=[];for(let i=0;i<o.components.length;i++){let a=o.components[i],c=Array.isArray(e)?i:a.name,m=id({checksumAddress:r,parameter:a,value:e[c]});s.push(m),m.dynamic&&(n=!0)}return{dynamic:n,encoded:n?hp(s):Ee(...s.map(({encoded:i})=>i))}}function ad(e){let t=e.match(/^(.*)\[(\d+)?\]$/);return t?[t[2]?Number(t[2]):null,t[1]]:void 0}function Fa(e){let{type:t}=e;if(t==="string"||t==="bytes"||t.endsWith("[]"))return!0;if(t==="tuple")return e.components?.some(Fa);let r=ad(e.type);return!!(r&&Fa({...e,type:r[1]}))}St();var cS={bytes:new Uint8Array,dataView:new DataView(new ArrayBuffer(0)),position:0,positionReadCount:new Map,recursiveReadCount:0,recursiveReadLimit:Number.POSITIVE_INFINITY,assertReadLimit(){if(this.recursiveReadCount>=this.recursiveReadLimit)throw new md({count:this.recursiveReadCount+1,limit:this.recursiveReadLimit})},assertPosition(e){if(e<0||e>this.bytes.length-1)throw new cd({length:this.bytes.length,position:e})},decrementPosition(e){if(e<0)throw new bp({offset:e});let t=this.position-e;this.assertPosition(t),this.position=t},getReadCount(e){return this.positionReadCount.get(e||this.position)||0},incrementPosition(e){if(e<0)throw new bp({offset:e});let t=this.position+e;this.assertPosition(t),this.position=t},inspectByte(e){let t=e??this.position;return this.assertPosition(t),this.bytes[t]},inspectBytes(e,t){let r=t??this.position;return this.assertPosition(r+e-1),this.bytes.subarray(r,r+e)},inspectUint8(e){let t=e??this.position;return this.assertPosition(t),this.bytes[t]},inspectUint16(e){let t=e??this.position;return this.assertPosition(t+1),this.dataView.getUint16(t)},inspectUint24(e){let t=e??this.position;return this.assertPosition(t+2),(this.dataView.getUint16(t)<<8)+this.dataView.getUint8(t+2)},inspectUint32(e){let t=e??this.position;return this.assertPosition(t+3),this.dataView.getUint32(t)},pushByte(e){this.assertPosition(this.position),this.bytes[this.position]=e,this.position++},pushBytes(e){this.assertPosition(this.position+e.length-1),this.bytes.set(e,this.position),this.position+=e.length},pushUint8(e){this.assertPosition(this.position),this.bytes[this.position]=e,this.position++},pushUint16(e){this.assertPosition(this.position+1),this.dataView.setUint16(this.position,e),this.position+=2},pushUint24(e){this.assertPosition(this.position+2),this.dataView.setUint16(this.position,e>>8),this.dataView.setUint8(this.position+2,e&255),this.position+=3},pushUint32(e){this.assertPosition(this.position+3),this.dataView.setUint32(this.position,e),this.position+=4},readByte(){this.assertReadLimit(),this._touch();let e=this.inspectByte();return this.position++,e},readBytes(e,t){this.assertReadLimit(),this._touch();let r=this.inspectBytes(e);return this.position+=t??e,r},readUint8(){this.assertReadLimit(),this._touch();let e=this.inspectUint8();return this.position+=1,e},readUint16(){this.assertReadLimit(),this._touch();let e=this.inspectUint16();return this.position+=2,e},readUint24(){this.assertReadLimit(),this._touch();let e=this.inspectUint24();return this.position+=3,e},readUint32(){this.assertReadLimit(),this._touch();let e=this.inspectUint32();return this.position+=4,e},get remaining(){return this.bytes.length-this.position},setPosition(e){let t=this.position;return this.assertPosition(e),this.position=e,()=>this.position=t},_touch(){if(this.recursiveReadLimit===Number.POSITIVE_INFINITY)return;let e=this.getReadCount();this.positionReadCount.set(this.position,e+1),e>0&&this.recursiveReadCount++}};function xp(e,{recursiveReadLimit:t=8192}={}){let r=Object.create(cS);return r.bytes=e,r.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength),r.positionReadCount=new Map,r.recursiveReadLimit=t,r}var bp=class extends F{constructor({offset:t}){super(`Offset \`${t}\` cannot be negative.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Cursor.NegativeOffsetError"})}},cd=class extends F{constructor({length:t,position:r}){super(`Position \`${r}\` is out of bounds (\`0 < position < ${t}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Cursor.PositionOutOfBoundsError"})}},md=class extends F{constructor({count:t,limit:r}){super(`Recursive read limit of \`${r}\` exceeded (recursive read count: \`${t}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Cursor.RecursiveReadLimitExceededError"})}};function Ii(e,t,r={}){let{as:o="Array",checksumAddress:n=!1}=r,s=typeof t=="string"?fi(t):t,i=xp(s);if(Qt(s)===0&&e.length>0)throw new ld;if(Qt(s)&&Qt(s)<32)throw new pd({data:typeof t=="string"?t:Me(t),parameters:e,size:Qt(s)});let a=0,c=o==="Array"?[]:{};for(let m=0;m<e.length;++m){let u=e[m];i.setPosition(a);let[p,l]=Mn(i,u,{checksumAddress:n,staticPosition:0});a+=l,o==="Array"?c.push(p):c[u.name??m]=p}return c}function Xo(e,t,r){let{checksumAddress:o=!1}=r??{};if(e.length!==t.length)throw new vp({expectedLength:e.length,givenLength:t.length});let n=Vb({checksumAddress:o,parameters:e,values:t}),s=hp(n);return s.length===0?"0x":s}function ud(e,t){if(e.length!==t.length)throw new vp({expectedLength:e.length,givenLength:t.length});let r=[];for(let o=0;o<e.length;o++){let n=e[o],s=t[o];r.push(ud.encode(n,s))}return Ee(...r)}(function(e){function t(r,o,n=!1){if(r==="address"){let c=o;return Rn(c),so(c.toLowerCase(),n?32:0)}if(r==="string")return hi(o);if(r==="bytes")return o;if(r==="bool")return so(Iu(o),n?32:1);let s=r.match(dp);if(s){let[c,m,u="256"]=s,p=Number.parseInt(u,10)/8;return oe(o,{size:n?32:p,signed:m==="int"})}let i=r.match(Hb);if(i){let[c,m]=i;if(Number.parseInt(m,10)!==(o.length-2)/2)throw new Da({expectedSize:Number.parseInt(m,10),value:o});return Pr(o,n?32:0)}let a=r.match(zb);if(a&&Array.isArray(o)){let[c,m]=a,u=[];for(let p=0;p<o.length;p++)u.push(t(m,o[p],!0));return u.length===0?"0x":Ee(...u)}throw new ki(r)}e.encode=t})(ud||(ud={}));function La(e){return Array.isArray(e)&&typeof e[0]=="string"?Wm(e):typeof e=="string"?Wm(e):e}var pd=class extends F{constructor({data:t,parameters:r,size:o}){super(`Data size of ${o} bytes is too small for given parameters.`,{metaMessages:[`Params: (${Qr(r)})`,`Data:   ${t} (${o} bytes)`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.DataSizeTooSmallError"})}},ld=class extends F{constructor(){super('Cannot decode zero data ("0x") with ABI parameters.'),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.ZeroDataError"})}},gp=class extends F{constructor({expectedLength:t,givenLength:r,type:o}){super(`Array length mismatch for type \`${o}\`. Expected: \`${t}\`. Given: \`${r}\`.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.ArrayLengthMismatchError"})}},Da=class extends F{constructor({expectedSize:t,value:r}){super(`Size of bytes "${r}" (bytes${ye(r)}) does not match expected size (bytes${t}).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.BytesSizeMismatchError"})}},vp=class extends F{constructor({expectedLength:t,givenLength:r}){super(["ABI encoding parameters/values length mismatch.",`Expected length (parameters): ${t}`,`Given length (values): ${r}`].join(`
`)),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.LengthMismatchError"})}},yp=class extends F{constructor(t){super(`Value \`${t}\` is not a valid array.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidArrayError"})}},ki=class extends F{constructor(t){super(`Type \`${t}\` is not a valid ABI Type.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidTypeError"})}};Je();Vo();St();Je();function mS(e,t){let{as:r}=t,o=Wb(e),n=xp(new Uint8Array(o.length));return o.encode(n),r==="Hex"?Me(n.bytes):n.bytes}function Kb(e,t={}){let{as:r="Hex"}=t;return mS(e,{as:r})}function Wb(e){return Array.isArray(e)?uS(e.map(t=>Wb(t))):pS(e)}function uS(e){let t=e.reduce((n,s)=>n+s.length,0),r=Jb(t);return{length:t<=55?1+t:1+r+t,encode(n){t<=55?n.pushByte(192+t):(n.pushByte(247+r),r===1?n.pushUint8(t):r===2?n.pushUint16(t):r===3?n.pushUint24(t):n.pushUint32(t));for(let{encode:s}of e)s(n)}}}function pS(e){let t=typeof e=="string"?fi(e):e,r=Jb(t.length);return{length:t.length===1&&t[0]<128?1:t.length<=55?1+t.length:1+r+t.length,encode(n){t.length===1&&t[0]<128?n.pushBytes(t):t.length<=55?(n.pushByte(128+t.length),n.pushBytes(t)):(n.pushByte(183+r),r===1?n.pushUint8(t.length):r===2?n.pushUint16(t.length):r===3?n.pushUint24(t.length):n.pushUint32(t.length),n.pushBytes(t))}}}function Jb(e){if(e<2**8)return 1;if(e<2**16)return 2;if(e<2**24)return 3;if(e<2**32)return 4;throw new F("Length is too large.")}import{secp256k1 as AK}from"@noble/curves/secp256k1";St();Je();_a();function yd(e,t={}){let{recovered:r}=t;if(typeof e.r>"u")throw new Oa({signature:e});if(typeof e.s>"u")throw new Oa({signature:e});if(r&&typeof e.yParity>"u")throw new Oa({signature:e});if(e.r<0n||e.r>nd)throw new dd({value:e.r});if(e.s<0n||e.s>nd)throw new hd({value:e.s});if(typeof e.yParity=="number"&&e.yParity!==0&&e.yParity!==1)throw new Ua({value:e.yParity})}function fS(e){return Zb(Me(e))}function Zb(e){if(e.length!==130&&e.length!==132)throw new fd({signature:e});let t=BigInt(be(e,0,32)),r=BigInt(be(e,32,64)),o=(()=>{let n=+`0x${e.slice(130)}`;if(!Number.isNaN(n))try{return vd(n)}catch{throw new Ua({value:n})}})();return typeof o>"u"?{r:t,s:r}:{r:t,s:r,yParity:o}}function bd(e){if(!(typeof e.r>"u")&&!(typeof e.s>"u"))return xd(e)}function xd(e){let t=typeof e=="string"?Zb(e):e instanceof Uint8Array?fS(e):typeof e.r=="string"?hS(e):e.v?dS(e):{r:e.r,s:e.s,...typeof e.yParity<"u"?{yParity:e.yParity}:{}};return yd(t),t}function dS(e){return{r:e.r,s:e.s,yParity:vd(e.v)}}function hS(e){let t=(()=>{let r=e.v?Number(e.v):void 0,o=e.yParity?Number(e.yParity):void 0;if(typeof r=="number"&&typeof o!="number"&&(o=vd(r)),typeof o!="number")throw new Ua({value:e.yParity});return o})();return{r:BigInt(e.r),s:BigInt(e.s),yParity:t}}function Yb(e){let{r:t,s:r,yParity:o}=e;return[o?"0x01":"0x",t===0n?"0x":Pf(oe(t)),r===0n?"0x":Pf(oe(r))]}function vd(e){if(e===0||e===27)return 0;if(e===1||e===28)return 1;if(e>=35)return e%2===0?1:0;throw new gd({value:e})}var fd=class extends F{constructor({signature:t}){super(`Value \`${t}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${ye(di(t))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}},Oa=class extends F{constructor({signature:t}){super(`Signature \`${qo(t)}\` is missing either an \`r\`, \`s\`, or \`yParity\` property.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.MissingPropertiesError"})}},dd=class extends F{constructor({value:t}){super(`Value \`${t}\` is an invalid r value. r must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidRError"})}},hd=class extends F{constructor({value:t}){super(`Value \`${t}\` is an invalid s value. s must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSError"})}},Ua=class extends F{constructor({value:t}){super(`Value \`${t}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}},gd=class extends F{constructor({value:t}){super(`Value \`${t}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}};function Qb(e,t={}){return typeof e.chainId=="string"?gS(e):{...e,...t.signature}}function gS(e){let{address:t,chainId:r,nonce:o}=e,n=bd(e);return{address:t,chainId:Number(r),nonce:BigInt(o),...n}}function ex(e){return yS(e,{presign:!0})}function yS(e,t={}){let{presign:r}=t;return $n(Ee("0x05",Kb(bS(r?{address:e.address,chainId:e.chainId,nonce:e.nonce}:e))))}function bS(e){let{address:t,chainId:r,nonce:o}=e,n=bd(e);return[r?oe(r):"0x",t,o?oe(o):"0x",...n?Yb(n):[]]}St();Je();import{secp256k1 as vS}from"@noble/curves/secp256k1";Je();function tx(e){return Ub(wS(e))}function wS(e){let{payload:t,signature:r}=e,{r:o,s:n,yParity:s}=r,a=new vS.Signature(BigInt(o),BigInt(n)).addRecoveryBit(s).recoverPublicKey(di(t).substring(2));return Nb(a)}var wd="0x8010801080108010801080108010801080108010801080108010801080108010",Cd=La("(uint256 chainId, address delegation, uint256 nonce, uint8 yParity, uint256 r, uint256 s), address to, bytes data");function Cp(e){if(typeof e=="string"){if(be(e,-32)!==wd)throw new wp(e)}else yd(e.authorization)}function ES(e){return typeof e=="string"?rx(e):e}function rx(e){Cp(e);let t=Eu(be(e,-64,-32)),r=be(e,-t-64,-64),o=be(e,0,-t-64),[n,s,i]=Ii(Cd,r);return{authorization:Qb({address:n.delegation,chainId:Number(n.chainId),nonce:n.nonce,yParity:n.yParity,r:n.r,s:n.s}),signature:o,...i&&i!=="0x"?{data:i,to:s}:{}}}function SS(e){let{data:t,signature:r}=e;Cp(e);let o=tx({payload:ex(e.authorization),signature:xd(e.authorization)}),n=Xo(Cd,[{...e.authorization,delegation:e.authorization.address,chainId:BigInt(e.authorization.chainId)},e.to??o,t??"0x"]),s=oe(ye(n),{size:32});return Ee(r,n,s,wd)}function kS(e){try{return Cp(e),!0}catch{return!1}}var wp=class extends F{constructor(t){super(`Value \`${t}\` is an invalid ERC-8010 wrapped signature.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"SignatureErc8010.InvalidWrappedSignatureError"})}};Nc();G();var Ep=class extends w{constructor({value:t}){super(`Number \`${t}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}};function ox(e,t){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(e))throw new Ep({value:e});let[r,o="0"]=e.split("."),n=r.startsWith("-");if(n&&(r=r.slice(1)),o=o.replace(/(0+)$/,""),t===0)Math.round(+`.${o}`)===1&&(r=`${BigInt(r)+1n}`),o="";else if(o.length>t){let[s,i,a]=[o.slice(0,t-1),o.slice(t-1,t),o.slice(t)],c=Math.round(+`${i}.${a}`);c>9?o=`${BigInt(s)+BigInt(1)}0`.padStart(s.length+1,"0"):o=`${s}${c}`,o.length>t&&(o=o.slice(1),r=`${BigInt(r)+1n}`),o=o.slice(0,t)}else o=o.padEnd(t,"0");return BigInt(`${n?"-":""}${r}${o}`)}function Bn(e,t="wei"){return ox(e,Dc[t])}function IS(e){return e.map(t=>({...t,value:BigInt(t.value)}))}function nx(e){return{...e,balance:e.balance?BigInt(e.balance):void 0,nonce:e.nonce?Ce(e.nonce):void 0,storageProof:e.storageProof?IS(e.storageProof):void 0}}async function sx(e,{address:t,blockNumber:r,blockTag:o,storageKeys:n}){let s=o??"latest",i=r!==void 0?S(r):void 0,a=await e.request({method:"eth_getProof",params:[t,n,i||s]});return nx(a)}D();async function ix(e,{address:t,blockNumber:r,blockTag:o="latest",slot:n}){let s=r!==void 0?S(r):void 0;return await e.request({method:"eth_getStorageAt",params:[t,n,s||o]})}Tt();D();async function _i(e,{blockHash:t,blockNumber:r,blockTag:o,hash:n,index:s}){let i=o||"latest",a=r!==void 0?S(r):void 0,c=null;if(n?c=await e.request({method:"eth_getTransactionByHash",params:[n]},{dedupe:!0}):t?c=await e.request({method:"eth_getTransactionByBlockHashAndIndex",params:[t,S(s)]},{dedupe:!0}):(a||i)&&(c=await e.request({method:"eth_getTransactionByBlockNumberAndIndex",params:[a||i,S(s)]},{dedupe:!!a})),!c)throw new ns({blockHash:t,blockNumber:r,blockTag:i,hash:n,index:s});return(e.chain?.formatters?.transaction?.format||fn)(c,"getTransaction")}async function ax(e,{hash:t,transactionReceipt:r}){let[o,n]=await Promise.all([T(e,$r,"getBlockNumber")({}),t?T(e,_i,"getTransaction")({hash:t}):void 0]),s=r?.blockNumber||n?.blockNumber;return s?o-s+1n:0n}Tt();async function Ai(e,{hash:t}){let r=await e.request({method:"eth_getTransactionReceipt",params:[t]},{dedupe:!0});if(!r)throw new ss({hash:t});return(e.chain?.formatters?.transactionReceipt?.format||oa)(r,"getTransactionReceipt")}Ko();Ta();Ie();G();Fo();Go();Mt();bn();async function cx(e,t){let{account:r,authorizationList:o,allowFailure:n=!0,blockNumber:s,blockOverrides:i,blockTag:a,stateOverride:c}=t,m=t.contracts,{batchSize:u=t.batchSize??1024,deployless:p=t.deployless??!1}=typeof e.batch?.multicall=="object"?e.batch.multicall:{},l=(()=>{if(t.multicallAddress)return t.multicallAddress;if(p)return null;if(e.chain)return Wt({blockNumber:s,chain:e.chain,contract:"multicall3"});throw new Error("client chain not configured. multicallAddress is required.")})(),d=[[]],h=0,g=0;for(let b=0;b<m.length;b++){let{abi:v,address:E,args:A,functionName:k}=m[b];try{let I=de({abi:v,args:A,functionName:k});g+=(I.length-2)/2,u>0&&g>u&&d[h].length>0&&(h++,g=(I.length-2)/2,d[h]=[]),d[h]=[...d[h],{allowFailure:!0,callData:I,target:E}]}catch(I){let R=Bt(I,{abi:v,address:E,args:A,docsPath:"/docs/contract/multicall",functionName:k,sender:r});if(!n)throw R;d[h]=[...d[h],{allowFailure:!0,callData:"0x",target:E}]}}let y=await Promise.allSettled(d.map(b=>T(e,De,"readContract")({...l===null?{code:gi}:{address:l},abi:_n,account:r,args:[b],authorizationList:o,blockNumber:s,blockOverrides:i,blockTag:a,functionName:"aggregate3",stateOverride:c}))),x=[];for(let b=0;b<y.length;b++){let v=y[b];if(v.status==="rejected"){if(!n)throw v.reason;for(let A=0;A<d[b].length;A++)x.push({status:"failure",error:v.reason,result:void 0});continue}let E=v.value;for(let A=0;A<E.length;A++){let{returnData:k,success:I}=E[A],{callData:R}=d[b][A],{abi:B,address:M,functionName:L,args:O}=m[x.length];try{if(R==="0x")throw new Zt;if(!I)throw new Er({data:k});let U=Et({abi:B,args:O,data:k,functionName:L});x.push(n?{result:U,status:"success"}:U)}catch(U){let re=Bt(U,{abi:B,address:M,args:O,docsPath:"/docs/contract/multicall",functionName:L});if(!n)throw re;x.push({error:re,result:void 0,status:"failure"})}}}if(x.length!==m.length)throw new w("multicall results mismatch");return x}Tf();ke();Ie();Fo();Po();Go();Mt();ut();D();Ea();Io();fu();oo();async function Ha(e,t){let{blockNumber:r,blockTag:o=e.experimental_blockTag??"latest",blocks:n,returnFullTransactions:s,traceTransfers:i,validation:a}=t;try{let c=[];for(let l of n){let d=l.blockOverrides?_u(l.blockOverrides):void 0,h=l.calls.map(y=>{let x=y,b=x.account?V(x.account):void 0,v=x.abi?de(x):x.data,E={...x,account:b,data:x.dataSuffix?Fe([v||"0x",x.dataSuffix]):v,from:x.from??b?.address};return nt(E),xt(E)}),g=l.stateOverrides?oi(l.stateOverrides):void 0;c.push({blockOverrides:d,calls:h,stateOverrides:g})}let u=(typeof r=="bigint"?S(r):void 0)||o;return(await e.request({method:"eth_simulateV1",params:[{blockStateCalls:c,returnFullTransactions:s,traceTransfers:i,validation:a},u]})).map((l,d)=>({...ra(l),calls:l.calls.map((h,g)=>{let{abi:y,args:x,functionName:b,to:v}=n[d].calls[g],E=h.error?.data??h.returnData,A=BigInt(h.gasUsed),k=h.logs?.map(M=>tt(M)),I=h.status==="0x1"?"success":"failure",R=y&&I==="success"&&E!=="0x"?Et({abi:y,data:E,functionName:b}):null,B=(()=>{if(I==="success")return;let M;if(h.error?.data==="0x"?M=new Zt:h.error&&(M=new Er(h.error)),!!M)return Bt(M,{abi:y??[],address:v??"0x",args:x,functionName:b??"<unknown>"})})();return{data:E,gasUsed:A,logs:k,status:I,...I==="success"?{result:R}:{error:B}}})}))}catch(c){let m=c,u=Uo(m,{});throw u instanceof Gt?m:u}}ba();St();Je();St();function kp(e){let t=!0,r="",o=0,n="",s=!1;for(let i=0;i<e.length;i++){let a=e[i];if(["(",")",","].includes(a)&&(t=!0),a==="("&&o++,a===")"&&o--,!!t){if(o===0){if(a===" "&&["event","function","error",""].includes(n))n="";else if(n+=a,a===")"){s=!0;break}continue}if(a===" "){e[i-1]!==","&&r!==","&&r!==",("&&(r="",t=!1);continue}n+=a,r+=a}}if(!s)throw new F("Unable to normalize signature.");return n}function Sp(e,t){let r=typeof e,o=t.type;switch(o){case"address":return lp(e,{strict:!1});case"bool":return r==="boolean";case"function":return r==="string";case"string":return r==="string";default:return o==="tuple"&&"components"in t?Object.values(t.components).every((n,s)=>Sp(Object.values(e)[s],n)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(o)?r==="number"||r==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(o)?r==="string"||e instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(o)?Array.isArray(e)&&e.every(n=>Sp(n,{...t,type:o.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function Ed(e,t,r){for(let o in e){let n=e[o],s=t[o];if(n.type==="tuple"&&s.type==="tuple"&&"components"in n&&"components"in s)return Ed(n.components,s.components,r[o]);let i=[n.type,s.type];if(i.includes("address")&&i.includes("bytes20")?!0:i.includes("address")&&i.includes("string")?lp(r[o],{strict:!1}):i.includes("address")&&i.includes("bytes")?lp(r[o],{strict:!1}):!1)return i}}function Ip(e,t={}){let{prepare:r=!0}=t,o=Array.isArray(e)?Km(e):typeof e=="string"?Km(e):e;return{...o,...r?{hash:Pi(o)}:{}}}function ja(e,t,r){let{args:o=[],prepare:n=!0}=r??{},s=Pa(t,{strict:!1}),i=e.filter(m=>s?m.type==="function"||m.type==="error"?kd(m)===be(t,0,4):m.type==="event"?Pi(m)===t:!1:"name"in m&&m.name===t);if(i.length===0)throw new Qo({name:t});if(i.length===1)return{...i[0],...n?{hash:Pi(i[0])}:{}};let a;for(let m of i){if(!("inputs"in m))continue;if(!o||o.length===0){if(!m.inputs||m.inputs.length===0)return{...m,...n?{hash:Pi(m)}:{}};continue}if(!m.inputs||m.inputs.length===0||m.inputs.length!==o.length)continue;if(o.every((p,l)=>{let d="inputs"in m&&m.inputs[l];return d?Sp(p,d):!1})){if(a&&"inputs"in a&&a.inputs){let p=Ed(m.inputs,a.inputs,o);if(p)throw new Sd({abiItem:m,type:p[0]},{abiItem:a,type:p[1]})}a=m}}let c=(()=>{if(a)return a;let[m,...u]=i;return{...m,overloads:u}})();if(!c)throw new Qo({name:t});return{...c,...n?{hash:Pi(c)}:{}}}function kd(...e){let t=(()=>{if(Array.isArray(e[0])){let[r,o]=e;return ja(r,o)}return e[0]})();return be(Pi(t),0,4)}function AS(...e){let t=(()=>{if(Array.isArray(e[0])){let[o,n]=e;return ja(o,n)}return e[0]})(),r=typeof t=="string"?t:xn(t);return kp(r)}function Pi(...e){let t=(()=>{if(Array.isArray(e[0])){let[r,o]=e;return ja(r,o)}return e[0]})();return typeof t!="string"&&"hash"in t&&t.hash?t.hash:$n(hi(AS(t)))}var Sd=class extends F{constructor(t,r){super("Found ambiguous types in overloaded ABI Items.",{metaMessages:[`\`${t.type}\` in \`${kp(xn(t.abiItem))}\`, and`,`\`${r.type}\` in \`${kp(xn(r.abiItem))}\``,"","These types encode differently and cannot be distinguished at runtime.","Remove one of the ambiguous items in the ABI."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiItem.AmbiguityError"})}},Qo=class extends F{constructor({name:t,data:r,type:o="item"}){let n=t?` with name "${t}"`:r?` with data "${r}"`:"";super(`ABI ${o}${n} not found.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiItem.NotFoundError"})}};Je();function ux(...e){let[t,r]=(()=>{if(Array.isArray(e[0])){let[s,i]=e;return[PS(s),i]}return e})(),{bytecode:o,args:n}=r;return Ee(o,t.inputs?.length&&n?.length?Xo(t.inputs,n):"0x")}function px(e){return Ip(e)}function PS(e){let t=e.find(r=>r.type==="constructor");if(!t)throw new Qo({name:"constructor"});return t}Je();function fx(...e){let[t,r=[]]=(()=>{if(Array.isArray(e[0])){let[m,u,p]=e;return[lx(m,u,{args:p}),p]}let[a,c]=e;return[a,c]})(),{overloads:o}=t,n=o?lx([t,...o],t.name,{args:r}):t,s=$S(n),i=r.length>0?Xo(n.inputs,r):void 0;return i?Ee(s,i):s}function Fn(e,t={}){return Ip(e,t)}function lx(e,t,r){let o=ja(e,t,r);if(o.type!=="function")throw new Qo({name:t,type:"function"});return o}function $S(e){return kd(e)}ke();var dx="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",dr="0x0000000000000000000000000000000000000000";Ta();G();Mt();var MS="0x6080604052348015600e575f80fd5b5061016d8061001c5f395ff3fe608060405234801561000f575f80fd5b5060043610610029575f3560e01c8063f8b2cb4f1461002d575b5f80fd5b610047600480360381019061004291906100db565b61005d565b604051610054919061011e565b60405180910390f35b5f8173ffffffffffffffffffffffffffffffffffffffff16319050919050565b5f80fd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6100aa82610081565b9050919050565b6100ba816100a0565b81146100c4575f80fd5b50565b5f813590506100d5816100b1565b92915050565b5f602082840312156100f0576100ef61007d565b5b5f6100fd848285016100c7565b91505092915050565b5f819050919050565b61011881610106565b82525050565b5f6020820190506101315f83018461010f565b9291505056fea26469706673582212203b9fe929fe995c7cf9887f0bdba8a36dd78e8b73f149b17d2d9ad7cd09d2dc6264736f6c634300081a0033";async function hx(e,t){let{blockNumber:r,blockTag:o,calls:n,stateOverrides:s,traceAssetChanges:i,traceTransfers:a,validation:c}=t,m=t.account?V(t.account):void 0;if(i&&!m)throw new w("`account` is required when `traceAssetChanges` is true");let u=m?ux(px("constructor(bytes, bytes)"),{bytecode:Tu,args:[MS,fx(Fn("function getBalance(address)"),[m.address])]}):void 0,p=i?await Promise.all(t.calls.map(async z=>{if(!z.data&&!z.abi)return;let{accessList:Te}=await Zu(e,{account:m.address,...z,data:z.abi?de(z):z.data});return Te.map(({address:yr,storageKeys:Co})=>Co.length>0?yr:null)})).then(z=>z.flat().filter(Boolean)):[],l=await Ha(e,{blockNumber:r,blockTag:o,blocks:[...i?[{calls:[{data:u}],stateOverrides:s},{calls:p.map((z,Te)=>({abi:[Fn("function balanceOf(address) returns (uint256)")],functionName:"balanceOf",args:[m.address],to:z,from:dr,nonce:Te})),stateOverrides:[{address:dr,nonce:0}]}]:[],{calls:[...n,{}].map(z=>({...z,from:m?.address})),stateOverrides:s},...i?[{calls:[{data:u}]},{calls:p.map((z,Te)=>({abi:[Fn("function balanceOf(address) returns (uint256)")],functionName:"balanceOf",args:[m.address],to:z,from:dr,nonce:Te})),stateOverrides:[{address:dr,nonce:0}]},{calls:p.map((z,Te)=>({to:z,abi:[Fn("function decimals() returns (uint256)")],functionName:"decimals",from:dr,nonce:Te})),stateOverrides:[{address:dr,nonce:0}]},{calls:p.map((z,Te)=>({to:z,abi:[Fn("function tokenURI(uint256) returns (string)")],functionName:"tokenURI",args:[0n],from:dr,nonce:Te})),stateOverrides:[{address:dr,nonce:0}]},{calls:p.map((z,Te)=>({to:z,abi:[Fn("function symbol() returns (string)")],functionName:"symbol",from:dr,nonce:Te})),stateOverrides:[{address:dr,nonce:0}]}]:[]],traceTransfers:a,validation:c}),d=i?l[2]:l[0],[h,g,,y,x,b,v,E]=i?l:[],{calls:A,...k}=d,I=A.slice(0,-1)??[],R=h?.calls??[],B=g?.calls??[],M=[...R,...B].map(z=>z.status==="success"?ue(z.data):null),L=y?.calls??[],O=x?.calls??[],U=[...L,...O].map(z=>z.status==="success"?ue(z.data):null),re=(b?.calls??[]).map(z=>z.status==="success"?z.result:null),W=(E?.calls??[]).map(z=>z.status==="success"?z.result:null),ge=(v?.calls??[]).map(z=>z.status==="success"?z.result:null),Ot=[];for(let[z,Te]of U.entries()){let yr=M[z];if(typeof Te!="bigint"||typeof yr!="bigint")continue;let Co=re[z-1],le=W[z-1],Eo=ge[z-1],nr=z===0?{address:dx,decimals:18,symbol:"ETH"}:{address:p[z-1],decimals:Eo||Co?Number(Co??1):void 0,symbol:le??void 0};Ot.some($l=>$l.token.address===nr.address)||Ot.push({token:nr,value:{pre:yr,post:Te,diff:Te-yr}})}return{assetChanges:Ot,block:k,results:I}}var Ga={};Ml(Ga,{InvalidWrappedSignatureError:()=>_p,assert:()=>_d,from:()=>DS,magicBytes:()=>Id,universalSignatureValidatorAbi:()=>FS,universalSignatureValidatorBytecode:()=>BS,unwrap:()=>gx,validate:()=>LS,wrap:()=>NS});St();Je();var Id="0x6492649264926492649264926492649264926492649264926492649264926492",BS="0x608060405234801561001057600080fd5b5060405161069438038061069483398101604081905261002f9161051e565b600061003c848484610048565b9050806000526001601ff35b60007f64926492649264926492649264926492649264926492649264926492649264926100748361040c565b036101e7576000606080848060200190518101906100929190610577565b60405192955090935091506000906001600160a01b038516906100b69085906105dd565b6000604051808303816000865af19150503d80600081146100f3576040519150601f19603f3d011682016040523d82523d6000602084013e6100f8565b606091505b50509050876001600160a01b03163b60000361016057806101605760405162461bcd60e51b815260206004820152601e60248201527f5369676e617475726556616c696461746f723a206465706c6f796d656e74000060448201526064015b60405180910390fd5b604051630b135d3f60e11b808252906001600160a01b038a1690631626ba7e90610190908b9087906004016105f9565b602060405180830381865afa1580156101ad573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906101d19190610633565b6001600160e01b03191614945050505050610405565b6001600160a01b0384163b1561027a57604051630b135d3f60e11b808252906001600160a01b03861690631626ba7e9061022790879087906004016105f9565b602060405180830381865afa158015610244573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906102689190610633565b6001600160e01b031916149050610405565b81516041146102df5760405162461bcd60e51b815260206004820152603a602482015260008051602061067483398151915260448201527f3a20696e76616c6964207369676e6174757265206c656e6774680000000000006064820152608401610157565b6102e7610425565b5060208201516040808401518451859392600091859190811061030c5761030c61065d565b016020015160f81c9050601b811480159061032b57508060ff16601c14155b1561038c5760405162461bcd60e51b815260206004820152603b602482015260008051602061067483398151915260448201527f3a20696e76616c6964207369676e617475726520762076616c756500000000006064820152608401610157565b60408051600081526020810180835289905260ff83169181019190915260608101849052608081018390526001600160a01b0389169060019060a0016020604051602081039080840390855afa1580156103ea573d6000803e3d6000fd5b505050602060405103516001600160a01b0316149450505050505b9392505050565b600060208251101561041d57600080fd5b508051015190565b60405180606001604052806003906020820280368337509192915050565b6001600160a01b038116811461045857600080fd5b50565b634e487b7160e01b600052604160045260246000fd5b60005b8381101561048c578181015183820152602001610474565b50506000910152565b600082601f8301126104a657600080fd5b81516001600160401b038111156104bf576104bf61045b565b604051601f8201601f19908116603f011681016001600160401b03811182821017156104ed576104ed61045b565b60405281815283820160200185101561050557600080fd5b610516826020830160208701610471565b949350505050565b60008060006060848603121561053357600080fd5b835161053e81610443565b6020850151604086015191945092506001600160401b0381111561056157600080fd5b61056d86828701610495565b9150509250925092565b60008060006060848603121561058c57600080fd5b835161059781610443565b60208501519093506001600160401b038111156105b357600080fd5b6105bf86828701610495565b604086015190935090506001600160401b0381111561056157600080fd5b600082516105ef818460208701610471565b9190910192915050565b828152604060208201526000825180604084015261061e816060850160208701610471565b601f01601f1916919091016060019392505050565b60006020828403121561064557600080fd5b81516001600160e01b03198116811461040557600080fd5b634e487b7160e01b600052603260045260246000fdfe5369676e617475726556616c696461746f72237265636f7665725369676e6572",FS=[{inputs:[{name:"_signer",type:"address"},{name:"_hash",type:"bytes32"},{name:"_signature",type:"bytes"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[{name:"_signer",type:"address"},{name:"_hash",type:"bytes32"},{name:"_signature",type:"bytes"}],outputs:[{type:"bool"}],stateMutability:"nonpayable",type:"function",name:"isValidSig"}];function _d(e){if(be(e,-32)!==Id)throw new _p(e)}function DS(e){return typeof e=="string"?gx(e):e}function gx(e){_d(e);let[t,r,o]=Ii(La("address, bytes, bytes"),e);return{data:r,signature:o,to:t}}function NS(e){let{data:t,signature:r,to:o}=e;return Ee(Xo(La("address, bytes, bytes"),[o,t,r]),Id)}function LS(e){try{return _d(e),!0}catch{return!1}}var _p=class extends F{constructor(t){super(`Value \`${t}\` is an invalid ERC-6492 wrapped signature.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"SignatureErc6492.InvalidWrappedSignatureError"})}};Ko();Ta();Fo();$u();Mt();To();kn();ut();Pt();Oe();D();Oe();qe();import{secp256k1 as OS}from"@noble/curves/secp256k1";function Ap({r:e,s:t,to:r="hex",v:o,yParity:n}){let s=(()=>{if(n===0||n===1)return n;if(o&&(o===27n||o===28n||o>=35n))return o%2n===0n?1:0;throw new Error("Invalid `v` or `yParity` value")})(),i=`0x${new OS.Signature(ue(e),ue(t)).toCompactHex()}${s===0?"1b":"1c"}`;return r==="hex"?i:Ue(i)}bi();async function en(e,t){let{address:r,hash:o,erc6492VerifierAddress:n=t.universalSignatureVerifierAddress??e.chain?.contracts?.erc6492Verifier?.address,multicallAddress:s=t.multicallAddress??e.chain?.contracts?.multicall3?.address}=t,i=(()=>{let a=t.signature;return pe(a)?a:typeof a=="object"&&"r"in a&&"s"in a?Ap(a):ee(a)})();try{return za.validate(i)?await US(e,{...t,multicallAddress:s,signature:i}):await zS(e,{...t,verifierAddress:n,signature:i})}catch(a){try{if(Xt(Cs(r),await uu({hash:o,signature:i})))return!0}catch{}if(a instanceof ao)return!1;throw a}}async function US(e,t){let{address:r,blockNumber:o,blockTag:n,hash:s,multicallAddress:i}=t,{authorization:a,data:c,signature:m,to:u}=za.unwrap(t.signature);if(await Ba(e,{address:r,blockNumber:o,blockTag:n})===Ke(["0xef0100",a.address]))return await HS(e,{address:r,blockNumber:o,blockTag:n,hash:s,signature:m});let l={address:a.address,chainId:Number(a.chainId),nonce:Number(a.nonce),r:S(a.r,{size:32}),s:S(a.s,{size:32}),yParity:a.yParity};if(!await Sb({address:r,authorization:l}))throw new ao;let h=await T(e,De,"readContract")({...i?{address:i}:{code:gi},authorizationList:[l],abi:_n,blockNumber:o,blockTag:"pending",functionName:"aggregate3",args:[[...c?[{allowFailure:!0,target:u??r,callData:c}]:[],{allowFailure:!0,target:r,callData:de({abi:Mf,functionName:"isValidSignature",args:[s,m]})}]]});if(h[h.length-1]?.returnData?.startsWith("0x1626ba7e"))return!0;throw new ao}async function zS(e,t){let{address:r,factory:o,factoryData:n,hash:s,signature:i,verifierAddress:a,...c}=t,m=await(async()=>!o&&!n||Ga.validate(i)?i:Ga.wrap({data:n,signature:i,to:o}))(),u=a?{to:a,data:de({abi:Bf,functionName:"isValidSig",args:[r,s,m]}),...c}:{data:An({abi:Bf,args:[r,s,m],bytecode:Hy}),...c},{data:p}=await T(e,Tr,"call")(u).catch(l=>{throw l instanceof Fs?new ao:l});if(jl(p??"0x0"))return!0;throw new ao}async function HS(e,t){let{address:r,blockNumber:o,blockTag:n,hash:s,signature:i}=t;if((await T(e,De,"readContract")({address:r,abi:Mf,args:[s,i],blockNumber:o,blockTag:n,functionName:"isValidSignature"}).catch(c=>{throw c instanceof Ds?new ao:c})).startsWith("0x1626ba7e"))return!0;throw new ao}var ao=class extends Error{};async function yx(e,{address:t,message:r,factory:o,factoryData:n,signature:s,...i}){let a=Si(r);return en(e,{address:t,factory:o,factoryData:n,hash:a,signature:s,...i})}async function bx(e,t){let{address:r,factory:o,factoryData:n,signature:s,message:i,primaryType:a,types:c,domain:m,...u}=t,p=ip({message:i,primaryType:a,types:c,domain:m});return en(e,{address:r,factory:o,factoryData:n,hash:p,signature:s,...u})}Tt();Ru();rt();Oe();rt();function Pp(e,{emitOnBegin:t=!1,emitMissed:r=!1,onBlockNumber:o,onError:n,poll:s,pollingInterval:i=e.pollingInterval}){let a=typeof s<"u"?s:!(e.transport.type==="webSocket"||e.transport.type==="ipc"||e.transport.type==="fallback"&&(e.transport.transports[0].config.type==="webSocket"||e.transport.transports[0].config.type==="ipc")),c;return a?(()=>{let p=Z(["watchBlockNumber",e.uid,t,r,i]);return it(p,{onBlockNumber:o,onError:n},l=>er(async()=>{try{let d=await T(e,$r,"getBlockNumber")({cacheTime:0});if(c!==void 0){if(d===c)return;if(d-c>1&&r)for(let h=c+1n;h<d;h++)l.onBlockNumber(h,c),c=h}(c===void 0||d>c)&&(l.onBlockNumber(d,c),c=d)}catch(d){l.onError?.(d)}},{emitOnBegin:t,interval:i}))})():(()=>{let p=Z(["watchBlockNumber",e.uid,t,r]);return it(p,{onBlockNumber:o,onError:n},l=>{let d=!0,h=()=>d=!1;return(async()=>{try{let g=(()=>{if(e.transport.type==="fallback"){let x=e.transport.transports.find(b=>b.config.type==="webSocket"||b.config.type==="ipc");return x?x.value:e.transport}return e.transport})(),{unsubscribe:y}=await g.subscribe({params:["newHeads"],onData(x){if(!d)return;let b=ue(x.result?.number);l.onBlockNumber(b,c),c=b},onError(x){l.onError?.(x)}});h=y,d||h()}catch(g){n?.(g)}})(),()=>h()})})()}async function Tp(e,t){let{checkReplacement:r=!0,confirmations:o=1,hash:n,onReplaced:s,retryCount:i=6,retryDelay:a=({count:A})=>~~(1<<A)*200,timeout:c=18e4}=t,m=Z(["waitForTransactionReceipt",e.uid,n]),u=t.pollingInterval?t.pollingInterval:e.chain?.experimental_preconfirmationTime?e.chain.experimental_preconfirmationTime:e.pollingInterval,p,l,d,h=!1,g,y,{promise:x,resolve:b,reject:v}=yi(),E=c?setTimeout(()=>{y?.(),g?.(),v(new Vc({hash:n}))},c):void 0;return g=it(m,{onReplaced:s,resolve:b,reject:v},async A=>{if(d=await T(e,Ai,"getTransactionReceipt")({hash:n}).catch(()=>{}),d&&o<=1){clearTimeout(E),A.resolve(d),g?.();return}y=T(e,Pp,"watchBlockNumber")({emitMissed:!0,emitOnBegin:!0,poll:!0,pollingInterval:u,async onBlockNumber(k){let I=B=>{clearTimeout(E),y?.(),B(),g?.()},R=k;if(!h)try{if(d){if(o>1&&(!d.blockNumber||R-d.blockNumber+1n<o))return;I(()=>A.resolve(d));return}if(r&&!p&&(h=!0,await Tn(async()=>{p=await T(e,_i,"getTransaction")({hash:n}),p.blockNumber&&(R=p.blockNumber)},{delay:a,retryCount:i}),h=!1),d=await T(e,Ai,"getTransactionReceipt")({hash:n}),o>1&&(!d.blockNumber||R-d.blockNumber+1n<o))return;I(()=>A.resolve(d))}catch(B){if(B instanceof ns||B instanceof ss){if(!p){h=!1;return}try{l=p,h=!0;let M=await Tn(()=>T(e,st,"getBlock")({blockNumber:R,includeTransactions:!0}),{delay:a,retryCount:i,shouldRetry:({error:U})=>U instanceof ni});h=!1;let L=M.transactions.find(({from:U,nonce:re})=>U===l.from&&re===l.nonce);if(!L||(d=await T(e,Ai,"getTransactionReceipt")({hash:L.hash}),o>1&&(!d.blockNumber||R-d.blockNumber+1n<o)))return;let O="replaced";L.to===l.to&&L.value===l.value&&L.input===l.input?O="repriced":L.from===L.to&&L.value===0n&&(O="cancelled"),I(()=>{A.onReplaced?.({reason:O,replacedTransaction:l,transaction:L,transactionReceipt:d}),A.resolve(d)})}catch(M){I(()=>A.reject(M))}}else I(()=>A.reject(B))}}})}),x}rt();function xx(e,{blockTag:t=e.experimental_blockTag??"latest",emitMissed:r=!1,emitOnBegin:o=!1,onBlock:n,onError:s,includeTransactions:i,poll:a,pollingInterval:c=e.pollingInterval}){let m=typeof a<"u"?a:!(e.transport.type==="webSocket"||e.transport.type==="ipc"||e.transport.type==="fallback"&&(e.transport.transports[0].config.type==="webSocket"||e.transport.transports[0].config.type==="ipc")),u=i??!1,p;return m?(()=>{let h=Z(["watchBlocks",e.uid,t,r,o,u,c]);return it(h,{onBlock:n,onError:s},g=>er(async()=>{try{let y=await T(e,st,"getBlock")({blockTag:t,includeTransactions:u});if(y.number!==null&&p?.number!=null){if(y.number===p.number)return;if(y.number-p.number>1&&r)for(let x=p?.number+1n;x<y.number;x++){let b=await T(e,st,"getBlock")({blockNumber:x,includeTransactions:u});g.onBlock(b,p),p=b}}(p?.number==null||t==="pending"&&y?.number==null||y.number!==null&&y.number>p.number)&&(g.onBlock(y,p),p=y)}catch(y){g.onError?.(y)}},{emitOnBegin:o,interval:c}))})():(()=>{let h=!0,g=!0,y=()=>h=!1;return(async()=>{try{o&&T(e,st,"getBlock")({blockTag:t,includeTransactions:u}).then(v=>{h&&g&&(n(v,void 0),g=!1)}).catch(s);let x=(()=>{if(e.transport.type==="fallback"){let v=e.transport.transports.find(E=>E.config.type==="webSocket"||E.config.type==="ipc");return v?v.value:e.transport}return e.transport})(),{unsubscribe:b}=await x.subscribe({params:["newHeads"],async onData(v){if(!h)return;let E=await T(e,st,"getBlock")({blockNumber:v.result?.number,includeTransactions:u}).catch(()=>{});h&&(n(E,p),g=!1,p=E)},onError(v){s?.(v)}});y=b,h||y()}catch(x){s?.(x)}})(),()=>y()})()}Ie();ti();rt();function vx(e,{address:t,args:r,batch:o=!0,event:n,events:s,fromBlock:i,onError:a,onLogs:c,poll:m,pollingInterval:u=e.pollingInterval,strict:p}){let l=typeof m<"u"?m:typeof i=="bigint"?!0:!(e.transport.type==="webSocket"||e.transport.type==="ipc"||e.transport.type==="fallback"&&(e.transport.transports[0].config.type==="webSocket"||e.transport.transports[0].config.type==="ipc")),d=p??!1;return l?(()=>{let y=Z(["watchEvent",t,r,o,e.uid,n,u,i]);return it(y,{onLogs:c,onError:a},x=>{let b;i!==void 0&&(b=i-1n);let v,E=!1,A=er(async()=>{if(!E){try{v=await T(e,Yu,"createEventFilter")({address:t,args:r,event:n,events:s,strict:d,fromBlock:i})}catch{}E=!0;return}try{let k;if(v)k=await T(e,Wo,"getFilterChanges")({filter:v});else{let I=await T(e,$r,"getBlockNumber")({});b&&b!==I?k=await T(e,mi,"getLogs")({address:t,args:r,event:n,events:s,fromBlock:b+1n,toBlock:I}):k=[],b=I}if(k.length===0)return;if(o)x.onLogs(k);else for(let I of k)x.onLogs([I])}catch(k){v&&k instanceof Sr&&(E=!1),x.onError?.(k)}},{emitOnBegin:!0,interval:u});return async()=>{v&&await T(e,Jo,"uninstallFilter")({filter:v}),A()}})})():(()=>{let y=!0,x=()=>y=!1;return(async()=>{try{let b=(()=>{if(e.transport.type==="fallback"){let k=e.transport.transports.find(I=>I.config.type==="webSocket"||I.config.type==="ipc");return k?k.value:e.transport}return e.transport})(),v=s??(n?[n]:void 0),E=[];v&&(E=[v.flatMap(I=>Ir({abi:[I],eventName:I.name,args:r}))],n&&(E=E[0]));let{unsubscribe:A}=await b.subscribe({params:["logs",{address:t,topics:E}],onData(k){if(!y)return;let I=k.result;try{let{eventName:R,args:B}=ci({abi:v??[],data:I.data,topics:I.topics,strict:d}),M=tt(I,{args:B,eventName:R});c([M])}catch(R){let B,M;if(R instanceof pr||R instanceof xr){if(p)return;B=R.abiItem.name,M=R.abiItem.inputs?.some(O=>!("name"in O&&O.name))}let L=tt(I,{args:M?[]:{},eventName:B});c([L])}},onError(k){a?.(k)}});x=A,y||x()}catch(b){a?.(b)}})(),()=>x()})()}rt();function wx(e,{batch:t=!0,onError:r,onTransactions:o,poll:n,pollingInterval:s=e.pollingInterval}){return(typeof n<"u"?n:e.transport.type!=="webSocket"&&e.transport.type!=="ipc")?(()=>{let m=Z(["watchPendingTransactions",e.uid,t,s]);return it(m,{onTransactions:o,onError:r},u=>{let p,l=er(async()=>{try{if(!p)try{p=await T(e,Xu,"createPendingTransactionFilter")({});return}catch(h){throw l(),h}let d=await T(e,Wo,"getFilterChanges")({filter:p});if(d.length===0)return;if(t)u.onTransactions(d);else for(let h of d)u.onTransactions([h])}catch(d){u.onError?.(d)}},{emitOnBegin:!0,interval:s});return async()=>{p&&await T(e,Jo,"uninstallFilter")({filter:p}),l()}})})():(()=>{let m=!0,u=()=>m=!1;return(async()=>{try{let{unsubscribe:p}=await e.transport.subscribe({params:["newPendingTransactions"],onData(l){if(!m)return;let d=l.result;o([d])},onError(l){r?.(l)}});u=p,m||u()}catch(p){r?.(p)}})(),()=>u()})()}function Cx(e){let{scheme:t,statement:r,...o}=e.match(jS)?.groups??{},{chainId:n,expirationTime:s,issuedAt:i,notBefore:a,requestId:c,...m}=e.match(GS)?.groups??{},u=e.split("Resources:")[1]?.split(`
- `).slice(1);return{...o,...m,...n?{chainId:Number(n)}:{},...s?{expirationTime:new Date(s)}:{},...i?{issuedAt:new Date(i)}:{},...a?{notBefore:new Date(a)}:{},...c?{requestId:c}:{},...u?{resources:u}:{},...t?{scheme:t}:{},...r?{statement:r}:{}}}var jS=/^(?:(?<scheme>[a-zA-Z][a-zA-Z0-9+-.]*):\/\/)?(?<domain>[a-zA-Z0-9+-.]*(?::[0-9]{1,5})?) (?:wants you to sign in with your Ethereum account:\n)(?<address>0x[a-fA-F0-9]{40})\n\n(?:(?<statement>.*)\n\n)?/,GS=/(?:URI: (?<uri>.+))\n(?:Version: (?<version>.+))\n(?:Chain ID: (?<chainId>\d+))\n(?:Nonce: (?<nonce>[a-zA-Z0-9]+))\n(?:Issued At: (?<issuedAt>.+))(?:\nExpiration Time: (?<expirationTime>.+))?(?:\nNot Before: (?<notBefore>.+))?(?:\nRequest ID: (?<requestId>.+))?/;$t();kn();function Ex(e){let{address:t,domain:r,message:o,nonce:n,scheme:s,time:i=new Date}=e;if(r&&o.domain!==r||n&&o.nonce!==n||s&&o.scheme!==s||o.expirationTime&&i>=o.expirationTime||o.notBefore&&i<o.notBefore)return!1;try{if(!o.address||!te(o.address,{strict:!1})||t&&!Xt(o.address,t))return!1}catch{return!1}return!0}async function Sx(e,t){let{address:r,domain:o,message:n,nonce:s,scheme:i,signature:a,time:c=new Date,...m}=t,u=Cx(n);if(!u.address||!Ex({address:r,domain:o,message:u,nonce:s,scheme:i,time:c}))return!1;let l=Si(n);return en(e,{address:u.address,hash:l,signature:a,...m})}Tt();async function Ti(e,{serializedTransaction:t,throwOnReceiptRevert:r,timeout:o}){let n=await e.request({method:"eth_sendRawTransactionSync",params:o?[t,S(o)]:[t]},{retryCount:0}),i=(e.chain?.formatters?.transactionReceipt?.format||oa)(n);if(i.status==="reverted"&&r)throw new is({receipt:i});return i}function kx(e){return{call:t=>Tr(e,t),createAccessList:t=>Zu(e,t),createBlockFilter:()=>gb(e),createContractEventFilter:t=>cu(e,t),createEventFilter:t=>Yu(e,t),createPendingTransactionFilter:()=>Xu(e),estimateContractGas:t=>ly(e,t),estimateGas:t=>ai(e,t),getBalance:t=>yb(e,t),getBlobBaseFee:()=>bb(e),getBlock:t=>st(e,t),getBlockNumber:t=>$r(e,t),getBlockTransactionCount:t=>xb(e,t),getBytecode:t=>Ba(e,t),getChainId:()=>Ct(e),getCode:t=>Ba(e,t),getContractEvents:t=>yu(e,t),getEip712Domain:t=>vb(e,t),getEnsAddress:t=>ab(e,t),getEnsAvatar:t=>fb(e,t),getEnsName:t=>db(e,t),getEnsResolver:t=>hb(e,t),getEnsText:t=>Ju(e,t),getFeeHistory:t=>Cb(e,t),estimateFeesPerGas:t=>uy(e,t),getFilterChanges:t=>Wo(e,t),getFilterLogs:t=>Eb(e,t),getGasPrice:()=>si(e),getLogs:t=>mi(e,t),getProof:t=>sx(e,t),estimateMaxPriorityFeePerGas:t=>my(e,t),getStorageAt:t=>ix(e,t),getTransaction:t=>_i(e,t),getTransactionConfirmations:t=>ax(e,t),getTransactionCount:t=>ii(e,t),getTransactionReceipt:t=>Ai(e,t),multicall:t=>cx(e,t),prepareTransactionRequest:t=>_r(e,t),readContract:t=>De(e,t),sendRawTransaction:t=>vi(e,t),sendRawTransactionSync:t=>Ti(e,t),simulate:t=>Ha(e,t),simulateBlocks:t=>Ha(e,t),simulateCalls:t=>hx(e,t),simulateContract:t=>eb(e,t),verifyHash:t=>en(e,t),verifyMessage:t=>yx(e,t),verifySiweMessage:t=>Sx(e,t),verifyTypedData:t=>bx(e,t),uninstallFilter:t=>Jo(e,t),waitForTransactionReceipt:t=>Tp(e,t),watchBlocks:t=>xx(e,t),watchBlockNumber:t=>Pp(e,t),watchContractEvent:t=>nb(e,t),watchEvent:t=>vx(e,t),watchPendingTransactions:t=>wx(e,t)}}function Dn(e){let{key:t="public",name:r="Public Client"}=e;return Gu({...e,key:t,name:r,type:"publicClient"}).extend(kx)}D();async function Ix(e,{chain:t}){let{id:r,name:o,nativeCurrency:n,rpcUrls:s,blockExplorers:i}=t;await e.request({method:"wallet_addEthereumChain",params:[{chainId:S(r),chainName:o,nativeCurrency:n,rpcUrls:s.default.http,blockExplorerUrls:i?Object.values(i).map(({url:a})=>a):void 0}]},{dedupe:!0,retryCount:0})}$u();function _x(e,t){let{abi:r,args:o,bytecode:n,...s}=t,i=An({abi:r,args:o,bytecode:n});return Zo(e,{...s,...s.authorizationList?{to:null}:{},data:i})}To();async function Ax(e){return e.account?.type==="local"?[e.account.address]:(await e.request({method:"eth_accounts"},{dedupe:!0})).map(r=>Yr(r))}ke();D();async function Px(e,t={}){let{account:r=e.account,chainId:o}=t,n=r?V(r):void 0,s=o?[n?.address,[S(o)]]:[n?.address],i=await e.request({method:"wallet_getCapabilities",params:s}),a={};for(let[c,m]of Object.entries(i)){a[Number(c)]={};for(let[u,p]of Object.entries(m))u==="addSubAccount"&&(u="unstable_addSubAccount"),a[Number(c)][u]=p}return typeof o=="number"?a[o]:a}async function Tx(e){return await e.request({method:"wallet_getPermissions"},{dedupe:!0})}ke();kn();async function $p(e,t){let{account:r=e.account,chainId:o,nonce:n}=t;if(!r)throw new We({docsPath:"/docs/eip7702/prepareAuthorization"});let s=V(r),i=(()=>{if(t.executor)return t.executor==="self"?t.executor:V(t.executor)})(),a={address:t.contractAddress??t.address,chainId:o,nonce:n};return typeof a.chainId>"u"&&(a.chainId=e.chain?.id??await T(e,Ct,"getChainId")({})),typeof a.nonce>"u"&&(a.nonce=await T(e,ii,"getTransactionCount")({address:s.address,blockTag:"pending"}),(i==="self"||i?.address&&Xt(i.address,s.address))&&(a.nonce+=1)),a}To();async function $x(e){return(await e.request({method:"eth_requestAccounts"},{dedupe:!0,retryCount:0})).map(r=>Cs(r))}async function Rx(e,t){return e.request({method:"wallet_requestPermissions",params:[t]},{retryCount:0})}async function Mx(e,t){let{chain:r=e.chain}=t,o=t.timeout??Math.max((r?.blockTime??0)*3,5e3),n=await Lu(e,t);return await Uu(e,{...t,id:n.id,timeout:o})}ke();G();Tt();ri();Io();ws();oo();var Ad=new Vt(128);async function Rp(e,t){let{account:r=e.account,chain:o=e.chain,accessList:n,authorizationList:s,blobs:i,data:a,gas:c,gasPrice:m,maxFeePerBlobGas:u,maxFeePerGas:p,maxPriorityFeePerGas:l,nonce:d,pollingInterval:h,throwOnReceiptRevert:g,type:y,value:x,...b}=t,v=t.timeout??Math.max((o?.blockTime??0)*3,5e3);if(typeof r>"u")throw new We({docsPath:"/docs/actions/wallet/sendTransactionSync"});let E=r?V(r):null;try{nt(t);let A=await(async()=>{if(t.to)return t.to;if(t.to!==null&&s&&s.length>0)return await Ho({authorization:s[0]}).catch(()=>{throw new w("`to` is required. Could not infer from `authorizationList`.")})})();if(E?.type==="json-rpc"||E===null){let k;o!==null&&(k=await T(e,Ct,"getChainId")({}),Es({currentChainId:k,chain:o}));let I=e.chain?.formatters?.transactionRequest?.format,B=(I||xt)({...kr(b,{format:I}),accessList:n,account:E,authorizationList:s,blobs:i,chainId:k,data:a,gas:c,gasPrice:m,maxFeePerBlobGas:u,maxFeePerGas:p,maxPriorityFeePerGas:l,nonce:d,to:A,type:y,value:x},"sendTransaction"),M=Ad.get(e.uid),L=M?"wallet_sendTransaction":"eth_sendTransaction",O=await(async()=>{try{return await e.request({method:L,params:[B]},{retryCount:0})}catch(re){if(M===!1)throw re;let W=re;if(W.name==="InvalidInputRpcError"||W.name==="InvalidParamsRpcError"||W.name==="MethodNotFoundRpcError"||W.name==="MethodNotSupportedRpcError")return await e.request({method:"wallet_sendTransaction",params:[B]},{retryCount:0}).then(ge=>(Ad.set(e.uid,!0),ge)).catch(ge=>{let Ot=ge;throw Ot.name==="MethodNotFoundRpcError"||Ot.name==="MethodNotSupportedRpcError"?(Ad.set(e.uid,!1),W):Ot});throw W}})(),U=await T(e,Tp,"waitForTransactionReceipt")({checkReplacement:!1,hash:O,pollingInterval:h,timeout:v});if(g&&U.status==="reverted")throw new is({receipt:U});return U}if(E?.type==="local"){let k=await T(e,_r,"prepareTransactionRequest")({account:E,accessList:n,authorizationList:s,blobs:i,chain:o,data:a,gas:c,gasPrice:m,maxFeePerBlobGas:u,maxFeePerGas:p,maxPriorityFeePerGas:l,nonce:d,nonceManager:E.nonceManager,parameters:[...Sa,"sidecars"],type:y,value:x,...b,to:A}),I=o?.serializers?.transaction,R=await E.signTransaction(k,{serializer:I});return await T(e,Ti,"sendRawTransactionSync")({serializedTransaction:R,throwOnReceiptRevert:g})}throw E?.type==="smart"?new Jt({metaMessages:["Consider using the `sendUserOperation` Action instead."],docsPath:"/docs/actions/bundler/sendUserOperation",type:"smart"}):new Jt({docsPath:"/docs/actions/wallet/sendTransactionSync",type:E?.type})}catch(A){throw A instanceof Jt?A:xi(A,{...t,account:E,chain:t.chain||void 0})}}async function Bx(e,t){let{id:r}=t;await e.request({method:"wallet_showCallsStatus",params:[r]})}ke();async function Fx(e,t){let{account:r=e.account}=t;if(!r)throw new We({docsPath:"/docs/eip7702/signAuthorization"});let o=V(r);if(!o.signAuthorization)throw new Jt({docsPath:"/docs/eip7702/signAuthorization",metaMessages:["The `signAuthorization` Action does not support JSON-RPC Accounts."],type:o.type});let n=await $p(e,t);return o.signAuthorization(n)}ke();D();async function Dx(e,{account:t=e.account,message:r}){if(!t)throw new We({docsPath:"/docs/actions/wallet/signMessage"});let o=V(t);if(o.signMessage)return o.signMessage({message:r});let n=typeof r=="string"?sr(r):r.raw instanceof Uint8Array?me(r.raw):r.raw;return e.request({method:"personal_sign",params:[n,o.address]},{retryCount:0})}ke();D();Io();oo();async function Nx(e,t){let{account:r=e.account,chain:o=e.chain,...n}=t;if(!r)throw new We({docsPath:"/docs/actions/wallet/signTransaction"});let s=V(r);nt({account:s,...t});let i=await T(e,Ct,"getChainId")({});o!==null&&Es({currentChainId:i,chain:o});let c=(o?.formatters||e.chain?.formatters)?.transactionRequest?.format||xt;return s.signTransaction?s.signTransaction({...n,chainId:i},{serializer:e.chain?.serializers?.transaction}):await e.request({method:"eth_signTransaction",params:[{...c({...n,account:s},"signTransaction"),chainId:S(i),from:s.address}]},{retryCount:0})}ke();async function Lx(e,t){let{account:r=e.account,domain:o,message:n,primaryType:s}=t;if(!r)throw new We({docsPath:"/docs/actions/wallet/signTypedData"});let i=V(r),a={EIP712Domain:sp({domain:o}),...t.types};if(np({domain:o,message:n,primaryType:s,types:a}),i.signTypedData)return i.signTypedData({domain:o,message:n,primaryType:s,types:a});let c=$b({domain:o,message:n,primaryType:s,types:a});return e.request({method:"eth_signTypedData_v4",params:[i.address,c]},{retryCount:0})}D();async function Ox(e,{id:t}){await e.request({method:"wallet_switchEthereumChain",params:[{chainId:S(t)}]},{retryCount:0})}async function Ux(e,t){return await e.request({method:"wallet_watchAsset",params:t},{retryCount:0})}async function zx(e,t){return Pn.internal(e,Rp,"sendTransactionSync",t)}function Hx(e){return{addChain:t=>Ix(e,t),deployContract:t=>_x(e,t),getAddresses:()=>Ax(e),getCallsStatus:t=>Ou(e,t),getCapabilities:t=>Px(e,t),getChainId:()=>Ct(e),getPermissions:()=>Tx(e),prepareAuthorization:t=>$p(e,t),prepareTransactionRequest:t=>_r(e,t),requestAddresses:()=>$x(e),requestPermissions:t=>Rx(e,t),sendCalls:t=>Lu(e,t),sendCallsSync:t=>Mx(e,t),sendRawTransaction:t=>vi(e,t),sendRawTransactionSync:t=>Ti(e,t),sendTransaction:t=>Zo(e,t),sendTransactionSync:t=>Rp(e,t),showCallsStatus:t=>Bx(e,t),signAuthorization:t=>Fx(e,t),signMessage:t=>Dx(e,t),signTransaction:t=>Nx(e,t),signTypedData:t=>Lx(e,t),switchChain:t=>Ox(e,t),waitForCallsStatus:t=>Uu(e,t),watchAsset:t=>Ux(e,t),writeContract:t=>Pn(e,t),writeContractSync:t=>zx(e,t)}}function Va(e){let{key:t="wallet",name:r="Wallet Client",transport:o}=e;return Gu({...e,key:t,name:r,transport:o,type:"walletClient"}).extend(Hx)}function jx({key:e,methods:t,name:r,request:o,retryCount:n=3,retryDelay:s=150,timeout:i,type:a},c){let m=ju();return{config:{key:e,methods:t,name:r,request:o,retryCount:n,retryDelay:s,timeout:i,type:a},request:Ib(o,{methods:t,retryCount:n,retryDelay:s,uid:m}),value:c}}Cn();G();var Mp=class extends w{constructor(){super("No URL was provided to the Transport. Please provide a valid RPC URL to the Transport.",{docsPath:"/docs/clients/intro",name:"UrlRequiredError"})}};Nf();function co(e,t={}){let{batch:r,fetchFn:o,fetchOptions:n,key:s="http",methods:i,name:a="HTTP JSON-RPC",onFetchRequest:c,onFetchResponse:m,retryDelay:u,raw:p}=t;return({chain:l,retryCount:d,timeout:h})=>{let{batchSize:g=1e3,wait:y=0}=typeof r=="object"?r:{},x=t.retryCount??d,b=h??t.timeout??1e4,v=e||l?.rpcUrls.default.http[0];if(!v)throw new Mp;let E=Ab(v,{fetchFn:o,fetchOptions:n,onRequest:c,onResponse:m,timeout:b});return jx({key:s,methods:i,name:a,async request({method:A,params:k}){let I={method:A,params:k},{schedule:R}=Mu({id:v,wait:y,shouldSplitBatch(O){return O.length>g},fn:O=>E.request({body:O}),sort:(O,U)=>O.id-U.id}),B=async O=>r?R(O):[await E.request({body:O})],[{error:M,result:L}]=await B(I);if(p)return{error:M,result:L};if(M)throw new Do({body:I,error:M,url:v});return L},retryCount:x,retryDelay:u,timeout:b,type:"http"},{fetchOptions:n,url:v})}}Pt();D();import{secp256k1 as qS}from"@noble/curves/secp256k1";mr();$t();function Gx(e){if(typeof e=="string"){if(!te(e,{strict:!1}))throw new ae({address:e});return{address:e,type:"json-rpc"}}if(!te(e.address,{strict:!1}))throw new ae({address:e.address});return{address:e.address,nonceManager:e.nonceManager,sign:e.sign,signAuthorization:e.signAuthorization,signMessage:e.signMessage,signTransaction:e.signTransaction,signTypedData:e.signTypedData,source:"custom",type:"local"}}Pt();qe();D();import{secp256k1 as VS}from"@noble/curves/secp256k1";var Pd=!1;async function Rr({hash:e,privateKey:t,to:r="object"}){let{r:o,s:n,recovery:s}=VS.sign(e.slice(2),t.slice(2),{lowS:!0,extraEntropy:pe(Pd,{strict:!1})?Ue(Pd):Pd}),i={r:S(o,{size:32}),s:S(n,{size:32}),v:s?28n:27n,yParity:s};return r==="bytes"||r==="hex"?Ap({...i,to:r}):i}async function Vx(e){let{chainId:t,nonce:r,privateKey:o,to:n="object"}=e,s=e.contractAddress??e.address,i=await Rr({hash:pu({address:s,chainId:t,nonce:r}),privateKey:o,to:n});return n==="object"?{address:s,chainId:t,nonce:r,...i}:i}async function qx({message:e,privateKey:t}){return await Rr({hash:Si(e),privateKey:t,to:"hex"})}qt();async function Kx(e){let{privateKey:t,transaction:r,serializer:o=um}=e,n=r.type==="eip4844"?{...r,sidecars:!1}:r,s=await Rr({hash:ce(await o(n)),privateKey:t});return await o(r,s)}async function Wx(e){let{privateKey:t,...r}=e;return await Rr({hash:ip(r),privateKey:t,to:"hex"})}function qa(e,t={}){let{nonceManager:r}=t,o=me(qS.getPublicKey(e.slice(2),!1)),n=mu(o);return{...Gx({address:n,nonceManager:r,async sign({hash:i}){return Rr({hash:i,privateKey:e,to:"hex"})},async signAuthorization(i){return Vx({...i,privateKey:e})},async signMessage({message:i}){return qx({message:i,privateKey:e})},async signTransaction(i,{serializer:a}={}){return Kx({privateKey:e,transaction:i,serializer:a})},async signTypedData(i){return Wx({...i,privateKey:e})}}),publicKey:o,source:"privateKey"}}var Ste=Zi(Rd(),1);import{z as _e}from"zod";var rr=Zi(Rd(),1),K_=Zi(Jx(),1),W_=Zi(D1(),1);import{z as Fi}from"zod";import{z as dt}from"zod";var Mk=Ze.object({detail:Ze.union([Ze.string(),Ze.array(Ze.object({msg:Ze.string(),type:Ze.string().optional(),ctx:Ze.record(Ze.unknown()).optional(),loc:Ze.array(Ze.union([Ze.string(),Ze.number()])).optional(),input:Ze.unknown().optional()}).passthrough()),Ze.record(Ze.unknown())]).optional(),type:Ze.string().optional(),code:Ze.string().optional()}),Lr=class extends Error{constructor(e,t){super(e),this.name=this.constructor.name,this.status=t.status,this.statusText=t.statusText,this.detail=t.detail,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}},zd=class Lp extends Lr{constructor(t,r){super(t,{status:r?.status??0,statusText:r?.statusText??"Unknown Error",detail:r?.detail||t}),this.name="RequestError",this.isRequestError=!0,this.data=r?.data,this.request=r?.request,this.response=r?.response,this.code=r?.code,this.type=r?.type}static fromFetchError(t){let r=Mk.safeParse(t.data);return r.success?new Lp(t.message,{status:t.status??void 0,statusText:t.statusText??void 0,data:t.data,request:t.request??void 0,response:t.response??void 0,detail:r.data.detail,code:r.data.code??void 0,type:r.data.type??void 0}):new Lp(t.message,{status:t.status??void 0,statusText:t.statusText??void 0,data:t.data,request:t.request??void 0,response:t.response??void 0,detail:t.data?.detail||"Unknown API error",code:t.status?.toString()??void 0})}static fromError(t,r){return new Lp(t.message,{request:r??void 0,detail:t.message})}},Bk=class extends Lr{constructor(e,t){super(e,t),this.isValidationError=!0,this.validationErrors=t.validationErrors}},Fk=class extends Lr{constructor(){super(...arguments),this.isAuthError=!0}},Up=class extends Lr{constructor(){super(...arguments),this.isBusinessError=!0}},Dk=class extends Lr{constructor(){super(...arguments),this.isServerError=!0}},Nk=class extends Lr{constructor(){super(...arguments),this.isUnknownError=!0}};function Lk(e){if(!e||!Array.isArray(e))return"unknown";let t=e.filter(r=>typeof r=="string"?!["body","query","path","header"].includes(r):!0);return t.length>0?t.join("."):"unknown"}function H1(e){if(!Array.isArray(e))return{errors:[],message:typeof e=="string"?e:"Validation error"};let t=e.map((n,s)=>{let i=Lk(n.loc),a=i;return i==="unknown"&&n.type&&(a=n.type==="missing"?"required field":n.type),{field:a,message:n.msg,type:n.type,context:n.ctx}}),r=t.length,o=r===1?`Validation failed: ${t[0].message}`:`Validation failed (${r} issue${r>1?"s":""})`;return{errors:t,message:o}}function Ok(e){return e===422?"validation":e===401||e===403?"auth":e>=400&&e<500?"business":e>=500?"server":"unknown"}function Uk(e,t,r){if(e===422&&Array.isArray(t)){let{message:o}=H1(t);return o}if(typeof t=="string")return t;if(t&&typeof t=="object"&&"message"in t){let o=t.message;if(typeof o=="string")return o}return r}function zk(e){let t=e.status??0,r=e.statusText??"Unknown Error",o=e.detail,n=Hk(o);if(n)return new Gd(n.message,{status:t,statusText:r,detail:o,errorCode:n.error_code,structuredDetails:n.details,suggestions:n.suggestions,links:n.links});let s=Ok(t),i=Uk(t,o,e.message),a={status:t,statusText:r,detail:o};if(s==="validation"&&Array.isArray(o)){let{errors:c}=H1(o);return new Bk(i,{...a,validationErrors:c})}return s==="auth"?new Fk(i,a):s==="business"?new Up(i,a):s==="server"?new Dk(i,a):new Nk(i,a)}var Gd=class extends Up{constructor(e,t){super(e,t),this.isResourceError=!0,this.errorCode=t.errorCode,this.structuredDetails=t.structuredDetails,this.suggestions=t.suggestions,this.links=t.links}};function Hk(e){if(!e||typeof e!="object")return null;let t=e;return t.error_code&&typeof t.error_code=="string"&&t.message&&typeof t.message=="string"?{error_code:t.error_code,message:t.message,details:t.details,suggestions:t.suggestions,links:t.links}:null}function j1(e,t){let{showErrorCode:r=!0,showSuggestions:o=!0,showLinks:n=!0}=t??{},s=[];return r&&e.errorCode?s.push(`Error [${e.errorCode}]: ${e.message}`):s.push(e.message),e.structuredDetails&&e.structuredDetails.length>0&&(s.push(""),s.push("Details:"),e.structuredDetails.forEach(i=>{i.message?s.push(`  - ${i.message}`):i.field&&i.value!==void 0&&s.push(`  - ${i.field}: ${i.value}`)})),o&&e.suggestions&&e.suggestions.length>0&&(s.push(""),s.push("Suggestions:"),e.suggestions.forEach(i=>{s.push(`  - ${i}`)})),n&&e.links&&e.links.length>0&&(s.push(""),s.push("Learn more:"),e.links.forEach(i=>{s.push(`  - ${i.label}: ${i.url}`)})),s.join(`
`)}var Xa=["2025-05-31","2025-10-28"],Mi=(0,z1.default)("phala::api-client");function jk(e){return Object.entries(e).map(([t,r])=>`    -H "${t}: ${r}"`).join(`
`)}function Gk(e){return e?`    -d '${(typeof e=="string"?e:JSON.stringify(e,null,2)).replace(/'/g,"\\'")}'`:""}function N1(e,t,r,o){let n=[];r.forEach((a,c)=>{n.push(`${c}: ${a}`)});let s=n.join(`
`),i=typeof o=="string"?o:JSON.stringify(o,null,2);return[`< HTTP/1.1 ${e} ${t}`,s?`< ${s.replace(/\n/g,`
< `)}`:"","",i].filter(Boolean).join(`
`)}var Vk=class{constructor(e={}){this.emitter=hh();let t={...e,apiKey:e.apiKey||process?.env?.PHALA_CLOUD_API_KEY,baseURL:e.baseURL||process?.env?.PHALA_CLOUD_API_PREFIX||"https://cloud-api.phala.network/api/v1"},r=t.version&&Xa.includes(t.version)?t.version:Xa[Xa.length-1];this.config=t;let{apiKey:o,baseURL:n,timeout:s,headers:i,useCookieAuth:a,onResponseError:c,...m}=t,u={"X-Phala-Version":r,"Content-Type":"application/json"};i&&typeof i=="object"&&Object.entries(i).forEach(([p,l])=>{typeof l=="string"&&(u[p]=l)}),!a&&o&&(u["X-API-Key"]=o),this.fetchInstance=Rk.create({baseURL:n,timeout:s||3e4,headers:u,...a?{credentials:"include"}:{},...m,onRequest({request:p,options:l}){if(Mi.enabled){let d=l.method||"GET",h=typeof p=="string"?p:p.url,g=h.startsWith("http")?h:`${n}${h}`,y={};l.headers&&typeof l.headers=="object"&&Object.entries(l.headers).forEach(([b,v])=>{typeof v=="string"&&(y[b]=v)});let x=[`> curl -X ${d} "${g}"`,jk(y),l.body?Gk(l.body):""].filter(Boolean).join(`
`);Mi(`
=== REQUEST ===
%s
`,x)}},onResponse({request:p,response:l,options:d}){if(Mi.enabled){let h=d.method||"GET",g=typeof p=="string"?p:p.url;Mi(`
=== RESPONSE [%s %s] (%dms) ===
%s
`,h,g,l.headers.get("x-response-time")||"?",N1(l.status,l.statusText,l.headers,l._data))}},onResponseError:({request:p,response:l,options:d})=>{if(console.warn(`HTTP ${l.status}: ${l.url}`),Mi.enabled){let h=d.method||"GET",g=typeof p=="string"?p:p.url;Mi(`
=== ERROR RESPONSE [%s %s] ===
%s
`,h,g,N1(l.status,l.statusText,l.headers,l._data))}c&&c({request:p,response:l,options:d})}})}get raw(){return this.fetchInstance}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}once(e,t){let r=o=>{t(o),this.emitter.off(e,r)};this.emitter.on(e,r)}async get(e,t){try{return await this.fetchInstance(e,{...t,method:"GET"})}catch(r){let o=this.convertToRequestError(r);throw this.emitError(o)}}async post(e,t,r){try{return await this.fetchInstance(e,{...r,method:"POST",body:t})}catch(o){let n=this.convertToRequestError(o);throw this.emitError(n)}}async put(e,t,r){try{return await this.fetchInstance(e,{...r,method:"PUT",body:t})}catch(o){let n=this.convertToRequestError(o);throw this.emitError(n)}}async patch(e,t,r){try{return await this.fetchInstance(e,{...r,method:"PATCH",body:t})}catch(o){let n=this.convertToRequestError(o);throw this.emitError(n)}}async delete(e,t){try{return await this.fetchInstance(e,{...t,method:"DELETE"})}catch(r){let o=this.convertToRequestError(r);throw this.emitError(o)}}async request(e,t){let{body:r,...o}=t||{};try{return await this.fetchInstance(e,{...o,body:r})}catch(n){let s=this.convertToRequestError(n);throw this.emitError(s)}}async requestFull(e,t){let{body:r,...o}=t||{},n=await this.fetchInstance.raw(e,{...o,body:r,ignoreResponseError:!0});return{status:n.status,statusText:n.statusText,headers:n.headers,data:n._data,ok:n.ok}}convertToRequestError(e){return e&&typeof e=="object"&&"data"in e?zd.fromFetchError(e):e instanceof Error?zd.fromError(e):new zd("Unknown error occurred",{detail:"Unknown error occurred"})}emitError(e){let t=zk(e);return this.emitter.emit("error",t),t}async safeRequest(e){try{return{success:!0,data:await e()}}catch(t){if(t instanceof Lr)return{success:!1,error:t};let r=this.convertToRequestError(t);return this.emitError(r),{success:!1,error:r}}}async safeGet(e,t){return this.safeRequest(()=>this.get(e,t))}async safePost(e,t,r){return this.safeRequest(()=>this.post(e,t,r))}async safePut(e,t,r){return this.safeRequest(()=>this.put(e,t,r))}async safePatch(e,t,r){return this.safeRequest(()=>this.patch(e,t,r))}async safeDelete(e,t){return this.safeRequest(()=>this.delete(e,t))}async safeRequestMethod(e,t){return this.safeRequest(()=>this.request(e,t))}async safeRequestFull(e,t){return this.safeRequest(()=>this.requestFull(e,t))}extend(e){let t=typeof e=="function"?e(this):e,r=Object.create(this);for(let[o,n]of Object.entries(t))typeof n=="function"&&(r[o]=(...s)=>n(this,...s));return r}};function qk(e={}){return new Vk(e)}function G1(e){if(e?.schema!==void 0&&e?.schema!==!1&&(typeof e.schema!="object"||e.schema===null||!("parse"in e.schema)||typeof e.schema.parse!="function"))throw new Error("Invalid schema: must be a Zod schema object, false, or undefined")}function V1(e){if(e?.schema!==void 0&&e?.schema!==!1&&(typeof e.schema!="object"||e.schema===null||!("parse"in e.schema)||typeof e.schema.parse!="function"))return{success:!1,error:{name:"ZodError",message:"Invalid schema: must be a Zod schema object, false, or undefined",issues:[{code:"invalid_type",expected:"object",received:typeof e.schema,path:["schema"],message:"Invalid schema: must be a Zod schema object, false, or undefined"}]}}}function q1(e,t){function r(i,a){return o(i,a)}async function o(i,a){G1(a);let c=await t(i);return a?.schema===!1?c:(a?.schema||e).parse(c)}function n(i,a){return s(i,a)}async function s(i,a){let c=V1(a);if(c)return c;let m=await(async()=>{try{return{success:!0,data:await t(i)}}catch(p){return p&&typeof p=="object"&&"status"in p?{success:!1,error:p}:p&&typeof p=="object"&&"issues"in p?{success:!1,error:p}:{success:!1,error:{name:"Error",message:p instanceof Error?p.message:String(p)}}}})();return m.success?a?.schema===!1?{success:!0,data:m.data}:(a?.schema||e).safeParse(m.data):m}return{action:r,safeAction:n}}function X(e,t){function r(i,...a){let[c,m]=a;return o(i,c,m)}async function o(i,a,c){G1(c);let m=await t(i,a);return c?.schema===!1?m:(c?.schema||e).parse(m)}function n(i,...a){let[c,m]=a;return s(i,c,m)}async function s(i,a,c){let m=V1(c);if(m)return m;let u=await(async()=>{try{return{success:!0,data:await t(i,a)}}catch(l){return l&&typeof l=="object"&&"status"in l?{success:!1,error:l}:l&&typeof l=="object"&&"issues"in l?{success:!1,error:l}:{success:!1,error:{name:"Error",message:l instanceof Error?l.message:String(l)}}}})();return u.success?c?.schema===!1?{success:!0,data:u.data}:(c?.schema||e).safeParse(u.data):u}return{action:r,safeAction:n}}var Kk=on.object({username:on.string(),email:on.string(),credits:on.number(),granted_credits:on.number(),avatar:on.string(),team_name:on.string(),team_tier:on.string()}).passthrough(),{action:Wk,safeAction:uo}=q1(Kk,async e=>await e.get("/auth/me")),Jk={[iu.id]:iu,[pa.id]:pa,[pm.id]:pm},Zk=nn.object({id:nn.string(),slug:nn.string().nullable(),url:nn.string(),version:nn.string(),chain_id:nn.number().nullable(),kms_contract_address:nn.string().nullable().transform(e=>e),gateway_app_id:nn.string().nullable().transform(e=>e)}).passthrough(),Or=Zk.transform(e=>{if(e.chain_id!=null){let t=Jk[e.chain_id];if(t)return{...e,chain:t}}return e}),Yk=J.object({name:J.string(),is_dev:J.boolean(),version:J.union([J.tuple([J.number(),J.number(),J.number()]),J.tuple([J.number(),J.number(),J.number(),J.number()])]),os_image_hash:J.string().nullable().optional()}).passthrough(),Xk=J.object({teepod_id:J.number(),name:J.string(),listed:J.boolean(),resource_score:J.number(),remaining_vcpu:J.number(),remaining_memory:J.number(),remaining_cvm_slots:J.number(),images:J.array(Yk),support_onchain_kms:J.boolean().optional(),fmspc:J.string().nullable().optional(),device_id:J.string().nullable().optional(),region_identifier:J.string().nullable().optional(),default_kms:J.string().nullable().optional(),kms_list:J.array(J.string()).default([])}).passthrough(),Qk=J.object({max_instances:J.number().nullable().optional(),max_vcpu:J.number().nullable().optional(),max_memory:J.number().nullable().optional(),max_disk:J.number().nullable().optional()}).passthrough(),e8=J.object({tier:J.string(),capacity:Qk,nodes:J.array(Xk),kms_list:J.array(Or)}).passthrough(),{action:t8,safeAction:Qa}=q1(e8,async e=>await e.get("/teepods/available")),K1=Pe.object({id:Pe.string(),name:Pe.string(),description:Pe.string(),vcpu:Pe.number(),memory_mb:Pe.number(),hourly_rate:Pe.string(),requires_gpu:Pe.boolean(),default_disk_size_gb:Pe.number().default(20),family:Pe.string().nullable()}).passthrough(),r8=Pe.object({name:Pe.string(),items:Pe.array(K1),total:Pe.number()}).strict(),o8=Pe.object({result:Pe.array(r8)}).strict(),n8=Pe.object({items:Pe.array(K1),total:Pe.number(),family:Pe.string()}).strict(),s8=Pe.object({family:Pe.string()}).strict(),{action:i8,safeAction:a8}=X(o8,async e=>await e.get("/instance-types")),{action:c8,safeAction:m8}=X(n8,async(e,t)=>{let r=s8.parse(t);return await e.get(`/instance-types/${r.family}`)}),W1=Dt.object({id:Dt.string(),name:Dt.string(),slug:Dt.string().nullable(),tier:Dt.string(),role:Dt.string(),created_at:Dt.string()}).passthrough(),u8=Dt.object({has_more:Dt.boolean(),next_cursor:Dt.string().nullable(),total:Dt.number().nullable()}).passthrough(),p8=Dt.object({data:Dt.array(W1),pagination:u8}).passthrough(),{action:l8,safeAction:f8}=X(p8,async(e,t)=>{let r=new URLSearchParams;t?.cursor&&r.append("cursor",t.cursor),t?.limit&&r.append("limit",t.limit.toString());let o=r.toString()?`/workspaces?${r.toString()}`:"/workspaces";return await e.get(o)}),{action:d8,safeAction:h8}=X(W1,async(e,t)=>await e.get(`/workspaces/${t}`)),g8=P.object({id:P.string(),name:P.string(),status:P.string(),uptime:P.string(),app_url:P.string().nullable(),app_id:P.string(),instance_id:P.string().nullable(),configuration:P.any().optional(),exited_at:P.string().nullable(),boot_progress:P.string().nullable(),boot_error:P.string().nullable(),shutdown_progress:P.string().nullable(),image_version:P.string().nullable()}),y8=P.object({id:P.number(),username:P.string()}),Vd=P.object({id:P.number(),name:P.string(),region_identifier:P.string().nullable().optional()}),J1=P.object({vcpu:P.number(),memory:P.number(),disk_size:P.number(),gpu_count:P.number().default(0)}),Z1=P.object({app:P.string(),instance:P.string()}),b8=P.object({hosted:g8,name:P.string(),managed_user:y8.nullable(),node:Vd.nullable(),listed:P.boolean().default(!1),status:P.string(),in_progress:P.boolean().default(!1),dapp_dashboard_url:P.string().nullable(),syslog_endpoint:P.string().nullable(),allow_upgrade:P.boolean().default(!1),project_id:P.string().nullable(),project_type:P.string().nullable(),billing_period:P.string().nullable(),kms_info:Or.nullable(),vcpu:P.number().nullable(),memory:P.number().nullable(),disk_size:P.number().nullable(),gateway_domain:P.string().nullable(),public_urls:P.array(Z1),machine_info:J1.nullable().optional(),updated_at:P.string().nullable().optional()}),Y1=P.object({id:P.number(),name:P.string(),status:P.string(),in_progress:P.boolean().optional().default(!1),teepod_id:P.number().nullable(),teepod:Vd.optional().nullable(),app_id:P.string(),vm_uuid:P.string().nullable(),instance_id:P.string().nullable(),vcpu:P.number(),memory:P.number(),disk_size:P.number(),base_image:P.string().nullable(),encrypted_env_pubkey:P.string().nullable(),listed:P.boolean().optional().default(!1),project_id:P.string().optional().nullable(),project_type:P.string().optional().nullable(),instance_type:P.string().optional().nullable(),public_sysinfo:P.boolean().optional().default(!1),public_logs:P.boolean().optional().default(!1),dapp_dashboard_url:P.string().optional().nullable(),syslog_endpoint:P.string().optional().nullable(),kms_info:Or.optional().nullable(),contract_address:P.string().optional().nullable(),deployer_address:P.string().optional().nullable(),scheduled_delete_at:P.string().optional().nullable(),public_urls:P.array(Z1).optional().default([]),gateway_domain:P.string().optional().nullable(),machine_info:J1.optional().nullable(),updated_at:P.string().optional().nullable()}),zp=P.object({id:P.number(),name:P.string(),status:P.string(),teepod_id:P.number(),teepod:Vd.optional().nullable(),user_id:P.number().optional().nullable(),app_id:P.string(),vm_uuid:P.string().nullable(),instance_id:P.string().nullable(),app_url:P.string().optional().nullable().default(null),base_image:P.string().nullable(),vcpu:P.number(),memory:P.number(),disk_size:P.number(),manifest_version:P.number().optional().nullable().default(2),version:P.string().optional().nullable().default("1.0.0"),runner:P.string().optional().nullable().default("docker-compose"),docker_compose_file:P.string().optional().nullable(),features:P.array(P.string()).optional().nullable().default(["kms","tproxy-net"]),created_at:P.string(),encrypted_env_pubkey:P.string().nullable()});function Li(e){return typeof e!="string"||e.length<5||e.length>63?!1:/^[a-zA-Z](?!.*--)([a-zA-Z0-9-]*[a-zA-Z0-9])?$/.test(e)}function X1(e){if(typeof e!="string")return Np();let t=e;return t=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),t=t.replace(/_/g,"-"),t=t.replace(/[^a-z0-9\s-]/gi,"-").replace(/\s+/g,"-"),t=t.replace(/-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),t.length===0||(/^\d/.test(t)&&(t=`dstack-app-${t}`),t.length<5&&(t=`dstack-app-${t}`),t=t.slice(0,63).replace(/-+$/,""),t.length===0)||!Li(t)?Np():t}function Np(){let e=Date.now().toString(36),t=Math.random().toString(36).substring(2,6);return`dstack-app-${e}-${t}`}var Ur=Bi.object({id:Bi.string().optional(),uuid:Bi.string().regex(/^[0-9a-f]{8}[-]?[0-9a-f]{4}[-]?4[0-9a-f]{3}[-]?[89ab][0-9a-f]{3}[-]?[0-9a-f]{12}$/i,"Invalid UUID format").optional(),app_id:Bi.string().optional(),instance_id:Bi.string().optional(),name:Bi.string().refine(Li,{message:"Name must be 5-63 characters, start with letter, and contain only letters/numbers/hyphens"}).optional()}),sn=e=>e.refine(t=>{let r=t;return!!(r.id||r.uuid||r.app_id||r.instance_id||r.name)},{message:"One of id, uuid, app_id, instance_id, or name must be provided"}),x8=sn(Ur),fe=x8.transform(e=>{let t;if(e.id)t=e.id;else if(e.uuid)t=e.uuid;else if(e.app_id)t=e.app_id;else if(e.instance_id)t=e.instance_id;else{if(e.name)return{cvmId:e.name};throw new Error("No valid identifier provided")}let r=/^[0-9a-f]{8}[-]?[0-9a-f]{4}[-]?4[0-9a-f]{3}[-]?[89ab][0-9a-f]{3}[-]?[0-9a-f]{12}$/i,o=/^[0-9a-f]{40}$/i,n;return r.test(t)?n=t.replace(/-/g,""):o.test(t)?n=`app_${t}`:n=t,{cvmId:n}}),v8=fe,{action:w8,safeAction:Se}=X(Y1,async(e,t)=>{let{cvmId:r}=v8.parse(t);return await e.get(`/cvms/${r}`)}),C8=tr.object({page:tr.number().int().min(1).optional(),page_size:tr.number().int().min(1).optional(),node_id:tr.number().int().min(1).optional(),teepod_id:tr.number().int().min(1).optional(),user_id:tr.string().optional()}).strict(),E8=tr.object({items:tr.array(b8),total:tr.number(),page:tr.number(),page_size:tr.number(),pages:tr.number()}).strict(),{action:S8,safeAction:Ln}=X(E8,async(e,t)=>{let r=C8.parse(t??{});return await e.get("/cvms/paginated",{params:r})}),k8=q.object({app_id:q.string().nullable().optional(),app_env_encrypt_pubkey:q.string().nullable().optional(),compose_hash:q.string(),kms_info:Or.nullable().optional(),fmspc:q.string().nullable().optional(),device_id:q.string().nullable().optional(),os_image_hash:q.string().nullable().optional(),instance_type:q.string().nullable().optional(),teepod_id:q.number().nullable().optional(),node_id:q.number().nullable().optional(),kms_id:q.string().nullable().optional()}).passthrough().transform(e=>{if("teepod_id"in e&&e.teepod_id!==void 0){let{teepod_id:t,...r}=e;return{...r,node_id:t}}return e}),Hd="Name must be 5-63 characters, start with letter, and contain only letters/numbers/hyphens",I8=q.object({node_id:q.number().optional(),teepod_id:q.number().optional(),region:q.string().optional(),name:q.string().min(5,Hd).max(63,Hd).refine(e=>Li(e),Hd),instance_type:q.string().optional(),image:q.string().optional(),vcpu:q.number().optional(),memory:q.number().optional(),disk_size:q.number().optional(),compose_file:q.object({allowed_envs:q.array(q.string()).optional(),pre_launch_script:q.string().optional(),docker_compose_file:q.string().optional(),name:q.string().optional().default(""),kms_enabled:q.boolean().optional(),public_logs:q.boolean().optional(),public_sysinfo:q.boolean().optional(),gateway_enabled:q.boolean().optional(),tproxy_enabled:q.boolean().optional()}),listed:q.boolean().optional(),kms_id:q.string().optional(),kms:q.enum(["PHALA","ETHEREUM","BASE"]).optional(),kms_contract:q.string().optional(),env_keys:q.array(q.string()).optional(),nonce:q.number().optional(),app_id:q.string().optional()}).passthrough().transform(e=>!e.instance_type&&!e.vcpu&&!e.memory?{...e,instance_type:"tdx.small"}:e);function _8(e){if(!e.compose_file)return e;let t={...e.compose_file};return typeof t.gateway_enabled=="boolean"&&typeof t.tproxy_enabled=="boolean"?delete t.tproxy_enabled:typeof t.tproxy_enabled=="boolean"&&typeof t.gateway_enabled>"u"&&(t.gateway_enabled=t.tproxy_enabled,delete t.tproxy_enabled,(typeof window<"u"?window.console:globalThis.console)&&console.warn("[phala/cloud] tproxy_enabled is deprecated, please use gateway_enabled instead. See docs for migration.")),{...e,compose_file:t}}var{action:A8,safeAction:qd}=X(k8,async(e,t)=>{let r=I8.parse(t),o=_8(r),n={...o};return typeof o.node_id=="number"?(n={...o,teepod_id:o.node_id},delete n.node_id):typeof o.teepod_id=="number"&&console.warn("[phala/cloud] teepod_id is deprecated, please use node_id instead."),await e.post("/cvms/provision",n)}),P8=Y.object({id:Y.number(),name:Y.string(),status:Y.string(),teepod_id:Y.number(),teepod:Y.object({id:Y.number(),name:Y.string()}).nullable(),user_id:Y.number().nullable(),app_id:Y.string().nullable(),vm_uuid:Y.string().nullable(),instance_id:Y.string().nullable(),app_url:Y.string().nullable().default(null),base_image:Y.string().nullable(),vcpu:Y.number(),memory:Y.number(),disk_size:Y.number(),manifest_version:Y.number().nullable().default(2),version:Y.string().nullable().default("1.0.0"),runner:Y.string().nullable().default("docker-compose"),docker_compose_file:Y.string().nullable(),features:Y.array(Y.string()).nullable().default(["kms","tproxy-net"]),created_at:Y.string(),encrypted_env_pubkey:Y.string().nullable().optional(),app_auth_contract_address:Y.string().nullable().optional(),deployer_address:Y.string().nullable().optional()}).passthrough(),Zee=Y.object({encrypted_env:Y.string().optional().nullable(),app_id:Y.string(),compose_hash:Y.string(),kms_id:Y.string().optional(),contract_address:Y.string().optional(),deployer_address:Y.string().optional(),env_keys:Y.array(Y.string()).optional().nullable()}).passthrough(),{action:T8,safeAction:Hp}=X(P8,async(e,t)=>await e.post("/cvms",t)),Q1=ft.object({allowed_envs:ft.array(ft.string()).optional(),docker_compose_file:ft.string(),features:ft.array(ft.string()).optional(),name:ft.string().optional(),manifest_version:ft.number().optional(),kms_enabled:ft.boolean().optional(),public_logs:ft.boolean().optional(),public_sysinfo:ft.boolean().optional(),tproxy_enabled:ft.boolean().optional(),pre_launch_script:ft.string().optional(),env_pubkey:ft.string().optional(),salt:ft.string().optional().nullable()}).passthrough();function jd(e){return e==null?e:Array.isArray(e)?e.map(jd):e&&typeof e=="object"&&e.constructor===Object?Object.keys(e).sort().reduce((t,r)=>{let o=e[r];return t[r]=jd(o),t},{}):e}function ev(e){let t={...e};return t.runner==="bash"&&"docker_compose_file"in t?delete t.docker_compose_file:t.runner==="docker-compose"&&"bash_script"in t&&delete t.bash_script,"pre_launch_script"in t&&!t.pre_launch_script&&delete t.pre_launch_script,t}function tv(e){let t=jd(e),r=JSON.stringify(t,null,4);return r=r.replace(/": /g,'":'),r}function R8(e){let t=ev(e),r=tv(t);return $8.createHash("sha256").update(r,"utf8").digest("hex")}function M8(e){let t=e;return{...e,getHash:()=>R8(t),toString:()=>tv(ev(t))}}var B8=Q1.transform(e=>M8(e)),F8=fe,{action:D8,safeAction:ec}=X(B8,async(e,t)=>{let{cvmId:r}=F8.parse(t);return await e.get(`/cvms/${r}/compose_file`)}),N8=Dr.object({id:Dr.string().optional(),uuid:Dr.string().regex(/^[0-9a-f]{8}[-]?[0-9a-f]{4}[-]?4[0-9a-f]{3}[-]?[89ab][0-9a-f]{3}[-]?[0-9a-f]{12}$/i).optional(),app_id:Dr.string().refine(e=>!e.startsWith("app_")&&e.length===40,"app_id should be 40 characters without prefix").transform(e=>e.startsWith("app_")?e:`app_${e}`).optional(),instance_id:Dr.string().refine(e=>!e.startsWith("instance_")&&e.length===40,"instance_id should be 40 characters without prefix").transform(e=>e.startsWith("instance_")?e:`instance_${e}`).optional(),app_compose:Q1,update_env_vars:Dr.boolean().optional().nullable()}).refine(e=>!!(e.id||e.uuid||e.app_id||e.instance_id),"One of id, uuid, app_id, or instance_id must be provided").transform(e=>({cvmId:e.id||e.uuid||e.app_id||e.instance_id,request:{...e.app_compose,update_env_vars:e.update_env_vars},_raw:e})),L8=Dr.object({app_id:Dr.string().nullable(),device_id:Dr.string().nullable(),compose_hash:Dr.string(),kms_info:Or.nullable().optional()}).passthrough(),{action:O8,safeAction:Kd}=X(L8,async(e,t)=>{let r=N8.parse(t);return await e.post(`/cvms/${r.cvmId}/compose_file/provision`,r.request)}),U8=hr.object({id:hr.string().optional(),uuid:hr.string().regex(/^[0-9a-f]{8}[-]?[0-9a-f]{4}[-]?4[0-9a-f]{3}[-]?[89ab][0-9a-f]{3}[-]?[0-9a-f]{12}$/i).optional(),app_id:hr.string().refine(e=>!e.startsWith("app_")&&e.length===40,"app_id should be 40 characters without prefix").transform(e=>e.startsWith("app_")?e:`app_${e}`).optional(),instance_id:hr.string().refine(e=>!e.startsWith("instance_")&&e.length===40,"instance_id should be 40 characters without prefix").transform(e=>e.startsWith("instance_")?e:`instance_${e}`).optional(),compose_hash:hr.string().min(1,"Compose hash is required"),encrypted_env:hr.string().optional(),env_keys:hr.array(hr.string()).optional(),update_env_vars:hr.boolean().optional().nullable()}).refine(e=>!!(e.id||e.uuid||e.app_id||e.instance_id),"One of id, uuid, app_id, or instance_id must be provided").transform(e=>({cvmId:e.id||e.uuid||e.app_id||e.instance_id,compose_hash:e.compose_hash,encrypted_env:e.encrypted_env,env_keys:e.env_keys,update_env_vars:e.update_env_vars??void 0,_raw:e})),z8=hr.any().transform(()=>{}),{action:H8,safeAction:Wd}=X(z8,async(e,t)=>{let r=U8.parse(t);return await e.patch(`/cvms/${r.cvmId}/compose_file`,{compose_hash:r.compose_hash,encrypted_env:r.encrypted_env,env_keys:r.env_keys,update_env_vars:r.update_env_vars})}),j8=sn(Ur.extend({encrypted_env:Xe.string().describe("Encrypted environment variables (hex string)"),env_keys:Xe.array(Xe.string()).optional().describe("List of allowed environment variable keys"),compose_hash:Xe.string().optional().describe("Compose hash for verification (Phase 2, required when env_keys changes)"),transaction_hash:Xe.string().optional().describe("On-chain transaction hash for verification (Phase 2, required when env_keys changes)")})).transform(e=>{let{cvmId:t}=fe.parse(e);return{cvmId:t,request:{encrypted_env:e.encrypted_env,env_keys:e.env_keys,compose_hash:e.compose_hash,transaction_hash:e.transaction_hash},_raw:e}}),G8=Xe.object({status:Xe.literal("in_progress"),message:Xe.string(),correlation_id:Xe.string(),allowed_envs_changed:Xe.boolean()}),V8=Xe.object({status:Xe.literal("precondition_required"),message:Xe.string(),compose_hash:Xe.string(),app_id:Xe.string(),device_id:Xe.string(),kms_info:Or}),q8=Xe.union([G8,V8]),{action:K8,safeAction:W8}=X(q8,async(e,t)=>{let r=j8.parse(t);try{return await e.patch(`/cvms/${r.cvmId}/envs`,r.request)}catch(o){if(o instanceof Lr&&o.status===465){let n=o.detail;if(n&&typeof n=="object"){let s=n;return{status:"precondition_required",message:s.message||"Compose hash verification required",compose_hash:s.compose_hash,app_id:s.app_id,device_id:s.device_id,kms_info:s.kms_info}}}throw o}}),J8=sn(Ur.extend({docker_compose_file:kt.string().describe("Docker Compose YAML content"),compose_hash:kt.string().optional().describe("Compose hash for verification (Phase 2, contract-owned KMS only)"),transaction_hash:kt.string().optional().describe("On-chain transaction hash for verification (Phase 2, contract-owned KMS only)")})).transform(e=>{let{cvmId:t}=fe.parse(e);return{cvmId:t,request:{docker_compose_file:e.docker_compose_file,compose_hash:e.compose_hash,transaction_hash:e.transaction_hash},_raw:e}}),Z8=kt.object({status:kt.literal("in_progress"),message:kt.string(),correlation_id:kt.string()}),Y8=kt.object({status:kt.literal("precondition_required"),message:kt.string(),compose_hash:kt.string(),app_id:kt.string(),device_id:kt.string(),kms_info:Or}),X8=kt.union([Z8,Y8]),{action:Q8,safeAction:eI}=X(X8,async(e,t)=>{let r=J8.parse(t),o={"Content-Type":"text/yaml"};r.request.compose_hash&&(o["X-Compose-Hash"]=r.request.compose_hash),r.request.transaction_hash&&(o["X-Transaction-Hash"]=r.request.transaction_hash);try{return await e.patch(`/cvms/${r.cvmId}/docker-compose`,r.request.docker_compose_file,{headers:o})}catch(n){if(n instanceof Lr&&n.status===465){let s=n.detail;if(s&&typeof s=="object"){let i=s;return{status:"precondition_required",message:i.message||"Compose hash verification required",compose_hash:i.compose_hash,app_id:i.app_id,device_id:i.device_id,kms_info:i.kms_info}}}throw n}}),tI=sn(Ur.extend({pre_launch_script:It.string().describe("Pre-launch script content (shell script)"),compose_hash:It.string().optional().describe("Compose hash for verification (Phase 2, contract-owned KMS only)"),transaction_hash:It.string().optional().describe("On-chain transaction hash for verification (Phase 2, contract-owned KMS only)")})).transform(e=>{let{cvmId:t}=fe.parse(e);return{cvmId:t,request:{pre_launch_script:e.pre_launch_script,compose_hash:e.compose_hash,transaction_hash:e.transaction_hash},_raw:e}}),rI=It.object({status:It.literal("in_progress"),message:It.string(),correlation_id:It.string()}),oI=It.object({status:It.literal("precondition_required"),message:It.string(),compose_hash:It.string(),app_id:It.string(),device_id:It.string(),kms_info:Or}),nI=It.union([rI,oI]),{action:sI,safeAction:iI}=X(nI,async(e,t)=>{let r=tI.parse(t),o={"Content-Type":"text/plain"};r.request.compose_hash&&(o["X-Compose-Hash"]=r.request.compose_hash),r.request.transaction_hash&&(o["X-Transaction-Hash"]=r.request.transaction_hash);try{return await e.patch(`/cvms/${r.cvmId}/pre-launch-script`,r.request.pre_launch_script,{headers:o})}catch(n){if(n instanceof Lr&&n.status===465){let s=n.detail;if(s&&typeof s=="object"){let i=s;return{status:"precondition_required",message:i.message||"Compose hash verification required",compose_hash:i.compose_hash,app_id:i.app_id,device_id:i.device_id,kms_info:i.kms_info}}}throw n}}),cI=fe,{action:mI,safeAction:uI}=X(aI.string(),async(e,t)=>{let{cvmId:r}=cI.parse(t);return await e.get(`/cvms/${r}/pre-launch-script`)}),pI=L1.object({kms_id:L1.string().min(1,"KMS ID is required")}),{action:lI,safeAction:fI}=X(Or,async(e,t)=>{let r=pI.parse(t);return await e.get(`/kms/${r.kms_id}`)}),dI=Nr.object({page:Nr.number().int().min(1).optional(),page_size:Nr.number().int().min(1).optional(),is_onchain:Nr.boolean().optional()}).strict(),hI=Nr.object({items:Nr.array(Or),total:Nr.number(),page:Nr.number(),page_size:Nr.number(),pages:Nr.number()}).strict(),{action:gI,safeAction:yI}=X(hI,async(e,t)=>{let r=dI.parse(t??{});return await e.get("/kms",{params:r})}),bI=Ni.object({kms:Ni.string().min(1,"KMS ID or slug is required"),app_id:Ni.string().refine(e=>e.length===40||e.startsWith("0x")&&e.length===42,"App ID must be exactly 40 characters or 42 characters with 0x prefix")}).strict(),xI=Ni.object({public_key:Ni.string(),signature:Ni.string()}).strict(),{action:vI,safeAction:jp}=X(xI,async(e,t)=>{let r=bI.parse(t);return await e.get(`/kms/${r.kms}/pubkey/${r.app_id}`)}),wI=Nn.object({counts:Nn.number().int().min(1).max(20).optional().default(1)}).strict(),CI=Nn.object({app_ids:Nn.array(Nn.object({app_id:Nn.string(),nonce:Nn.number().int().min(0)}))}).strict(),{action:EI,safeAction:SI}=X(CI,async(e,t)=>{let r=wI.parse(t??{}),o=new URLSearchParams;return o.append("counts",r.counts.toString()),await e.get(`/kms/phala/next_app_id?${o.toString()}`)}),kI=fe,{action:II,safeAction:Jd}=X(zp,async(e,t)=>{let{cvmId:r}=kI.parse(t);return await e.post(`/cvms/${r}/start`)}),_I=fe,{action:AI,safeAction:Zd}=X(zp,async(e,t)=>{let{cvmId:r}=_I.parse(t);return await e.post(`/cvms/${r}/stop`)}),PI=fe,{action:TI,safeAction:$I}=X(zp,async(e,t)=>{let{cvmId:r}=PI.parse(t);return await e.post(`/cvms/${r}/shutdown`)}),MI=sn(Ur.extend({force:RI.boolean().optional()})),{action:BI,safeAction:Yd}=X(zp,async(e,t)=>{let r=MI.parse(t),{cvmId:o}=fe.parse(r),{force:n=!1}=r;return await e.post(`/cvms/${o}/restart`,{force:n})}),DI=fe,{action:NI,safeAction:Xd}=X(FI.void(),async(e,t)=>{let{cvmId:r}=DI.parse(t);await e.delete(`/cvms/${r}`)}),LI=ie.object({name:ie.string(),mount_point:ie.string(),total_size:ie.number(),free_size:ie.number()}),OI=ie.object({os_name:ie.string(),os_version:ie.string(),kernel_version:ie.string(),cpu_model:ie.string(),num_cpus:ie.number(),total_memory:ie.number(),available_memory:ie.number(),used_memory:ie.number(),free_memory:ie.number(),total_swap:ie.number(),used_swap:ie.number(),free_swap:ie.number(),uptime:ie.number(),loadavg_one:ie.number(),loadavg_five:ie.number(),loadavg_fifteen:ie.number(),disks:ie.array(LI)}),UI=ie.object({is_online:ie.boolean(),is_public:ie.boolean().default(!1),error:ie.string().nullable(),sysinfo:OI.nullable(),status:ie.string().nullable(),in_progress:ie.boolean().default(!1),boot_progress:ie.string().nullable(),boot_error:ie.string().nullable()}),zI=fe,{action:HI,safeAction:jI}=X(UI,async(e,t)=>{let{cvmId:r}=zI.parse(t);return await e.get(`/cvms/${r}/stats`)}),GI=Br.object({app:Br.string(),instance:Br.string()}),VI=Br.object({is_online:Br.boolean(),is_public:Br.boolean().default(!0),error:Br.string().nullable(),internal_ip:Br.string().nullable(),latest_handshake:Br.string().nullable(),public_urls:Br.array(GI).nullable()}),qI=fe,{action:KI,safeAction:WI}=X(VI,async(e,t)=>{let{cvmId:r}=qI.parse(t);return await e.get(`/cvms/${r}/network`)}),ZI=fe,{action:YI,safeAction:XI}=X(JI.string(),async(e,t)=>{let{cvmId:r}=ZI.parse(t);return await e.get(`/cvms/${r}/docker-compose.yml`)}),QI=Ae.object({id:Ae.string(),names:Ae.array(Ae.string()),image:Ae.string(),image_id:Ae.string(),command:Ae.string().nullable().optional(),created:Ae.number(),state:Ae.string(),status:Ae.string(),log_endpoint:Ae.string().nullable()}),e_=Ae.object({is_online:Ae.boolean(),is_public:Ae.boolean().default(!0),error:Ae.string().nullable(),docker_compose_file:Ae.string().nullable(),manifest_version:Ae.number().nullable(),version:Ae.string().nullable(),runner:Ae.string().nullable(),features:Ae.array(Ae.string()).nullable(),containers:Ae.array(QI).nullable()}),t_=fe,{action:r_,safeAction:o_}=X(e_,async(e,t)=>{let{cvmId:r}=t_.parse(t);return await e.get(`/cvms/${r}/composition`)}),n_=H.object({common_name:H.string().nullable(),organization:H.string().nullable(),country:H.string().nullable(),state:H.string().nullable(),locality:H.string().nullable()}),s_=H.object({common_name:H.string().nullable(),organization:H.string().nullable(),country:H.string().nullable()}),i_=H.object({subject:n_,issuer:s_,serial_number:H.string(),not_before:H.string(),not_after:H.string(),version:H.string(),fingerprint:H.string(),signature_algorithm:H.string(),sans:H.array(H.string()).nullable(),is_ca:H.boolean(),position_in_chain:H.number().nullable(),quote:H.string().nullable(),app_id:H.string().nullable().optional(),cert_usage:H.string().nullable().optional()}),a_=H.object({imr:H.number(),event_type:H.number(),digest:H.string(),event:H.string(),event_payload:H.string()}),c_=H.object({mrtd:H.string(),rootfs_hash:H.string().nullable().optional(),rtmr0:H.string(),rtmr1:H.string(),rtmr2:H.string(),rtmr3:H.string(),event_log:H.array(a_),app_compose:H.string()}),m_=H.object({name:H.string().nullable(),is_online:H.boolean(),is_public:H.boolean().default(!0),error:H.string().nullable(),app_certificates:H.array(i_).nullable(),tcb_info:c_.nullable(),compose_file:H.string().nullable()}),u_=fe,{action:p_,safeAction:l_}=X(m_,async(e,t)=>{let{cvmId:r}=u_.parse(t);return await e.get(`/cvms/${r}/attestation`)}),f_=sn(Ur.extend({vcpu:Di.number().optional(),memory:Di.number().optional(),disk_size:Di.number().optional(),instance_type:Di.string().optional(),allow_restart:Di.boolean().optional()})),{action:d_,safeAction:h_}=X(Di.void(),async(e,t)=>{let r=f_.parse(t),{cvmId:o}=fe.parse(r),{...n}=r;await e.patch(`/cvms/${o}/resources`,n)}),g_=sn(Ur.extend({public_sysinfo:O1.boolean(),public_logs:O1.boolean()})),{action:y_,safeAction:Qd}=X(Y1,async(e,t)=>{let r=g_.parse(t),{cvmId:o}=fe.parse(r),{public_sysinfo:n,public_logs:s}=r;return await e.patch(`/cvms/${o}/visibility`,{public_sysinfo:n,public_logs:s})}),U1=ct.object({name:ct.string(),os_image_hash:ct.string().nullable(),is_current:ct.boolean()}),b_=ct.object({version:ct.union([ct.tuple([ct.number(),ct.number(),ct.number(),ct.number()]),ct.tuple([ct.number(),ct.number(),ct.number()])]),prod:U1.nullable(),dev:U1.nullable()}),x_=ct.array(b_),v_=fe,{action:w_,safeAction:C_}=X(x_,async(e,t)=>{let{cvmId:r}=v_.parse(t);return await e.get(`/cvms/${r}/available-os-images`)}),E_=sn(Ur.extend({os_image_name:rv.string().min(1,"OS image name is required")})),{action:S_,safeAction:k_}=X(rv.void(),async(e,t)=>{let r=E_.parse(t),{cvmId:o}=fe.parse(r),{os_image_name:n}=r;await e.patch(`/cvms/${o}/os-image`,{os_image_name:n})}),I_=Mr.object({id:Mr.string().optional(),instance_id:Mr.string().optional(),name:Mr.string(),status:Mr.string(),uptime:Mr.string().optional(),exited_at:Mr.string().optional(),boot_progress:Mr.string().optional(),boot_error:Mr.string().optional(),shutdown_progress:Mr.string().optional()}),__=fe,{action:A_,safeAction:P_}=X(I_,async(e,t)=>{let{cvmId:r}=__.parse(t);return await e.get(`/cvms/${r}/state`)});function Le(e={}){let t=qk(e),r={getCurrentUser:Wk,safeGetCurrentUser:uo,getAvailableNodes:t8,safeGetAvailableNodes:Qa,listAllInstanceTypeFamilies:i8,safeListAllInstanceTypeFamilies:a8,listFamilyInstanceTypes:c8,safeListFamilyInstanceTypes:m8,listWorkspaces:l8,safeListWorkspaces:f8,getWorkspace:d8,safeGetWorkspace:h8,getCvmInfo:w8,safeGetCvmInfo:Se,getCvmList:S8,safeGetCvmList:Ln,provisionCvm:A8,safeProvisionCvm:qd,commitCvmProvision:T8,safeCommitCvmProvision:Hp,getCvmComposeFile:D8,safeGetCvmComposeFile:ec,provisionCvmComposeFileUpdate:O8,safeProvisionCvmComposeFileUpdate:Kd,commitCvmComposeFileUpdate:H8,safeCommitCvmComposeFileUpdate:Wd,updateCvmEnvs:K8,safeUpdateCvmEnvs:W8,updateDockerCompose:Q8,safeUpdateDockerCompose:eI,updatePreLaunchScript:sI,safeUpdatePreLaunchScript:iI,getCvmPreLaunchScript:mI,safeGetCvmPreLaunchScript:uI,startCvm:II,safeStartCvm:Jd,stopCvm:AI,safeStopCvm:Zd,shutdownCvm:TI,safeShutdownCvm:$I,restartCvm:BI,safeRestartCvm:Yd,deleteCvm:NI,safeDeleteCvm:Xd,getCvmStats:HI,safeGetCvmStats:jI,getCvmNetwork:KI,safeGetCvmNetwork:WI,getCvmDockerCompose:YI,safeGetCvmDockerCompose:XI,getCvmContainersStats:r_,safeGetCvmContainersStats:o_,getCvmAttestation:p_,safeGetCvmAttestation:l_,updateCvmResources:d_,safeUpdateCvmResources:h_,updateCvmVisibility:y_,safeUpdateCvmVisibility:Qd,getAvailableOsImages:w_,safeGetAvailableOsImages:C_,updateOsImage:S_,safeUpdateOsImage:k_,getKmsInfo:lI,safeGetKmsInfo:fI,getKmsList:gI,safeGetKmsList:yI,getAppEnvEncryptPubKey:vI,safeGetAppEnvEncryptPubKey:jp,nextAppIds:EI,safeNextAppIds:SI,getCvmState:A_,safeGetCvmState:P_};return t.extend(r)}function Op(e){if(typeof e=="string"){if(e.startsWith("0x")&&pe(e))return e;if(pe(`0x${e}`))return`0x${e}`}throw new Error(`Invalid hex value: ${e}`)}var ov=class extends Error{constructor(e,t,r){super(e),this.code=t,this.details=r,this.name="NetworkError"}};var Fr=class extends Error{constructor(e,t,r){super(e),this.hash=t,this.details=r,this.name="TransactionError"}};async function T_(e,t){try{let r=await e.walletClient.getChainId();return{isCorrectNetwork:r===t,currentChainId:r}}catch(r){throw new ov(`Failed to check network status: ${r instanceof Error?r.message:"Unknown error"}`,"NETWORK_CHECK_FAILED",r)}}async function $_(e,t,r){try{let o=await e.getBalance({address:t});return{address:t,balance:o,sufficient:r?o>=r:!0,required:r}}catch(o){throw new ov(`Failed to check balance: ${o instanceof Error?o.message:"Unknown error"}`,"BALANCE_CHECK_FAILED",o)}}async function R_(e,t,r={}){let{timeout:o=6e4,pollingInterval:n=2e3,confirmations:s=1}=r,i=Date.now();return new Promise((a,c)=>{let m=async()=>{try{let u=await e.getTransactionReceipt({hash:t});if(u){if(s>1&&await e.getBlockNumber()-u.blockNumber+1n<BigInt(s)){if(Date.now()-i>=o){c(new Fr(`Transaction confirmation timeout after ${o}ms`,t));return}setTimeout(m,n);return}a(u)}else{if(Date.now()-i>=o){c(new Fr(`Transaction receipt timeout after ${o}ms`,t));return}setTimeout(m,n)}}catch(u){if(Date.now()-i>=o){c(new Fr(`Transaction receipt timeout after ${o}ms`,t,u));return}setTimeout(m,n)}};m()})}async function nv(e,t){let{targetChainId:r,minBalance:o,requiredAddress:n}=t,s=await T_(e,r),i=await $_(e.publicClient,e.address,o),a=n?e.address.toLowerCase()===n.toLowerCase():!0;return{networkValid:s.isCorrectNetwork,balanceValid:i.sufficient,addressValid:a,details:{currentChainId:s.currentChainId,balance:i.balance,address:e.address}}}function e0(){let e={state:"idle"},t,r,o=a=>{e={...e,...a}},n=()=>{t&&(clearTimeout(t),t=void 0),r&&(r.abort(),r=void 0),e={state:"idle"}},s=()=>{r&&r.abort(),t&&(clearTimeout(t),t=void 0),o({state:"error",aborted:!0,error:"Transaction aborted by user"})};return{get status(){return{...e}},get isIdle(){return e.state==="idle"},get isSubmitting(){return e.state==="submitting"},get isPending(){return e.state==="pending"},get isSuccess(){return e.state==="success"},get isError(){return e.state==="error"},get isTimeout(){return e.state==="timeout"},get isAborted(){return e.aborted===!0},get isComplete(){return["success","error","timeout"].includes(e.state)},abort:s,reset:n,execute:async(a,c,m,u={})=>{let{timeout:p=6e4,confirmations:l=1,onSubmitted:d,onConfirmed:h,onError:g,signal:y}=u;try{if(n(),r=new AbortController,y){if(y.aborted)throw new Fr("Operation was aborted before execution");y.addEventListener("abort",()=>{s()})}if(o({state:"submitting",startTime:Date.now(),error:void 0,hash:void 0,receipt:void 0,aborted:!1}),r.signal.aborted)throw new Fr("Transaction aborted");let x=await a(c,...m);if(r.signal.aborted)throw new Fr("Transaction aborted after submission",x);o({state:"pending",hash:x,submitTime:Date.now()}),d?.(x),p>0&&(t=setTimeout(()=>{e.state==="pending"&&!r?.signal.aborted&&o({state:"timeout",error:`Transaction timeout after ${p}ms`})},p));let b=await Promise.race([R_(c.publicClient,x,{timeout:p,confirmations:l}),new Promise((E,A)=>{r?.signal.addEventListener("abort",()=>{A(new Fr("Transaction aborted while waiting for receipt",x))})})]);t&&(clearTimeout(t),t=void 0);let v=b.status==="success";if(o({state:v?"success":"error",receipt:b,confirmTime:Date.now(),error:v?void 0:"Transaction failed on-chain"}),v)h?.(b);else{let E=new Fr("Transaction failed on-chain",x,b);throw g?.(E,x),E}return{hash:x,receipt:b,success:v}}catch(x){let b=x instanceof Fr?x:new Fr(`Transaction execution failed: ${x instanceof Error?x.message:"Unknown error"}`,e.hash,x);throw o({state:"error",error:b.message}),g?.(b,e.hash),b}}}}async function sv(e,t,r,o={},n={}){let{maxRetries:s=3,initialDelay:i=1e3,maxDelay:a=1e4,backoffFactor:c=2,retryCondition:m=()=>!0}=n,u,p=i;for(let l=0;l<=s;l++)try{return await e0().execute(e,t,r,o)}catch(d){if(u=d instanceof Error?d:new Error(String(d)),l===s||!m(u))break;await new Promise(h=>setTimeout(h,p)),p=Math.min(p*c,a)}throw u}var iv=[{inputs:[{name:"deployer",type:"address"},{name:"disableUpgrades",type:"bool"},{name:"allowAnyDevice",type:"bool"},{name:"deviceId",type:"bytes32"},{name:"composeHash",type:"bytes32"}],name:"deployAndRegisterApp",outputs:[{name:"",type:"address"}],stateMutability:"nonpayable",type:"function"},{inputs:[{name:"appId",type:"address",indexed:!0},{name:"deployer",type:"address",indexed:!0}],name:"AppDeployedViaFactory",type:"event",anonymous:!1},{inputs:[{name:"appId",type:"address",indexed:!1}],name:"AppRegistered",type:"event",anonymous:!1}],M_=Ne.object({chain:Ne.unknown().optional(),rpcUrl:Ne.string().optional(),kmsContractAddress:Ne.string(),privateKey:Ne.string().optional(),walletClient:Ne.unknown().optional(),publicClient:Ne.unknown().optional(),allowAnyDevice:Ne.boolean().optional().default(!1),deviceId:Ne.string().optional().default("0000000000000000000000000000000000000000000000000000000000000000"),composeHash:Ne.string().optional().default("0000000000000000000000000000000000000000000000000000000000000000"),disableUpgrades:Ne.boolean().optional().default(!1),skipPrerequisiteChecks:Ne.boolean().optional().default(!1),minBalance:Ne.string().optional()}).passthrough(),B_=M_.refine(e=>{let t=!!e.privateKey,r=!!e.walletClient;return t!==r},{message:"Either 'privateKey' or 'walletClient' must be provided, but not both",path:["privateKey","walletClient"]}).refine(e=>{let t=!!e.publicClient,r=!!e.walletClient,o=!!e.chain;return t&&r?!0:o},{message:"Chain is required when publicClient or walletClient is not provided",path:["chain"]}),F_=Ne.object({appId:Ne.string(),appAuthAddress:Ne.string(),deployer:Ne.string(),transactionHash:Ne.string(),blockNumber:Ne.bigint().optional(),gasUsed:Ne.bigint().optional()}).passthrough();function D_(e,t,r){try{let o=fr({abi:iv,eventName:"AppDeployedViaFactory",logs:e.logs,strict:!1});if(o.length===0)throw e.status==="reverted"?new Error(`Transaction failed: ${e.transactionHash}`):new Error(`Transaction ${e.transactionHash} has no AppDeployedViaFactory events. The deployment failed. Status: ${e.status}. Found ${e.logs.length} logs.`);let n=o[0];if(!n?.args)throw new Error("Event has no data");let{appId:s,deployer:i}=n.args;if(!s)throw new Error("Event missing appId");return{appId:s,appAuthAddress:s,deployer:t,transactionHash:e.transactionHash,blockNumber:e.blockNumber,gasUsed:e.gasUsed}}catch(o){throw o instanceof Error?o:new Error(`Parse failed: ${o}`)}}async function N_(e,t){let r=B_.parse(e),{chain:o,rpcUrl:n,kmsContractAddress:s,privateKey:i,walletClient:a,publicClient:c,allowAnyDevice:m=!1,deviceId:u="0000000000000000000000000000000000000000000000000000000000000000",composeHash:p="0000000000000000000000000000000000000000000000000000000000000000",disableUpgrades:l=!1,skipPrerequisiteChecks:d=!1,minBalance:h,timeout:g=12e4,retryOptions:y,signal:x,onTransactionStateChange:b,onTransactionSubmitted:v,onTransactionConfirmed:E}=r,A="0000000000000000000000000000000000000000000000000000000000000000",I=u!==A&&u!=="0x"+A?!1:m,R,B,M,L;if(i){let le=qa(i);if(c){if(typeof c!="object"||!c)throw new Error("publicClient is invalid");R=c}else{if(!o)throw new Error("Chain required for publicClient");R=Dn({chain:o,transport:co(n)})}if(!o)throw new Error("Chain required for walletClient");B=Va({account:le,chain:o,transport:co(n)}),M=le.address,L=o.id}else if(a){if(typeof a!="object"||!a)throw new Error("walletClient is invalid");if(B=a,c){if(typeof c!="object"||!c)throw new Error("publicClient is invalid");R=c}else{if(!o)throw new Error("Chain required for publicClient");R=Dn({chain:o,transport:co(n)})}if(!B.account?.address)throw new Error("WalletClient needs an account");M=B.account.address,o?L=o.id:L=await B.getChainId()}else throw new Error("Need privateKey or walletClient");let O={publicClient:R,walletClient:B,address:M,chainId:L},U=e0();if(b&&typeof b=="function"){let le=()=>{b(U.status),U.isComplete||setTimeout(le,100)};setTimeout(le,10)}if(!d){let le={targetChainId:L,minBalance:h?Bn(h):Bn("0.001")},Eo=await nv(O,le);if(!Eo.networkValid)throw new Error(`Wrong network. Need chain ${le.targetChainId}, got ${Eo.details.currentChainId}`);if(!Eo.balanceValid){let nr=Number(le.minBalance)/1e18,$l=Number(Eo.details.balance)/1e18;throw new Error(`Not enough ETH. Need ${nr}, have ${$l.toFixed(6)}`)}}let re=Op(u),W=Op(p),ge=`0x${re.slice(2).padEnd(64,"0")}`,Ot=`0x${W.slice(2).padEnd(64,"0")}`,z=async le=>{try{let nr=await le.publicClient.getCode({address:s});if(!nr||nr==="0x")throw new Error(`No contract at ${s}`)}catch(nr){if(nr instanceof Error&&nr.message.includes("No contract at"))throw nr}let Eo={address:s,abi:iv,functionName:"deployAndRegisterApp",args:[le.address,l,I,ge,Ot],account:le.walletClient.account||le.address,chain:o||null};return await le.walletClient.writeContract(Eo)},Te=y?await sv(z,O,[],{timeout:g,confirmations:1,onSubmitted:v,onConfirmed:E,signal:x},y):await U.execute(z,O,[],{timeout:g,confirmations:1,onSubmitted:v,onConfirmed:E,signal:x}),yr=D_(Te.receipt,M,s);return t?.schema===!1?yr:(t?.schema||F_).parse(yr)}async function av(e,t){try{return{success:!0,data:await N_(e,t)}}catch(r){let o=r instanceof Error?r.message:"Unknown deployment error";return{success:!1,error:{isRequestError:!0,message:o,status:500,detail:o}}}}var cv=[{inputs:[{name:"composeHash",type:"bytes32"}],name:"addComposeHash",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{name:"composeHash",type:"bytes32",indexed:!1}],name:"ComposeHashAdded",type:"event",anonymous:!1}],L_=_e.object({chain:_e.unknown().optional(),rpcUrl:_e.string().optional(),appId:_e.string(),composeHash:_e.string(),privateKey:_e.string().optional(),walletClient:_e.unknown().optional(),publicClient:_e.unknown().optional(),skipPrerequisiteChecks:_e.boolean().optional().default(!1),minBalance:_e.string().optional(),timeout:_e.number().optional().default(12e4),retryOptions:_e.unknown().optional(),signal:_e.unknown().optional(),onTransactionStateChange:_e.function().optional(),onTransactionSubmitted:_e.function().optional(),onTransactionConfirmed:_e.function().optional()}).passthrough().refine(e=>{let t=!!e.privateKey,r=!!e.walletClient;return t!==r},{message:"Either 'privateKey' or 'walletClient' must be provided, but not both",path:["privateKey","walletClient"]}).refine(e=>{let t=!!e.publicClient,r=!!e.walletClient,o=!!e.chain;return t&&r?!0:o},{message:"Chain is required when publicClient or walletClient is not provided",path:["chain"]}),O_=_e.object({composeHash:_e.string(),appId:_e.string(),transactionHash:_e.string(),blockNumber:_e.bigint().optional(),gasUsed:_e.bigint().optional()}).passthrough();function U_(e,t,r,o){console.log(e.logs);try{let n=fr({abi:cv,eventName:"ComposeHashAdded",logs:e.logs,strict:!1});if(n.length>0){let s=n[0];s?.args?.composeHash!==t&&console.warn(`Event compose hash (${s?.args?.composeHash}) does not match expected (${t})`)}return{composeHash:t,appAuthAddress:r,appId:o,transactionHash:e.transactionHash,blockNumber:e.blockNumber,gasUsed:e.gasUsed}}catch(n){return console.warn("Failed to parse ComposeHashAdded event, returning basic result:",n),{composeHash:t,appAuthAddress:r,appId:o,transactionHash:e.transactionHash,blockNumber:e.blockNumber,gasUsed:e.gasUsed}}}async function z_(e,t){let r=L_.parse(e),{chain:o,rpcUrl:n,appId:s,composeHash:i,privateKey:a,walletClient:c,publicClient:m,timeout:u=12e4,retryOptions:p,signal:l,onTransactionStateChange:d,onTransactionSubmitted:h,onTransactionConfirmed:g,skipPrerequisiteChecks:y=!1,minBalance:x}=r,b,v,E,A,k=s.startsWith("0x")?s:`0x${s}`;if(a){let U=qa(a);if(m)b=m;else{if(!o)throw new Error("Chain required when creating publicClient");b=Dn({chain:o,transport:co(n)})}if(!o)throw new Error("Chain required when creating walletClient");v=Va({account:U,chain:o,transport:co(n)}),E=U.address,A=o.id}else if(c){if(v=c,m)b=m;else{if(!o)throw new Error("Chain required when creating publicClient");b=Dn({chain:o,transport:co(n)})}if(!v.account?.address)throw new Error("WalletClient must have an account with address");E=v.account.address,A=o?o.id:await v.getChainId()}else throw new Error("Either privateKey or walletClient must be provided");let I={publicClient:b,walletClient:v,address:E,chainId:A},R=e0();if(d&&typeof d=="function"){let U=()=>{d(R.status),R.isComplete||setTimeout(U,100)};setTimeout(U,10)}if(!y){let U={targetChainId:A,minBalance:x?Bn(x):Bn("0.001")},re=await nv(I,U);if(!re.networkValid)throw new Error(`Network mismatch: Expected chain ${U.targetChainId}, but wallet is on chain ${re.details.currentChainId}`);if(!re.balanceValid){let W=Number(U.minBalance)/1e18,ge=Number(re.details.balance)/1e18;throw new Error(`Insufficient balance: Required ${W} ETH, but account has ${ge.toFixed(6)} ETH`)}}let B=async U=>await U.walletClient.writeContract({address:k,abi:cv,functionName:"addComposeHash",args:[Op(i)],account:U.walletClient.account||U.address,chain:o||null}),M=p?await sv(B,I,[],{timeout:u,confirmations:1,onSubmitted:h,onConfirmed:g,signal:l},p):await R.execute(B,I,[],{timeout:u,confirmations:1,onSubmitted:h,onConfirmed:g,signal:l}),L=U_(M.receipt,Op(i),k,s);return t?.schema===!1?L:(t?.schema||O_).parse(L)}async function mv(e,t){try{return{success:!0,data:await z_(e,t)}}catch(r){let o=r instanceof Error?r.message:"Unknown blockchain error";return{success:!1,error:{isRequestError:!0,message:o,status:500,detail:o}}}}var $te=Fi.object({target:Fi.string().describe("Target status to wait for (e.g., 'running', 'stopped')"),interval:Fi.number().min(5).max(30).default(5).describe("Polling interval in seconds"),timeout:Fi.number().min(10).max(600).default(300).describe("Timeout per attempt in seconds"),maxRetries:Fi.number().min(0).default(Number.POSITIVE_INFINITY).describe("Maximum number of retry attempts (Infinity for unlimited)"),retryDelay:Fi.number().min(0).default(5e3).describe("Delay between retries in milliseconds")});var H_=dt.object({vm_uuid:dt.string(),status:dt.string(),uptime:dt.string().nullable().optional(),in_progress:dt.boolean(),boot_progress:dt.string().nullable().optional(),boot_error:dt.string().nullable().optional(),operation_type:dt.string().nullable().optional(),operation_started_at:dt.string().nullable().optional(),correlation_id:dt.string().nullable().optional()}),j_=dt.record(dt.string(),H_),G_=dt.object({vmUuids:dt.array(dt.string())}),{action:Mte,safeAction:Bte}=X(j_,async(e,t)=>{let{vmUuids:r}=G_.parse(t);return await e.post("/status/batch",{vm_uuids:r})}),V_=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/gm;function q_(e){let t={},r=e.toString();r=r.replace(/\r\n?/gm,`
`);let o;for(;(o=V_.exec(r))!=null;){let n=o[1];if(!n)continue;let s=o[2]||"";s=s.trim();let i=s[0];s=s.replace(/^(['"`])([\s\S]*)\1$/gm,"$2"),i==='"'&&(s=s.replace(/\\n/g,`
`),s=s.replace(/\\r/g,"\r")),t[n]=s}return t}function Gp(e){let t=q_(e),r=[];for(let[o,n]of Object.entries(t))r.push({key:o,value:n});return r}import ht from"chalk";import J_ from"ora";function Z_(e,t){let r=e.split(/\s+/),o=[],n="";for(let s of r){let i=n.length===0?s:`${n} ${s}`;i.length<=t?n=i:(n.length>0&&o.push(n),n=s)}return n.length>0&&o.push(n),o}function Y_(e,t){if(e.length<=t)return[e];let r=[],o=0;for(;o<e.length;)r.push(e.slice(o,o+t)),o+=t;return r}function uv(e,t){let r=[];for(let o of e.split(`
`)){if(o.length<=t){r.push(o);continue}if(o.indexOf(" ")===-1){r.push(...Y_(o,t));continue}let n=Z_(o,t);r.push(...n)}if(r.length===0){let o=e.trim();r.push(o)}return r}var f={error:(e,...t)=>{et()||(process.stderr.write(`${ht.red("\u2717")} ${ht.red(e)}`),t.length>0&&process.stderr.write(` ${t.map(String).join(" ")}`),process.stderr.write(`
`))},warn:(e,...t)=>{et()||(process.stderr.write(`${ht.yellow("\u26A0")} ${ht.yellow(e)}`),t.length>0&&process.stderr.write(` ${t.map(String).join(" ")}`),process.stderr.write(`
`))},info:(e,...t)=>{et()||(process.stderr.write(`${ht.blue("\u2139")} ${ht.blue(e)}`),t.length>0&&process.stderr.write(` ${t.map(String).join(" ")}`),process.stderr.write(`
`))},success:(e,...t)=>{et()||(process.stderr.write(`${ht.green("\u2713")} ${ht.green(e)}`),t.length>0&&process.stderr.write(` ${t.map(String).join(" ")}`),process.stderr.write(`
`))},debug:(e,...t)=>{et()||process.env.DEBUG&&(process.stderr.write(`${ht.gray("\u{1F50D}")} ${ht.gray(e)}`),t.length>0&&process.stderr.write(` ${t.map(String).join(" ")}`),process.stderr.write(`
`))},table:(e,t)=>{if(!et()){if(e.length===0){console.log(ht.yellow("No data to display"));return}if(t){let r;typeof t[0]=="string"?r=t.map(i=>({key:i,header:i})):r=t;let o={};for(let i of r){let a=i.header||String(i.key);o[String(i.key)]=a.length}for(let i of e)for(let a of r){let c=String(typeof a.key=="string"&&!(a.key in i)?"":i[String(a.key)]??"");o[String(a.key)]=Math.max(o[String(a.key)],c.length)}let n=[];for(let i of r){let a=i.header||String(i.key);n.push(ht.bold(a.padEnd(o[String(i.key)])))}console.log(n.join("  "));let s=[];for(let i of r)s.push("-".repeat(o[String(i.key)]));console.log(s.join("  "));for(let i of e){let a=[];for(let c of r){let m=String(typeof c.key=="string"&&!(c.key in i)?"":i[String(c.key)]??"");a.push(m.padEnd(o[String(c.key)]))}console.log(a.join("  "))}}else{let r=e[0],o=Object.keys(r),n={};for(let a of o)n[a]=a.length;for(let a of e)for(let c of o){let m=String(a[c]??"");n[c]=Math.max(n[c],m.length)}let s=[];for(let a of o)s.push(ht.bold(a.padEnd(n[a])));console.log(s.join("  "));let i=[];for(let a of o)i.push("-".repeat(n[a]));console.log(i.join("  "));for(let a of e){let c=[];for(let m of o){let u=String(a[m]??"");c.push(u.padEnd(n[m]))}console.log(c.join("  "))}}}},keyValueTable:(e,t)=>{if(et())return;let{borderStyle:r="single",keyColor:o=ht.blue,valueColor:n=ht.white,maxWidth:s=process.stdout.columns||80}=t||{},a={single:{topLeft:"\u250C",topRight:"\u2510",bottomLeft:"\u2514",bottomRight:"\u2518",horizontal:"\u2500",vertical:"\u2502",cross:"\u253C",leftT:"\u251C",rightT:"\u2524"},double:{topLeft:"\u2554",topRight:"\u2557",bottomLeft:"\u255A",bottomRight:"\u255D",horizontal:"\u2550",vertical:"\u2551",cross:"\u256C",leftT:"\u2560",rightT:"\u2563"},rounded:{topLeft:"\u256D",topRight:"\u256E",bottomLeft:"\u2570",bottomRight:"\u256F",horizontal:"\u2500",vertical:"\u2502",cross:"\u253C",leftT:"\u251C",rightT:"\u2524"},bold:{topLeft:"\u250F",topRight:"\u2513",bottomLeft:"\u2517",bottomRight:"\u251B",horizontal:"\u2501",vertical:"\u2503",cross:"\u254B",leftT:"\u2523",rightT:"\u252B"},none:{topLeft:"",topRight:"",bottomLeft:"",bottomRight:"",horizontal:"",vertical:"",cross:"",leftT:"",rightT:""}}[r],c=0,m=0;for(let[h,g]of Object.entries(e)){c=Math.max(c,h.length);let y=String(g??"");m=Math.max(m,y.length)}let u=4,p=1,l=s-u-p;if(c+m>l){let h=c/(c+m);c=Math.floor(l*h),m=l-c}let d=c+m+u+p;r!=="none"&&console.log(a.topLeft+a.horizontal.repeat(d-2)+a.topRight);for(let[h,g]of Object.entries(e)){let y=h,x=String(g??""),b=uv(y,c),v=uv(x,m),E=Math.max(b.length,v.length);for(;b.length<E;)b.push("");for(;v.length<E;)v.push("");for(let A=0;A<E;A++){let k=b[A].padEnd(c),I=v[A].padEnd(m);console.log(r!=="none"?`${a.vertical} ${o(k)} ${a.vertical} ${n(I)} ${a.vertical}`:`${o(k)} : ${n(I)}`)}}r!=="none"&&console.log(a.bottomLeft+a.horizontal.repeat(d-2)+a.bottomRight)},break:()=>{et()||process.stderr.write(`
`)},startSpinner:e=>{if(et())return{stop:()=>{}};let t=J_(e).start();return{stop:(r=!0,o)=>{o&&(t.text=o),r?t.succeed():t.fail()}}},logDetailedError(e,t){if(et())return;let r=t?`[${t}] `:"",o=s=>s!==null&&typeof s=="object"&&"isRequestError"in s&&s.isRequestError===!0&&"status"in s&&"message"in s&&"data"in s,n=s=>s!==null&&typeof s=="object"&&"issues"in s&&Array.isArray(s.issues);if(o(e)){process.stderr.write(`${r}HTTP ${e.status}: ${e.message}
`),e.data!==void 0&&e.data!==null&&process.stderr.write(`${JSON.stringify(e.data,null,2)}
`);return}if(n(e)){process.stderr.write(`${r}Validation error: ${JSON.stringify(e.issues)}
`);return}e instanceof Error?process.stderr.write(`${r}${e.message}
`):process.stderr.write(`${r}${String(e)}
`)}};var lv=Ur.extend({api_version:zr.enum(Xa).optional(),gateway_domain:zr.string().optional(),gateway_port:zr.number().int().positive().optional(),compose_file:zr.string().optional(),env_file:zr.string().optional(),public_logs:zr.boolean().optional(),public_sysinfo:zr.boolean().optional(),listed:zr.boolean().optional()}),tc="phala.toml";function t0(){return X_.join(process.cwd(),tc)}function qp(){return Vp.existsSync(t0())}function Q_(){let e=t0();if(!Vp.existsSync(e))throw new Error(`Project configuration file not found: ${tc}
Run 'phala init' to create one.`);try{let t=Vp.readFileSync(e,"utf8"),r=pv.parse(t),o=lv.parse(r);if(o.id||o.uuid||o.app_id||o.instance_id||o.name){let{cvmId:n}=fe.parse(o);return{...o,cvm_id:n}}return o}catch(t){if(t instanceof zr.ZodError){let r=t.issues.map(o=>`  - ${o.path.join(".")}: ${o.message}`).join(`
`);throw new Error(`Invalid project configuration:
${r}`)}throw new Error(`Failed to parse ${tc}: ${t instanceof Error?t.message:String(t)}`)}}function fv(e){let t=t0();try{let r=lv.parse(e),o=pv.stringify(r);Vp.writeFileSync(t,o,"utf8"),f.success(`Project configuration saved to ${tc}`)}catch(r){if(r instanceof zr.ZodError){let o=r.issues.map(n=>`  - ${n.path.join(".")}: ${n.message}`).join(`
`);throw new Error(`Invalid configuration:
${o}`)}throw new Error(`Failed to save ${tc}: ${r instanceof Error?r.message:String(r)}`)}}function r0(){return qp()?Q_():{}}function dv(e){if(!e)return;let{cvmId:t}=fe.parse({id:e});return t}import Kp from"crypto";import Hr from"fs";import Oi from"os";import n0 from"path";var rc=n0.join(Oi.homedir(),".phala-cloud"),oc=n0.join(rc,"api-key"),o0=n0.join(rc,"docker-credentials.json");function hv(){if(!Hr.existsSync(rc))try{Hr.mkdirSync(rc,{recursive:!0})}catch(e){throw f.error(`Failed to create directory ${rc}:`,e),e}}function gv(){let e=[Oi.hostname(),Oi.platform(),Oi.arch(),Oi.cpus()[0]?.model||"",Oi.userInfo().username],t=Kp.createHash("sha256");return t.update(e.join("|")),t.digest()}function eA(e){try{let t=gv(),r=Kp.randomBytes(16),o=Kp.createCipheriv("aes-256-cbc",t.slice(0,32),r),n=o.update(e,"utf8","hex");return n+=o.final("hex"),`${r.toString("hex")}:${n}`}catch(t){throw f.error("Encryption failed:",t),new Error("Failed to encrypt data")}}function tA(e){try{let t=gv(),r=e.split(":");if(r.length!==2)throw new Error("Invalid encrypted format");let o=Buffer.from(r[0],"hex"),n=r[1],s=Kp.createDecipheriv("aes-256-cbc",t.slice(0,32),o),i=s.update(n,"hex","utf8");return i+=s.final("utf8"),i}catch(t){throw f.error("Decryption failed:",t),new Error("Failed to decrypt data")}}async function Wp(e){hv();try{let t=eA(e);Hr.writeFileSync(oc,t,{mode:384})}catch(t){throw f.error("Failed to save API key:",t),t}}function _t(){try{if(process.env.PHALA_CLOUD_API_KEY)return process.env.PHALA_CLOUD_API_KEY;if(Hr.existsSync(oc)){let e=Hr.readFileSync(oc,"utf8").trim();return tA(e)}return null}catch(e){return f.error("Failed to read API key:",e),null}}async function jr(){try{Hr.existsSync(oc)?(Hr.unlinkSync(oc),f.success("API key removed successfully.")):f.warn("No API key found to remove.")}catch(e){throw f.error("Failed to remove API key:",e),e}}async function s0(e){hv();try{Hr.writeFileSync(o0,JSON.stringify(e,null,2),{mode:384}),f.success("Docker information saved successfully.")}catch(t){throw f.error("Failed to save Docker information:",t),t}}async function po(){try{if(Hr.existsSync(o0)){let e=Hr.readFileSync(o0,"utf8");return JSON.parse(e)}return null}catch(e){return f.error("Failed to read Docker credentials:",e),null}}async function K(){let e=_t();return Le({apiKey:e})}async function Jp(e){return Le({apiKey:e})}import{z as C}from"zod";var rA=C.object({password:C.string(),registry:C.string().nullable(),username:C.string()}),dre=C.object({docker_compose_file:C.string(),docker_config:rA.optional().nullable(),features:C.array(C.string()),kms_enabled:C.boolean(),manifest_version:C.number(),name:C.string(),public_logs:C.boolean(),public_sysinfo:C.boolean(),runner:C.string().optional(),salt:C.string().nullable().optional(),tproxy_enabled:C.boolean(),version:C.string().optional()}).passthrough(),yv=C.object({id:C.number(),name:C.string(),status:C.string(),teepod_id:C.number().nullable(),teepod:C.object({id:C.number(),name:C.string()}).nullable(),user_id:C.number().nullable(),app_id:C.string(),vm_uuid:C.string().nullable(),instance_id:C.string().nullable(),app_url:C.string().nullable(),base_image:C.string().nullable(),vcpu:C.number(),memory:C.number(),disk_size:C.number(),manifest_version:C.number().nullable(),version:C.string().nullable(),runner:C.string().nullable(),docker_compose_file:C.string().nullable(),features:C.array(C.string()).nullable(),created_at:C.string(),encrypted_env_pubkey:C.string().nullable()}),hre=C.object({key:C.string(),value:C.string()}),oA=C.object({is_online:C.boolean(),is_public:C.boolean(),error:C.string().nullable(),internal_ip:C.string(),latest_handshake:C.string(),public_urls:C.array(C.object({app:C.string(),instance:C.string()}))}),bv=C.object({id:C.number(),name:C.string(),status:C.string(),teepod_id:C.number(),teepod:C.object({id:C.number(),name:C.string()}),user_id:C.number().nullable(),app_id:C.string(),vm_uuid:C.string().nullable(),instance_id:C.string().nullable(),app_url:C.string().nullable(),base_image:C.string().nullable(),vcpu:C.number(),memory:C.number(),disk_size:C.number(),manifest_version:C.number().nullable(),version:C.string().nullable(),runner:C.string().nullable(),docker_compose_file:C.string().nullable(),features:C.array(C.string()).nullable(),created_at:C.string(),encrypted_env_pubkey:C.string().nullable()}),xv=C.object({is_online:C.boolean(),is_public:C.boolean(),error:C.string().nullable(),app_certificates:C.array(C.object({subject:C.object({common_name:C.string().nullable(),organization:C.string().nullable(),country:C.string().nullable(),state:C.string().nullable().optional(),locality:C.string().nullable().optional()}),issuer:C.object({common_name:C.string().nullable(),organization:C.string().nullable(),country:C.string().nullable()}),serial_number:C.string(),not_before:C.string(),not_after:C.string(),version:C.string(),fingerprint:C.string(),signature_algorithm:C.string(),sans:C.string().nullable(),is_ca:C.boolean(),position_in_chain:C.number(),quote:C.string().nullable()})).nullable(),tcb_info:C.object({mrtd:C.string(),rootfs_hash:C.string(),rtmr0:C.string(),rtmr1:C.string(),rtmr2:C.string(),rtmr3:C.string(),event_log:C.array(C.object({imr:C.number(),event_type:C.number(),digest:C.string(),event:C.string(),event_payload:C.string()}))}).nullable(),compose_file:C.string().nullable()}),nA=C.object({name:C.string(),description:C.string().optional(),version:C.array(C.number()).optional(),is_dev:C.boolean().optional(),os_image_hash:C.string().nullable().optional(),rootfs_hash:C.string().optional(),shared_ro:C.boolean().optional(),cmdline:C.string().optional(),kernel:C.string().optional(),initrd:C.string().optional(),hda:C.string().nullable().optional(),rootfs:C.string().optional(),bios:C.string().optional()}),gre=C.object({teepod_id:C.number().nullable(),id:C.number().optional(),name:C.string(),listed:C.boolean().optional(),resource_score:C.number().optional(),remaining_vcpu:C.number().optional(),remaining_memory:C.number().optional(),remaining_cvm_slots:C.number().optional(),images:C.array(nA).optional(),region_identifier:C.string().optional(),dedicated_for_team_id:C.number().nullable().optional(),support_onchain_kms:C.boolean().optional(),fmspc:C.string().nullable().optional(),device_id:C.string().nullable().optional()});import sA from"inquirer";async function iA(e){let t=await K(),r=e.replace(/^app_/,""),o=await Se(t,{app_id:r});if(!o.success)throw new Error(o.error.message);return o.data}async function vv(e){let t=await K(),r=await ec(t,{id:e});if(!r.success)throw new Error(r.error.message);return r.data}async function wv(){let e=f.startSpinner("Fetching available CVMs"),t=await K(),r=await Ln(t);if(e.stop(!0),!r.success){f.error(`Failed to fetch CVMs: ${r.error.message}`);return}let n=r.data.items;if(!n||n.length===0){f.info("No CVMs found for your account");return}let s=n.map(a=>{let c=a,m=c.hosted?.app_id||c.hosted?.id,u=c.name||c.hosted?.name,p=c.status||c.hosted?.status;return{name:`${u||"Unnamed"} (${m}) - Status: ${p||"Unknown"}`,value:m}}),{selectedCvm:i}=await sA.prompt([{type:"list",name:"selectedCvm",message:"Select a CVM:",choices:s}]);return i}async function Cv(e){let t=await K(),r=e.replace(/^app_/,""),o=await t.get(`cvms/app_${r}/attestation`);try{return xv.parse(o)}catch(n){return f.debug(`Validation error: ${n instanceof Error?n.message:String(n)}`),{is_online:!!o?.is_online,is_public:!!o?.is_public,error:typeof o?.error=="string"?o.error:null,app_certificates:Array.isArray(o?.app_certificates)?o.app_certificates:null,tcb_info:o?.tcb_info||null,compose_file:typeof o?.compose_file=="string"?o.compose_file:null}}}async function Ev(e,t){let r=await K(),o=e.replace(/^app_/,""),n=await r.post(`cvms/app_${o}/replicas`,t);return bv.parse(n)}async function i0(e,t,r,o,n){let s=await K(),i=e.replace(/^app_/,""),a={};if(t!==void 0&&(a.vcpu=t),r!==void 0&&(a.memory=r),o!==void 0&&(a.disk_size=o),n!==void 0&&(a.allow_restart=n),Object.keys(a).length===0)throw new Error("At least one resource parameter must be provided");return await s.patch(`cvms/app_${i}/resources`,a),!0}async function Sv(e){return await(await K()).post("cvms/pubkey/from_cvm_configuration",e)}async function kv(e){let r=await(await K()).post("cvms/from_cvm_configuration",e);return yv.parse(r)}async function Iv(e,t){let r=await K(),o=e.replace(/^app_/,"");return await r.put(`cvms/app_${o}/compose`,t)}async function _v(e=!1){let t=await K(),r="teepods/available";return e&&(r+="?v03x_only=1"),await t.get(r)}function Zp(e,t){let r=[];t.follow&&r.push("follow"),t.tail&&r.push(`lines=${t.tail}`),t.timestamps&&r.push("timestamps"),r.push("ansi");let o=e.includes("?")?"&":"?";return e+o+r.join("&")}async function Av(e,t){let r=e.body?.getReader();if(!r)throw new Error("No response body available for streaming");let o=new TextDecoder;for(;;){let{done:n,value:s}=await r.read();if(n)break;t(o.decode(s,{stream:!0}))}}async function Pv(e){let t=await iA(e);if(!t.syslog_endpoint)throw new Error(`No syslog endpoint available for CVM '${e}'`);return`${t.syslog_endpoint}&ch=serial`}async function Tv(e,t){let o=await(await K()).get(`cvms/${e}/composition`);if(!o.containers?.length)throw new Error(`No containers found for CVM '${e}'`);let n=o.containers;if(t&&(n=n.filter(i=>i.names.some(a=>a===t||a===`/${t}`)||i.id.startsWith(t)),!n.length))throw new Error(`Container '${t}' not found in CVM '${e}'`);let s=n.find(i=>i.log_endpoint);if(!s?.log_endpoint)throw new Error(`No log endpoints available for CVM '${e}'`);return s.log_endpoint}async function $v(e,t={}){let r=await Pv(e),o=Zp(r,t),n=await fetch(o);if(!n.ok)throw new Error(`Failed to fetch serial logs: ${n.status} ${n.statusText}`);return n.text()}async function Rv(e,t={}){let r=await Tv(e,t.container),o=Zp(r,t),n=await fetch(o);if(!n.ok)throw new Error(`Failed to fetch container logs: ${n.status} ${n.statusText}`);return n.text()}async function Mv(e,t,r={},o){let n=await Pv(e),s=Zp(n,{...r,follow:!0}),i=await fetch(s,{signal:o});if(!i.ok)throw new Error(`Failed to stream serial logs: ${i.status} ${i.statusText}`);await Av(i,t)}async function Bv(e,t,r={},o){let n=await Tv(e,r.container),s=Zp(n,{...r,follow:!0}),i=await fetch(s,{signal:o});if(!i.ok)throw new Error(`Failed to stream container logs: ${i.status} ${i.statusText}`);await Av(i,t)}import zi from"chalk";import On from"semver";import aA from"os";import Fv from"path";import nc from"fs-extra";var Yp=Fv.join(aA.homedir(),".phala-cloud"),c0=Fv.join(Yp,"config.json"),a0={apiUrl:"https://cloud-api.phala.network",cloudUrl:"https://cloud.phala.com",defaultTeepodId:3,defaultImage:"dstack-dev-0.3.5",defaultVcpu:1,defaultMemory:2048,defaultDiskSize:20};function cA(){if(!nc.existsSync(Yp))try{nc.mkdirSync(Yp,{recursive:!0})}catch(e){throw new Error(`Failed to create directory ${Yp}: ${String(e)}`)}}function Xp(){try{if(nc.existsSync(c0)){let e=nc.readFileSync(c0,"utf8");return{...a0,...JSON.parse(e)}}return a0}catch{return a0}}function m0(e){cA();try{nc.writeFileSync(c0,JSON.stringify({...Xp(),...e},null,2),{mode:384})}catch(t){throw new Error(`Failed to save configuration: ${String(t)}`)}}function Ui(e){return Xp()[e]}function Dv(e,t){let r=Xp();r[e]=t,m0(r)}function Nv(){return Xp()}function Qp(){return typeof process.versions.bun=="string"?"bun":"node"}function sc(e,t){if(t==="bun")return"bun";let r=e.npm_config_user_agent;if(r){let n=(r.split(" ")[0]??"").split("/")[0];if(n==="pnpm")return"pnpm";if(n==="yarn")return"yarn";if(n==="npm")return"npm";if(n==="bun")return"bun"}return"npm"}function ic(e,t){switch(e){case"bun":return`bun add -g ${t}`;case"pnpm":return`pnpm add -g ${t}`;case"yarn":return`yarn global add ${t}`;default:return`npm i -g ${t}`}}function Lv(e,t){switch(e){case"bun":return{command:"bun",args:["add","-g",t]};case"pnpm":return{command:"pnpm",args:["add","-g",t]};case"yarn":return{command:"yarn",args:["global","add",t]};default:return{command:"npm",args:["i","-g",t]}}}var mA=200,uA=1440*60*1e3;function el(e){return e?e==="1"||e.toLowerCase()==="true":!1}function Ov(e){return typeof e=="string"&&e.trim().length>0}function pA(e){return e.startsWith("@")?e.replace("/","%2F"):e}function lA(e){let r=On.parse(e)?.prerelease?.[0];return typeof r=="string"&&r.length>0?r:void 0}function zv(e,t,r){if(Ov(t.PHALA_UPDATE_CHANNEL))return t.PHALA_UPDATE_CHANNEL;let o=r.get("updateCheckChannel");return Ov(o)?o:lA(e)??"latest"}function fA(e){return e.replace(/[^a-zA-Z0-9_-]/g,"_")}function u0(e,t){return`${e}_${fA(t)}`}function Uv(e,t){let r=e.get(t);if(typeof r=="number"&&Number.isFinite(r))return r;if(typeof r=="string"){let o=Number(r);return Number.isFinite(o)?o:void 0}}function Hv(){return{get(e){return Ui(e)},save(e){m0(e)}}}function tl(e){let{executableName:t,packageName:r,currentVersion:o,runtime:n,env:s,isJson:i,stderrIsTTY:a,configStore:c=Hv()}=e;try{if(!a||i||el(s.CI)||el(s.PHALA_DISABLE_UPDATE_CHECK)||c.get("disableUpdateNotice")===!0)return null;let m=On.valid(o);if(!m)return null;let u=zv(o,s,c),p=u0("updateCheckLatest",u),l=c.get(p)??(u==="latest"?c.get("updateCheckLatest"):void 0),d=typeof l=="string"?On.valid(l):null;if(!d||!On.gt(d,m))return null;let h=sc(s,n),g=u==="latest"?`${r}@latest`:`${r}@${u}`,y=ic(h,g);return{message:`${[zi.yellow(`Update available: v${m} -> v${d}${u==="latest"?"":` (${u})`}.`),zi.gray(`Update with: "${t} self update" (or "${y}").`),zi.gray(`Disable with: PHALA_DISABLE_UPDATE_CHECK=1 or "${t} config set disableUpdateNotice true".`)].join(`
`)}
`,currentVersion:m,latestVersion:d,packageName:r}}catch{return null}}async function jv(e){let{executableName:t,packageName:r,currentVersion:o,runtime:n,env:s,isJson:i,stderrIsTTY:a,now:c=Date.now(),timeoutMs:m=mA,ttlMs:u=uA,fetchImpl:p=fetch,configStore:l=Hv()}=e;try{if(!a||i||el(s.CI)||el(s.PHALA_DISABLE_UPDATE_CHECK)||l.get("disableUpdateNotice")===!0)return null;let d=tl({executableName:t,packageName:r,currentVersion:o,runtime:n,env:s,isJson:i,stderrIsTTY:a,configStore:l});if(d)return d;let h=zv(o,s,l),g=u0("updateCheckLastAt",h),y=Uv(l,g)??(h==="latest"?Uv(l,"updateCheckLastAt"):void 0);if(y&&c-y<u)return null;let b=`https://registry.npmjs.org/${pA(r)}`,v=new AbortController,E=setTimeout(()=>v.abort(),m);E.unref?.();let A,k=null;try{if(A=await p(b,{signal:v.signal,headers:{accept:"application/json"}}),!A.ok)return null;let I=await A.json();if(!I||typeof I!="object")return null;let R=I["dist-tags"];if(!R||typeof R!="object")return null;let B=R[h]??R.latest;if(typeof B!="string")return null;k=On.valid(B);let M=On.valid(o);if(!k||!M||!On.gt(k,M))return null;let L=sc(s,n),O=h==="latest"?`${r}@latest`:`${r}@${h}`,U=ic(L,O);return{message:`${[zi.yellow(`Update available: v${M} -> v${k}${h==="latest"?"":` (${h})`}.`),zi.gray(`Update with: "${t} self update" (or "${U}").`),zi.gray(`Disable with: PHALA_DISABLE_UPDATE_CHECK=1 or "${t} config set disableUpdateNotice true".`)].join(`
`)}
`,currentVersion:M,latestVersion:k,packageName:r}}finally{clearTimeout(E);let I=u0("updateCheckLatest",h);l.save({[g]:c,...k?{[I]:k}:{},...h==="latest"?{updateCheckLastAt:c,...k?{updateCheckLatest:k}:{}}:{}})}}catch{return null}}async function Vv(e){let{registry:t,argv:r,executableName:o,version:n,packageName:s,packageVersion:i,runtime:a,stdout:c,stderr:m,stdin:u,env:p,cwd:l}=e,d=gA(r);if((d.length>0?t.getNode(d):null)?.group){let v=r.slice(d.length),E=Yi(v,void 0);if(E.flags["--help"]||E.positionals.length===0)return Gv({registry:t,argv:r,executableName:o,version:n,packageName:s,packageVersion:i,runtime:a,env:p,stdout:c,stderr:m,groupPath:d})}let g=t.resolveCommand(d);if(!g)return d.length>1&&t.getNode([d[0]])?.group?Gv({registry:t,argv:r,executableName:o,version:n,packageName:s,packageVersion:i,runtime:a,env:p,stdout:c,stderr:m,groupPath:[d[0]]}):hA({registry:t,argv:r,executableName:o,version:n,packageName:s,packageVersion:i,runtime:a,env:p,stdout:c,stderr:m});let{definition:y,consumed:x}=g,b=r.slice(x.length);try{let v=Yi(b,y.meta.options);if(v.flags["--version"])return c.write(`${n}
`),0;if(v.flags["--help"])return c.write(`${Bl({executableName:o,definition:y,registry:t})}
`),0;let A=!(y.path[0]==="self"&&y.path[1]==="update")?jv({executableName:o,packageName:s,currentVersion:i,runtime:a,env:p,isJson:v.flags["--json"]===!0,stderrIsTTY:m.isTTY===!0}):Promise.resolve(null);y.meta.stability==="deprecated"&&m.write(Hi.yellow(`Warning: This command is deprecated and may be removed in a future version.
`));let k=Z0(y.meta,v),I={...k.options,...k.positionals,options:k.options,positionals:k.positionals,raw:k.raw},R,B="cvmId"in I?I.cvmId:void 0,M="interactive"in I&&I.interactive===!0;if(v.flags["--debug"]&&(console.log("[DISPATCHER DEBUG] 'cvmId' in mergedInput:","cvmId"in I),console.log("[DISPATCHER DEBUG] rawCvmId:",B),console.log("[DISPATCHER DEBUG] mergedInput keys:",Object.keys(I))),M){let W=await wv();W&&(R={app_id:W})}if(!R&&B&&typeof B=="string"&&(R={id:B}),!R){let W=r0().cvm_id;W&&(R={id:W})}v.flags["--debug"]&&(console.log("[DISPATCHER DEBUG] final cvmId:",JSON.stringify(R)),console.log("[DISPATCHER DEBUG] cvmId type:",typeof R),console.log("[DISPATCHER DEBUG] cvmId is undefined:",R===void 0));let L={argv:b,rawFlags:v.flags,rawPositionals:v.positionals,cwd:l,env:p,stdout:c,stderr:m,stdin:u,projectConfig:r0(),cvmId:R,cli:{executableName:o,packageName:s,packageVersion:i,runtime:a},success(W){if(et()){let ge=typeof W=="string"?{success:!0,message:W}:{success:!0,...typeof W=="object"&&W!==null?W:{data:W}};c.write(`${JSON.stringify(ge,null,2)}
`)}else typeof W=="string"?c.write(`${Hi.green("\u2713")} ${Hi.green(W)}
`):(c.write(`${Hi.green("\u2713")} Success
`),c.write(`${JSON.stringify(W,null,2)}
`))},fail(W,ge){et()?c.write(`${JSON.stringify({success:!1,error:W,...ge&&{details:ge}},null,2)}
`):(m.write(`${Hi.red("\u2717")} ${Hi.red(W)}
`),ge&&m.write(`${JSON.stringify(ge,null,2)}
`))}};v.flags["--debug"]&&console.log("[DISPATCHER DEBUG] context.cvmId after creation:",JSON.stringify(L.cvmId));let O=y.schema.parse(I);v.flags["--debug"]&&console.log("[DISPATCHER DEBUG] context.cvmId before handler:",JSON.stringify(L.cvmId));let U=await y.run(O,L),re=await A;return typeof U=="number"?(U===0&&re&&!et()&&m.write(re.message),U):(re&&!et()&&m.write(re.message),0)}catch(v){if(v instanceof dA){let E=v.issues.some(k=>k.code==="invalid_type"&&k.received==="undefined"&&k.message==="Required"),A=b.some(k=>!k.startsWith("-"));return E&&!A?(c.write(`${Bl({executableName:o,definition:y,registry:t})}
`),0):(m.write(yA(v)),1)}if(p0(v))return m.write(`${v.message}
`),1;throw v}}function hA(e){let{registry:t,argv:r,executableName:o,version:n,packageName:s,packageVersion:i,runtime:a,env:c,stdout:m,stderr:u}=e;try{let p=Yi(r,void 0);if(p.flags["--version"])return m.write(`${n}
`),0;if(p.flags["--help"])return m.write(`${Cc({registry:t,executableName:o})}
`),0;if(p.positionals.length===0){m.write(`${Cc({registry:t,executableName:o})}
`);let d=tl({executableName:o,packageName:s,currentVersion:i,runtime:a,env:c,isJson:!1,stderrIsTTY:u.isTTY===!0});return d&&u.write(d.message),0}let l=p.positionals.join(" ");return u.write(`Unknown command "${l}". Run \`${o} --help\` for a list of commands.
`),1}catch(p){if(p0(p))return u.write(`${p.message}
`),1;throw p}}function Gv(e){let{registry:t,argv:r,executableName:o,version:n,packageName:s,packageVersion:i,runtime:a,env:c,stdout:m,stderr:u,groupPath:p}=e;try{let l=r.slice(p.length),d=Yi(l,void 0);if(d.flags["--version"])return m.write(`${n}
`),0;if(d.flags["--help"]||d.positionals.length===0){if(m.write(`${rh({registry:t,executableName:o,groupPath:p})}
`),!d.flags["--help"]){let y=tl({executableName:o,packageName:s,currentVersion:i,runtime:a,env:c,isJson:!1,stderrIsTTY:u.isTTY===!0});y&&u.write(y.message)}return 0}let h=d.positionals.join(" "),g=p.join(" ");return u.write(`Unknown subcommand "${h}" for "${g}". Run \`${o} ${g} --help\` for a list of subcommands.
`),1}catch(l){if(p0(l))return u.write(`${l.message}
`),1;throw l}}function gA(e){let t=[];for(let r of e){if(r.startsWith("-"))break;t.push(r)}return t}function yA(e){let t=e.issues[0];return t?`Invalid value for "${t.path.length>0?t.path.join("."):"input"}": ${t.message}
`:`${e.message}
`}function p0(e){return e instanceof Error&&Object.prototype.hasOwnProperty.call(e,"code")&&typeof e.code=="string"}function qv(e){return{name:e,children:new Map,aliasMap:new Map}}var rl=class{constructor(){this.root=qv(null)}registerGroup(t){let r=this.ensurePath(t.path);r.group=t;let o=this.getParentNode(t.path);if(o&&t.meta.aliases){let n=t.path[t.path.length-1];for(let s of t.meta.aliases)o.aliasMap.set(s,n)}}registerCommand(t){let r=this.ensurePath(t.path);r.command=t;let o=this.getParentNode(t.path);if(o&&t.meta.aliases){let n=t.path[t.path.length-1];for(let s of t.meta.aliases)o.aliasMap.set(s,n)}}resolveCommand(t){let r=this.root,o;for(let a=0;a<t.length;a+=1){let c=t[a],m=this.getChild(r,c);if(!m)break;r=m,r.command&&(o={node:r,depth:a+1})}if(!o)return;let n=t.slice(0,o.depth),s=t.slice(o.depth),i=o.node.command;return i?{definition:i,consumed:n,remaining:s}:null}getChildren(t=[]){let r=this.getNode(t);return r?[...r.children.values()]:[]}getNode(t){let r=this.root;for(let o of t){let n=this.getChild(r,o);if(!n)return;r=n}return r}ensurePath(t){let r=this.root;for(let o of t){let n=r.children.get(o);n||(n=qv(o),r.children.set(o,n)),r=n}return r}getParentNode(t){if(t.length!==0)return this.getNode(t.slice(0,-1))}getChild(t,r){let o=t.children.get(r);if(o)return o;let n=t.aliasMap.get(r);if(n)return t.children.get(n)}};import{readFileSync as l0}from"fs";import{dirname as vA,join as wA}from"path";import{fileURLToPath as CA}from"url";function $(e){return{path:e.path,meta:e.meta,schema:e.schema,run:e.handler}}import bA from"@michaelhomer/jqjs";function Kv(e,t){let o=[...bA.compile(t)(e)];return o.length===1?o[0]:o}function Wv(e,t=2){return e==null?String(e):typeof e=="string"?e:JSON.stringify(e,null,t)}import{z as mt}from"zod";var xA=["GET","POST","PUT","PATCH","DELETE","HEAD","OPTIONS"],Jv={name:"api",description:`Make an authenticated HTTP request to Phala Cloud API.

The endpoint should be an API path like "/cvms" or "/users/me".

By default, GET is used. If you add -f, -F, -d or --input, it switches to POST.
Use -X to override the method explicitly.

Use -f key=value for string parameters, -F key:=value for typed JSON values
(numbers, booleans, null, arrays, objects). Both support @file syntax to read
values from files: -f content=@file.txt (as string), -F config:=@data.json (as JSON).

Use -d to send raw request body data (cURL-style). If the value is valid JSON,
it will be sent as JSON automatically.

Use --input to send a JSON file as request body, or --input - to read from stdin.

Use -q to filter JSON output with jq syntax (built-in, no jq installation needed).

ENVIRONMENT VARIABLES

  PHALA_CLOUD_API_KEY       Override the API key (useful for CI/CD)
  PHALA_CLOUD_API_PREFIX    Override the API base URL`,stability:"unstable",arguments:[{name:"endpoint",description:"API endpoint path",required:!0}],options:[...Kn,{name:"method",shorthand:"X",description:"HTTP method (default: GET)",type:"string",target:"method"},{name:"field",shorthand:"f",description:"String parameter: key=value (use key=@file to read from file)",type:"string[]",target:"field"},{name:"raw-field",shorthand:"F",description:"Typed JSON parameter: key:=value (use key:=@file for JSON file)",type:"string[]",target:"rawField"},{name:"header",shorthand:"H",description:"HTTP header: key:value",type:"string[]",target:"header"},{name:"data",shorthand:"d",description:"Request body data (cURL-style)",type:"string[]",target:"data"},{name:"input",description:'Read body from file (use "-" for stdin)',type:"string",target:"input"},{name:"include",shorthand:"i",description:"Print response headers",type:"boolean",target:"include"},{name:"jq",shorthand:"q",description:"Filter output with jq expression",type:"string",target:"jq"},{name:"silent",description:"Don't print response body",type:"boolean",target:"silent"}],examples:[{name:"List CVMs",value:"phala api /cvms"},{name:"Get CVM by app ID",value:"phala api /cvms/app_xxx"},{name:"Filter with jq",value:"phala api /cvms -q '.items[].name'"},{name:"POST with string params",value:"phala api /endpoint -X POST -f name=foo -f tag=bar"},{name:"POST with typed params",value:"phala api /endpoint -X POST -F count:=10 -F enabled:=true"},{name:"POST from file",value:"phala api /endpoint -X POST --input data.json"},{name:"POST with cURL-style -d",value:`phala api /endpoint -d '{"foo":"bar"}'`},{name:"POST with file content as string field",value:"phala api /endpoint -f content=@readme.txt"},{name:"POST with JSON file as nested object",value:"phala api /endpoint -F config:=@settings.json"},{name:"Show response headers",value:"phala api /cvms -i"}]},Zv=mt.object({endpoint:mt.string(),method:mt.enum(xA).default("GET").transform(e=>e.toUpperCase()),field:mt.array(mt.string()).optional(),rawField:mt.array(mt.string()).optional(),header:mt.array(mt.string()).optional(),data:mt.array(mt.string()).optional(),input:mt.string().optional(),include:mt.boolean().default(!1),jq:mt.string().optional(),silent:mt.boolean().default(!1),apiToken:mt.string().optional()});var EA=CA(import.meta.url),SA=vA(EA),kA=wA(SA,"../../../package.json"),Yv="unknown";try{Yv=JSON.parse(l0(kA,"utf-8")).version||"unknown"}catch{}function IA(e){let t={};for(let r of e??[]){let o=r.indexOf("=");if(o>0){let n=r.slice(0,o),s=r.slice(o+1);if(s.startsWith("@")){let i=s.slice(1);t[n]=f0(i)}else t[n]=s}}return t}function _A(e){let t={};for(let r of e??[]){let o=r.indexOf(":=");if(o>0){let n=r.slice(0,o),s=r.slice(o+2);if(s.startsWith("@")){let i=s.slice(1),a=f0(i);try{t[n]=JSON.parse(a)}catch{throw new Error(`Failed to parse JSON from file "${i}" for field "${n}"`)}}else t[n]=AA(s)}}return t}function AA(e){if(e==="true")return!0;if(e==="false")return!1;if(e==="null")return null;if(/^-?\d+$/.test(e))return Number.parseInt(e,10);if(/^-?\d+\.\d+$/.test(e))return Number.parseFloat(e);if(e.startsWith("[")||e.startsWith("{"))try{return JSON.parse(e)}catch{}return e}function PA(e){let t={};for(let r of e??[]){let o=r.indexOf(":");if(o>0){let n=r.slice(0,o).trim(),s=r.slice(o+1).trim();t[n]=s}}return t}function TA(e,t){let r=t.toLowerCase();return Object.keys(e).some(o=>o.toLowerCase()===r)}function f0(e){return e==="-"?l0(0,"utf-8"):l0(e,"utf-8")}function $A(e){return f0(e)}function RA(e){return!["GET","HEAD","OPTIONS"].includes(e)}function MA(e){if(e.input&&e.data&&e.data.length>0)throw new Error('"-d/--data" cannot be used with "--input"');if(e.input){let n=$A(e.input);try{return{body:JSON.parse(n)}}catch{return{body:n}}}if(e.data&&e.data.length>0){if(e.field&&e.field.length>0||e.rawField&&e.rawField.length>0)throw new Error('"-d/--data" cannot be used with "-f/--field" or "-F/--raw-field"');let n=e.data.length===1?e.data[0]:e.data.join("&"),s=n.trim();if(s.startsWith("{")||s.startsWith("["))try{return{body:JSON.parse(s)}}catch{}return{body:n,defaultContentType:"application/x-www-form-urlencoded"}}let t=IA(e.field),r=_A(e.rawField),o={...t,...r};return Object.keys(o).length===0?{body:void 0}:{body:o}}async function BA(e,t){let r=e.apiToken||_t();if(!r)return t.stderr.write(`Error: Not authenticated. Run "phala login" first.
`),1;let o=Le({apiKey:r,headers:{"User-Agent":`phala-cli/${Yv}`}}),n=PA(e.header),s=e.endpoint.startsWith("/")?e.endpoint:`/${e.endpoint}`;try{let{body:i,defaultContentType:a}=MA(e);a&&!TA(n,"content-type")&&(n["Content-Type"]=a);let c=i!==void 0&&e.method==="GET"?"POST":e.method,m=await o.requestFull(s,{method:c,body:RA(c)?i:void 0,headers:n});if(e.include&&(t.stdout.write(`HTTP/1.1 ${m.status} ${m.statusText}
`),m.headers.forEach((u,p)=>{t.stdout.write(`${p}: ${u}
`)}),t.stdout.write(`
`)),!e.silent&&m.data!==void 0){let u=m.data;if(e.jq)try{u=Kv(u,e.jq)}catch(l){return t.stderr.write(`Error: jq filter failed: ${l.message}
`),1}let p=Wv(u);t.stdout.write(`${p}
`)}return m.ok?0:1}catch(i){let a=i;return t.stderr.write(`Error: ${a.message}
`),1}}var Xv=$({path:["api"],meta:Jv,schema:Zv,handler:BA});var Qv={path:["auth"],meta:{name:"auth",description:"Authenticate with Phala Cloud",stability:"deprecated"}};import FA from"prompts";var xe=process.env.CLOUD_URL||"https://cloud.phala.com";var Un=1,zn=2048,Hn=40,d0="dstack-0.3.6",e6=`version: '3.8'
services:
  postgres:
    image: ankane/pgvector:latest
    environment:
        - POSTGRES_PASSWORD=postgres
        - POSTGRES_USER=postgres
        - POSTGRES_DB=eliza
        - PGDATA=/var/lib/postgresql/data/pgdata
    volumes:
        - postgres-data:/var/lib/postgresql/data:rw
    ports:
        - '127.0.0.1:5432:5432'
    healthcheck:
        test: ['CMD-SHELL', 'pg_isready -U $\${POSTGRES_USER} -d $\${POSTGRES_DB}']
        interval: 5s
        timeout: 5s
        retries: 5
    restart: always
    networks:
      - eliza-network
  eliza:
    image: {{imageName}}
    command: bun run start
    volumes:
      - /var/run/tappd.sock:/var/run/tappd.sock
    environment:
{{#each envVars}}      - {{{this}}}
{{/each}}
    ports:
      - '3000:3000'
      - '50000-50100:50000-50100/udp'
    depends_on:
      postgres:
        condition: service_healthy
    restart: always
    networks:
      - eliza-network


networks:
  eliza-network:
    driver: bridge

volumes:
  postgres-data:`,t6=`version: '3.8'
services:
  app:
    image: {{imageName}}
    container_name: app
    volumes:
      - /var/run/tappd.sock:/var/run/tappd.sock
    environment:
{{#each envVars}}      - {{{this}}}
{{/each}}
    restart: always
`;import{z as ol}from"zod";var r6={name:"login",description:"Authenticate with Phala Cloud (use 'phala login' instead)",stability:"deprecated",arguments:[{name:"api-key",description:"API key for authentication (optional, triggers device flow if not provided)",required:!1,target:"apiKey"}],options:[{name:"manual",description:"Manually enter API key instead of using device flow",type:"boolean"},{name:"no-open",description:"Don't automatically open browser for device flow",type:"boolean"}]},o6=ol.object({apiKey:ol.string().min(1,"API key cannot be empty").optional(),manual:ol.boolean().optional(),noOpen:ol.boolean().optional()});async function h0(e){try{await Wp(e);let t=await Jp(e),r=await uo(t),o=r.data;if(!r.success||!o?.username)throw await jr(),new Error("Invalid API key");return o}catch(t){throw await jr(),t instanceof Error?t:new Error(String(t))}}async function DA(){let e,t=await FA({type:"password",name:"apiKey",message:"Enter your API key:",validate:async r=>{if(!r||r.trim().length===0)return"API key cannot be empty";try{return e=await h0(r),!0}catch(o){return o instanceof Error?o.message:"Invalid API key"}}});if(!t.apiKey)throw new Error("API key input cancelled");return e||(e=await h0(t.apiKey)),{apiKey:t.apiKey,user:e}}async function NA(e,t){f.warn('The "phala auth login" command is deprecated and will be removed in a future version.'),f.info('Please use "phala login" instead for a better experience.'),f.break();try{let r=e.apiKey,o;if(r)o=await h0(r);else{let n=await DA();r=n.apiKey,o=n.user}if(!o)throw new Error("Failed to validate API key");return f.success(`Welcome ${o.username}! API key validated and saved successfully`),f.break(),f.info(`Open in Web UI at ${xe}/dashboard/`),0}catch(r){return f.error("Failed to set API key"),f.logDetailedError(r),1}}var n6=$({path:["auth","login"],meta:r6,schema:o6,handler:NA});import{z as LA}from"zod";var s6={name:"logout",description:"Remove the stored API key (use 'phala logout' instead)",stability:"deprecated"},i6=LA.object({});async function OA(e,t){f.warn('The "phala auth logout" command is deprecated and will be removed in a future version.'),f.info('Please use "phala logout" instead.'),f.break();try{return await jr(),f.success("API key removed successfully"),0}catch(r){return f.error("Failed to remove API key"),f.logDetailedError(r),1}}var a6=$({path:["auth","logout"],meta:s6,schema:i6,handler:OA});import{z as nl}from"zod";var Nt={name:"json",shorthand:"j",description:"Output in JSON format",type:"boolean",target:"json",negatedName:"no-json"},g0={name:"debug",shorthand:"d",description:"Enable debug output",type:"boolean",target:"debug"},c6={name:"status",description:"Check Phala Cloud status and authentication",stability:"stable",options:[...Kn,Nt,g0],examples:[{name:"Show login status in human-readable format",value:"phala status"},{name:"Get status as JSON",value:"phala status --json"}]},sl=nl.object({json:nl.boolean().default(!1),debug:nl.boolean().default(!1),apiToken:nl.string().optional()});async function y0(e,t){we(e.json);let r=e.debug||t.env.DEBUG?.toLowerCase()==="true",o=e.apiToken||_t();if(!o)return f.warn('Not authenticated. Please set an API key with "phala login"'),0;r&&f.debug(`Using API key: ${o.substring(0,5)}...`);try{let n=Le({apiKey:o}),s=await uo(n);if(!s.success)return f.error("Failed to get user information"),s.error&&f.error(`Error: ${s.error.message}`),t.fail(s.error?.message||"Failed to get user information"),1;let i=s.data,a=t.env.PHALA_CLOUD_API_PREFIX||"https://cloud-api.phala.network/api/v1";return e.json?(t.success({apiUrl:a,username:i.username,team_name:i.team_name}),0):(t.stdout.write(`Integrated API: ${a}
`),t.stdout.write(`Logged in as: ${i.username}
`),t.stdout.write(`Current Workspace: ${i.team_name}
`),0)}catch(n){return f.error("Authentication failed. Your API key may be invalid or expired."),f.info('Please set a new API key with "phala login"'),r&&f.logDetailedError(n),t.fail("Authentication failed. Your API key may be invalid or expired."),1}}var m6=$({path:["status"],meta:c6,schema:sl,handler:y0});var u6={name:"status",description:"Check authentication status (use 'phala status' instead)",stability:"deprecated",options:[...Kn,Nt,g0]},p6=sl;var l6=$({path:["auth","status"],meta:u6,schema:p6,handler:async(e,t)=>(e.json||(f.warn('The "phala auth status" command is deprecated and will be removed in a future version.'),f.info('Please use "phala status" instead.'),f.break()),y0(e,t))});var b0={group:Qv,commands:[n6,a6,l6]};var f6={path:["config"],meta:{name:"config",description:"Manage your local configuration",stability:"stable"}};import{z as d6}from"zod";var h6={name:"get",description:"Get a configuration value",stability:"stable",arguments:[{name:"key",description:"Configuration key",required:!0}]},g6=d6.object({key:d6.string()});async function UA(e,t){try{let r=Ui(e.key);return r===void 0?(t.stderr.write(`Configuration key '${e.key}' not found
`),1):(t.stdout.write(`${e.key}: ${JSON.stringify(r)}
`),0)}catch(r){return t.stderr.write(`Failed to get configuration value
`),f.logDetailedError(r),1}}var y6=$({path:["config","get"],meta:h6,schema:g6,handler:UA});import{z as b6}from"zod";var x6={name:"list",aliases:["ls"],description:"List all configuration values",stability:"stable",options:[{name:"json",shorthand:"j",description:"Output in JSON format",type:"boolean",target:"json"}]},v6=b6.object({json:b6.boolean().default(!1)});async function zA(e,t){we(e.json);try{let r=Nv();if(e.json)return t.success(r),0;t.stdout.write(`Configuration values:
`);for(let[o,n]of Object.entries(r))t.stdout.write(`${o}: ${JSON.stringify(n)}
`);return 0}catch(r){return f.logDetailedError(r),t.fail("Failed to list configuration values"),1}}var w6=$({path:["config","list"],meta:x6,schema:v6,handler:zA});import{z as x0}from"zod";var C6={name:"set",description:"Set a configuration value",stability:"stable",arguments:[{name:"key",description:"Configuration key",required:!0},{name:"value",description:"Configuration value",required:!0}]},E6=x0.object({key:x0.string(),value:x0.string()});async function HA(e,t){try{let r=e.value;if(e.value.startsWith("{")||e.value.startsWith("[")||e.value==="true"||e.value==="false"||!Number.isNaN(Number(e.value)))try{r=JSON.parse(e.value)}catch{}return Dv(e.key,r),t.stdout.write(`Configuration value for '${e.key}' set successfully
`),0}catch(r){return t.stderr.write(`Failed to set configuration value
`),f.logDetailedError(r),1}}var S6=$({path:["config","set"],meta:C6,schema:E6,handler:HA});var v0={group:f6,commands:[y6,w6,S6]};var k6={path:["cvms"],meta:{name:"cvms",description:"Manage Phala Confidential Virtual Machines (CVMs)",stability:"unstable"}};import al from"chalk";import{z as il}from"zod";var I6={name:"attestation",description:"Get attestation information for a CVM",stability:"unstable",arguments:[Be],options:[Nt,$e],examples:[{name:"Show attestation summary",value:"phala cvms attestation"},{name:"Output full attestation JSON",value:"phala cvms attestation --json"}]},_6=il.object({cvmId:il.string().optional(),interactive:il.boolean().default(!1),json:il.boolean().default(!1)});async function jA(e,t){if(we(e.json),!t.cvmId)return t.fail("No CVM ID provided. Use --interactive to select interactively."),1;try{let r=await K(),o=await Se(r,t.cvmId);if(!o.success)return t.fail(o.error.message),1;let n=o.data;if(!n)return t.fail("CVM not found"),1;let s=n.app_id,i=f.startSpinner(`Fetching attestation information for CVM app_${s}...`);try{let a=await Cv(s);if(i.stop(!0),!a)return t.fail("No attestation information found"),1;if(e.json)return t.success(a),0;if(f.success("Attestation Summary:"),f.keyValueTable({Status:a.is_online?al.green("Online"):al.red("Offline"),"Public Access":a.is_public?al.green("Enabled"):al.yellow("Disabled"),Error:a.error||"None",Certificates:`${a.app_certificates?.length||0} found`},{borderStyle:"rounded"}),a.app_certificates?.length&&a.app_certificates.forEach((c,m)=>{f.break(),f.success(`Certificate #${m+1} (${c.position_in_chain===0?"End Entity":"CA"}):`),f.keyValueTable({Subject:`${c.subject.common_name||"Unknown"}${c.subject.organization?` (${c.subject.organization})`:""}`,Issuer:`${c.issuer.common_name||"Unknown"}${c.issuer.organization?` (${c.issuer.organization})`:""}`,"Serial Number":c.serial_number,Validity:`${new Date(c.not_before).toLocaleString()} to ${new Date(c.not_after).toLocaleString()}`,Fingerprint:c.fingerprint,"Signature Algorithm":c.signature_algorithm,"Is CA":c.is_ca?"Yes":"No","Position in Chain":c.position_in_chain},{borderStyle:"rounded"})}),a.tcb_info&&(f.break(),f.success("Trusted Computing Base (TCB) Information:"),f.keyValueTable({Mrtd:a.tcb_info.mrtd,"Rootfs Hash":a.tcb_info.rootfs_hash,Rtmr0:a.tcb_info.rtmr0,Rtmr1:a.tcb_info.rtmr1,Rtmr2:a.tcb_info.rtmr2,Rtmr3:a.tcb_info.rtmr3,"Event Log Entries":`${a.tcb_info.event_log.length} entries`},{borderStyle:"rounded"}),a.tcb_info.event_log?.length)){f.break(),f.success("Event Log (Showing entries to reproduce RTMR3):");let c=a.tcb_info.event_log.filter(m=>m.event).map(m=>({Event:m.event,IMR:m.imr.toString(),"Event Type":m.event_type.toString(),Payload:m.event_payload}));f.table(c,[{key:"Event",header:"Event"},{key:"IMR",header:"IMR"},{key:"Event Type",header:"Type"},{key:"Payload",header:"Payload"}]),a.tcb_info.event_log.length>c.length&&f.info("To see all full attestation data, use --json"),f.break(),f.success("To reproduce RTMR3, use the tool at https://rtmr3-calculator.vercel.app/")}return 0}catch(a){throw i.stop(!1),a}}catch(r){return f.logDetailedError(r),t.fail(`Failed to get attestation information: ${r instanceof Error?r.message:String(r)}`),1}}var A6=$({path:["cvms","attestation"],meta:I6,schema:_6,handler:jA});import D6 from"fs";import WA from"path";import w0 from"fs";import C0 from"path";import GA from"inquirer";function Lt(e,t=process.cwd()){let r=C0.resolve(t,e);if(!w0.existsSync(r))throw new Error(`File not found at ${r}`);return!0}async function lo(e,t,r="file",o=process.cwd()){return(await GA.prompt([{type:"input",name:r,message:e,default:t,validate:s=>{let i=C0.resolve(o,s);return w0.existsSync(i)?!0:`File not found at ${i}`}}]))[r]}function ji(e,t){for(let r of e){let o=C0.join(process.cwd(),r);if(w0.existsSync(o))return t?f.info(t.replace("{path}",o)):f.info(`File detected: ${o}`),r}}import*as P6 from"fs";var ac=(e,t)=>{let r={};if(e){for(let o of e)if(o.includes("=")){let[n,...s]=o.split("="),i=s.join("=");n&&(r[n]=i)}}if(t){let o=P6.readFileSync(t,"utf8");for(let n of o.split(`
`)){if(!n.trim()||n.trim().startsWith("#"))continue;let s=-1,i=!1,a="";for(let g=0;g<n.length;g++)if((n[g]==='"'||n[g]==="'"||n[g]==="`")&&(g===0||n[g-1]!=="\\"))i&&n[g]===a?(i=!1,a=""):i||(i=!0,a=n[g]);else if(n[g]==="="&&!i){s=g;break}else if(n[g]==="#"&&!i)break;if(s===-1){n.trim().startsWith("#");continue}let c=n.substring(0,s).trim(),m=n.substring(s+1),u=!1,p="",l=-1;for(let g=0;g<m.length;g++)if((m[g]==='"'||m[g]==="'"||m[g]==="`")&&(g===0||m[g-1]!=="\\"))u&&m[g]===p?(u=!1,p=""):u||(u=!0,p=m[g]);else if(m[g]==="#"&&!u&&g>0&&m[g-1]===" "){l=g-1;break}else if(m[g]==="#"&&!u&&g===0){l=g;break}l!==-1&&(m=m.substring(0,l)),m===void 0&&(m="");let d=m.charAt(0),h=m.charAt(m.length-1);d==='"'&&h==='"'||d==="'"&&h==="'"||d==="`"&&h==="`"?(m=m.substring(1,m.length-1),d==='"'&&(m=m.replace(/\\\\n/g,`
`))):m=m.trim(),c&&(r[c]=m)}}return Object.entries(r).map(([o,n])=>({key:o,value:n}))};import{execSync as fo,spawn as VA}from"child_process";import*as ne from"fs";import*as E0 from"net";import*as Gr from"os";import*as or from"path";var Qe={version:"0.5.3",baseUrl:"https://github.com/Dstack-TEE/dstack/releases/download/v0.5.3",installDir:or.join(Gr.homedir(),".phala-cloud","simulator"),defaultLogPath:or.join(Gr.homedir(),".phala-cloud","logs","dstack-simulator.log"),platforms:{darwin:{filename:"dstack-simulator-0.5.3-aarch64-apple-darwin.tgz",extractedFolder:"0.5.3",socketPath:or.join(Gr.homedir(),".phala-cloud","simulator","0.5.3","dstack.sock")},linux:{filename:"dstack-simulator-0.5.3-x86_64-linux-musl.tgz",extractedFolder:"0.5.3",socketPath:or.join(Gr.homedir(),".phala-cloud","simulator","0.5.3","dstack.sock")},win32:{filename:"dstack-simulator-0.5.3-x86_64-pc-windows-msvc.tgz",extractedFolder:"dstack-simulator-0.5.3-x86_64-pc-windows-msvc",socketPath:"127.0.0.1:8090"}}};function T6(){try{if(!ne.existsSync(Qe.installDir))return!1;let e=Gr.platform();if(!Qe.platforms[e])throw new Error(`Unsupported platform: ${e}`);let t=or.join(Qe.installDir,Qe.platforms[e].extractedFolder);if(!ne.existsSync(t))return!1;let o=or.join(t,e==="win32"?"dstack-simulator.exe":"dstack-simulator");return ne.existsSync(o)}catch(e){return f.error("Error checking if simulator is installed:",e),!1}}function cc(){let e=Gr.platform();if(!Qe.platforms[e])throw new Error(`Unsupported platform: ${e}. Only darwin, linux, and win32 are supported.`);return e}async function $6(e){let t=r=>{f.info(r),e&&e(r)};try{let r=cc(),o=Qe.platforms[r];if(r==="win32"){try{fo("tar --version",{stdio:"ignore"})}catch{throw new Error("Windows 10 build 17063 or later is required (includes tar command). Please update your Windows version.")}throw new Error("Windows platform is currently not supported. Support will be added in a future release.")}ne.existsSync(Qe.installDir)||(f.info(`Creating installation directory at ${Qe.installDir}`),ne.mkdirSync(Qe.installDir,{recursive:!0})),process.chdir(Qe.installDir);let n=`${Qe.baseUrl}/${o.filename}`;f.info(`Downloading simulator from ${n}`),fo(`wget ${n}`,{stdio:"inherit"});let s=or.join(Qe.installDir,o.extractedFolder);ne.existsSync(s)||ne.mkdirSync(s,{recursive:!0}),f.info(`Extracting ${o.filename} to ${s}`);let i=`tar -xvf "${o.filename}" -C "${s}" --strip-components=1`;f.debug(`Running: ${i}`);try{fo(i,{stdio:"inherit"}),ne.unlinkSync(o.filename)}catch(a){throw f.error(`Failed to extract ${o.filename}:`,a),new Error("Failed to extract simulator archive. Make sure you have sufficient permissions and disk space.")}f.success("Simulator installation completed successfully")}catch(r){throw f.error("Error installing simulator:",r),new Error(`Failed to install simulator: ${r}`)}}var S0=()=>or.join(Gr.tmpdir(),"dstack-simulator.pid");function qA(e){return Buffer.byteLength(e,"utf8")>104}function cl(){try{let e=S0();if(ne.existsSync(e)){let t=Number.parseInt(ne.readFileSync(e,"utf-8").trim(),10);try{return process.kill(t,0),t}catch{ne.unlinkSync(e)}}return null}catch(e){return f.warn("Error checking simulator PID:",e),null}}function KA(e,t){try{let r=S0();t&&f.info(`Saving simulator PID ${e} to: ${r}`),ne.writeFileSync(r,e.toString(),"utf-8")}catch(r){f.warn("Failed to save simulator PID:",r)}}async function R6(e={}){try{let t=cc(),r=Qe.platforms[t],o=or.join(Qe.installDir,r.extractedFolder),n=cl();if(n)throw new Error(`Simulator is already running with PID: ${n}`);if(t!=="win32"&&qA(r.socketPath))throw new Error(`Socket path is too long (${r.socketPath.length} chars, max 104): ${r.socketPath}`);if(t!=="win32"&&ne.existsSync(r.socketPath)){f.warn(`Removing existing socket file: ${r.socketPath}`);try{ne.unlinkSync(r.socketPath)}catch(m){f.warn(`Failed to remove existing socket file: ${m}`)}}process.chdir(o);let s=t==="win32"?"dstack-simulator.exe":"./dstack-simulator";e.verbose&&t!=="win32"&&f.info(`Using socket path: ${r.socketPath}`);let i={background:e.background??!0,logToFile:e.logToFile??!0,logFilePath:e.logFilePath??Qe.defaultLogPath};if(i.logToFile){let m=or.dirname(i.logFilePath);ne.existsSync(m)||ne.mkdirSync(m,{recursive:!0}),e.verbose&&f.info(`Simulator logs will be written to: ${i.logFilePath}`)}e.verbose&&f.info(`Starting simulator with: ${s}`);let a=i.logToFile?["ignore",ne.openSync(i.logFilePath,"a"),ne.openSync(i.logFilePath,"a")]:"inherit",c=VA(s,[],{stdio:a,shell:t==="win32",detached:i.background});if(i.logToFile&&Array.isArray(a)&&(typeof a[1]=="number"&&ne.closeSync(a[1]),typeof a[2]=="number"&&ne.closeSync(a[2])),i.logToFile){let u=`
=== Simulator started at ${new Date().toISOString()} ===
Command: ${s}

`;ne.appendFileSync(i.logFilePath,u)}return c.pid&&KA(c.pid,e.verbose),i.background&&(c.unref(),e.verbose&&f.success("Simulator is running in the background")),await I0(),c}catch(t){throw f.error("Error running simulator:",t),new Error(`Failed to run simulator: ${t}`)}}async function mc(){try{let e=cc(),t=Qe.platforms[e];if(e==="darwin"||e==="linux"){let r=t.socketPath;return ne.existsSync(r)?new Promise(o=>{let n=E0.createConnection({path:r}).on("connect",()=>{n.end(),o(!0)}).on("error",()=>{o(!1)});setTimeout(()=>{n.end(),o(!1)},1e3)}):!1}if(e==="win32"){let r="127.0.0.1";return new Promise(n=>{let s=E0.createConnection({host:r,port:8090}).on("connect",()=>{s.end(),n(!0)}).on("error",()=>{n(!1)});setTimeout(()=>{s.end(),n(!1)},1e3)})}return!1}catch(e){return f.error("Error checking if simulator is running:",e),!1}}async function M6(){try{let e=cl();if(!await mc()&&!e)return f.info("Simulator is not running"),!0;let r=cc(),o=!1;if(r==="win32")try{e?(f.info(`Stopping simulator process (PID: ${e})...`),process.kill(e,"SIGTERM")):fo("taskkill /F /IM dstack-simulator.exe",{stdio:"ignore"}),o=!0}catch(s){if(s.code!=="ESRCH")return f.error("Failed to stop simulator:",s),!1;o=!0}else try{e?(f.info(`Stopping simulator process (PID: ${e})...`),process.kill(e,"SIGTERM")):fo("pkill -f dstack-simulator",{stdio:"ignore"}),o=!0}catch(s){if(s.code!=="ESRCH")return f.error("Failed to stop simulator:",s),!1;o=!0}let n=S0();if(ne.existsSync(n))try{ne.unlinkSync(n)}catch(s){f.warn("Failed to remove PID file:",s)}return await jn(),o&&f.success("Simulator stopped successfully"),o}catch(e){return f.error("Error stopping simulator:",e),!1}}function k0(){let e=cc(),t=Qe.platforms[e];return e==="win32"?"http://127.0.0.1:8090":`${t.socketPath||"/tmp/dstack.sock"}`}async function I0(e){try{let t=k0(),r=e||t;await fo(`export DSTACK_SIMULATOR_ENDPOINT=${r}`);let o=r.replace(/dstack\.sock$/,"tappd.sock");return await fo(`export TAPPD_SIMULATOR_ENDPOINT=${o}`),f.success("Setting environment for current process..."),f.success(`  DSTACK_SIMULATOR_ENDPOINT=${r}`),f.success(`  TAPPD_SIMULATOR_ENDPOINT=${o}`),r}catch(t){throw f.error("Error setting simulator endpoint environment variable:",t),new Error(`Failed to set simulator endpoint: ${t}`)}}async function jn(){try{return await fo("unset DSTACK_SIMULATOR_ENDPOINT"),await fo("unset TAPPD_SIMULATOR_ENDPOINT"),f.debug("Deleted simulator endpoint environment variables from current process"),!0}catch(e){return f.warn("Error while unsetting simulator endpoint environment variables:",e),!1}}import N6 from"inquirer";import{z as gr}from"zod";var B6={name:"create",description:'Create a new CVM (use "phala deploy" instead)',stability:"deprecated",options:[{name:"name",shorthand:"n",description:"Name of the CVM",type:"string",target:"name"},{name:"compose",shorthand:"c",description:"Path to Docker Compose file",type:"string",target:"compose"},{name:"vcpu",description:`Number of vCPUs, default is ${Un}`,type:"string",target:"vcpu"},{name:"memory",description:`Memory in MB, default is ${zn}`,type:"string",target:"memory"},{name:"disk-size",description:`Disk size in GB, default is ${Hn}`,type:"string",target:"diskSize"},{name:"teepod-id",description:"TEEPod ID to use. If not provided, it will be selected automatically.",type:"string",target:"teepodId"},{name:"image",description:"Version of dstack image to use. If not provided, a default image is used.",type:"string",target:"image"},{name:"env-file",shorthand:"e",description:"Path to environment file",type:"string",target:"envFile"},{name:"skip-env",description:"Skip environment variable prompt",type:"boolean",target:"skipEnv"},{name:"debug",description:"Enable debug mode",type:"boolean",target:"debug"}],examples:[{name:"Create a CVM interactively",value:"phala cvms create"},{name:"Create using predefined values",value:"phala cvms create --name demo --compose ./docker-compose.yml"}]},F6=gr.object({name:gr.string().optional(),compose:gr.string().optional(),vcpu:gr.string().optional(),memory:gr.string().optional(),diskSize:gr.string().optional(),teepodId:gr.string().optional(),image:gr.string().optional(),envFile:gr.string().optional(),skipEnv:gr.boolean().default(!1),debug:gr.boolean().default(!1)});async function JA(e){if(e)return e;let{value:t}=await N6.prompt([{type:"input",name:"value",message:"Enter a name for the CVM:",validate:r=>{let o=r.trim();return o?o.length>20?"CVM name must be less than 20 characters":o.length<3?"CVM name must be at least 3 characters":/^[a-zA-Z0-9_-]+$/.test(o)?!0:"CVM name must contain only letters, numbers, underscores, and hyphens":"CVM name is required"}}]);return t.trim()}async function ZA(e){if(e)return e;let r=ji(["docker-compose.yml","docker-compose.yaml"],"Detected docker compose file: {path}");return await lo("Enter the path to your Docker Compose file:",r,"file")}async function YA(e){if(e.envFile)return ac([],e.envFile);if(e.skipEnv)return f.info("Skipping environment variable prompt"),[];let{shouldSkip:t}=await N6.prompt([{type:"confirm",name:"shouldSkip",message:"Do you want to skip environment variable prompt?",default:!0}]);if(t)return f.info("Skipping environment variable prompt"),[];let r=await lo("Enter the path to your environment file:",".env","file");return ac([],r)}function _0(e,t){if(!e)return t;let r=Number(e);return Number.isFinite(r)?r:t}function XA(e,t){return!Number.isFinite(t)||t<=0?`Invalid ${e}: ${t}`:null}async function QA(e,t){if(!t.nodes.length)return;if(!e)return t.nodes[0];let r=Number(e);return t.nodes.find(o=>o.teepod_id===r)}function eP(e,t){let r=e.images??[];return t?r.find(o=>o.name===t):r.find(o=>o.name===d0)}async function tP(e,t){try{f.warn('\u26A0\uFE0F  This command is deprecated. Please use "phala deploy" instead.'),f.warn("\u26A0\uFE0F  This legacy API will be maintained but may have limited support.\\n");let r=await JA(e.name),o=await ZA(e.compose),n=WA.resolve(o);if(!D6.existsSync(n))return f.error(`Docker Compose file not found: ${n}`),1;let s=D6.readFileSync(n,"utf8");await jn(),process.env.DSTACK_DOCKER_USERNAME&&process.env.DSTACK_DOCKER_PASSWORD?f.info("\u{1F510} Using private DockerHub registry credentials..."):process.env.DSTACK_AWS_ACCESS_KEY_ID&&process.env.DSTACK_AWS_SECRET_ACCESS_KEY&&process.env.DSTACK_AWS_REGION&&process.env.DSTACK_AWS_ECR_REGISTRY?f.info(`\u{1F510} Using private AWS ECR registry: ${process.env.DSTACK_AWS_ECR_REGISTRY}`):f.info("\u{1F510} Using public DockerHub registry...");let i=[];try{i=await YA(e)}catch(A){return f.error(`Failed to read environment file: ${A instanceof Error?A.message:String(A)}`),1}let a=_0(e.vcpu,Un),c=_0(e.memory,zn),m=_0(e.diskSize,Hn);for(let[A,k]of[["number of vCPUs",a],["memory",c],["disk size",m]]){let I=XA(A,k);if(I)return f.error(I),1}let u=f.startSpinner("Fetching available TEEPods"),p=await _v(!0);u.stop(!0);let l=await QA(e.teepodId,p);if(!l)return f.error("Failed to find suitable TEEPod"),1;let d=eP(l,e.image);if(!d)return f.error(e.image?`Failed to find selected image: ${e.image}`:`Failed to find default image ${d0}`),1;let h={teepod_id:l.teepod_id,name:r,image:d.name,vcpu:a,memory:c,disk_size:m,compose_manifest:{docker_compose_file:s,docker_config:{url:"",username:"",password:""},features:["kms","tproxy-net"],kms_enabled:!0,manifest_version:2,name:r,public_logs:!0,public_sysinfo:!0,runner:"docker-compose",tproxy_enabled:!0},listed:!1},g=f.startSpinner("Getting public key from CVM"),y=await Sv(h);if(g.stop(!0),!y)return f.error("Failed to get public key from CVM"),1;let x=f.startSpinner("Encrypting environment variables"),b=await(0,rr.encryptEnvVars)(i,y.app_env_encrypt_pubkey);x.stop(!0),e.debug&&(f.debug("Public key:",y.app_env_encrypt_pubkey),f.debug("Encrypted environment variables:",b),f.debug("Environment variables:",JSON.stringify(i)));let v=f.startSpinner("Creating CVM"),E=await kv({...h,encrypted_env:b,app_env_encrypt_pubkey:y.app_env_encrypt_pubkey,app_id_salt:y.app_id_salt});return v.stop(!0),E?(f.success("CVM created successfully"),f.break(),f.keyValueTable({"CVM ID":E.id,Name:E.name,Status:E.status,"App ID":`app_${E.app_id}`,"App URL":E.app_url||`${xe}/dashboard/cvms/app_${E.app_id}`},{borderStyle:"rounded"}),f.info(""),f.success(`Your CVM is being created. You can check its status with:
phala cvms get app_${E.app_id}`),0):(f.error("Failed to create CVM"),1)}catch(r){return f.error(`Failed to create CVM: ${r instanceof Error?r.message:String(r)}`),1}}var L6=$({path:["cvms","create"],meta:B6,schema:F6,handler:tP});import rP from"inquirer";import{z as uc}from"zod";var O6={name:"delete",description:"Delete a CVM",stability:"unstable",arguments:[Be],options:[$e,{name:"force",shorthand:"f",description:"Skip confirmation prompt",type:"boolean",target:"force"},{name:"yes",shorthand:"y",description:"Alias for --force (skip confirmation prompt)",type:"boolean",target:"yes"}],examples:[{name:"Delete a CVM interactively",value:"phala cvms delete"},{name:"Delete CVM by app_id",value:"phala cvms delete app_123 --force"},{name:"Delete CVM by UUID",value:"phala cvms delete 550e8400-e29b-41d4-a716-446655440000 -f"},{name:"Delete CVM by name",value:"phala cvms delete my-app --yes"}]},U6=uc.object({cvmId:uc.string().optional(),interactive:uc.boolean().default(!1),force:uc.boolean().default(!1),yes:uc.boolean().default(!1)});async function oP(e,t){if(!t.cvmId)return t.fail("No CVM ID provided. Use --interactive to select interactively."),1;try{let r=await K(),o=await Se(r,t.cvmId);if(!o.success)return t.fail(o.error.message),1;let n=o.data;if(!n)return t.fail("CVM not found"),1;let s=n.name||`app_${n.app_id}`;if(!e.force&&!e.yes){let{confirm:c}=await rP.prompt([{type:"confirm",name:"confirm",message:`Are you sure you want to delete CVM "${s}"? This action cannot be undone.`,default:!1}]);if(!c)return f.info("Deletion cancelled"),0}let i=f.startSpinner(`Deleting CVM ${s}`),a=await Xd(r,t.cvmId);return i.stop(!0),a.success?(f.success(`CVM ${s} deleted successfully`),0):(f.error(`Failed to delete CVM ${s}: ${a.error.message}`),1)}catch(r){return f.error("Failed to delete CVM"),f.logDetailedError(r),1}}var z6=$({path:["cvms","delete"],meta:O6,schema:U6,handler:oP});import A0 from"chalk";import{z as ml}from"zod";var H6={name:"get",description:"Get details of a CVM",stability:"unstable",arguments:[Be],options:[Nt,$e],examples:[{name:"Show CVM details interactively",value:"phala cvms get"},{name:"Get CVM by app_id",value:"phala cvms get app_abc123"},{name:"Get CVM by UUID",value:"phala cvms get 550e8400-e29b-41d4-a716-446655440000"},{name:"Get CVM by name",value:"phala cvms get my-app"}]},j6=ml.object({cvmId:ml.string().optional(),json:ml.boolean().default(!1),interactive:ml.boolean().default(!1)});async function nP(e,t){if(we(e.json),!t.cvmId)return t.fail("No CVM ID provided. Use --interactive to select interactively."),1;try{let r=f.startSpinner("Fetching CVM details"),o=await K(),n=await Se(o,t.cvmId);if(r.stop(!0),!n.success)return t.fail(n.error.message),1;let s=n.data;if(!s)return t.fail("CVM not found"),1;if(e.json)return t.success(s),0;f.break();let i=s.status==="running"?A0.green(s.status):s.status==="stopped"?A0.red(s.status):A0.yellow(s.status);return f.keyValueTable({Name:s.name,"App ID":`app_${s.app_id}`,Status:i,vCPU:s.vcpu,Memory:`${s.memory} MB`,"Disk Size":`${s.disk_size} GB`,"Dstack Image":s.base_image,"App URL":`${xe}/dashboard/cvms/app_${s.app_id}`}),0}catch(r){return f.logDetailedError(r),t.fail(`Failed to get CVM details: ${r instanceof Error?r.message:String(r)}`),1}}var G6=$({path:["cvms","get"],meta:H6,schema:j6,handler:nP});import P0 from"chalk";import{z as V6}from"zod";var q6={name:"list",aliases:["ls"],description:"List all CVMs",stability:"unstable",options:[Nt],examples:[{name:"Display CVMs in table format",value:"phala cvms list"},{name:"Print CVMs as JSON",value:"phala cvms list --json"}]},K6=V6.object({json:V6.boolean().default(!1)});async function sP(e,t){we(e.json);try{let r=f.startSpinner("Fetching CVMs"),o=await K(),n=await Ln(o);if(r.stop(!0),!n.success)return t.fail(n.error.message),1;let s=n.data.items??[];if(e.json)return t.success({items:s}),0;if(s.length===0)return f.info("No CVMs found"),0;for(let i of s){let a=i,c=a.status==="running"?P0.green(a.status):a.status==="stopped"?P0.red(a.status):P0.yellow(a.status??"unknown");f.keyValueTable({Name:a.name||"Unknown","App ID":`app_${a.hosted?.app_id||"unknown"}`,"CVM ID":a.hosted?.id?.replace(/-/g,"")||"unknown",Region:a.node?.region_identifier||"N/A",Status:c,"Node Info URL":a.hosted?.app_url||"N/A","App URL":`${xe}/dashboard/cvms/${a.hosted?.id?.replace(/-/g,"")||"unknown"}`},{borderStyle:"rounded"}),f.break()}return f.success(`Found ${s.length} CVMs`),f.break(),f.info(`Go to ${xe}/dashboard/ to view your CVMs`),0}catch(r){return f.logDetailedError(r),t.fail(`Failed to list CVMs: ${r instanceof Error?r.message:String(r)}`),1}}var W6=$({path:["cvms","list"],meta:q6,schema:K6,handler:sP});import{z as iP}from"zod";var J6={name:"list-nodes",description:"List all available worker nodes.",stability:"unstable"},Z6=iP.object({});async function aP(e,t){try{let r=await K(),o=await Qa(r);if(!o.success)throw new Error(o.error.message);let{nodes:n,kms_list:s}=o.data;if(!n||n.length===0)return f.info("No available nodes found."),0;f.info("Available Nodes:");for(let i of n)if(f.info("----------------------------------------"),f.info(`  ID:          ${i.teepod_id}`),f.info(`  Name:        ${i.name}`),f.info(`  Region:      ${i.region_identifier}`),f.info(`  FMSPC:       ${i.fmspc||"N/A"}`),f.info(`  Device ID:   ${i.device_id||"N/A"}`),f.info(`  Support Onchain KMS: ${i.support_onchain_kms}`),f.info("  Images:"),i.images&&i.images.length>0)for(let a of i.images)f.info(`    - ${a.name}`),f.info(`      Hash: ${a.os_image_hash||"N/A"}`);else f.info("    N/A");if(s&&s.length>0){f.info(`
Available KMS Instances:`);for(let i of s)f.info("----------------------------------------"),f.info(`  ID:                 ${i.id}`),f.info(`  URL:                ${i.url}`),f.info(`  Version:            ${i.version}`),f.info(`  Chain ID:           ${i.chain_id}`),f.info(`  Contract Address:   ${i.kms_contract_address}`),f.info(`  Gateway App ID:     ${i.gateway_app_id}`)}return 0}catch(r){return f.error("Failed to list available nodes"),f.logDetailedError(r),1}}var Y6=$({path:["cvms","list-nodes"],meta:J6,schema:Z6,handler:aP});async function X6(e){try{let t=await K(),r=await Se(t,{id:e});if(r.success&&r.data.public_logs===!1)return f.warn("Logs are disabled for this CVM (public_logs=false)."),f.warn("To enable logs, run:"),f.warn(`  phala deploy --cvm-id ${e} --public-logs`),!0}catch(t){f.debug?.(`Failed to check CVM info: ${t}`)}return!1}function ul(e,t){return async function(o,n){if(we(o.json),!n.cvmId)return n.fail("No CVM ID provided. Use --interactive to select interactively."),1;let{cvmId:s}=fe.parse(n.cvmId),i=t(o),a=e.logType==="serial"?"serial":"container";try{if(o.follow){if(o.json)return n.fail("Cannot use --json with --follow"),1;f.info(`Streaming ${a} logs (press Ctrl+C to stop)...`),f.break();let m=new AbortController,u=!1,p=()=>{u=!0,m.abort()};process.on("SIGINT",p),process.on("SIGTERM",p);try{await e.streamLogs(s,l=>process.stdout.write(l),i,m.signal)}catch(l){if(l.name!=="AbortError")throw l}finally{process.removeListener("SIGINT",p),process.removeListener("SIGTERM",p)}return u&&(f.break(),f.info("Stopped streaming logs")),0}let c=await e.fetchLogs(s,i);return o.json?(n.success({logs:c,cvm_id:s}),0):(c.trim()?console.log(c):await X6(s)||f.info("No logs available"),0)}catch(c){return await X6(s)||(f.logDetailedError(c),n.fail(`Failed to fetch ${a} logs: ${c instanceof Error?c.message:String(c)}`)),1}}}import{z as an}from"zod";var Q6={name:"logs",description:"Fetch container logs from a CVM",stability:"unstable",arguments:[Be],options:[{name:"tail",shorthand:"n",description:"Number of lines to show from the end of the logs",type:"number",target:"tail"},{name:"follow",shorthand:"f",description:"Follow log output (stream logs in real-time)",type:"boolean",target:"follow"},{name:"timestamps",shorthand:"t",description:"Show timestamps with log entries",type:"boolean",target:"timestamps"},{name:"container",shorthand:"c",description:"Container name or ID to fetch logs from (defaults to first container)",type:"string",target:"container"},Nt,$e],examples:[{name:"Show container logs from a CVM",value:"phala cvms logs app_abc123"},{name:"Show last 100 lines of logs",value:"phala cvms logs app_abc123 --tail 100"},{name:"Follow logs in real-time",value:"phala cvms logs app_abc123 --follow"},{name:"Show logs from a specific container",value:"phala cvms logs app_abc123 --container my-service"},{name:"Show logs with timestamps",value:"phala cvms logs app_abc123 --timestamps"}]},ew=an.object({cvmId:an.string().optional(),tail:an.number().optional(),follow:an.boolean().default(!1),timestamps:an.boolean().default(!1),container:an.string().optional(),json:an.boolean().default(!1),interactive:an.boolean().default(!1)});var cP=ul({logType:"container",fetchLogs:Rv,streamLogs:Bv},e=>({tail:e.tail,timestamps:e.timestamps,container:e.container})),tw=$({path:["cvms","logs"],meta:Q6,schema:ew,handler:cP});import nw from"fs";import mP from"path";import{z as pl}from"zod";var rw={name:"replicate",description:"Create a replica of an existing CVM",stability:"unstable",arguments:[{name:"cvm-id",description:"UUID of the CVM to replicate",required:!0,target:"cvmId"}],options:[{name:"teepod-id",description:"TEEPod ID to use for the replica",type:"string",target:"teepodId"},{name:"env-file",shorthand:"e",description:"Path to environment file",type:"string",target:"envFile"}],examples:[{name:"Replicate a CVM",value:"phala cvms replicate 1234 --teepod-id 5"}]},ow=pl.object({cvmId:pl.string().min(1,"CVM ID is required"),teepodId:pl.string().optional(),envFile:pl.string().optional()});function uP(e){return nw.readFileSync(e,"utf-8").split(`
`).filter(r=>r.trim()!==""&&!r.trim().startsWith("#")).map(r=>{let[o,...n]=r.split("=");return{key:o.trim(),value:n.join("=").trim()}})}async function pP(e,t){try{let r=e.cvmId.replace(/-/g,""),o;if(e.envFile){let i=mP.resolve(process.cwd(),e.envFile);if(!nw.existsSync(i))throw new Error(`Environment file not found: ${i}`);let a=uP(i),c=await vv(r);f.info("Encrypting environment variables..."),o=await(0,rr.encryptEnvVars)(a,c.env_pubkey)}let n={};e.teepodId&&(n.teepod_id=Number.parseInt(e.teepodId,10)),o&&(n.encrypted_env=o);let s=await Ev(r,n);return f.success(`Successfully created replica of CVM UUID: ${r} with App ID: ${s.app_id}`),f.keyValueTable({"CVM UUID":s.vm_uuid.replace(/-/g,""),"App ID":s.app_id,Name:s.name,Status:s.status,TEEPod:`${s.teepod.name} (ID: ${s.teepod_id})`,vCPUs:s.vcpu,Memory:`${s.memory} MB`,"Disk Size":`${s.disk_size} GB`,"App URL":s.app_url||`${process.env.CLOUD_URL||"https://cloud.phala.com"}/dashboard/cvms/${s.vm_uuid.replace(/-/g,"")}`},{borderStyle:"rounded"}),f.success(`Your CVM replica is being created. You can check its status with:
phala cvms get ${s.app_id}`),0}catch(r){return f.error("Failed to create CVM replica"),f.logDetailedError(r),1}}var sw=$({path:["cvms","replicate"],meta:rw,schema:ow,handler:pP});import cn from"chalk";import R0 from"inquirer";async function ho(e,t={}){let{maxRetries:r=100,retryDelayMs:o=3e3,spinner:n,logRetries:s=!0}=t,i;for(let c=0;c<=r;c++)try{return await e()}catch(m){i=m;let u=m;if((u.message?.includes("409")||u.status===409||u.message?.includes("Conflict"))&&c<r)n&&n.stop(!0),s&&f.warn(`CVM is busy, retrying in ${o}ms... (attempt ${c+1}/${r})`),await new Promise(l=>setTimeout(l,o));else throw m}let a=i;throw new Error(`Failed after ${r} retries due to conflicts: ${a?.message||String(i)}`)}import{z as go}from"zod";var iw={name:"resize",description:"Resize resources for a CVM",stability:"unstable",arguments:[Be],options:[$e,{name:"vcpu",shorthand:"v",description:"Number of virtual CPUs",type:"string",target:"vcpu"},{name:"memory",shorthand:"m",description:"Memory size in MB",type:"string",target:"memory"},{name:"disk-size",shorthand:"d",description:"Disk size in GB",type:"string",target:"diskSize"},{name:"allow-restart",shorthand:"r",description:"Allow restart of the CVM if needed for resizing",type:"string",target:"allowRestart"},{name:"yes",shorthand:"y",description:"Automatically confirm the resize operation",type:"boolean",target:"yes"},{name:"json",description:"Output result in JSON format",type:"boolean",target:"json"}],examples:[{name:"Resize CVM interactively",value:"phala cvms resize"},{name:"Resize without confirmation",value:"phala cvms resize app_123 --vcpu 4 --memory 4096 --disk-size 120 --yes"}]},aw=go.object({cvmId:go.string().optional(),interactive:go.boolean().default(!1),vcpu:go.string().optional(),memory:go.string().optional(),diskSize:go.string().optional(),allowRestart:go.string().optional(),yes:go.boolean().default(!1),json:go.boolean().default(!1)});function T0(e,t){if(e===void 0)return;let r=Number.parseInt(e,10);if(Number.isNaN(r)||r<0)throw new Error(`Please provide a valid non-negative number for ${t}`);return r}function lP(e){if(e===void 0)return;let t=e.trim().toLowerCase();if(["true","1","yes","y"].includes(t))return!0;if(["false","0","no","n"].includes(t))return!1;throw new Error(`Invalid value for --allow-restart: ${e}`)}async function $0(e,t){return(await R0.prompt([{type:"input",name:"value",message:e,default:t,validate:o=>{let n=Number.parseInt(o,10);return Number.isNaN(n)||n<0?"Please enter a valid non-negative number":!0},filter:o=>Number.parseInt(o,10)}])).value}async function fP(e,t){if(we(e.json),!t.cvmId)return t.fail("No CVM ID provided. Use --interactive to select interactively."),1;try{let r=await K(),o=await Se(r,t.cvmId);if(!o.success)return t.fail(o.error.message),1;let n=o.data;if(!n)return t.fail("CVM not found"),1;let s=n.app_id,i,a,c,m;try{i=T0(e.vcpu,"--vcpu"),a=T0(e.memory,"--memory"),c=T0(e.diskSize,"--disk-size"),m=lP(e.allowRestart)}catch(u){return f.error(u instanceof Error?u.message:String(u)),1}if(Dl()?(i===void 0&&(i=await $0("Enter number of vCPUs:",n.vcpu)),a===void 0&&(a=await $0("Enter memory in MB:",n.memory)),c===void 0&&(c=await $0("Enter disk size in GB:",n.disk_size)),m===void 0&&(m=(await R0.prompt([{type:"confirm",name:"allowRestart",message:"Allow restart of the CVM if needed for resizing?",default:!1}])).allowRestart)):(i===void 0&&(i=n.vcpu),a===void 0&&(a=n.memory),c===void 0&&(c=n.disk_size),m===void 0&&(m=!0)),Dl()){if(f.keyValueTable({vCPUs:n.vcpu!==i?`${cn.red(n.vcpu)} -> ${cn.green(i)}`:n.vcpu,Memory:n.memory!==a?`${cn.red(n.memory)} MB -> ${cn.green(a)} MB`:n.memory,"Disk Size":n.disk_size!==c?`${cn.red(n.disk_size)} GB -> ${cn.green(c)} GB`:n.disk_size,"Allow Restart":m?cn.green("Yes"):cn.red("No")}),!e.yes){let{confirm:p}=await R0.prompt([{type:"confirm",name:"confirm",message:`Are you sure you want to resize CVM app_${s}?`,default:!1}]);if(!p)return f.info("Resize operation cancelled"),0}let u=f.startSpinner(`Resizing CVM with App ID app_${s}`);await ho(()=>i0(s,i,a,c,m?1:0),{spinner:u}),u.stop(!0),f.break(),f.success(`Your CVM is being resized. You can check the dashboard for more details:
${xe}/dashboard/cvms/app_${s}`)}else await ho(()=>i0(s,i,a,c,m?1:0)),t.success({app_id:s,vcpu:i,memory:a,disk_size:c,allow_restart:m});return 0}catch(r){return f.error("Failed to resize CVM"),f.logDetailedError(r),t.fail(r instanceof Error?r.message:String(r)),1}}var cw=$({path:["cvms","resize"],meta:iw,schema:aw,handler:fP});async function ll(e,t=3e5){let r=_t(),o=Le({apiKey:r}),n=Date.now(),s=2e3;for(f.info("Waiting for CVM to be ready...");Date.now()-n<t;){try{let i=await Se(o,{uuid:e});if(!i.success)f.warn(`Failed to get CVM info: ${i.error.message}`);else{let a=i.data,c=a.status,m=a.in_progress,u=Math.floor((Date.now()-n)/1e3);if(f.info(`  [${u}s] status=${c}, in_progress=${m}`),c==="running"&&!m){let p=Math.floor((Date.now()-n)/1e3);f.success(`CVM is ready (took ${p}s)`);return}}}catch(i){f.warn(`Error checking CVM status: ${i}`)}await new Promise(i=>setTimeout(i,s))}throw new Error(`Timeout waiting for CVM to be ready (${Math.floor(t/1e3)}s)`)}import{z as M0}from"zod";var mw={name:"restart",description:"Restart a CVM",stability:"stable",arguments:[Be],options:[$e],examples:[{name:"Restart CVM by app_id",value:"phala cvms restart app_123"},{name:"Restart CVM by UUID",value:"phala cvms restart 550e8400-e29b-41d4-a716-446655440000"},{name:"Restart CVM by name",value:"phala cvms restart my-app"}]},uw=M0.object({cvmId:M0.string().optional(),interactive:M0.boolean().default(!1)});async function dP(e,t){if(!t.cvmId)return t.fail("No CVM ID provided. Use --interactive to select interactively."),1;try{let r=await K(),o=await Se(r,t.cvmId);if(!o.success)return t.fail(o.error.message),1;let n=o.data;n.in_progress&&(f.warn("CVM is currently in progress (updating/restarting). Waiting for operation to complete..."),await ll(n.vm_uuid,3e5));let s=f.startSpinner("Restarting CVM"),i=t.cvmId,a=await ho(()=>Yd(r,i),{spinner:s});if(s.stop(!0),!a.success)return f.error(`Failed to restart CVM: ${a.error.message}`),1;let c=a.data;return f.break(),f.keyValueTable({"CVM ID":c.id,Name:c.name,Status:c.status,"App ID":`app_${c.app_id}`,"App URL":c.app_url||`${xe}/dashboard/cvms/app_${c.app_id}`},{borderStyle:"rounded"}),f.break(),f.success(`Your CVM is being restarted. You can check the dashboard for more details:
${xe}/dashboard/cvms/app_${c.app_id}`),0}catch(r){return f.error("Failed to restart CVM"),f.logDetailedError(r),1}}var pw=$({path:["cvms","restart"],meta:mw,schema:uw,handler:dP});import{z as Gn}from"zod";var lw={name:"serial-logs",description:"Fetch VM serial console logs from a CVM",stability:"unstable",arguments:[Be],options:[{name:"tail",shorthand:"n",description:"Number of lines to show from the end of the logs",type:"number",target:"tail"},{name:"follow",shorthand:"f",description:"Follow log output (stream logs in real-time)",type:"boolean",target:"follow"},{name:"timestamps",shorthand:"t",description:"Show timestamps with log entries",type:"boolean",target:"timestamps"},Nt,$e],examples:[{name:"Show VM serial logs",value:"phala cvms serial-logs app_abc123"},{name:"Show last 100 lines of serial logs",value:"phala cvms serial-logs app_abc123 --tail 100"},{name:"Follow serial logs in real-time",value:"phala cvms serial-logs app_abc123 --follow"},{name:"Show serial logs with timestamps",value:"phala cvms serial-logs app_abc123 --timestamps"}]},fw=Gn.object({cvmId:Gn.string().optional(),tail:Gn.number().optional(),follow:Gn.boolean().default(!1),timestamps:Gn.boolean().default(!1),json:Gn.boolean().default(!1),interactive:Gn.boolean().default(!1)});var hP=ul({logType:"serial",fetchLogs:$v,streamLogs:Mv},e=>({tail:e.tail,timestamps:e.timestamps})),dw=$({path:["cvms","serial-logs"],meta:lw,schema:fw,handler:hP});import{z as B0}from"zod";var hw={name:"start",description:"Start a stopped CVM",stability:"stable",arguments:[Be],options:[$e],examples:[{name:"Start CVM by app_id",value:"phala cvms start app_123"},{name:"Start CVM by UUID",value:"phala cvms start 550e8400-e29b-41d4-a716-446655440000"},{name:"Start CVM by name",value:"phala cvms start my-app"}]},gw=B0.object({cvmId:B0.string().optional(),interactive:B0.boolean().default(!1)});async function gP(e,t){if(!t.cvmId)return t.fail("No CVM ID provided. Use --interactive to select interactively."),1;try{let r=await K(),o=f.startSpinner("Starting CVM"),n=t.cvmId,s=await ho(()=>Jd(r,n),{spinner:o});if(o.stop(!0),!s.success)return f.error(`Failed to start CVM: ${s.error.message}`),1;let i=s.data;return f.break(),f.keyValueTable({"CVM ID":i.id,Name:i.name,Status:i.status,"App ID":`app_${i.app_id}`},{borderStyle:"rounded"}),f.break(),f.success(`Your CVM is being started. You can check the dashboard for more details:
${xe}/dashboard/cvms/app_${i.app_id}`),0}catch(r){return f.error("Failed to start CVM"),f.logDetailedError(r),1}}var yw=$({path:["cvms","start"],meta:hw,schema:gw,handler:gP});import{z as F0}from"zod";var bw={name:"stop",description:"Stop a running CVM",stability:"stable",arguments:[Be],options:[$e],examples:[{name:"Stop CVM by app_id",value:"phala cvms stop app_123"},{name:"Stop CVM by UUID",value:"phala cvms stop 550e8400-e29b-41d4-a716-446655440000"},{name:"Stop CVM by name",value:"phala cvms stop my-app"}]},xw=F0.object({cvmId:F0.string().optional(),interactive:F0.boolean().default(!1)});async function yP(e,t){if(!t.cvmId)return t.fail("No CVM ID provided. Use --interactive to select interactively."),1;try{let r=await K(),o=f.startSpinner("Stopping CVM"),n=t.cvmId,s=await ho(()=>Zd(r,n),{spinner:o});if(o.stop(!0),!s.success)return f.error(`Failed to stop CVM: ${s.error.message}`),1;let i=s.data;return f.break(),f.keyValueTable({"CVM ID":i.id,Name:i.name,Status:i.status,"App ID":`app_${i.app_id}`},{borderStyle:"rounded"}),f.break(),f.success(`Your CVM is being stopped. You can check the dashboard for more details:
${xe}/dashboard/cvms/app_${i.app_id}`),0}catch(r){return f.error("Failed to stop CVM"),f.logDetailedError(r),1}}var vw=$({path:["cvms","stop"],meta:bw,schema:xw,handler:yP});import bP from"fs";import{z as Gi}from"zod";var ww={name:"upgrade",description:'Upgrade a CVM to a new version (use "phala deploy" instead)',stability:"deprecated",arguments:[Be],options:[$e,{name:"compose",shorthand:"c",description:"Path to new Docker Compose file",type:"string",target:"compose"},{name:"env-file",shorthand:"e",description:"Path to environment file",type:"string",target:"envFile"},{name:"debug",description:"Enable debug mode",type:"boolean",target:"debug"}],examples:[{name:"Upgrade a CVM interactively",value:"phala cvms upgrade"},{name:"Upgrade using a compose file",value:"phala cvms upgrade app_123 --compose ./docker-compose.yml"}]},Cw=Gi.object({cvmId:Gi.string().optional(),interactive:Gi.boolean().default(!1),compose:Gi.string().optional(),envFile:Gi.string().optional(),debug:Gi.boolean().default(!1)});async function xP(e){if(e.compose)return e.compose;let r=ji(["docker-compose.yml","docker-compose.yaml"],"Detected docker compose file: {path}");return lo("Enter the path to your Docker Compose file:",r,"file")}async function vP(e,t){try{if(f.warn('\u26A0\uFE0F  This command is deprecated. Please use "phala deploy" instead.'),f.warn(`\u26A0\uFE0F  This legacy API will be maintained but may have limited support.
`),!t.cvmId)return f.error("No CVM ID provided. Use --interactive to select interactively."),1;let r=await K(),o=await Se(r,t.cvmId);if(!o.success)return f.error(o.error.message),1;let n=o.data;if(!n)return f.error("CVM not found"),1;let s=n.app_id,i=n,a=await xP(e),c="";if(a)try{c=bP.readFileSync(a,"utf8")}catch(h){return f.error(`Failed to read Docker Compose file: ${h instanceof Error?h.message:String(h)}`),1}await jn(),process.env.DSTACK_DOCKER_USERNAME&&process.env.DSTACK_DOCKER_PASSWORD?f.info("\u{1F510} Using private DockerHub registry credentials..."):process.env.DSTACK_AWS_ACCESS_KEY_ID&&process.env.DSTACK_AWS_SECRET_ACCESS_KEY&&process.env.DSTACK_AWS_REGION&&process.env.DSTACK_AWS_ECR_REGISTRY?f.info(`\u{1F510} Using private AWS ECR registry: ${process.env.DSTACK_AWS_ECR_REGISTRY}`):f.info("\u{1F510} Using public DockerHub registry...");let m,u=[];if(e.envFile)try{let h=ac([],e.envFile);m=await(0,rr.encryptEnvVars)(h,i.encrypted_env_pubkey),u=h.map(g=>g.key)}catch(h){return f.error(`Failed to read environment file: ${h instanceof Error?h.message:String(h)}`),1}let p={compose_manifest:{docker_compose_file:c,manifest_version:1,runner:"docker-compose",version:"1.0.0",features:["kms","tproxy-net"],name:`app_${s}`,allowed_envs:u},encrypted_env:m,allow_restart:!0,env_keys:u},l=f.startSpinner(`Upgrading CVM app_${s}`),d=await Iv(s,p);return d?(l.stop(!0),d.detail&&f.info(`Details: ${d.detail}`),f.break(),f.success(`Your CVM is being upgraded. You can check the dashboard for more details:
${xe}/dashboard/cvms/app_${s}`),0):(l.stop(!1),f.error("Failed to upgrade CVM"),1)}catch(r){return f.error(`Failed to upgrade CVM: ${r instanceof Error?r.message:String(r)}`),e.debug&&f.error("Full Error:",r),1}}var Ew=$({path:["cvms","upgrade"],meta:ww,schema:Cw,handler:vP});var D0={group:k6,commands:[A6,L6,z6,G6,W6,Y6,tw,sw,cw,pw,dw,yw,vw,Ew]};import{z as se}from"zod";var Sw={name:"deploy",description:"Deploy a new CVM or update an existing one. Creates a new CVM by default; updates when --cvm-id is provided or found in phala.toml.",stability:"stable",arguments:[],options:[X0,Q0,{name:"debug",description:"Enable debug logging",type:"boolean",target:"debug",group:"advanced"},{name:"name",shorthand:"n",description:"Name of the CVM (optional; default: current directory name, converted to a valid hostname)",type:"string",target:"name",group:"basic"},{name:"compose",shorthand:"c",description:"Path to Docker Compose file (default: docker-compose.yml in current directory)",type:"string",target:"compose",group:"basic"},{name:"instance-type",shorthand:"t",description:"Instance type (e.g., tdx.small, tdx.medium, tdx.large). Optional - auto-selected if not specified.",type:"string",target:"instanceType",group:"basic"},{name:"vcpu",description:`[DEPRECATED] Use --instance-type instead. Number of vCPUs, default is ${Un}`,type:"string",target:"vcpu",deprecated:!0,group:"deprecated"},{name:"memory",description:`[DEPRECATED] Use --instance-type instead. Memory with optional unit, e.g., 2G, 1024MB, default is ${zn}MB`,type:"string",target:"memory",deprecated:!0,group:"deprecated"},{name:"disk-size",description:`Disk size with optional unit (optional, auto-matched if not specified), e.g., 50G, 100GB, default is ${Hn}GB`,type:"string",target:"diskSize",group:"advanced"},{name:"image",description:"OS image version (optional, auto-selected if not specified)",type:"string",target:"image",group:"advanced"},{name:"region",shorthand:"r",description:"Preferred region (e.g., us-west, eu-central). Optional - auto-selected if not specified.",type:"string",target:"region",group:"basic"},{name:"node-id",description:"Node ID (optional, auto-selected if not specified)",type:"string",target:"nodeId",group:"advanced"},{name:"env",shorthand:"e",description:"Environment variable (KEY=VALUE) or path to env file. Can be specified multiple times.",type:"string[]",target:"env",group:"basic"},{name:"env-file",description:"[DEPRECATED] Use -e instead. Path to environment file.",type:"string",target:"envFile",deprecated:!0,group:"deprecated"},{name:"kms",description:"KMS type: phala (default), ethereum/eth, or base",type:"string",target:"kms",group:"basic"},{name:"kms-id",description:"[DEPRECATED] Use --kms instead. KMS ID to use.",type:"string",target:"kmsId",deprecated:!0,group:"deprecated"},{name:"custom-app-id",description:"Custom App ID to use. For PHALA KMS, requires --nonce.",type:"string",target:"customAppId",group:"advanced"},{name:"nonce",description:"Nonce for deterministic app_id generation (PHALA KMS only, requires --custom-app-id).",type:"string",target:"nonce",group:"advanced"},{name:"pre-launch-script",description:"Path to pre-launch script",type:"string",target:"preLaunchScript",group:"advanced"},{name:"private-key",description:"Private key for signing transactions.",type:"string",target:"privateKey",group:"advanced"},{name:"rpc-url",description:"RPC URL for the blockchain.",type:"string",target:"rpcUrl",group:"advanced"},{name:"wait",description:"Wait for CVM to complete deployment/update before returning (only applies to updates)",type:"boolean",target:"wait",group:"basic"},{name:"ssh-pubkey",description:"Path to SSH public key file (default: ~/.ssh/id_rsa.pub)",type:"string",target:"sshPubkey",group:"basic"},{name:"dev-os",description:"Use development OS image (requires SSH public key)",type:"boolean",target:"devOs",group:"basic"},{name:"non-dev-os",description:"Use non-development OS image (SSH public key only if explicitly specified)",type:"boolean",target:"nonDevOs",group:"basic"},{name:"public-logs",description:"Make CVM logs publicly accessible (default: true for --dev-os, false otherwise)",type:"boolean",target:"publicLogs"},{name:"public-sysinfo",description:"Make CVM system info publicly accessible (default: true)",type:"boolean",target:"publicSysinfo"},{name:"listed",description:"List CVM on the public Trust Center (default: false)",type:"boolean",target:"listed"}],examples:[{name:"Deploy new CVM with auto-selection (simplest)",value:"phala deploy"},{name:"Deploy with environment variables",value:"phala deploy -e NODE_ENV=production -e DEBUG=true"},{name:"Deploy with env file",value:"phala deploy -e .env"},{name:"Deploy with specific instance type",value:"phala deploy --instance-type tdx.medium"},{name:"Deploy to specific region",value:"phala deploy --region us-west"},{name:"Deploy with on-chain KMS (Ethereum)",value:"phala deploy --kms ethereum --private-key <key> --rpc-url <url>"},{name:"Update existing CVM by ID",value:"phala deploy --cvm-id app_abc123"},{name:"Update CVM with new compose file and env",value:"phala deploy --cvm-id my-app --compose ./new-docker-compose.yml -e .env"},{name:"Update CVM and wait for completion",value:"phala deploy --cvm-id app_abc123 --wait"},{name:"Update CVM configured in phala.toml (auto-detected)",value:"phala deploy"},{name:"Deploy with explicit privacy settings",value:"phala deploy --public-logs=false --public-sysinfo=false"},{name:"Deploy and list on Trust Center",value:"phala deploy --listed"},{name:"Update existing CVM visibility",value:"phala deploy --cvm-id app_123 --public-logs=false"}]},kw=se.object({compose:se.string().optional(),json:se.boolean().default(!1),debug:se.boolean().default(!1),apiToken:se.string().optional(),name:se.string().optional(),instanceType:se.string().optional(),vcpu:se.string().optional(),memory:se.string().optional(),diskSize:se.string().optional(),image:se.string().optional(),region:se.string().optional(),nodeId:se.string().optional(),env:se.array(se.string()).optional(),envFile:se.string().optional(),interactive:se.boolean().default(!1),kms:se.enum(["phala","ethereum","eth","base"]).default("phala"),kmsId:se.string().optional(),cvmId:se.string().optional(),customAppId:se.string().optional(),nonce:se.string().optional(),preLaunchScript:se.string().optional(),privateKey:se.string().optional(),rpcUrl:se.string().optional(),wait:se.boolean().default(!1),sshPubkey:se.string().optional(),devOs:se.boolean().default(!1),nonDevOs:se.boolean().default(!1),publicLogs:se.boolean().optional(),publicSysinfo:se.boolean().optional(),listed:se.boolean().optional()});import yo from"path";import $w from"os";function wP(e){let t=e.indexOf("=");if(t===-1)return!1;let r=e.substring(0,t);return r.includes("/")||r.includes("\\")?!1:/^[A-Za-z_][A-Za-z0-9_]*$/.test(r)}function Iw(e){let t={files:[],keyValues:[]};for(let r of e)if(wP(r)){let o=r.indexOf("="),n=r.substring(0,o),s=r.substring(o+1);t.keyValues.push({key:n,value:s})}else t.files.push(r);return t}function _w(e){let t=new Map;for(let r of e)t.set(r.key,r.value);return Array.from(t.entries()).map(([r,o])=>({key:r,value:o}))}function Aw(e,t="B"){if(!e||typeof e!="string")throw new Error("Invalid input: must be a non-empty string");let r=e.trim().match(/^(\d+(?:\.\d+)?)\s*([KkMmGgTt][Bb]?)?$/);if(!r)throw new Error(`Invalid format: ${e}. Expected format: <number>[unit] (e.g., 2G, 500MB, 1T)`);let o=Number.parseFloat(r[1]),n=(r[2]||t).toUpperCase().replace("B",""),s={K:1024,M:1024*1024,G:1024*1024*1024,T:1024*1024*1024*1024,"":1};if(!(n in s))throw new Error(`Unsupported unit: ${n}. Supported units: B, K/KB, M/MB, G/GB, T/TB`);return Math.round(o*s[n])}function Pw(e){let t=Aw(e,"MB"),r=Math.round(t/(1024*1024));if(r%1024!==0)throw new Error(`Memory must be a multiple of 1GB (1024MB). Got: ${r}MB`);return r}function Tw(e){let t=Aw(e,"GB"),r=Math.round(t/(1024*1024*1024));if(r%1!==0)throw new Error(`Disk size must be a multiple of 1GB. Got: ${r}GB`);return r}import fl from"dedent";import Vr from"fs-extra";import dl from"inquirer";function CP(e,t){if(e instanceof Gd)return t.json?{success:!1,error_code:e.errorCode,message:e.message,details:e.structuredDetails,suggestions:e.suggestions,links:e.links}:j1(e);if(e&&typeof e=="object"&&"response"in e){let n=e.response?.data?.detail;if(n&&typeof n=="object"&&"error_code"in n){let{error_code:s,message:i,details:a,suggestions:c,links:m}=n;if(t.json)return{success:!1,error_code:s,message:i,details:a,suggestions:c,links:m};let u=`
Error [${s}]: ${i}
`;if(a&&a.length>0){u+=`
Details:
`;for(let p of a)p.message?u+=`  - ${p.message}
`:p.field&&p.value!==void 0&&(u+=`  - ${p.field}: ${p.value}
`)}if(c&&c.length>0){u+=`
Suggestions:
`;for(let p of c)u+=`  - ${p}
`}if(m&&m.length>0){u+=`
Learn more:
`;for(let p of m)u+=`  - ${p.label}: ${p.url}
`}return u}}let r=e instanceof Error?e.message:String(e||"Unknown error");return t.json?{success:!1,error:r}:`
Error: ${r}
`}async function EP({apiToken:e,interactive:t}){if(e)return Le({apiKey:e});if(process.env.PHALA_CLOUD_API_KEY)return Le({apiKey:process.env.PHALA_CLOUD_API_KEY});let r=_t();if(r)return Le({apiKey:r});if(t){let{apiToken:o}=await dl.prompt([{type:"password",name:"apiToken",message:"Enter your API token:",validate:n=>n.trim()?!0:"API token is required"}]);return Le({apiKey:o})}throw new Error("API token is required. Please run 'phala auth login' or set PHALA_CLOUD_API_KEY environment variable")}async function SP({dockerComposePath:e,interactive:t}){if(!e)if(t){let o=ji(["docker-compose.yml","docker-compose.yaml"],"Detected docker compose file: {path}");e=await lo("Enter the path to your Docker Compose file:",o,"file")}else throw new Error(fl(`
                       Docker Compose file is required.

                           Usage examples:
                           phala deploy -c docker-compose.yml
                       phala deploy --kms ethereum --private-key <your-private-key> --rpc-url <rpc-url> -c docker-compose.yml

                       Minimal required parameters:
                           -c, --compose <path>    Path to docker-compose.yml

                       For on-chain KMS, also provide:
                           --kms <type>            KMS type (phala, ethereum, base)
                           --private-key <key>     Private key for deployment
                           --rpc-url <url>         RPC URL for the blockchain

                               Run with --interactive for guided setup
                                   `));if(!Vr.existsSync(e))throw new Error(`Docker compose file not found: ${e}`);return Vr.readFileSync(e,"utf8")}var kP=async(e,t)=>{let r=e.privateKey||process.env.PRIVATE_KEY;if(t&&!e.privateKey)if(e.interactive)r=(await dl.prompt([{type:"password",name:"privateKey",message:"Enter your private key:",validate:n=>n.trim()?!0:"Private key is required"}])).privateKey;else throw new Error("When using on-chain KMS, either --private-key (or PRIVATE_KEY env) must be provided");return r};function Rw(e){e.kmsId&&f.warn("--kms-id is deprecated. Use --kms instead.");let t=(e.kms??"phala").toLowerCase(),r;switch(t){case"eth":case"ethereum":r="ETHEREUM";break;case"base":r="BASE";break;default:r="PHALA";break}return{kmsType:r,deprecatedKmsId:e.kmsId}}var IP=async e=>{let t=e.name;if(e.name){if(!Li(e.name))throw new Error(`Invalid CVM name: "${e.name}". Name must be 5-63 characters, start with letter, and contain only letters/numbers/hyphens.`);return e.name}let r=yo.basename(process.cwd()),o=X1(r);return e.interactive?t=(await dl.prompt([{type:"input",name:"name",message:"Enter a name for the CVM:",default:o,validate:s=>s.trim()?Li(s.trim())?!0:"Name must be 5-63 characters, start with letter, and contain only letters/numbers/hyphens":"CVM name is required"}])).name:t=o,t},_P=async e=>{let t=[];if(e.envFile&&typeof e.envFile=="string"){f.warn("--env-file is deprecated. Use -e <file> or -e KEY=VALUE instead.");try{let r=Vr.readFileSync(e.envFile,{encoding:"utf8"});t.push(...Gp(r))}catch(r){throw new Error(`Error reading environment file ${e.envFile}: ${r instanceof Error?r.message:String(r)}`)}}if(e.env&&e.env.length>0){let r=Iw(e.env);for(let o of r.files){let n=yo.resolve(process.cwd(),o);if(!Vr.existsSync(n))throw new Error(`Environment file not found: ${o}`);try{let s=Vr.readFileSync(n,{encoding:"utf8"});t.push(...Gp(s))}catch(s){throw new Error(`Error reading environment file ${o}: ${s instanceof Error?s.message:String(s)}`)}}t.push(...r.keyValues)}if(e.interactive&&t.length===0&&!e.env&&!e.envFile){let{envPath:r}=await dl.prompt([{type:"input",name:"envPath",message:"Enter the path to your environment file (leave empty to skip):",default:"",validate:o=>{if(!o||o.trim()==="")return!0;let n=yo.resolve(process.cwd(),o);return Vr.existsSync(n)?!0:`File not found at ${n}`}}]);if(r.trim()){let o=yo.resolve(process.cwd(),r.trim()),n=Vr.readFileSync(o,{encoding:"utf8"});t.push(...Gp(n))}}if(t.length!==0)return _w(t)},AP=async e=>{let t=e.sshPubkey;if(!(e.nonDevOs&&!e.sshPubkey)){if(t){if(t.startsWith("~")&&(t=yo.join($w.homedir(),t.slice(1))),!Vr.existsSync(t))throw new Error(`SSH public key file not found: ${t}`)}else{let r=$w.homedir(),o=[yo.join(r,".ssh","id_rsa.pub"),yo.join(r,".ssh","id_ed25519.pub"),yo.join(r,".ssh","id_ecdsa.pub"),yo.join(r,".ssh","id_dsa.pub")];for(let n of o)if(Vr.existsSync(n)){t=n;break}if(!t){if(e.devOs)throw new Error(fl(`
						SSH public key is required for dev images but not found.

						Searched for:
						  - ~/.ssh/id_rsa.pub
						  - ~/.ssh/id_ed25519.pub
						  - ~/.ssh/id_ecdsa.pub
						  - ~/.ssh/id_dsa.pub

						Please either:
						  1. Create an SSH key pair: ssh-keygen -t rsa
						  2. Specify a different key file: --ssh-pubkey <path>
					`));return}}try{let r=Vr.readFileSync(t,"utf8").trim();return f.info(`Using SSH public key from ${t}`),r}catch(r){throw new Error(`Failed to read SSH public key from ${t}: ${r instanceof Error?r.message:String(r)}`)}}};var PP=(e,t)=>{let r=e.devOs===!0;return{publicLogs:e.publicLogs??t?.public_logs??r,publicSysinfo:e.publicSysinfo??t?.public_sysinfo??!0,listed:e.listed??t?.listed??!1}},TP=(e,t,r,o,n,s)=>{let i={name:t,compose_file:{name:"",docker_compose_file:r,allowed_envs:o?.map(u=>u.key)||[],public_logs:n.publicLogs,public_sysinfo:n.publicSysinfo},listed:n.listed},{kmsType:a,deprecatedKmsId:c}=s??Rw(e);e.instanceType&&(i.instance_type=e.instanceType),e.vcpu&&(i.vcpu=Number(e.vcpu)),e.memory&&(i.memory=Pw(e.memory)),e.diskSize&&(i.disk_size=Tw(e.diskSize)),e.nodeId&&(i.teepod_id=Number(e.nodeId)),e.region&&(i.region=e.region),e.image&&(i.image=e.image),i.kms=a,c&&(i.kms_id=c);let m=a==="ETHEREUM"||a==="BASE";if(e.devOs?i.prefer_dev=!0:(e.nonDevOs||m)&&(i.prefer_dev=!1),e.customAppId&&(i.app_id=e.customAppId,a==="PHALA")){if(!e.nonce)throw new Error("--nonce is required when using --custom-app-id with PHALA KMS.");let u=Number(e.nonce);if(Number.isNaN(u))throw new Error(`Invalid nonce value: "${e.nonce}". Nonce must be a valid number.`);i.nonce=u}if(e.nonce&&!e.customAppId)throw new Error("--nonce requires --custom-app-id to be specified.");return i},$P=async(e,t,r,o,n,s,i)=>{let a=Rw(e),c=await IP(e),m=await AP(e),u=[...r||[]];m&&u.push({key:"DSTACK_AUTHORIZED_KEYS",value:m});let p=PP(e,i),l=TP(e,c,t,u,p,a);n.write(`Provisioning CVM ${c}...
`);let d=await qd(o,l);if(!d.success){let v=CP(d.error,e);throw f.error("Error in provisioning CVM:",v),d.error}let h=d.data,g,y=h.kms_info;if(!h.app_id&&!!y?.chain_id&&!!y?.kms_contract_address){if(!y?.chain_id||!y?.chain)throw new Error("KMS chain info is missing from provision response. Please retry or contact support.");if(!y?.kms_contract_address)throw new Error("KMS contract address is missing from provision response. Please retry or contact support.");let v=await kP(e,y.chain_id),E=await av({chain:y.chain,rpcUrl:e.rpcUrl,kmsContractAddress:y.kms_contract_address,privateKey:v,deviceId:h.device_id,composeHash:h.compose_hash});if(!E.success){f.logDetailedError(E,"Deploy App Auth");let M=typeof E=="object"&&E!==null?JSON.stringify(E):String(E);throw new Error(`Deployment contract failed: ${M}`)}let A=E.data,k=y.slug||y.id;if(!k)throw new Error("KMS reference (slug or id) is missing from provision response");let I=await jp(o,{app_id:A.appId,kms:k});if(!I.success)throw f.logDetailedError(I.error,"Get App Env Encrypt PubKey"),new Error(`Failed to get app env encrypt pubkey: ${I.error.message}`);let R=I.data,B=await(0,rr.encryptEnvVars)(u,R.public_key);g=await Hp(o,{app_id:A.appId,encrypted_env:B,compose_hash:h.compose_hash,kms_id:k,contract_address:A.appAuthAddress,deployer_address:A.deployer})}else{let v=u&&u.length>0?await(0,rr.encryptEnvVars)(u,h.app_env_encrypt_pubkey):void 0;g=await Hp(o,{app_id:h.app_id,encrypted_env:v,compose_hash:h.compose_hash,kms_id:a.deprecatedKmsId})}if(!g.success)throw f.logDetailedError(g.error,"Commit CVM Provision"),new Error(`Failed to commit CVM provision: ${g.error.message}`);let b=g.data;if(e?.json!==!1)n.write(`${JSON.stringify({success:!0,vm_uuid:b.vm_uuid,name:b.name,app_id:b.app_id,dashboard_url:`${xe}/dashboard/cvms/${b.vm_uuid}`},null,2)}
`);else{let v=fl`
      CVM created successfully!

      CVM ID:    ${b.vm_uuid}
      Name:      ${b.name}
      App ID:    ${b.app_id}
      Dashboard URL:  ${xe}/dashboard/cvms/${b.vm_uuid}
    `;n.write(`${v}
`)}},RP=async(e,t,r,o,n)=>{let[s,i]=await Promise.all([Se(o,{id:e.uuid}),ec(o,{id:e.uuid})]);if(!s.success)throw f.logDetailedError(s.error,"Get CVM Info"),new Error(`Failed to get cvm info: ${s.error.message}`);if(!i.success)throw f.logDetailedError(i.error,"Get CVM Compose File"),new Error(`Failed to get cvm compose file: ${i.error.message}`);let a=s.data,c=i.data;c.docker_compose_file=t,r&&r.length>0&&(c.allowed_envs=r.map(h=>h.key)),f.info(`Preparing update for CVM ${e.uuid}...`);let m=await Kd(o,{id:e.uuid,app_compose:c,update_env_vars:!!(r&&r.length>0)});if(!m.success)throw f.logDetailedError(m.error,"Provision CVM Compose File Update"),new Error(`Failed to provision cvm compose file: ${m.error.message}`);let u=m.data,p;if(a.kms_info?.chain_id){if(!e.privateKey)throw new Error("Private key is required for contract DstackApp");let h=await mv({chain:a.kms_info?.chain,rpcUrl:e.rpcUrl,appId:a.app_id,composeHash:u.compose_hash,privateKey:e.privateKey});if(!h.success){f.logDetailedError(h,"Add Compose Hash");let g=typeof h=="object"&&h!==null?JSON.stringify(h):String(h);throw new Error(`Failed to add compose hash: ${g}`)}if(r&&r.length>0){let g=a.kms_info?.slug||a.kms_info?.id;if(!g)throw new Error("KMS slug or id is required for decentralized KMS");let y=await jp(o,{app_id:a.app_id,kms:g});if(!y.success)throw f.logDetailedError(y.error,"Get App Env Encrypt PubKey"),new Error(`Failed to get app env encrypt pubkey: ${y.error.message}`);let x=y.data;p=await(0,rr.encryptEnvVars)(r,x.public_key)}}else if(r&&r.length>0){if(!a.encrypted_env_pubkey)throw new Error("CVM encrypted_env_pubkey is required for centralized KMS");p=await(0,rr.encryptEnvVars)(r,a.encrypted_env_pubkey)}let l={id:e.uuid,compose_hash:u.compose_hash,encrypted_env:p,env_keys:r?.length?r.map(h=>h.key):void 0,update_env_vars:r?.length?!0:void 0},d=await Wd(o,l);if(!d.success)throw f.logDetailedError(d.error,"Commit CVM Compose File Update"),new Error(`Failed to commit CVM compose file update: ${d.error.message}`);if(e.publicLogs!==void 0||e.publicSysinfo!==void 0){let h=await Qd(o,{id:e.uuid,public_logs:e.publicLogs??a.public_logs,public_sysinfo:e.publicSysinfo??a.public_sysinfo});h.success?f.info("CVM visibility settings updated"):f.warn(`Failed to update visibility: ${h.error.message}`)}if(e.wait){f.info("Waiting for update to complete...");try{await ll(e.uuid,3e5)}catch(h){throw f.logDetailedError(h,"Wait for CVM Ready"),new Error(`Wait failed: ${h instanceof Error?h.message:String(h)}`)}}e?.json!==!1?n.write(`${JSON.stringify({success:!0,vm_uuid:e.uuid,name:a.name,app_id:a.app_id,dashboard_url:`${xe}/dashboard/cvms/${e.uuid}`},null,2)}
`):n.write(`CVM compose file updated successfully!
`)};async function Mw(e,t){we(e.json||!1);try{let r=e.compose||t.projectConfig.compose_file,o=await EP({apiToken:e.apiToken,interactive:e.interactive}),n=await SP({dockerComposePath:r,interactive:e.interactive}),s={...e,env:e.env&&e.env.length>0?e.env:t.projectConfig.env_file?[t.projectConfig.env_file]:void 0},i=await _P(s);e.debug&&(console.log("[DEBUG] context.cvmId:",JSON.stringify(t.cvmId)),console.log("[DEBUG] input.cvmId:",e.cvmId));let a=t.cvmId?.id||t.cvmId?.uuid||t.cvmId?.app_id||t.cvmId?.instance_id;e.debug&&(console.log("[DEBUG] resolved uuid:",a),console.log("[DEBUG] isUpdate:",!!a)),!!a?await RP({...e,uuid:a},n,i,o,t.stdout):await $P(e,n,i??[],o,t.stdout,t.stderr,t.projectConfig)}catch(r){throw e.json!==!1?t.stderr.write(`${JSON.stringify({success:!1,error:r instanceof Error?r.message:String(r),stack:e.debug&&r instanceof Error?r.stack:void 0},null,2)}
`):t.stderr.write(`${fl`${r instanceof Error?r.message:String(r)}`}
`),r}}async function MP(e,t){try{return await Mw(e,t),0}catch{return 1}}var Bw=$({path:["deploy"],meta:Sw,schema:kw,handler:MP});import{z as n3}from"zod";var Fw={path:["docker"],meta:{name:"docker",description:"Login to Docker Hub and manage Docker images",stability:"unstable"}};import VP from"fs";import Vw from"path";import qw from"inquirer";import{exec as OP,spawn as UP}from"child_process";import bo from"fs";import Uw from"os";import pc from"path";import{promisify as zP}from"util";import{execa as HP}from"execa";import jP from"handlebars";import{INVALID as BP,ParseStatus as FP,ZodIssueCode as Vi,ZodParsedType as Dw,ZodType as DP,addIssueToContext as qi,z as Nw}from"zod";var NP="ZodDecimal",LP=/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/,Lw=class e extends DP{constructor(){super(...arguments);this.max=this.lte;this.min=this.gte}_parse(r){if(r.data!==null&&typeof r.data=="object"&&"toNumber"in r.data&&(r.data=r.data.toNumber()),this._def.coerce&&(r.data=Number(r.data)),this._getType(r)!==Dw.number){let i=this._getOrReturnCtx(r);return qi(i,{code:Vi.invalid_type,expected:Dw.number,received:i.parsedType}),BP}let n,s=new FP;for(let i of this._def.checks)if(i.kind==="precision"){let a=r.data.toString().match(LP);Math.max((a[1]?a[1].length:0)-(a[2]?Number.parseInt(a[2],10):0),0)>i.value&&(n=this._getOrReturnCtx(r,n),qi(n,{code:Vi.custom,message:i.message,params:{precision:i.value}}),s.dirty())}else i.kind==="wholeNumber"?r.data.toString().split(".")[0].length>i.value&&(n=this._getOrReturnCtx(r,n),qi(n,{code:Vi.custom,message:i.message,params:{wholeNumber:i.value}}),s.dirty()):i.kind==="min"?(i.inclusive?r.data<i.value:r.data<=i.value)&&(n=this._getOrReturnCtx(r,n),qi(n,{code:Vi.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?r.data>i.value:r.data>=i.value)&&(n=this._getOrReturnCtx(r,n),qi(n,{code:Vi.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="finite"&&(Number.isFinite(r.data)||(n=this._getOrReturnCtx(r,n),qi(n,{code:Vi.not_finite,message:i.message}),s.dirty()));return{status:s.value,value:r.data}}static{this.create=r=>new e({checks:[],typeName:NP,coerce:r?.coerce??!1})}setLimit(r,o,n,s){return new e({...this._def,checks:[...this._def.checks,{kind:r,value:o,inclusive:n,message:s}]})}_addCheck(r){return new e({...this._def,checks:[...this._def.checks,r]})}lte(r,o){return this.setLimit("max",r,!0,o)}lt(r,o){return this.setLimit("max",r,!1,o)}gt(r,o){return this.setLimit("min",r,!1,o)}gte(r,o){return this.setLimit("min",r,!0,o)}precision(r,o){return this._addCheck({kind:"precision",value:r,message:o})}wholeNumber(r,o){return this._addCheck({kind:"wholeNumber",value:r,message:o})}get minValue(){let r=null;for(let o of this._def.checks)o.kind==="min"&&(r===null||o.value>r)&&(r=o.value);return r}get maxValue(){let r=null;for(let o of this._def.checks)o.kind==="max"&&(r===null||o.value<r)&&(r=o.value);return r}positive(r){return this._addCheck({kind:"min",value:0,inclusive:!1,message:r})}negative(r){return this._addCheck({kind:"max",value:0,inclusive:!1,message:r})}nonpositive(r){return this._addCheck({kind:"max",value:0,inclusive:!0,message:r})}nonnegative(r){return this._addCheck({kind:"min",value:0,inclusive:!0,message:r})}finite(r){return this._addCheck({kind:"finite",message:r})}safe(r){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:r})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:r})}get isFinite(){let r=null,o=null;for(let n of this._def.checks){if(n.kind==="finite")return!0;n.kind==="min"?(o===null||n.value>o)&&(o=n.value):n.kind==="max"&&(r===null||n.value<r)&&(r=n.value)}return Number.isFinite(o)&&Number.isFinite(r)}},Ow=Nw.object({template:Nw.string().min(1,"Template cannot be empty")});var lc=zP(OP),zw=".phala-cloud/logs",GP=".phala-cloud/compose",Hw=10,At=class{constructor(t,r,o){this.image=t,this.username=r||"",this.registry=o||""}ensureLogsDir(){let t=pc.resolve(zw);bo.existsSync(t)||bo.mkdirSync(t,{recursive:!0})}getLogFilePath(t,r){let o=new Date().toISOString().replace(/[:.]/g,"-");return pc.resolve(zw,`${r||this.image}-${t}-${o}.log`)}getSystemArchitecture(){let t=Uw.arch();switch(t){case"arm":case"arm64":return"arm64";case"x64":return"amd64";default:return t}}spawnProcess(t,r,o,n){return new Promise((s,i)=>{let a=UP(t,r);this.ensureLogsDir();let c=this.getLogFilePath(o,n),m=bo.createWriteStream(c,{flags:"a"}),u=[],p=(l,d=!1)=>{let h=l.toString().split(`
`);m.write(l);for(let g of h)if(g.trim()){u.push(g),u.length>Hw&&u.shift(),console.clear(),console.log(`Latest ${Hw} lines (full log at ${c}):`),console.log("-".repeat(50));for(let y of u)d?console.error(y):console.log(y)}};a.stdout.on("data",l=>p(l)),a.stderr.on("data",l=>p(l,!0)),a.on("close",l=>{m.end(),l===0?(console.log(`
Operation completed. Full log available at: ${c}`),s()):i(new Error(`Process exited with code ${l}. Check log file: ${c}`))}),a.on("error",l=>{m.end(),i(l)})})}setCredentials(t,r){this.username=t,r&&(this.registry=r)}async buildImage(t,r){try{let o=this.getSystemArchitecture(),n=`${this.username}/${this.image}:${r}`,s=f.startSpinner(`Building Docker image ${this.username}/${this.image}:${r}`);Lt(t);let i=["build","-t",n,"-f",t];return o==="arm64"&&(console.log("Detected arm64 architecture, using --platform linux/amd64"),i.push("--platform","linux/amd64")),i.push("."),await this.spawnProcess("docker",i,"build",this.image),s.stop(!0,`Docker image ${n} built successfully`),!0}catch(o){return f.error(`Failed to build Docker image: ${o instanceof Error?o.message:String(o)}`),!1}}async pushImage(t){try{let r=f.startSpinner(`Pushing Docker image ${t} to Docker Hub`);if(!await po())throw r.stop(!1),new Error('Docker credentials not found. Please log in first with "phala docker login"');let n=t;return console.log(`Pushing image ${n} to Docker Hub...`),await this.spawnProcess("docker",["push",n],"push",t.replace(/.*\/+([\w-]+):.*$/g,"$1")),r.stop(!0,`Docker image ${n} pushed successfully`),!0}catch(r){return f.error(`Failed to push Docker image: ${r instanceof Error?r.message:String(r)}`),!1}}async login(t,r,o){try{let n=f.startSpinner(`Logging in to Docker Hub as ${t}`);if(await this.checkLogin())return n.stop(!0,"Already logged in to Docker Hub"),this.setCredentials(t,o),!0;if(!r)throw n.stop(!1),new Error("Password is required for Docker login");try{await HP("docker",["login",...o?[o]:[],"-u",t,"--password-stdin"],{input:r,timeout:1e4})}catch(i){throw i.timedOut?(n.stop(!1),new Error("Docker login timed out. Please check your credentials and try again.")):i}return n.stop(!0,"Logged in to Docker Hub successfully"),this.setCredentials(t,o),!0}catch(n){return f.error(`Failed to login to Docker Hub: ${n instanceof Error?n.message:String(n)}`),!1}}async checkLogin(){try{let t=Uw.homedir(),r=pc.join(t,".docker","config.json");if(!bo.existsSync(r))return!1;let o=JSON.parse(bo.readFileSync(r,"utf-8"));return!!(o?.auths&&Object.keys(o.auths).length>0)}catch(t){return f.debug(`Docker login check failed: ${t instanceof Error?t.message:String(t)}`),!1}}async buildComposeFile(t,r,o){if(!this.username)throw new Error("Docker Hub username is required for building compose file");let n=o==="eliza"?e6:t6,s=Ow.parse({template:n}),i=pc.resolve(GP);bo.existsSync(i)||(f.info(`Creating directory: ${i}`),bo.mkdirSync(i,{recursive:!0}));let a=[];r&&(a=bo.readFileSync(r,"utf-8").split(`
`).filter(d=>d&&!d.startsWith("#")).map(d=>{let h=d.indexOf("#");return h>0?d.substring(0,h).trim():d.trim()}).filter(d=>d.includes("=")).map(d=>{let[h,g]=d.split("=",2),y=h.trim();return(g?g.trim():"")===""?null:`${y}=${y}`}).filter(Boolean));let c=t,u=jP.compile(s.template,{noEscape:!0})({imageName:c,envVars:a.map(l=>l.replace(/=.*/,`=\${${l.split("=")[0]}}`))}),p=pc.join(i,`${t.replace(/.*\/+([\w-]+):.*$/g,"$1")}-tee-compose.yaml`);return bo.writeFileSync(p,u),f.success(`Backup of docker compose file created at: ${p}`),p}async runComposeLocally(t,r){try{let o=f.startSpinner(`Running Docker Compose file at ${t}`);Lt(t);let n=["-f",t,"up","-d"];return r&&(Lt(r),n.splice(2,0,"--env-file",r)),await lc(`docker compose ${n.join(" ")}`),o.stop(!0,"Docker Compose file running successfully"),!0}catch(o){return f.error(`Failed to run Docker Compose file: ${o instanceof Error?o.message:String(o)}`),!1}}async runSimulator(t,r){try{f.info(`Running TEE simulator with image ${t}`),f.info("Pulling latest simulator image..."),await lc(`docker pull ${t}`),f.info("Starting simulator in background...");let{stdout:o}=await lc(`docker run -d --name tee-simulator --rm -p ${r}:${r} ${t}`),n=o.trim();return f.success(`TEE simulator running successfully. Container ID: ${n}`),f.break(),f.break(),f.info("Useful commands:"),f.info(`- View logs: docker logs -f ${n}`),f.info(`- Stop simulator: docker stop ${n}`),I0(`http://localhost:${r}`),!0}catch(o){return f.error(`Failed to run TEE simulator: ${o instanceof Error?o.message:String(o)}`),!1}}async stopSimulator(){try{let t=f.startSpinner("Stopping TEE simulator...");return await lc("docker stop tee-simulator"),await jn(),t.stop(!0,"TEE simulator stopped successfully"),!0}catch(t){return f.error(`Failed to stop TEE simulator: ${t instanceof Error?t.message:String(t)}`),!1}}static async listLocalImages(){try{let{stdout:t}=await lc('docker images --format "{{.Repository}}:{{.Tag}}"'),o=(await po())?.username;return t.split(`
`).filter(s=>s&&!s.includes("<none>")).filter(s=>s.includes(`${o}/`)).map(s=>({imageName:s}))}catch(t){return f.error(`Failed to list local Docker images: ${t instanceof Error?t.message:String(t)}`),[]}}};import{z as hl}from"zod";var jw={name:"build",description:"Build a Docker image",stability:"unstable",options:[{name:"image",shorthand:"i",description:"Image name",type:"string",target:"image"},{name:"tag",shorthand:"t",description:"Image tag",type:"string",target:"tag"},{name:"file",shorthand:"f",description:"Path to Dockerfile",type:"string",target:"file"}],examples:[{name:"Build docker image with prompts",value:"phala docker build"},{name:"Build docker image with options",value:"phala docker build --image myapp --tag latest"}]},Gw=hl.object({image:hl.string().optional(),tag:hl.string().optional(),file:hl.string().default("Dockerfile")});async function qP(e,t){try{let r=await po();if(!r)return f.error('Docker information not found. Please login first with "phala docker login"'),1;let o=e.image;o||(o=(await qw.prompt([{type:"input",name:"image",message:"Enter the Docker image name:",validate:m=>m.trim()?!0:"Image name is required"}])).image);let n=e.tag;n||(n=(await qw.prompt([{type:"input",name:"tag",message:"Enter the Docker image tag:",default:"latest",validate:m=>m.trim()?!0:"Tag is required"}])).tag);let s=Vw.resolve(process.cwd(),e.file);if(!VP.existsSync(s)){f.info(`Default Dockerfile not found at ${s}`);let c=await lo("Enter the path to your Dockerfile:","Dockerfile","file");s=Vw.resolve(process.cwd(),c)}return await new At(o,r.username,r.registry).buildImage(s,n)?(f.success(`Docker image ${r.username}/${o}:${n} built successfully`),0):(f.error("Failed to build Docker image"),1)}catch(r){return f.error("Failed to build Docker image"),f.logDetailedError(r),1}}var Kw=$({path:["docker","build"],meta:jw,schema:Gw,handler:qP});import dc from"fs";import gl from"path";import hc from"inquirer";import{z as fc}from"zod";var Ww={name:"generate",description:"Generate a Docker Compose file",stability:"unstable",options:[{name:"image",shorthand:"i",description:"Docker image name to use in the compose file (e.g. phala/phala-cloud)",type:"string",target:"image"},{name:"env-file",shorthand:"e",description:"Path to environment variables file",type:"string",target:"envFile"},{name:"output",shorthand:"o",description:"Output path for generated docker-compose.yml",type:"string",target:"output"},{name:"template",description:"Template to use for the generated docker-compose.yml",type:"string",target:"template"}]},Jw=fc.object({image:fc.string().optional(),envFile:fc.string().optional(),output:fc.string().optional(),template:fc.string().optional()});async function KP(e){if(e)return e;let t=await At.listLocalImages();if(t.length===0)throw new Error('No local Docker images found. Please build an image first with "phala docker build"');let r=Array.from(new Set(t.map(n=>n.imageName))),{selectedImage:o}=await hc.prompt([{type:"list",name:"selectedImage",message:"Select an image to use in the compose file:",choices:r}]);return o}async function WP(e){if(e)return Lt(e),e;let t=gl.join(process.cwd(),".env");if(dc.existsSync(t)){let{useDefault:o}=await hc.prompt([{type:"confirm",name:"useDefault",message:"Use .env file in current directory?",default:!0}]);if(o)return t}let{envPath:r}=await hc.prompt([{type:"input",name:"envPath",message:"Enter path to environment variables file:",validate:o=>{try{return Lt(o),!0}catch{return`File not found: ${o}`}}}]);return r}async function JP(e){let t=e??gl.join(process.cwd(),"docker-compose.yml");if(dc.existsSync(t)){let{confirmOverwrite:o}=await hc.prompt([{type:"confirm",name:"confirmOverwrite",message:`File ${t} already exists. Overwrite?`,default:!1}]);if(!o){let{customPath:n}=await hc.prompt([{type:"input",name:"customPath",message:"Enter alternative output path:",default:gl.join(process.cwd(),"docker-generated-compose.yml")}]);t=n}}let r=gl.dirname(t);return dc.existsSync(r)||(f.info(`Creating directory: ${r}`),dc.mkdirSync(r,{recursive:!0})),t}async function ZP(e,t){try{let r=await po();if(!r||!r.username)throw new Error('Docker Hub username not found. Please login first with "phala docker login"');let o=await KP(e.image),n=await WP(e.envFile),s=await JP(e.output);n?f.info(`Generating Docker Compose file for ${o} using env file: ${n}`):f.info(`Generating Docker Compose file for ${o} without env file`);let a=await new At("",r.username,r.registry).buildComposeFile(o,n,e.template);return a!==s&&dc.copyFileSync(a,s),f.success(`Docker Compose file generated successfully: ${s}`),0}catch(r){return f.error("Failed to generate Docker Compose file"),f.logDetailedError(r),1}}var Zw=$({path:["docker","generate"],meta:Ww,schema:Jw,handler:ZP});import Qw from"prompts";import{z as yl}from"zod";var Yw={name:"login",description:"Login to Docker Hub",stability:"unstable",options:[{name:"username",shorthand:"u",description:"Docker Hub username",type:"string",target:"username"},{name:"password",shorthand:"p",description:"Docker Hub password",type:"string",target:"password"},{name:"registry",shorthand:"r",description:"Docker registry URL",type:"string",target:"registry"}]},Xw=yl.object({username:yl.string().optional(),password:yl.string().optional(),registry:yl.string().optional()});async function YP(e,t){try{let r=e.username,o=e.password,n=e.registry;if(!r){f.info("First we need your Docker Hub username to check if you are already logged in.");let c=await Qw({type:"text",name:"username",message:"Enter your Docker Hub username:",validate:m=>m.length>0?!0:"Username cannot be empty"});if(!c.username)return f.error("Username is required"),1;r=c.username}let s=new At("",r,n);if(await s.login(r))return f.success(`${r} is logged in to Docker Hub`),await s0({username:r,registry:n||null}),0;if(!o){let c=await Qw({type:"password",name:"password",message:"Enter your Docker Hub password:",validate:m=>m.length>0?!0:"Password cannot be empty"});if(!c.password)return f.error("Password is required"),1;o=c.password}return await s.login(r,o,n)?(await s0({username:r,registry:n||null}),f.success("Logged in to Docker Hub successfully"),0):(f.error("Failed to login to Docker Hub"),1)}catch(r){return f.error("Failed to login to Docker Hub"),f.logDetailedError(r),1}}var e5=$({path:["docker","login"],meta:Yw,schema:Xw,handler:YP});import XP from"inquirer";import{z as t5}from"zod";var r5={name:"push",description:"Push a Docker image to Docker Hub",stability:"unstable",options:[{name:"image",shorthand:"i",description:"Full image name (e.g. username/image:tag)",type:"string",target:"image"}]},o5=t5.object({image:t5.string().optional()});async function QP(e){if(e)return e;let t=await At.listLocalImages();if(t.length===0)throw new Error('No local Docker images found. Please build an image first with "phala docker build"');let r=Array.from(new Set(t.map(n=>n.imageName))),{selectedImage:o}=await XP.prompt([{type:"list",name:"selectedImage",message:"Select an image to push:",choices:r}]);return o}async function e3(e,t){try{let r=await po();if(!r)throw new Error('Docker information not found. Please login first with "phala docker login"');let o=await QP(e.image);return await new At("",r.username,r.registry).pushImage(o)?(f.success(`Docker image ${o} pushed successfully`),0):(f.error("Failed to push Docker image"),1)}catch(r){return f.error("Failed to push Docker image"),f.logDetailedError(r),1}}var n5=$({path:["docker","push"],meta:r5,schema:o5,handler:e3});import a5 from"fs";import c5 from"path";import xl from"inquirer";import{z as bl}from"zod";var s5={name:"run",description:"Run a Docker Compose setup",stability:"unstable",options:[{name:"compose",shorthand:"c",description:"Path to docker-compose.yml file",type:"string",target:"compose"},{name:"env-file",shorthand:"e",description:"Path to environment variables file",type:"string",target:"envFile"},{name:"skip-env",description:"Skip environment variables file prompt",type:"boolean",target:"skipEnv"}]},i5=bl.object({compose:bl.string().optional(),envFile:bl.string().optional(),skipEnv:bl.boolean().default(!0)});async function t3(e){if(e)return Lt(e),e;let t=c5.join(process.cwd(),"docker-compose.yml");if(a5.existsSync(t)){let{useDefault:o}=await xl.prompt([{type:"confirm",name:"useDefault",message:"Use docker-compose.yml in current directory?",default:!0}]);if(o)return t}let{composePath:r}=await xl.prompt([{type:"input",name:"composePath",message:"Enter path to docker-compose.yml file:",validate:o=>{try{return Lt(o),!0}catch{return"File not found"}}}]);return r}async function r3(e,t){if(t)return e;if(e)return Lt(e),e;let r=c5.join(process.cwd(),".env");if(a5.existsSync(r)){let{useDefault:n}=await xl.prompt([{type:"confirm",name:"useDefault",message:"Use .env file in current directory?",default:!0}]);if(n)return r}let{envPath:o}=await xl.prompt([{type:"input",name:"envPath",message:"Enter path to environment variables file:",validate:n=>{try{return Lt(n),!0}catch{return`File not found: ${n}`}}}]);return o}async function o3(e,t){try{let r=await t3(e.compose),o=await r3(e.envFile,e.skipEnv),n=new At("");return o?(f.info(`Validating env file: ${o}`),Lt(o),f.info(`Running Docker Compose with compose file: ${r} and env file: ${o}`)):f.info(`Running Docker Compose with compose file: ${r} without env file`),await n.runComposeLocally(r,o)?(f.success("Docker Compose is running"),0):(f.error("Failed to run Docker Compose"),1)}catch(r){return f.error("Failed to run Docker Compose"),f.logDetailedError(r),1}}var m5=$({path:["docker","run"],meta:s5,schema:i5,handler:o3});var s3={name:"docker",description:"Login to Docker Hub and manage Docker images",stability:"unstable"},i3=n3.object({});async function a3(e,t){return t.stdout.write(`Available docker subcommands: login, build, push, generate, run. Use 'phala docker <command> --help' for details.
`),0}var c3=$({path:["docker"],meta:s3,schema:i3,handler:a3}),N0={group:Fw,commands:[c3,e5,Kw,n5,Zw,m5]};import z0 from"path";import h5 from"fs-extra";import xo from"chalk";import U0 from"inquirer";import Ki from"chalk";import m3 from"open";import u3 from"ora";import p3 from"prompts";import{z as vl}from"zod";var u5={name:"login",description:"Authenticate with Phala Cloud",stability:"stable",arguments:[{name:"api-key",description:"API key for authentication (optional, triggers device flow if not provided)",required:!1,target:"apiKey"}],options:[{name:"manual",description:"Manually enter API key instead of using device flow",type:"boolean"},{name:"no-open",description:"Don't automatically open browser for device flow",type:"boolean"}]},p5=vl.object({apiKey:vl.string().min(1,"API key cannot be empty").optional(),manual:vl.boolean().optional(),noOpen:vl.boolean().optional()});function l3(e){let{detail:t}=e;if(t&&typeof t=="object"&&!Array.isArray(t)){let r=t;if(r.error&&typeof r.error=="string")return{error:r.error,error_description:typeof r.error_description=="string"?r.error_description:void 0}}return null}async function L0(e){try{await Wp(e);let t=await Jp(e),r=await uo(t),o=r.data;if(!r.success||!o?.username)throw await jr(),new Error("Invalid API key");return o}catch(t){throw await jr(),t instanceof Error?t:new Error(String(t))}}async function f3(){let e,t=await p3({type:"password",name:"apiKey",message:"Enter your API key:",validate:async r=>{if(!r||r.trim().length===0)return"API key cannot be empty";try{return e=await L0(r),!0}catch(o){return o instanceof Error?o.message:"Invalid API key"}}});if(!t.apiKey)throw new Error("API key input cancelled");return e||(e=await L0(t.apiKey)),{apiKey:t.apiKey,user:e}}async function d3(e){let t=Le({useCookieAuth:!0}),r=await t.post("/auth/device/code",{client_id:"phala-cli",scope:"user:profile cvms:* nodes:*"}),{device_code:o,user_code:n,verification_uri_complete:s,interval:i,expires_in:a}=r;if(console.log(),console.log(Ki.bold("To authenticate, visit:")),console.log(Ki.cyan(s)),console.log(),console.log(Ki.bold("And enter code:"),Ki.yellow(n)),console.log(),!e.noOpen)try{await m3(s),console.log("Opening browser automatically...")}catch{console.warn("Could not open browser automatically. Please visit the URL above.")}let c=u3("Waiting for authorization...").start(),m=Date.now()+a*1e3;for(;Date.now()<m;){await new Promise(u=>setTimeout(u,i*1e3));try{let u=await t.post("/auth/device/token",{device_code:o,grant_type:"urn:ietf:params:oauth:grant-type:device_code"});return c.succeed("Authorization successful!"),u.access_token}catch(u){if(u instanceof Up){let p=l3(u);if(p)switch(p.error){case"authorization_pending":continue;case"expired_token":throw c.fail("Authorization expired"),new Error(p.error_description||"Device authorization expired. Please try again.");case"access_denied":throw c.fail("Authorization denied"),new Error(p.error_description||"You denied the authorization request.");default:throw c.fail("Authorization failed"),new Error(`Authorization failed: ${p.error_description||p.error}`)}}throw c.fail("Request failed"),u}}throw c.fail("Authorization timed out"),new Error("Authorization timed out. Please try again.")}async function wl(e,t){try{let r,o;if(e.apiKey)r=e.apiKey;else if(e.manual){let n=await f3();r=n.apiKey,o=n.user}else r=await d3({noOpen:e.noOpen});if(o||(o=await L0(r)),!o)throw new Error("Failed to validate API key");return console.log(Ki.green(`Welcome ${o.username}! API key validated and saved successfully`)),0}catch(r){return console.error(Ki.red(`Failed to authenticate: ${r instanceof Error?r.message:String(r)}`)),1}}var l5=$({path:["login"],meta:u5,schema:p5,handler:wl});import{z as O0}from"zod";var h3={name:"json",shorthand:"j",description:"Output in JSON format",type:"boolean",target:"json",negatedName:"no-json"},f5={name:"link",description:"Link a local directory to a CVM",stability:"unstable",arguments:[{name:"cvm-id",description:"CVM ID or name to link (optional, interactive if not provided)",required:!1,target:"cvmId"}],options:[h3],examples:[{name:"Link to a CVM by name or ID",value:"phala link my-cvm-name"},{name:"Link to an existing CVM interactively",value:"phala link"}]},d5=O0.object({cvmId:O0.string().optional(),json:O0.boolean().default(!1)});function g3(e){return e!==null&&typeof e=="object"&&"name"in e&&e.name==="ExitPromptError"}function g5(){let e=["docker-compose.yml","docker-compose.yaml"];for(let t of e)if(h5.existsSync(z0.join(process.cwd(),t)))return t}function y5(){let e=".env.production";if(h5.existsSync(z0.join(process.cwd(),e)))return e}async function b5(e){let t=_t();if(!t){if(f.info(`Not authenticated. Starting login flow...
`),await wl({manual:!1,noOpen:!1},e)!==0||(t=_t(),!t))return null;console.log()}let r=Le({apiKey:t}),o=await uo(r);if(o.success){let n=o.data;f.success(`Authenticated as ${n.username}`),console.log()}else{if(f.info(`API key expired or invalid. Starting login flow...
`),await wl({manual:!1,noOpen:!1},e)!==0||(t=_t(),!t))return null;console.log()}return t}function x5(e,t,r){let o={name:e};t&&(o.compose_file=t),r&&(o.env_file=r),fv(o),console.log(),console.log(xo.bold("Created phala.toml:")),console.log(xo.dim(`  name = "${e}"`)),t&&console.log(xo.dim(`  compose_file = "${t}"`)),r&&console.log(xo.dim(`  env_file = "${r}"`)),console.log(),f.success("Project linked successfully!"),f.info('Run "phala deploy" to update your CVM.')}async function y3(e,t){we(e.json);try{return e.cvmId?await b3(e.cvmId,t):await x3(t)}catch(r){if(g3(r))return console.log(),f.info("Link cancelled."),0;throw r}}async function b3(e,t){let r=await b5(t);if(!r)return t.fail("Authentication failed."),1;let o=Le({apiKey:r}),n=await Se(o,{id:e});if(!n.success)return t.fail(`CVM not found: ${e}`),1;let i=n.data.name||e;if(f.success(`Found CVM: ${i}`),qp()){let{overwrite:m}=await U0.prompt([{type:"confirm",name:"overwrite",message:"phala.toml already exists. Overwrite?",default:!1}]);if(!m)return f.info("Link cancelled."),0}let a=g5(),c=y5();return(a||c)&&(console.log(),f.info("Detected local files:"),a&&console.log(xo.green(`  \u2713 ${a}`)),c&&console.log(xo.green(`  \u2713 ${c}`))),x5(i,a,c),0}async function x3(e){let t=await b5(e);if(!t)return e.fail("Authentication failed."),1;let r=f.startSpinner("Fetching your CVMs..."),o=Le({apiKey:t}),n=await Ln(o);if(r.stop(!0),!n.success)return e.fail(`Failed to fetch CVMs: ${n.error.message}`),1;let i=n.data.items??[];if(i.length===0)return f.warn("You don't have any CVMs yet."),f.info('Deploy your first CVM with "phala deploy"'),0;let a=z0.basename(process.cwd()),c=i.map(d=>{let h=d.hosted?.app_id||d.hosted?.id||"",g=d.name||d.hosted?.name||"Unnamed",y=d.status||d.hosted?.status||"Unknown";return{name:`${g} (${h}) - Status: ${y}`,value:g,cvmName:g}}),m=c.findIndex(d=>d.cvmName.toLowerCase()===a.toLowerCase());console.log(xo.bold(`Found ${i.length} CVM(s):
`));let{selectedCvm:u}=await U0.prompt([{type:"list",name:"selectedCvm",message:"Select a CVM to link:",choices:c.map(d=>({name:d.name,value:d.value})),default:m>=0?m:0}]);if(qp()){let{overwrite:d}=await U0.prompt([{type:"confirm",name:"overwrite",message:"phala.toml already exists. Overwrite?",default:!1}]);if(!d)return f.info("Link cancelled."),0}let p=g5(),l=y5();return console.log(),(p||l)&&(f.info("Detected local files:"),p&&console.log(xo.green(`  \u2713 ${p}`)),l&&console.log(xo.green(`  \u2713 ${l}`)),console.log()),x5(u,p,l),0}var v5=$({path:["link"],meta:f5,schema:d5,handler:y3});import{z as v3}from"zod";var w5={name:"logout",description:"Remove the stored API key",stability:"stable"},C5=v3.object({});async function w3(e,t){try{return await jr(),f.success("API key removed successfully"),0}catch(r){return f.error("Failed to remove API key"),f.logDetailedError(r),1}}var E5=$({path:["logout"],meta:w5,schema:C5,handler:w3});var S5={path:["nodes"],meta:{name:"nodes",description:"List and manage TEE nodes",stability:"unstable"}};import{z as k5}from"zod";var I5={name:"list",aliases:["ls"],description:"List all available worker nodes",stability:"unstable",options:[{name:"json",description:"Output in JSON format",type:"boolean"}]},H0=k5.object({json:k5.boolean().optional().default(!1)});async function _5(e,t){we(e.json);try{let r=await K(),o=await Qa(r);if(!o.success)return t.fail(o.error.message),1;let{nodes:n,kms_list:s}=o.data;if(e.json)return t.success({nodes:n,kms_list:s}),0;if(!n||n.length===0)return f.info("No available nodes found."),0;f.info("Available Nodes:");for(let i of n)if(f.info("----------------------------------------"),f.info(`  ID:          ${i.teepod_id}`),f.info(`  Name:        ${i.name}`),f.info(`  Region:      ${i.region_identifier}`),f.info(`  FMSPC:       ${i.fmspc||"N/A"}`),f.info(`  Device ID:   ${i.device_id||"N/A"}`),f.info(`  Support Onchain KMS: ${i.support_onchain_kms}`),f.info("  Images:"),i.images&&i.images.length>0)for(let a of i.images)f.info(`    - ${a.name}`),f.info(`      Hash: ${a.os_image_hash||"N/A"}`);else f.info("    N/A");if(s&&s.length>0){f.info("\\nAvailable KMS Instances:");for(let i of s)f.info("----------------------------------------"),f.info(`  Slug:               ${i.slug}`),f.info(`  URL:                ${i.url}`),f.info(`  Version:            ${i.version}`),i.chain_id&&(f.info(`  Chain ID:           ${i.chain_id}`),f.info(`  Contract Address:   ${i.kms_contract_address}`),f.info(`  Gateway App ID:     ${i.gateway_app_id}`))}return 0}catch(r){return t.fail(`Failed to list available nodes: ${r instanceof Error?r.message:String(r)}`),1}}var C3={name:"nodes",description:"List and manage TEE nodes",stability:"unstable"},A5=$({path:["nodes","list"],meta:I5,schema:H0,handler:_5}),P5=$({path:["nodes"],meta:C3,schema:H0,handler:_5});var j0={group:S5,commands:[P5,A5]};import{z as I3}from"zod";var T5={path:["simulator"],meta:{name:"simulator",description:"TEE simulator commands",stability:"unstable"}};import{z as G0}from"zod";var $5={name:"start",description:"Start the TEE simulator",stability:"unstable",options:[{name:"port",shorthand:"p",description:"Simulator port (default: 8090)",type:"string",target:"port"},{name:"verbose",shorthand:"v",description:"Enable verbose output",type:"boolean",target:"verbose"}]},R5=G0.object({port:G0.string().default("8090"),verbose:G0.boolean().default(!1)});async function E3(e,t){try{return T6()||await $6(),await mc()?(f.success("TEE simulator is already running"),0):(await R6({verbose:e.verbose}),f.success("TEE simulator started successfully"),0)}catch(r){return f.error("Failed to start TEE simulator"),f.logDetailedError(r),1}}var M5=$({path:["simulator","start"],meta:$5,schema:R5,handler:E3});import{z as S3}from"zod";var B5={name:"stop",description:"Stop the TEE simulator",stability:"unstable"},F5=S3.object({});async function k3(e,t){try{return await M6()?(f.success("TEE simulator stopped successfully"),0):(f.error("Failed to stop TEE simulator"),1)}catch(r){return f.error("Failed to stop TEE simulator"),f.logDetailedError(r),1}}var D5=$({path:["simulator","stop"],meta:B5,schema:F5,handler:k3});var _3={name:"simulator",description:"TEE simulator commands",stability:"unstable"},A3=I3.object({});async function P3(e,t){try{let r=await mc(),o=cl();if(r&&o){let s=k0(),i=s.replace(/dstack\.sock$/,"tappd.sock");t.stdout.write(`\u2713 TEE simulator is running (PID: ${o})\\n`),t.stdout.write(`
Set these environment variables to use the simulator:
`),t.stdout.write(`  export DSTACK_SIMULATOR_ENDPOINT=${s}\\n`),t.stdout.write(`  export TAPPD_SIMULATOR_ENDPOINT=${i}\\n`)}else t.stdout.write(`TEE simulator is not running\\n
`),t.stdout.write(`To start the simulator, run:
`),t.stdout.write("  phala simulator start\\n");return 0}catch(r){return t.stderr.write(`Error checking simulator status: ${r instanceof Error?r.message:String(r)}\\n`),1}}var T3=$({path:["simulator"],meta:_3,schema:A3,handler:P3}),V0={group:T5,commands:[T3,M5,D5]};import{z as Wi}from"zod";import{readFileSync as B3}from"fs";import{dirname as F3,join as D3}from"path";import{fileURLToPath as N3}from"url";function N5(e,t,r){switch(t){case"bash":return $3(e,r);case"zsh":return R3(e,r);case"fish":return M3(e,r)}}function $3(e,t){let r=t?`
    # Version check (once per day)
    local completion_version="${t}"
    local check_file=~/."${e}"/completion-check
    local today=$(date +%Y%m%d)

    if [[ ! -f "$check_file" ]] || [[ "$(cat "$check_file" 2>/dev/null)" != "$today" ]]; then
        local cli_version=$(${e} --version 2>/dev/null | grep -oE '[0-9]+\\.[0-9]+\\.[0-9]+' | head -1)

        if [[ -n "$cli_version" ]] && [[ "$cli_version" != "$completion_version" ]]; then
            echo "" >&2
            echo "\u26A0\uFE0F  ${e} completion is outdated" >&2
            echo "   CLI version: v$cli_version" >&2
            echo "   Completion version: v$completion_version" >&2
            echo "   Update with: ${e} completion --shell bash > ~/."${e}"_completion && source ~/."${e}"_completion" >&2
            echo "" >&2
        fi

        mkdir -p ~/."${e}"
        echo "$today" > "$check_file"
    fi
`:"";return`
# ${e} bash completion${t?`
# Generated for CLI version: ${t}`:""}

_${e}_completions() {
    local cur="\${COMP_WORDS[COMP_CWORD]}"
    local prev="\${COMP_WORDS[COMP_CWORD-1]}"
    local line="\${COMP_LINE}"
${r}
    # Call the CLI's completion endpoint
    local completions=$( ${e} __complete -- "\${line}" "\${cur}" 2>/dev/null )

    COMPREPLY=( $(compgen -W "$completions" -- "$cur") )
}

complete -F _${e}_completions ${e}
`.trim()}function R3(e,t){let r=t?`
    # Version check (once per day)
    local completion_version="${t}"
    local check_file=~/."${e}"/completion-check
    local today=$(date +%Y%m%d)

    if [[ ! -f "$check_file" ]] || [[ "$(cat "$check_file" 2>/dev/null)" != "$today" ]]; then
        local cli_version=$(${e} --version 2>/dev/null | grep -oE '[0-9]+\\.[0-9]+\\.[0-9]+' | head -1)

        if [[ -n "$cli_version" ]] && [[ "$cli_version" != "$completion_version" ]]; then
            echo "" >&2
            echo "\u26A0\uFE0F  ${e} completion is outdated" >&2
            echo "   CLI version: v$cli_version" >&2
            echo "   Completion version: v$completion_version" >&2
            echo "   Update with: ${e} completion --shell zsh > ~/."${e}"_completion && source ~/."${e}"_completion" >&2
            echo "" >&2
        fi

        mkdir -p ~/."${e}"
        echo "$today" > "$check_file"
    fi
`:"";return`
#compdef ${e}${t?`
# Generated for CLI version: ${t}`:""}

_${e}() {
    local line state
${r}
    _arguments -C \\
        "1: :->cmds" \\
        "*::arg:->args"

    case $state in
        cmds)
            local completions=$( ${e} __complete -- "\${words[@]}" "\${words[CURRENT]}" 2>/dev/null )
            _describe 'command' completions
            ;;
        args)
            local completions=$( ${e} __complete -- "\${words[@]}" "\${words[CURRENT]}" 2>/dev/null )
            _describe 'argument' completions
            ;;
    esac
}

_${e}
`.trim()}function M3(e,t){let r=t?`
    # Version check (once per day)
    set -l completion_version "${t}"
    set -l check_file ~/."${e}"/completion-check
    set -l today (date +%Y%m%d)

    if not test -f $check_file; or test (cat $check_file 2>/dev/null) != $today
        set -l cli_version (${e} --version 2>/dev/null | grep -oE '[0-9]+\\.[0-9]+\\.[0-9]+' | head -1)

        if test -n "$cli_version"; and test "$cli_version" != "$completion_version"
            echo "" >&2
            echo "\u26A0\uFE0F  ${e} completion is outdated" >&2
            echo "   CLI version: v$cli_version" >&2
            echo "   Completion version: v$completion_version" >&2
            echo "   Update with: ${e} completion --shell fish > ~/.config/fish/completions/${e}.fish" >&2
            echo "" >&2
        end

        mkdir -p ~/."${e}"
        echo $today > $check_file
    end
`:"";return`
# ${e} fish completion${t?`
# Generated for CLI version: ${t}`:""}

function __${e}_complete
    set -l line (commandline -cp)
    set -l token (commandline -ct)
${r}
    ${e} __complete -- $line $token 2>/dev/null
end

complete -c ${e} -f -a "(__${e}_complete)"
`.trim()}function L3(){try{let e=N3(import.meta.url),t=F3(e),r=D3(t,"../package.json");return JSON.parse(B3(r,"utf-8")).version}catch{return"unknown"}}var O3={name:"__complete",description:"Internal command for shell completion",stability:"stable",arguments:[{name:"line",description:"Full command line",required:!0},{name:"fragment",description:"Current word being completed",required:!0}]},U3=Wi.object({line:Wi.string(),fragment:Wi.string()});async function z3(e,t){return t.stdout.write(`
`),0}var wpe=$({path:["__complete"],meta:O3,schema:U3,handler:z3}),H3={name:"completion",description:"Generate shell completion scripts",stability:"stable",options:[{name:"shell",type:"string",description:"Shell type (bash, zsh, fish)"},{name:"fig",type:"boolean",description:"Generate Fig/Amazon Q completion spec"}]},j3=Wi.object({shell:Wi.enum(["bash","zsh","fish"]).optional(),fig:Wi.boolean().optional()});async function G3(e,t){if(e.fig)return t.stdout.write(`Fig spec generation requires registry access. See fig-spec.ts for implementation.
`),0;let r=e.shell||V3();if(!r)return t.stderr.write(`Could not detect shell. Please specify with --shell (bash, zsh, or fish)
`),1;let o=L3(),n=N5("phala",r,o);switch(t.stdout.write(`# Add this to your shell configuration file:

`),t.stdout.write(`${n}

`),t.stdout.write(`# Installation instructions:
`),r){case"bash":t.stdout.write(`# For bash, add to ~/.bashrc:
`),t.stdout.write(`#   phala completion --shell bash >> ~/.bashrc
`),t.stdout.write(`#   source ~/.bashrc
`);break;case"zsh":t.stdout.write(`# For zsh, add to ~/.zshrc:
`),t.stdout.write(`#   phala completion --shell zsh >> ~/.zshrc
`),t.stdout.write(`#   source ~/.zshrc
`);break;case"fish":t.stdout.write(`# For fish, run:
`),t.stdout.write(`#   phala completion --shell fish > ~/.config/fish/completions/phala.fish
`);break}return 0}function V3(){let e=process.env.SHELL||"";return e.includes("bash")?"bash":e.includes("zsh")?"zsh":e.includes("fish")?"fish":null}var L5=$({path:["completion"],meta:H3,schema:j3,handler:G3});import{spawn as X3}from"child_process";import Q3 from"chalk";import{execSync as q3}from"child_process";import{existsSync as O5,readFileSync as K3}from"fs";import{homedir as gc,platform as W3}from"os";import{basename as J3,join as yc}from"path";import U5 from"chalk";var Vn=class extends Error{constructor(r,o){super(`CVM is not running (current status: ${U5.yellow(r)})`);this.status=r;this.cvmId=o;this.name="CvmNotRunningError"}},qn=class extends Error{constructor(r){super("CVM is not registered on any gateway.");this.cvmId=r;this.name="NoGatewayError"}};function Cl(e){let t=e.lastIndexOf(":");if(t>0){let r=e.substring(t+1);if(/^\d+$/.test(r))return{host:e.substring(0,t),port:r}}return{host:e}}function q0(){let e=[yc(gc(),".ssh","id_rsa"),yc(gc(),".ssh","id_ed25519"),yc(gc(),".ssh","id_ecdsa"),yc(gc(),".ssh","id_dsa")];for(let t of e)if(O5(t))return t}function z5(e){if(e){let t=e.startsWith("~")?yc(gc(),e.slice(1)):e;if(!O5(t))throw new Error(`SSH key file not found: ${t}`);return t}return q0()}function El(e){return e?e.toLowerCase().includes("dev"):!1}async function Sl(e,t){let r=await e.getCvmInfo({id:t});if(!r.gateway_domain)throw new qn(t);if(r.status!=="running")throw new Vn(r.status,t);return{appId:r.app_id,gatewayDomain:r.gateway_domain,status:r.status,baseImage:r.base_image}}function kl(e,t){return`${e}-22.${t}`}function Il(e,t){return e!=="443"?e:t||"443"}function _l(e){return/^[a-zA-Z0-9_./:@=-]+$/.test(e)?e:`'${e.replace(/'/g,"'\\''")}'`}function Z3(){try{return q3("openssl version",{encoding:"utf-8"}).toLowerCase().includes("libressl")}catch{return!1}}function Y3(e){if(J3(e).toLowerCase().includes("ed25519"))return!0;try{let r=K3(e,"utf-8");return r.includes("ssh-ed25519")||r.includes("ED25519")}catch{return!1}}function Al(e){W3()==="darwin"&&Z3()&&Y3(e)&&(f.warn("Detected LibreSSL with ed25519 key on macOS. This combination may cause SSH connection issues."),f.info(`If\xB7you\xB7experience\xB7problems,\xB7install\xB7OpenSSL\xB7via\xB7Homebrew:\xB7${U5.cyan("brew\xB7install\xB7openssl")}`),f.info("Then ensure Homebrew's OpenSSL is in your PATH before /usr/bin"))}function Pl(e,t){return["-o",`ProxyCommand=${e?"openssl s_client -quiet -connect %h:%p":"openssl s_client -quiet -connect %h:%p 2>/dev/null"}`,"-o","StrictHostKeyChecking=no","-o","UserKnownHostsFile=/dev/null","-o",`ConnectTimeout=${t}`]}import{z as vo}from"zod";var H5={name:"ssh",description:"Connect to a CVM via SSH",stability:"unstable",arguments:[{name:"cvm-name",description:"CVM name. If not provided, reads from phala.toml",required:!1,target:"cvmId"}],options:[{name:"port",shorthand:"p",description:"Gateway port. Priority: CLI option > phala.toml gateway_port > 443",type:"string",target:"port"},{name:"gateway",shorthand:"g",description:"Gateway domain. Priority: CLI option > phala.toml gateway_domain > API. When specified, skips API call for offline usage",type:"string",target:"gatewayDomain"},{name:"timeout",shorthand:"t",description:"Connection timeout in seconds (default: 30)",type:"string",target:"timeout"},{name:"verbose",shorthand:"v",description:"Show verbose connection details",type:"boolean",target:"verbose"},{name:"dry-run",description:"Print the SSH command without executing it",type:"boolean",target:"dryRun"}],passThrough:{description:"All arguments after -- are passed directly to ssh. Common options: -i (identity file), -L (local forward), -R (remote forward), -D (SOCKS proxy), -N (no command), -v (ssh verbose). Any trailing arguments are executed as remote command. Note: -o ProxyCommand is blocked.",examples:["-- -L 8080:localhost:80","-- -i ~/.ssh/key -D 1080 -N","-- ls -la /app"]},examples:[{name:"Connect using configuration from phala.toml",value:"phala ssh"},{name:"Connect to a specific CVM (queries API for gateway)",value:"phala ssh app_123"},{name:"Offline mode: connect without API (using phala.toml gateway)",value:"phala ssh app_123 -g dstack-pha-prod7.phala.network -p 16185"},{name:"Connect with custom SSH key",value:"phala ssh app_123 -- -i ~/.ssh/custom_key"},{name:"Forward local port 8080 to remote port 80",value:"phala ssh app_123 -- -L 8080:localhost:80"},{name:"SOCKS proxy without remote command",value:"phala ssh app_123 -- -D 1080 -N"},{name:"Execute remote command",value:"phala ssh app_123 -- ls -la /app"},{name:"Connect with verbose output for debugging",value:"phala ssh app_123 -v"},{name:"Print the SSH command without executing",value:"phala ssh app_123 --dry-run -- -L 8080:localhost:80"}]},j5=vo.object({cvmId:vo.string().optional(),port:vo.string().default("443"),gatewayDomain:vo.string().optional(),timeout:vo.string().default("30"),verbose:vo.boolean().default(!1),dryRun:vo.boolean().default(!1),"--":vo.array(vo.string()).optional()});function eT(e){for(let t=0;t<e.length;t++){let r=e[t];if(r==="-o"&&t+1<e.length&&e[t+1].toLowerCase().startsWith("proxycommand")||r.toLowerCase().startsWith("-oproxycommand"))return"-o ProxyCommand"}return null}async function tT(e,t){try{let r=t.cvmId?.id||t.cvmId?.uuid||t.cvmId?.app_id||t.cvmId?.instance_id;if(!r)return f.error(`No CVM ID provided. Either pass a CVM ID as argument or configure it in phala.toml.
Supported fields: id, uuid, app_id, or instance_id`),1;let o=e["--"]??[],n=eT(o);if(n)return f.error(`${n} is not allowed as it would break the TLS gateway connection.`),1;let s=e.gatewayDomain??t.projectConfig.gateway_domain,i=e.port!=="443"?e.port:t.projectConfig.gateway_port?.toString()??"443",a,c;if(s)c=s,a=r.startsWith("app_")?r.substring(4):r;else try{let b=await K(),v=await Sl(b,r);a=v.appId,c=v.gatewayDomain,El(v.baseImage)||f.warn("This CVM is not using a dev image. SSH access may not be available.")}catch(b){return b instanceof qn?f.error(b.message):b instanceof Vn?(f.error(b.message),f.info("Please start the CVM first using: phala cvms start")):f.error(b instanceof Error?b.message:"Failed to fetch CVM info"),1}let m=Cl(c),u=Il(i,m.port),p=kl(a,m.host),l=q0();l&&Al(l),e.verbose&&f.info(`Connecting to ${Q3.cyan(p)}:${u}...`);let d=Pl(e.verbose,e.timeout),{options:h,command:g}=rT(o),y=[];if(e.verbose&&y.push("-v"),y.push(...d,"-p",u,...h,`root@${p}`,...g),e.dryRun){let b=y.map(v=>_l(v));return t.stdout.write(`ssh ${b.join(" ")}
`),0}let x=X3("ssh",y,{stdio:"inherit"});return x.on("error",b=>{f.break(),f.error(`SSH connection failed: ${b.message}`)}),new Promise(b=>{x.on("close",v=>{f.break(),v===0?(f.success("Connection closed"),b(0)):(f.error(`Connection failed with code ${v}`),b(v??1))})})}catch(r){return f.error("Failed to connect via SSH"),r instanceof Error?f.error(r.message):f.error(String(r)),1}}function rT(e){let t=[],r=[],o=new Set(["-b","-c","-D","-E","-e","-F","-I","-i","-J","-L","-l","-m","-O","-o","-P","-p","-R","-S","-W","-w"]),n=0,s=!1;for(;n<e.length;){let i=e[n];if(s){r.push(i),n++;continue}if(i.startsWith("-")){t.push(i);let a=i.length===2?i:i.slice(0,2);o.has(a)&&i.length===2&&n+1<e.length&&(n++,t.push(e[n])),n++}else s=!0,r.push(i),n++}return{options:t,command:r}}var G5=$({path:["ssh"],meta:H5,schema:j5,handler:tT});import{spawn as oT}from"child_process";import K0 from"chalk";import{z as wo}from"zod";var V5={name:"cp",description:"Copy files to/from a CVM via SCP",stability:"unstable",arguments:[{name:"source",description:"Source path. Local file or remote in format 'cvm-name:path'. Use ':path' to read cvm_id from phala.toml",required:!0,target:"source"},{name:"destination",description:"Destination path. Local file or remote in format 'cvm-name:path'. Use ':path' to read cvm_id from phala.toml",required:!0,target:"destination"}],options:[{name:"identity",shorthand:"i",description:"SSH identity file (private key)",type:"string",target:"identity"},{name:"port",shorthand:"p",description:"SSH port. Priority: CLI option > phala.toml gateway_port > 443",type:"string",target:"port"},{name:"gateway",shorthand:"g",description:"Gateway domain. Priority: CLI option > phala.toml gateway_domain > API. When specified, skips API call for offline usage",type:"string",target:"gatewayDomain"},{name:"recursive",shorthand:"r",description:"Recursively copy directories",type:"boolean",target:"recursive"},{name:"verbose",shorthand:"v",description:"Show verbose SCP details",type:"boolean",target:"verbose"},{name:"dry-run",description:"Print the SCP command without executing it",type:"boolean",target:"dryRun"}],examples:[{name:"Upload using phala.toml cvm_id",value:"phala cp ./local.txt :/root/remote.txt"},{name:"Upload to a specific CVM (queries API for gateway)",value:"phala cp ./local.txt app_123:/root/remote.txt"},{name:"Download from CVM",value:"phala cp app_123:/root/remote.txt ./local.txt"},{name:"Offline mode: copy without API (using phala.toml gateway)",value:"phala cp -g dstack-pha-prod7.phala.network -p 16185 ./file.txt app_123:/root/"},{name:"Upload directory recursively",value:"phala cp -r ./local_dir app_123:/root/remote_dir"},{name:"Copy with custom SSH key",value:"phala cp -i ~/.ssh/custom_key app_123:/root/file.txt ./file.txt"},{name:"Print the SCP command without executing",value:"phala cp ./local.txt app_123:/root/remote.txt --dry-run"}]},q5=wo.object({source:wo.string(),destination:wo.string(),identity:wo.string().optional(),port:wo.string().default("443"),gatewayDomain:wo.string().optional(),recursive:wo.boolean().default(!1),verbose:wo.boolean().default(!1),dryRun:wo.boolean().default(!1)});function K5(e){let t=e.match(/^([^:]+):(.+)$/);return t?{isRemote:!0,cvmId:t[1],path:t[2]}:{isRemote:!1,path:e}}async function nT(e,t){try{let r=K5(e.source),o=K5(e.destination);if(r.isRemote===o.isRemote)return f.error("Either source or destination must be a remote path in format: cvm-id:path"),f.info("Examples:"),f.info("  phala cp ./local.txt app_123:/root/remote.txt"),f.info("  phala cp app_123:/root/remote.txt ./local.txt"),1;let n=r.isRemote?r:o,s;if(n.cvmId?s=dv(n.cvmId):s=t.cvmId?.id||t.cvmId?.uuid||t.cvmId?.app_id||t.cvmId?.instance_id,!s)return f.error(`No CVM ID provided. Either use format cvm-id:path or configure it in phala.toml.
Supported fields: id, uuid, app_id, or instance_id`),1;let i=e.gatewayDomain??t.projectConfig.gateway_domain,a=e.port!=="443"?e.port:t.projectConfig.gateway_port?.toString()??"443",c,m;if(i)m=i,c=s.startsWith("app_")?s.substring(4):s;else try{let k=await K(),I=await Sl(k,s);c=I.appId,m=I.gatewayDomain,El(I.baseImage)||f.warn("This CVM is not using a dev image. SCP access may not be available.")}catch(k){return k instanceof qn?f.error(k.message):k instanceof Vn?(f.error(k.message),f.info("Please start the CVM first using: phala cvms start")):f.error(k instanceof Error?k.message:"Failed to fetch CVM info"),1}let u=Cl(m),p=Il(a,u.port),l=kl(c,u.host),d=z5(e.identity);d?Al(d):f.warn("No default SSH key found. SCP will use ssh-agent or prompt for password."),e.verbose&&f.info(`Connecting to ${K0.cyan(l)}:${p}...`);let g=[...Pl(e.verbose,"30"),"-P",p];e.verbose&&g.unshift("-v"),d&&g.push("-i",d),e.recursive&&g.push("-r");let y=r.isRemote?`root@${l}:${r.path}`:r.path,x=o.isRemote?`root@${l}:${o.path}`:o.path;if(g.push(y,x),e.dryRun){let k=g.map(I=>_l(I));return t.stdout.write(`scp ${k.join(" ")}
`),0}let b=r.isRemote?"download":"upload",v=r.isRemote?o.path:r.path,E=r.isRemote?r.path:o.path;f.info(`${b==="upload"?"Uploading":"Downloading"} ${K0.cyan(v)} ${b==="upload"?"to":"from"} ${K0.cyan(E)}...`);let A=oT("scp",g,{stdio:"inherit"});return A.on("error",k=>{f.break(),f.error(`SCP failed: ${k.message}`)}),new Promise(k=>{A.on("close",I=>{f.break(),I===0?(f.success(`${b==="upload"?"Upload":"Download"} completed`),k(0)):(f.error(`Transfer failed with code ${I}`),k(I??1))})})}catch(r){return f.error("Failed to copy file via SCP"),r instanceof Error&&f.error(r.message),1}}var W5=$({path:["cp"],meta:V5,schema:q5,handler:nT});var J5={path:["self"],meta:{name:"self",description:"Self management commands",stability:"unstable"}};import uT from"prompts";import{execa as pT}from"execa";import lT from"semver";import{z as Ji}from"zod";var sT={name:"json",shorthand:"j",description:"Output in JSON format",type:"boolean",target:"json",negatedName:"no-json"},iT={name:"yes",shorthand:"y",description:"Skip confirmation prompt",type:"boolean",target:"yes"},aT={name:"dry-run",description:"Print the update command without executing it",type:"boolean",target:"dryRun"},cT={name:"package-manager",description:"Override package manager (npm|pnpm|yarn|bun)",type:"string",target:"packageManager",aliases:["pm"],argumentName:"name"},mT={name:"channel",description:"Release channel/dist-tag (e.g. latest, beta, next)",type:"string",target:"channel",argumentName:"tag"},Z5={name:"update",description:"Update the Phala CLI",stability:"unstable",options:[sT,iT,aT,cT,mT],examples:[{name:"Update CLI",value:"phala self update"},{name:"Dry run (print command)",value:"phala self update --dry-run"},{name:"Use beta channel",value:"phala self update --channel beta"}]},Y5=Ji.object({json:Ji.boolean().default(!1),yes:Ji.boolean().default(!1),dryRun:Ji.boolean().default(!1),packageManager:Ji.enum(["npm","pnpm","yarn","bun"]).optional(),channel:Ji.string().regex(/^[A-Za-z0-9][A-Za-z0-9._-]*$/).optional()});function bc(e){return typeof e=="string"&&e.trim().length>0}function fT(e){if(typeof e!="object"||e===null||!("code"in e))return;let t=e.code;return typeof t=="string"?t:void 0}function dT(e){let r=lT.parse(e)?.prerelease?.[0];return typeof r=="string"&&r.length>0?r:void 0}function hT(e,t,r,o){let n=[],s=o instanceof Error&&typeof o.message=="string"?o.message:String(o),i=fT(o);(/permission denied|eacces|not permitted/i.test(s)||o instanceof Error&&(i==="EACCES"||i==="EPERM"))&&n.push(`Permission error while running "${r}". Ensure your global install prefix is writable (avoid sudo if possible).`),/command not found|not recognized as an internal|ENOENT/i.test(s)&&n.push(`Package manager "${t}" not found. Install it or rerun with --package-manager npm|pnpm|yarn|bun.`);let a=e.NVM_DIR;t==="npm"&&bc(a)&&n.push(`Detected nvm (NVM_DIR=${a}). Make sure the intended Node version is active (e.g. "nvm use <version>") and your npm global bin is on PATH.`);let c=e.FNM_DIR;return t==="npm"&&bc(c)&&n.push(`Detected fnm (FNM_DIR=${c}). Ensure your shell has fnm env loaded (e.g. eval "$(fnm env)") so the correct node/npm are on PATH.`),n}function gT(e,t,r){if(bc(e))return e.trim();if(bc(r.PHALA_UPDATE_CHANNEL))return r.PHALA_UPDATE_CHANNEL;let o=Ui("updateCheckChannel");return bc(o)?o:dT(t)??"latest"}async function yT(e,t){we(e.json);let r=t.cli?.packageName??"phala",o=t.cli?.runtime??Qp(),n=e.packageManager??sc(t.env,o),s=t.cli?.packageVersion??"0.0.0",i=gT(e.channel,s,t.env),a=i==="latest"?`${r}@latest`:`${r}@${i}`,c=ic(n,a),{command:m,args:u}=Lv(n,a);if(e.json&&e.dryRun)return t.success({command:c,dryRun:!0}),0;if(e.dryRun)return t.stdout.write(`${c}
`),0;let p=t.stderr.isTTY===!0&&e.json!==!0;if(!e.yes&&!p){let d=`Non-interactive session detected. Re-run with --yes to apply the update, or use --dry-run to print the command.
`;return e.json?(t.success({command:c,ran:!1,reason:"nonInteractive"}),0):(t.stderr.write(d),1)}if(!(e.yes||await uT({type:"confirm",name:"ok",message:`Run "${c}"?`,initial:!0}).then(d=>d.ok===!0)))return e.json&&t.success({command:c,ran:!1}),0;try{return await pT(m,u,{stdio:"inherit"}),e.json?(t.success({command:c,ran:!0}),0):(f.success("Update completed"),0)}catch(d){let h=hT(t.env,n,c,d);if(f.logDetailedError(d),t.fail("Self update failed",{command:c,hints:h.length>0?h:void 0}),!e.json&&h.length>0)for(let g of h)f.info(g);return 1}}var X5=$({path:["self","update"],meta:Z5,schema:Y5,handler:yT});var W0={group:J5,commands:[X5]};var CT=wT(import.meta.url),ET=xT(CT),ST=vT(ET,"../package.json"),Tl=JSON.parse(bT(ST,"utf-8")),kT="+ba64170",IT=`v${Tl.version}${kT}`,_T=Qp(),ve=new rl;ve.registerCommand(Xv);ve.registerCommand(m6);ve.registerCommand(Bw);ve.registerCommand(v5);ve.registerCommand(l5);ve.registerCommand(E5);ve.registerCommand(L5);ve.registerCommand(G5);ve.registerCommand(W5);ve.registerGroup(W0.group);for(let e of W0.commands)ve.registerCommand(e);ve.registerGroup(b0.group);for(let e of b0.commands)ve.registerCommand(e);ve.registerGroup(v0.group);for(let e of v0.commands)ve.registerCommand(e);ve.registerGroup(D0.group);for(let e of D0.commands)ve.registerCommand(e);ve.registerGroup(N0.group);for(let e of N0.commands)ve.registerCommand(e);ve.registerGroup(j0.group);for(let e of j0.commands)ve.registerCommand(e);ve.registerGroup(V0.group);for(let e of V0.commands)ve.registerCommand(e);process.on("SIGINT",()=>process.exit(0));process.on("SIGTERM",()=>process.exit(0));async function AT(){let e=await Vv({registry:ve,argv:process.argv.slice(2),executableName:Tl.name??"phala",version:IT,packageName:Tl.name??"phala",packageVersion:Tl.version,runtime:_T,cwd:process.cwd(),env:process.env,stdout:process.stdout,stderr:process.stderr,stdin:process.stdin});process.exit(e)}AT().catch(e=>{console.error("An error occurred:",e),process.exit(1)});
/*! Bundled license information:

@noble/hashes/esm/utils.js:
@noble/hashes/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
//# sourceMappingURL=index.js.map