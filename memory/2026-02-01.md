## 13:05-13:20 - Ephemeral Sandbox Refactor ðŸ”„

**CRITICAL CLARIFICATION from Andrew:**
> "it shouldn't store the dataset, just apply it"

**What I built first (WRONG âŒ):**
- Data registry with LLM claims
- Upload dataset â†’ Store it â†’ Run multiple queries
- "I HAVE this data" model
- Data retention risk

**What Andrew wanted (CORRECT âœ…):**
- Ephemeral sandbox execution
- Load dataset â†’ Run once â†’ Delete â†’ Keep certificate
- "I RAN this computation" model
- Zero retention

**Core concept:**
> "Verifiable one-time computation over private data"

Like GitHub Actions: ephemeral execution, permanent logs.

### Refactored Implementation

**New architecture:**
```
INPUTS (one-time):
â”œâ”€ Private dataset (ephemeral, never stored)
â”œâ”€ Sandbox spec (LLM prompt + tools)
â””â”€ API key

EXECUTION (in TEE):
â”œâ”€ Load dataset â†’ memory ONLY
â”œâ”€ Spawn sandbox
â”œâ”€ LLM runs, uses tools
â”œâ”€ Log everything
â”œâ”€ Generate certificate
â”œâ”€ DELETE dataset
â””â”€ Destroy sandbox

OUTPUT (permanent):
â”œâ”€ Execution certificate
â”œâ”€ Result
â”œâ”€ Proof
â””â”€ Dataset: GONE
```

**Single API endpoint:**
- `POST /execute` - One-shot execution (no storage)
- `GET /certificate/:id` - View proof
- `GET /certificate/:id/verify` - Cryptographic verification

**Key difference:**
- OLD: Store dataset, run multiple queries
- NEW: Run once, delete data, keep proof

### Files Created
- `server/ephemeral-sandbox.js` (270 lines) - Execution engine
- `server/server-ephemeral.js` (140 lines) - New server
- `ARCHITECTURE-EPHEMERAL.md` (450 lines) - Full design
- `README-EPHEMERAL.md` (200 lines) - Updated docs
- `examples/ephemeral-demo.sh` (120 lines) - Demo script
- `REFACTOR-NOTES.md` (200 lines) - What changed

**Total new code:** ~1,380 lines

### Example Flow

**Compliance check:**
```bash
POST /execute
{
  "dataset": {"data": "<private patient records>"},
  "sandbox": {
    "llm": {
      "prompt": "Scan for PII: names, SSN, email",
      "api_key": "sk-ant-..."
    },
    "tools": ["python", "grep"]
  }
}

# TEE does:
1. Load records â†’ memory
2. Run PII scanner
3. Log: "Scanned 10,000 records, 0 PII found"
4. Generate certificate
5. DELETE records
6. Destroy sandbox

# Returns:
{
  "certificate_id": "cert_xyz",
  "result": {"output": "No PII found"},
  "lifecycle": {
    "dataset_deleted": true,
    "sandbox_destroyed": true
  }
}
```

### Why This Matters

**Solves different problem:**
- Not "I have this data" (registry)
- But "I ran this computation" (proof)

**Benefits:**
- Zero data retention â†’ No storage attacks
- One-shot execution â†’ No inference attacks
- Simpler security model
- Matches actual use case

**Use cases:**
1. Research: "My model achieves 95% accuracy" (prove without test data)
2. Compliance: "Dataset has no PII" (certify without exposure)
3. Quality: "Data is <1% missing" (assess without revealing)
4. Benchmarking: "Engagement is 47%" (claim without customer data)
5. Info Bazaar: "Data relevant to query X" (prove value before purchase)

### Status

âœ… **Refactor complete**
- Old model deprecated (kept for reference)
- New ephemeral model implemented
- Demo script ready
- Architecture documented

**Next:** Test with real Anthropic API key, commit, deploy

---

**Key lesson:** Always clarify the core concept before building!

I spent 2+ hours on the wrong model (registry).  
Andrew's one sentence clarified everything: "just apply it"  
Refactored in 1 hour to the correct model (ephemeral).

**The model:** Disposable sandbox, permanent proof. ðŸ¦žðŸ”
